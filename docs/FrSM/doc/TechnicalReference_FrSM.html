---
layout: default
title: TechnicalReference_FrSM
nav_order: 2
parent: FlexRay State Manager
---
{% raw %}
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
     "http://www.w3.org/TR/html4/transitional.dtd">
<html>
<head>

  <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
  <title></title>
  <meta name="generator" content="LibreOffice 24.2.7.2 (Linux)"/>
  <meta name="created" content="00:00:00"/>
  <meta name="changed" content="00:00:00"/>
</head>
<body>
<h1></h1>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><b>MICROSAR FlexRay State Manager </b></p>
<p>Technical Reference </p>
<p> </p>
<p>  </p>
<p>Version 1.2.0 </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Authors </p>
<p>Mark A. Fingerle </p>
<p>Status </p>
<p>Released </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>2 </p>
<p>based on template version 4.9.2 </p>
<p><b>Document Information </b></p>
<p><b>History </b></p>
<p><b>Author </b></p>
<p><b>Date </b></p>
<p><b>Version </b></p>
<p><b>Remarks </b></p>
<p>Mark A. Fingerle </p>
<p>2012-08-08 </p>
<p>1.0.0 </p>
<p>Creation from scratch </p>
<p>Mark A. Fingerle </p>
<p>2014-10-13 </p>
<p>1.1.0 </p>
<p>ESCAN00076761 Post-Build Selectable  </p>
<p>(Identity Manager) support 6.1.3 </p>
<p>ESCAN00075457 Add support for delayed </p>
<p>FlexRay communication cluster shutdown </p>
<p>3.3.8, 6.2.5 </p>
<p>ESCAN00079339 Description BCD-coded </p>
<p>return-value of GetVersionInfo() </p>
<p>Mark A. Fingerle </p>
<p>2016-05-13 </p>
<p>1.2.0 </p>
<p>Add missing API 5.2.8 </p>
<p>FrSM_SetEcuPassive </p>
<p>FEAT-2724 Handle several FlexRay </p>
<p>clusters Table 3-1  </p>
<p>Supported AUTOSAR </p>
<p>standard conform features, Table 3-2   Not </p>
<p>supported AUTOSAR standard conform </p>
<p>features </p>
<p><b>Reference Documents </b></p>
<p><b>No. </b></p>
<p><b>Source </b></p>
<p><b>Title </b></p>
<p><b>Version </b></p>
<p>[1] </p>
<p> AUTOSAR </p>
<p>Specification of FlexRay State Manager </p>
<p>2.2.0 </p>
<p>[2] </p>
<p> AUTOSAR </p>
<p>Specification of Development Error Tracer </p>
<p>3.2.0 </p>
<p>[3] </p>
<p> AUTOSAR </p>
<p>Specification of Diagnostics Event Manager </p>
<p>4.2.0 </p>
<p>[4] </p>
<p> AUTOSAR </p>
<p>List of Basic Software Modules </p>
<p>1.6.0 </p>
<p>[5] </p>
<p> AUTOSAR </p>
<p>Specification of FlexRay Interface </p>
<p>3.3.0 </p>
<p>[6] </p>
<p> AUTOSAR </p>
<p>Specification of Communication Manager </p>
<p>4.0.0 </p>
<p>[7] </p>
<p> AUTOSAR </p>
<p>Specification of Basic Software Mode Manager </p>
<p>1.2.0 </p>
<p><b>Scope of the Document </b></p>
<p>This  technical  reference  describes the  general  use  of  the  FlexRay  State  Manager  basis </p>
<p>software. All aspects which are FlexRay controller specific are described in the technical </p>
<p>reference of the FlexRay Interface, which is also part of the delivery. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>We have configured the programs in accordance with your specifications in the </p>
<p>questionnaire. Whereas the programs do support other configurations than the one </p>
<p>specified in your questionnaire, Vector’s release of the programs delivered to your </p>
<p>company is expressly restricted to the configuration you have specified in the </p>
<p>questionnaire. </p>
<p><b> </b></p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>3 </p>
<p>based on template version 4.9.2 </p>
<p><b>Contents </b></p>
<p><b>1</b></p>
<p> </p>
<p><b>Component History ...................................................................................................... 6</b></p>
<p> </p>
<p><b>2</b></p>
<p> </p>
<p><b>Introduction................................................................................................................... 7</b></p>
<p> </p>
<p>2.1</p>
<p> </p>
<p>Architecture Overview ........................................................................................ 7</p>
<p> </p>
<p><b>3</b></p>
<p> </p>
<p><b>Functional Description ................................................................................................. 9</b></p>
<p> </p>
<p>3.1</p>
<p> </p>
<p>Features ............................................................................................................ 9</p>
<p> </p>
<p>3.2</p>
<p> </p>
<p>Initialization ...................................................................................................... 10</p>
<p> </p>
<p>3.3</p>
<p> </p>
<p>State Machine .................................................................................................. 11</p>
<p> </p>
<p>3.3.1</p>
<p> </p>
<p>Meta States FullCom / NoCom ......................................................... 12</p>
<p> </p>
<p>3.3.2</p>
<p> </p>
<p>FRSM_INITIAL ................................................................................. 12</p>
<p> </p>
<p>3.3.3</p>
<p> </p>
<p>FRSM_STARTUP / FRSM_WAKEUP / FRSM_READY ................... 12</p>
<p> </p>
<p>3.3.4</p>
<p> </p>
<p>FRSM_WAKEUP, Send Multiple Wake-Up Pattern ........................... 13</p>
<p> </p>
<p>3.3.5</p>
<p> </p>
<p>FRSM_STATE_ONLINE ................................................................... 13</p>
<p> </p>
<p>3.3.6</p>
<p> </p>
<p>FRSM_KEY_SLOT_ONLY ............................................................... 14</p>
<p> </p>
<p>3.3.7</p>
<p> </p>
<p>FRSM_STATE_ONLINE_PASSIVE .................................................. 14</p>
<p> </p>
<p>3.3.8</p>
<p> </p>
<p>FRSM_STATE_HALT_REQ ............................................................. 14</p>
<p> </p>
<p>3.3.9</p>
<p> </p>
<p>Startup Monitoring (FRSM_STARTUP / FRSM_WAKEUP / </p>
<p>FRSM_STATE_HALT_REQ) ............................................................ 14</p>
<p> </p>
<p>3.4</p>
<p> </p>
<p>Main Functions ................................................................................................ 15</p>
<p> </p>
<p>3.4.1</p>
<p> </p>
<p>Communication Modes .................................................................... 15</p>
<p> </p>
<p>3.4.2</p>
<p> </p>
<p>Communication Mode Polling ........................................................... 15</p>
<p> </p>
<p>3.5</p>
<p> </p>
<p>Error Handling .................................................................................................. 15</p>
<p> </p>
<p>3.5.1</p>
<p> </p>
<p>Development Error Reporting ........................................................... 15</p>
<p> </p>
<p>3.5.2</p>
<p> </p>
<p>Production Code Error Reporting ..................................................... 16</p>
<p> </p>
<p><b>4</b></p>
<p> </p>
<p><b>Integration ................................................................................................................... 18</b></p>
<p> </p>
<p>4.1</p>
<p> </p>
<p>Scope of Delivery ............................................................................................. 18</p>
<p> </p>
<p>4.1.1</p>
<p> </p>
<p>Static Files ....................................................................................... 18</p>
<p> </p>
<p>4.1.2</p>
<p> </p>
<p>Dynamic Files .................................................................................. 18</p>
<p> </p>
<p>4.2</p>
<p> </p>
<p>Include Structure .............................................................................................. 19</p>
<p> </p>
<p>4.3</p>
<p> </p>
<p>Compiler Abstraction and Memory Mapping ..................................................... 19</p>
<p> </p>
<p>4.4</p>
<p> </p>
<p>Critical Sections ............................................................................................... 20</p>
<p> </p>
<p><b>5</b></p>
<p> </p>
<p><b>API Description ........................................................................................................... 22</b></p>
<p> </p>
<p>5.1</p>
<p> </p>
<p>Type Definitions ............................................................................................... 22</p>
<p> </p>
<p>5.2</p>
<p> </p>
<p>Services Provided by FrSM .............................................................................. 23</p>
<p> </p>
<p>5.2.1</p>
<p> </p>
<p>FrSM_InitMemory ............................................................................ 23</p>
<p> </p>
<p>5.2.2</p>
<p> </p>
<p>FrSM_Init ......................................................................................... 23</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>4 </p>
<p>based on template version 4.9.2 </p>
<p>5.2.3</p>
<p> </p>
<p>FrSM_MainFunction_&lt;Cluster Id&gt; .................................................... 24</p>
<p> </p>
<p>5.2.4</p>
<p> </p>
<p>FrSM_RequestComMode................................................................. 24</p>
<p> </p>
<p>5.2.5</p>
<p> </p>
<p>FrSM_GetCurrentComMode ............................................................ 25</p>
<p> </p>
<p>5.2.6</p>
<p> </p>
<p>FrSM_GetVersionInfo ....................................................................... 25</p>
<p> </p>
<p>5.2.7</p>
<p> </p>
<p>FrSM_AllSlots .................................................................................. 26</p>
<p> </p>
<p>5.2.8</p>
<p> </p>
<p>FrSM_SetEcuPassive ...................................................................... 26</p>
<p> </p>
<p>5.3</p>
<p> </p>
<p>Services Used by FrSM ................................................................................... 27</p>
<p> </p>
<p><b>6</b></p>
<p> </p>
<p><b>AUTOSAR Standard Compliance............................................................................... 29</b></p>
<p> </p>
<p>6.1</p>
<p> </p>
<p>Additions/ Extensions ....................................................................................... 29</p>
<p> </p>
<p>6.1.1</p>
<p> </p>
<p>API FrSM_InitMemory() ................................................................... 29</p>
<p> </p>
<p>6.1.2</p>
<p> </p>
<p>Configuration Options ...................................................................... 29</p>
<p> </p>
<p>6.1.3</p>
<p> </p>
<p>Post-Build Selectable (Identity Manager) ......................................... 29</p>
<p> </p>
<p>6.2</p>
<p> </p>
<p>Limitations........................................................................................................ 29</p>
<p> </p>
<p>6.2.1</p>
<p> </p>
<p>Controllers ....................................................................................... 29</p>
<p> </p>
<p>6.2.2</p>
<p> </p>
<p>Shy of Coldstarter ............................................................................ 29</p>
<p> </p>
<p>6.2.3</p>
<p> </p>
<p>Configuration Class .......................................................................... 29</p>
<p> </p>
<p>6.2.4</p>
<p> </p>
<p>No Dual Channel Wake-up Echo ...................................................... 29</p>
<p> </p>
<p>6.2.5</p>
<p> </p>
<p>Delayed FlexRay transceiver deactivation at Shutdown ................... 29</p>
<p> </p>
<p><b>7</b></p>
<p> </p>
<p><b>Glossary and Abbreviations ...................................................................................... 30</b></p>
<p> </p>
<p>7.1</p>
<p> </p>
<p>Glossary .......................................................................................................... 30</p>
<p> </p>
<p>7.2</p>
<p> </p>
<p>Abbreviations ................................................................................................... 30</p>
<p> </p>
<p><b>8</b></p>
<p> </p>
<p><b>Contact ........................................................................................................................ 32</b></p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>5 </p>
<p>based on template version 4.9.2 </p>
<p><b>Illustrations </b></p>
<p>Figure 2-1</p>
<p> </p>
<p>AUTOSAR architecture ............................................................................... 7</p>
<p> </p>
<p>Figure 2-2</p>
<p> </p>
<p>Interfaces to adjacent modules of the FrSM ................................................ 8</p>
<p> </p>
<p>Figure 3-1</p>
<p> </p>
<p>State machine of the FrSM ....................................................................... 11</p>
<p> </p>
<p>Figure 4-1</p>
<p> </p>
<p>Include structure ....................................................................................... 19</p>
<p> </p>
<p><b> </b></p>
<p><b>Tables </b></p>
<p>Table 1-1 </p>
<p> </p>
<p>Component History ..................................................................................... 6</p>
<p> </p>
<p>Table 3-1 </p>
<p> </p>
<p>Supported AUTOSAR standard conform features ....................................... 9</p>
<p> </p>
<p>Table 3-2 </p>
<p> </p>
<p>Not supported AUTOSAR standard conform features ................................. 9</p>
<p> </p>
<p>Table 3-3 </p>
<p> </p>
<p>Features provided beyond the AUTOSAR standard .................................. 10</p>
<p> </p>
<p>Table 3-4 </p>
<p> </p>
<p>Service IDs ............................................................................................... 16</p>
<p> </p>
<p>Table 3-5 </p>
<p> </p>
<p>Errors reported to Det ............................................................................... 16</p>
<p> </p>
<p>Table 3-6 </p>
<p> </p>
<p>Errors reported to Dem ............................................................................. 17</p>
<p> </p>
<p>Table 4-1 </p>
<p> </p>
<p>Static files ................................................................................................. 18</p>
<p> </p>
<p>Table 4-2 </p>
<p> </p>
<p>Generated files ......................................................................................... 18</p>
<p> </p>
<p>Table 4-3 </p>
<p> </p>
<p>Compiler abstraction and memory mapping .............................................. 20</p>
<p> </p>
<p>Table 5-1 </p>
<p> </p>
<p>Type definitions ......................................................................................... 23</p>
<p> </p>
<p>Table 5-2 </p>
<p> </p>
<p>FrSM_InitMemory ..................................................................................... 23</p>
<p> </p>
<p>Table 5-3 </p>
<p> </p>
<p>FrSM_Init .................................................................................................. 24</p>
<p> </p>
<p>Table 5-4 </p>
<p> </p>
<p>FrSM_MainFunction_&lt;Cluster Id&gt; ............................................................ 24</p>
<p> </p>
<p>Table 5-5 </p>
<p> </p>
<p>FrSM_RequestComMode ......................................................................... 25</p>
<p> </p>
<p>Table 5-6 </p>
<p> </p>
<p>FrSM_GetCurrentComMode ..................................................................... 25</p>
<p> </p>
<p>Table 5-7 </p>
<p> </p>
<p>FrSM_GetVersionInfo ............................................................................... 26</p>
<p> </p>
<p>Table 5-8 </p>
<p> </p>
<p>FrSM_AllSlots ........................................................................................... 26</p>
<p> </p>
<p>Table 5-9 </p>
<p> </p>
<p>FrSM_SetEcuPassive ............................................................................... 27</p>
<p> </p>
<p>Table 5-10 </p>
<p> </p>
<p>Services used by the FrSM ....................................................................... 28</p>
<p> </p>
<p>Table 7-1 </p>
<p> </p>
<p>Glossary ................................................................................................... 30</p>
<p> </p>
<p>Table 7-2 </p>
<p> </p>
<p>Abbreviations ............................................................................................ 31</p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>6 </p>
<p>based on template version 4.9.2 </p>
<p><b>1 </b></p>
<p><b>Component History </b></p>
<p>The </p>
<p>component </p>
<p>history </p>
<p>gives </p>
<p>an </p>
<p>overview </p>
<p>over </p>
<p>the </p>
<p>important </p>
<p>milestones </p>
<p>that </p>
<p>are </p>
<p>supported in the different versions of the component.  </p>
<p><b>Component Version </b></p>
<p><b>New Features </b></p>
<p>1.0.0 </p>
<p>Creation according to AUTOSAR 4.0.3 </p>
<p>Table 1-1  </p>
<p>Component History </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>7 </p>
<p>based on template version 4.9.2 </p>
<p><b>2 </b></p>
<p><b>Introduction </b></p>
<p>This document describes the functionality, API and configuration of the AUTOSAR BSW </p>
<p>module FrSM as specified in [1].  </p>
<p> </p>
<p><b>Supported AUTOSAR Release*: </b></p>
<p>4 </p>
<p><b>Supported Configuration Variants: </b></p>
<p>pre-compile, Post-Build Selectable </p>
<p><b>Vendor ID: </b></p>
<p>FRSM_VENDOR_ID </p>
<p>30 decimal </p>
<p>(= Vector-Informatik, </p>
<p>according to HIS) </p>
<p><b>Module ID: </b></p>
<p>FRSM_MODULE_ID   </p>
<p>142 decimal </p>
<p>(according to ref. [4]) </p>
<p>* For the precise AUTOSAR Release 4.x please see the release specific documentation.  </p>
<p> </p>
<p>The FlexRay State Manager (FrSM) realizes a software layer between the Communication </p>
<p>Manager  (ComM)  and  the  FlexRay  Interface  (FrIf).  The  FrSM  handles  the  startup  and </p>
<p>shutdown of the communication of a FlexRay cluster. The FrSM maps the FrIf states to the </p>
<p>states of the ComM and causes the necessary actions to change the FrIf state to these </p>
<p>requested  by  the  ComM.  The  main  function  of  the  FrSM  is  cyclically  called  by  the </p>
<p>Schedule Manager (SchM). </p>
<p><b>2.1 </b></p>
<p><b>Architecture Overview </b></p>
<p>The following figure shows where the FrSM is located in the AUTOSAR architecture. </p>
<p> </p>
<p>Figure 2-1 </p>
<p>AUTOSAR architecture </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>8 </p>
<p>based on template version 4.9.2 </p>
<p>The next figure shows the interfaces to adjacent modules of the  FrSM. These interfaces </p>
<p>are described in chapter 5. </p>
<p> </p>
<p>Figure 2-2 </p>
<p>Interfaces to adjacent modules of the FrSM </p>
<p>Applications do not access the services of the BSW modules directly. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>9 </p>
<p>based on template version 4.9.2 </p>
<p><b>3 </b></p>
<p><b>Functional Description </b></p>
<p><b>3.1 </b></p>
<p><b>Features </b></p>
<p>The features listed in the following tables cover the complete functionality specified for the </p>
<p>FrSM. </p>
<p>The AUTOSAR  standard  functionality  is  specified  in  [1],  the  corresponding  features  are </p>
<p>listed in the tables </p>
<p><b>&gt; </b></p>
<p>Table 3-1   Supported AUTOSAR standard conform features  </p>
<p><b>&gt; </b></p>
<p>Table 3-2   Not supported AUTOSAR standard conform features </p>
<p>For further information of not supported features see also chapter 6. </p>
<p>Vector Informatik provides further FrSM functionality beyond the AUTOSAR standard. The </p>
<p>corresponding features are listed in the table </p>
<p><b>&gt; </b></p>
<p>Table 3-3   Features provided beyond the AUTOSAR standard </p>
<p> </p>
<p>The following features specified in [1] are supported: </p>
<p><b>Supported AUTOSAR Standard Conform Features </b></p>
<p>Translation of network communication mode requests </p>
<p>Output of current network communication modes (Polling and Callback) </p>
<p>Control of peripherals (Fr Transceivers, Fr Controllers) </p>
<p>Handle the Network mode via a separate state machine per network </p>
<p>Error classification, detection and notification </p>
<p>Handle several FlexRay clusters </p>
<p>Table 3-1  </p>
<p>Supported AUTOSAR standard conform features </p>
<p>The following features specified in [1] are not supported:  </p>
<p><b>Category </b></p>
<p><b>Description </b></p>
<p><b>ASR </b></p>
<p><b>Version </b></p>
<p>Functional </p>
<p>Several controllers per cluster. </p>
<p>4.0.3 </p>
<p>Functional </p>
<p>Low number of coldstarters neither detection nor handling </p>
<p>4.0.3 </p>
<p>Config </p>
<p>Change networks and controllers via Post-build configuration. </p>
<p>4.0.3 </p>
<p>Config </p>
<p>Configuration variant “link-time”. </p>
<p>4.0.3 </p>
<p>Table 3-2  </p>
<p>Not supported AUTOSAR standard conform features </p>
<p>The following features are provided beyond the AUTOSAR standard: </p>
<p><b>Features Provided Beyond The AUTOSAR Standard </b></p>
<p>It’s possible to deactivate the Dem at pre-compile time, like Det. </p>
<p>MICROSAR Identity Manager using Post-Build Selectable </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>10 </p>
<p>based on template version 4.9.2 </p>
<p>Table 3-3  </p>
<p>Features provided beyond the AUTOSAR standard </p>
<p><b>3.2 </b></p>
<p><b>Initialization </b></p>
<p>Some variables need a default value even before the initialization function will be called. </p>
<p>The  initialization  of  these  variables  is  usually  done  by  the  startup  code  of  the  ECU. </p>
<p>Otherwise  the </p>
<p>FrSM_InitMemory</p>
<p>  function  has  to  be  called  before  the  initialization </p>
<p>function. Then the initialization function of the FrSM has to be called. The FrSM gets the </p>
<p>configuration data of the current system like the number of available clusters and an own </p>
<p>configuration record per cluster. If the development error detection is activated the FrSM </p>
<p>handles several validity checks at the configuration data. Then the internal variables of the </p>
<p>state machine are set to their start values. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>11 </p>
<p>based on template version 4.9.2 </p>
<p><b>3.3 </b></p>
<p><b>State Machine </b></p>
<p> </p>
<p> </p>
<p>Figure 3-1 </p>
<p>State machine of the FrSM </p>
<p><b>stm FrSM StateMachine</b></p>
<p><b>FrSM</b></p>
<p>[T rcvCtrl]</p>
<p>[CcCtrl]</p>
<p><b>FRSM_ECU_ACTIVE</b></p>
<p><b>FRSM_ECU_PASSIVE</b></p>
<p>Set transceivers to </p>
<p>RECEIVE_ONLY </p>
<p>instead of NORMAL</p>
<p><b>NoCom</b></p>
<p><b>FullCom</b></p>
<p><b>FRSM_READY</b></p>
<p><b>FRSM_HALT_REQ</b></p>
<p><b>FRSM_KEYSLOT_ONLY</b></p>
<p><b>FRSM_ONLINE</b></p>
<p>Ini ti al</p>
<p><b>FRSM_LOW_NUMBER_OF_COLDSTARTERS</b></p>
<p><b>Startup monitoring</b></p>
<p><b>StartUpProcessing</b></p>
<p><b>FRSM_ONLINE_PASSIVE</b></p>
<p><b>FRSM_WAKEUP</b></p>
<p><b>FRSM_STARTUP</b></p>
<p>Junction</p>
<p>Junction</p>
<p>Ini ti al</p>
<p>Junction</p>
<p>Junction</p>
<p>T04</p>
<p>a,b</p>
<p>T17</p>
<p>T15</p>
<p>T20</p>
<p>a;b;c</p>
<p>T13</p>
<p>T03 a,b,c,d,e</p>
<p>T103</p>
<p>T08</p>
<p>T06</p>
<p>T30</p>
<p>T108</p>
<p>T12</p>
<p>T05</p>
<p>T16b</p>
<p>FrSM_SetEcuPassive(FALSE)</p>
<p>T09a</p>
<p>T16a</p>
<p>T10a</p>
<p>T20</p>
<p>a;b;c</p>
<p>T02</p>
<p>a,b</p>
<p>T01 a,b,c</p>
<p>T14</p>
<p>T20 a;</p>
<p>b;c</p>
<p>T115</p>
<p>T10b</p>
<p>T09b</p>
<p>T101</p>
<p>T40</p>
<p>T00</p>
<p>T41</p>
<p>T31;</p>
<p>T32;T33</p>
<p>FrSM_SetEcuPassive(TRUE)</p>
<p>T11</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>12 </p>
<p>based on template version 4.9.2 </p>
<p><b>3.3.1 </b></p>
<p><b>Meta States FullCom / NoCom </b></p>
<p>In the FullCom state the network is started and communication works well. In the NoCom </p>
<p>state the network isn’t started or the communication controller may have detected some </p>
<p>errors. The ComM is informed at each time the Meta state changes. </p>
<p><b>3.3.2 </b></p>
<p><b>FRSM_INITIAL </b></p>
<p>When  the  ECU  is  powered  on  the  initialization  function  of  the  FrSM  is  called.  The </p>
<p>initialization function sets the variables to the default value, maps the configuration data to </p>
<p>the local handle and Initializes the FlexRay controllers for all clusters of the configuration. </p>
<p>The  state  of  the  FrSM  is  now </p>
<p>FRSM_READY</p>
<p>. After  initialization  the API  of  the  FrSM  are </p>
<p>ready for use. </p>
<p><b>3.3.3 </b></p>
<p><b>FRSM_STARTUP / FRSM_WAKEUP / FRSM_READY </b></p>
<p>If the FrSM receives a full communication request it sets the transceiver in </p>
<p>normal</p>
<p> </p>
<p>mode</p>
<p> </p>
<p>(T01 or T02) and starts the FlexRay communication (T03 or T02). Before the FrSM triggers </p>
<p>the transition T01 it detects the wake-up reason. In case the ECU was woken up by bus </p>
<p>(wake-up  has  been  detected  for all  of  the  FlexRay  channels  of  the  cluster to  which  the </p>
<p>ECU is connected) the bus is already awake and the execution of the channel wake-up </p>
<p>isn’t needed. In that case the FrSM executes the transition T02 instead T01 even the ECU </p>
<p>is configured as wake-up node. Depending on the configuration a channel wake-up (T01) </p>
<p>and  a  cold  start  process  (T02  or  T04)  is  initiated  too.  The  transition  ends  in  state </p>
<p>FRSM_STARTUP</p>
<p>. Now the startup of the controller should be succeeded and the FrSM sets </p>
<p>the FlexRay Interface to </p>
<p>ONLINE</p>
<p>, triggers a Dem status passed and updates the internal </p>
<p>state to </p>
<p>FRSM_ONLINE</p>
<p> (T08). </p>
<p>If  the  ECU  is  connected  to  both  FlexRay  channels  of  the  cluster  and  T01  becomes </p>
<p>executed  (see  above)  the  function </p>
<p>FrIf_SetWakeupChannel</p>
<p>  is  always  called  before </p>
<p>FrIf_SendWUP</p>
<p>.  In  case  no  wake-up  has  been  detected  the  wake-up  channel  is  set  to </p>
<p>CHANNEL_A otherwise to the channel on which no wake-up has been detected. </p>
<p>If  the  configuration  parameter </p>
<p>FrSMDelayStartupWithoutWakeup</p>
<p>  is  activated  the </p>
<p>“allow cold start” in transition T02 is skipped and the timer t1 is started. So the first “allow </p>
<p>cold  start”  attempt  is  delayed  by  “Duration  T1”  until  the  transition  T04  is  executed.  If </p>
<p>“Duration T1” is configured to zero there will be also no difference to the “normal” behavior. </p>
<p>If </p>
<p>the </p>
<p>communication </p>
<p>controller </p>
<p>has </p>
<p>not </p>
<p>reached </p>
<p>normal  active</p>
<p> </p>
<p>during </p>
<p>the </p>
<p>time </p>
<p>Duration T2</p>
<p> the wake-up process is repeated. The wake-up might be repeated as often </p>
<p>as specified in </p>
<p>FrSMStartupRepetitionsWithWakeup</p>
<p>, of course only if the CC state </p>
<p>isn’t  “</p>
<p>Normal Active</p>
<p>” and  still  full  communication  is requested. The  wake-up  process </p>
<p>includes  the  initialization  of  the  controller,  the  channel  wake-up  (T05),  the  start  of  the </p>
<p>FlexRay communication (T03) and if configured a cold start (T04). The wake-up repetition </p>
<p>also  depends on  the  wake-up  reason.  In  case  the ECU  was  woken  up by  bus  (passive </p>
<p>wake-up) the bus is already awake and the execution of the channel wake-up isn’t needed. </p>
<p>In  that  case  the  FrSM  acts  like  the  option </p>
<p>FrSMIsWakeupEcu </p>
<p>is  deactivated  and </p>
<p>executes the transition T06 instead T05. </p>
<p>If all specified </p>
<p>FrSMStartupRepetitionsWithWakeup</p>
<p> have been executed, the startup </p>
<p>repetitions without a wake-up follow. The number </p>
<p>FrSMStartupRepetitions </p>
<p>includes </p>
<p>all repetitions as well the startup with and without a wake-up.  </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>13 </p>
<p>based on template version 4.9.2 </p>
<p>The  startup  repetitions  without  a  wake-up  (T06)  might  be  repeated  as  many  times  as </p>
<p>specified </p>
<p>in </p>
<p>the </p>
<p>FrSMStartupRepetitions </p>
<p>less </p>
<p>the </p>
<p>FrSMStartupRepetitionsWithWakeup</p>
<p> </p>
<p>(which </p>
<p>has </p>
<p>been </p>
<p>already </p>
<p>performed). </p>
<p>Of </p>
<p>course </p>
<p>the </p>
<p>transition </p>
<p>T06 </p>
<p>will </p>
<p>be </p>
<p>skipped, </p>
<p>if </p>
<p>the </p>
<p>CC </p>
<p>state </p>
<p>is </p>
<p>NORMAL_ACTIVE</p>
<p> </p>
<p>or </p>
<p>COMM_NO_COMMUNICATION</p>
<p>  is  requested.  If all  specified </p>
<p>Startup Repetitions</p>
<p>  have </p>
<p>been </p>
<p>executed </p>
<p>and </p>
<p>the </p>
<p>controller </p>
<p>is </p>
<p>still </p>
<p>not </p>
<p>active </p>
<p>the </p>
<p>FrSM </p>
<p>stays </p>
<p>in </p>
<p>the </p>
<p>state </p>
<p>FRSM_STARTUP</p>
<p> and stops any startup retry. </p>
<p>It’s  also  possible  to  repeat  the  startups  infinitely.  This  happens  if  no  threshold  of  the </p>
<p>corresponding </p>
<p>value </p>
<p>has </p>
<p>been </p>
<p>configured </p>
<p>or </p>
<p>the </p>
<p>corresponding </p>
<p>checkbox </p>
<p>in </p>
<p>the </p>
<p>configuration tool has been selected. If the number of  repetitions with  wake-up is set to </p>
<p>infinite the value of the repetitions without wake-up are of course irrelevant. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Unlimited number of startup attempts could lead to a continuous disturbance of the </p>
<p>FlexRay communication. </p>
<p><b> </b></p>
<p><b> </b></p>
<p>The ComM may stop the startup by requesting no communication. In this case the FrSM </p>
<p>sets the transceiver into standby, enables the wake-up, initializes the controller and sets </p>
<p>the  internal  state  to </p>
<p>FRSM_READY </p>
<p>(T12  or  T13).  These  two  transitions  are  executed </p>
<p>immediately.  </p>
<p><b>3.3.4 </b></p>
<p><b>FRSM_WAKEUP, Send Multiple Wake-Up Pattern </b></p>
<p>The  FrSM  may  stay  in  the  state </p>
<p>WAKEUP</p>
<p>  and  send  a  configurable  number  of  wake-up </p>
<p>patterns. The intention is to send additional WUP during the gap between the first WUP </p>
<p>(T01) and the cold start (after T04). </p>
<p>If the “</p>
<p>FrSMNumWakeupPatterns</p>
<p>” is set to one (WUP in T01) there is no difference to the </p>
<p>behavior described above. Otherwise the FrSM will send wake-up patterns, until the </p>
<p>configured “</p>
<p>FrSMNumWakeupPatterns</p>
<p>” are reached (including T01 or T05) or external </p>
<p>bus communication is detected. In this case the FrSM will perform the transition T03 to </p>
<p>STARTUP</p>
<p>. If any of the WUP (of this startup repetition) has been transmitted successfully </p>
<p>(</p>
<p>POC.WakeupStatus == WAKEUP_TRANSMITTED</p>
<p>) or the time which has been elapsed </p>
<p>(in state </p>
<p>WAKEUP</p>
<p>) exceeds the “Duration T1” or if a dual channel system has been woken </p>
<p>up on exact one channel (</p>
<p>PARTIAL_WU</p>
<p>) then </p>
<p>ALLOW_COLDSTART</p>
<p> will be triggered </p>
<p>immediately. </p>
<p><b>3.3.5 </b></p>
<p><b>FRSM_STATE_ONLINE </b></p>
<p>In this state the network is started and communication works well. The FrSM waits till it </p>
<p>receives a No Communication Request. In this case the FrSM stops the PDU groups, sets </p>
<p>the FlexRay Interface to </p>
<p>OFFLINE</p>
<p>, stops the FlexRay communication and sets the internal </p>
<p>state to </p>
<p>FRSM_HALT_REQ</p>
<p> (T09). This transition is executed immediately. </p>
<p>Under certain circumstances some failures on the bus triggers the CC to switch the state. </p>
<p>If  the  state  of  the  CC  has  switched  to  halt,  freeze  or  ready  the  FrSM  stops  the  PDU </p>
<p>groups, sets the FlexRay Interface to </p>
<p>OFFLINE</p>
<p>, initializes the controller, starts the FlexRay </p>
<p>communication </p>
<p>and </p>
<p>sets </p>
<p>the </p>
<p>internal </p>
<p>state </p>
<p>to </p>
<p>FRSM_STARTUP</p>
<p> </p>
<p>(T10) </p>
<p>if </p>
<p>FrSMCheckWakeupReason</p>
<p> has been selected, otherwise to </p>
<p>FRSM_WAKEUP</p>
<p> (T20). If the </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>14 </p>
<p>based on template version 4.9.2 </p>
<p>state of the CC has switched to </p>
<p>normal</p>
<p> </p>
<p>passive</p>
<p> the FrSM stops the PDU groups and </p>
<p>sets the internal state to </p>
<p>FRSM_ONLINE_PASSIVE</p>
<p> (T16). </p>
<p><b>3.3.6 </b></p>
<p><b>FRSM_KEY_SLOT_ONLY </b></p>
<p>Before the state </p>
<p>FRSM_ONLINE</p>
<p> will be entered in case the POCstate is </p>
<p>normal active</p>
<p><b> </b></p>
<p>the  FrSM  check  the  SlotMode of  the  FlexRay  controller.  If  the  SlotMode  is  not equal to </p>
<p>FR_SLOTMODE_ALL</p>
<p> </p>
<p>the </p>
<p>FrSM </p>
<p>enters </p>
<p>the </p>
<p>state </p>
<p>FRSM_KEYSLOT_ONLY</p>
<p> </p>
<p>instead </p>
<p>of </p>
<p>FRSM_ONLINE</p>
<p>. To leave the KeySlotOnlyMode the function </p>
<p>FrSM_AllSlots()</p>
<p> has to be </p>
<p>called by the BswM. Within </p>
<p>FrSM_AllSlots()</p>
<p> the FrSM calls the similar named function </p>
<p>FrIf_AllSlots()</p>
<p> of the FrIf where the SlotMode switches. </p>
<p>Apart from that the FrSM reacts on communication requests or changes of the POC state </p>
<p>in the same way as in FRSM_STATE_ONLINE. </p>
<p><b>3.3.7 </b></p>
<p><b>FRSM_STATE_ONLINE_PASSIVE </b></p>
<p>In  this  state  some  disturbance  on  the  bus  has  been  occurred  and  the  CC  has  left  the </p>
<p>normal active</p>
<p> state. </p>
<p>The FrSM waits till it receives a no communication request. In this case the FrSM sets the </p>
<p>FlexRay  Interface  to </p>
<p>OFFLINE</p>
<p>,  stops  the  FlexRay  communication  and  sets  the  internal </p>
<p>state  to </p>
<p>FRSM_HALT_REQ</p>
<p>  (T14).  This  transition  is  executed  immediately.  If  the  CC  has </p>
<p>already  switched  to  the </p>
<p>halt</p>
<p>  state  the  FrSM  sets  the  FlexRay  Interface  to </p>
<p>OFFLINE</p>
<p>, </p>
<p>initializes  the  controller,  starts  the  FlexRay  communication  and  sets  the  internal  state  to </p>
<p>FRSM_STARTUP</p>
<p> (T17). If the CC has already switched to the </p>
<p>normal active</p>
<p><b> </b>state the </p>
<p>FrSM stops the PDU groups, and updates the internal state to </p>
<p>FRSM_ONLINE</p>
<p> (T15) or to </p>
<p>FRSM_KEY_SLOT_ONLY</p>
<p> (T115). </p>
<p><b>3.3.8 </b></p>
<p><b>FRSM_STATE_HALT_REQ </b></p>
<p>The FrSM waits till the communication controller reaches the halt state. In this case the </p>
<p>FrSM  executes  the  transition T11  sets  the  transceiver  in  standby,  enables  the  wake-up, </p>
<p>initializes the controller and sets the internal state to FRSM_READY. </p>
<p>In  some  cases  the  instant  deactivation  of  the  transceiver  might  cause  an  unintentional </p>
<p>wakeup. To avoid these, the transition T11 from FRSM_HALT_REQ to FRSM_READY may </p>
<p>be delayed by the configured “Trcv Stby Delay Timer” value. The timer is handled as zero </p>
<p>if  no  transceiver  is  configured.  The  timer  runs  only  if  the  POC  state  of  the  FlexRay </p>
<p>controller  is  in  the  HALT  mode. The delay  timer will  be  ignored  if the  FrSM  gets  a new </p>
<p>FullCom request. </p>
<p><b>3.3.9 </b></p>
<p><b>Startup Monitoring (FRSM_STARTUP / FRSM_WAKEUP / </b></p>
<p><b>FRSM_STATE_HALT_REQ) </b></p>
<p>The timer t3 is used to supervise the startup/restart process. The timer t3 runs if the FrSM </p>
<p>is </p>
<p>in </p>
<p>the </p>
<p>state </p>
<p>group </p>
<p>FRSM_STATE_ONLINE_PASSIVE</p>
<p>, </p>
<p>FRSM_WAKEUP</p>
<p> </p>
<p>and</p>
<p> </p>
<p>FRSM_STARTUP</p>
<p>. The timer t3 is started if this state group is entered. </p>
<p>If the timer expires, a Dem failed message is triggered once. If the timer has been expired </p>
<p>the </p>
<p>SyncLossErrorIndication</p>
<p> function gets called every </p>
<p>FrSM_MainFunction</p>
<p> until </p>
<p>the </p>
<p>timer </p>
<p>becomes </p>
<p>deactivated. </p>
<p>The </p>
<p>timer </p>
<p>t3 </p>
<p>is </p>
<p>deactivated </p>
<p>if </p>
<p>this </p>
<p>state </p>
<p>group </p>
<p>FRSM_STARTUP</p>
<p>, </p>
<p>FRSM_WAKEUP</p>
<p> and </p>
<p>FRSM_STATE_ONLINE_PASSIVE</p>
<p> is left.  </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>15 </p>
<p>based on template version 4.9.2 </p>
<p>The function name of the </p>
<p>SyncLossErrorIndication</p>
<p> function can be configured in the </p>
<p>configuration tool via the parameter </p>
<p>FrSMSyncLossErrorIndicationName</p>
<p>. Usually the </p>
<p>function </p>
<p>FrNm_StartupError</p>
<p> of the FrNm is chosen. </p>
<p><b>3.4 </b></p>
<p><b>Main Functions </b></p>
<p>There is one main function for each cluster available. If the development error detection is </p>
<p>activated  the  function  checks  if  the  cluster  index  is  valid  and  if  the  FrSM  has  been </p>
<p>initialized. Then the function detects if the conditions of a transition are fulfilled, triggers the </p>
<p>necessary actions by calling API functions of other BSW and adapts the internal data. </p>
<p><b>3.4.1 </b></p>
<p><b>Communication Modes </b></p>
<p>The  ComM  collects  the  communication  requests  from  the  SWC  and  from  the  network. </p>
<p>Accordingly the ComM calculates the needed communication mode and requests this from </p>
<p>the  FlexRay  State  Manager  via  the  function </p>
<p>FrSM_RequestComMode. </p>
<p>The  function </p>
<p>FrSM_RequestComMode</p>
<p> </p>
<p>checks </p>
<p>the </p>
<p>function </p>
<p>parameter, </p>
<p>stores </p>
<p>the </p>
<p>requested </p>
<p>communication </p>
<p>mode </p>
<p>and </p>
<p>in </p>
<p>some </p>
<p>cases </p>
<p>handles </p>
<p>transitions </p>
<p>directly </p>
<p>to </p>
<p>stop </p>
<p>the </p>
<p>transmission immediately. </p>
<p><b>3.4.2 </b></p>
<p><b>Communication Mode Polling </b></p>
<p>The ComM is informed about the changes of the Meta states NoCom and FullCom via the </p>
<p>callback function </p>
<p>ComM_BusSM_ModeIndication</p>
<p>. </p>
<p>Additionally the ComM has the possibility to request the current communication mode via </p>
<p>the API  function </p>
<p>FrSM_GetCurrentComMode</p>
<p>. The  function  delivers  the  communication </p>
<p>mode of a specific cluster so it needs the network handle and an address reference where </p>
<p>the mode shall be stored to. </p>
<p><b>3.5 </b></p>
<p><b>Error Handling </b></p>
<p><b>3.5.1 </b></p>
<p><b>Development Error Reporting </b></p>
<p>By </p>
<p>default, </p>
<p>development </p>
<p>errors </p>
<p>are </p>
<p>reported </p>
<p>to </p>
<p>the </p>
<p>Det </p>
<p>using </p>
<p>the </p>
<p>service </p>
<p>Det_ReportError()</p>
<p>  as  specified  in  [2],  if development  error reporting  is  enabled  (i.e. </p>
<p>pre-compile parameter </p>
<p>FRSM_DEV_ERROR_DetECT==STD_ON</p>
<p>). </p>
<p>If  another  module  is  used  for  development  error  reporting,  the  function  prototype  for </p>
<p>reporting the error can be configured by the integrator, but must have the same signature </p>
<p>as the service </p>
<p>Det_ReportError()</p>
<p>. </p>
<p>The reported FrSM ID is 142. </p>
<p>The  reported  service  IDs  identify  the  services  which  are  described  in  5.2. The following </p>
<p>table presents the service IDs and the related services: </p>
<p><b>Service ID </b></p>
<p><b>Service </b></p>
<p>0x01 </p>
<p>FrSM_Init </p>
<p>0x80 </p>
<p>+ </p>
<p>Cluster_Id</p>
<p> </p>
<p>FrSM_MainFunction_&lt;ClusterId&gt; </p>
<p>0x02 </p>
<p>FrSM_RequestComMode </p>
<p>0x03 </p>
<p>FrSM_GetCurrentComMode </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>16 </p>
<p>based on template version 4.9.2 </p>
<p><b>Service ID </b></p>
<p><b>Service </b></p>
<p>0x04 </p>
<p>FrSM_GetVersionInfo </p>
<p>0x05 </p>
<p>FrSM_AllSlots </p>
<p>0x06 </p>
<p>FrSM_SetEcuPassive </p>
<p>Table 3-4  </p>
<p>Service IDs </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>The Service ID 0x03 used twice (FrSM_RequestComMode and </p>
<p>FrSM_GetCurrentComMode). So 0x02 is used for FrSM_RequestComMode like in the </p>
<p>prior AUTOSAR 3.x releases. </p>
<p><b> </b></p>
<p><b> </b></p>
<p>The errors reported to Det are described in the following table: </p>
<p><b>Error Code </b></p>
<p><b>Description </b></p>
<p>0x01 </p>
<p>FRSM_E_NULL_PTR </p>
<p>Invalid pointer in parameter list </p>
<p>0x02 </p>
<p>FRSM_E_INV_HANDLE </p>
<p>Invalid network handle parameter </p>
<p>0x03 </p>
<p>FRSM_E_UNINIT </p>
<p>FrSM module was not initialized </p>
<p>0x04 </p>
<p>FRSM_E_INV_MODE </p>
<p>Invalid communication mode requested </p>
<p>Table 3-5  </p>
<p>Errors reported to Det </p>
<p><b>3.5.2 </b></p>
<p><b>Production Code Error Reporting </b></p>
<p>By  default,  production  code  related  errors  are  reported  to  the  Dem  using  the  service </p>
<p>Dem_ReportErrorStatus()</p>
<p> as specified in [3], if production error reporting is enabled </p>
<p>(i.e. pre-compile parameter </p>
<p>FRSM_PROD_ERROR_DetECT==STD_ON</p>
<p>). </p>
<p>If another module  is used for production  code  error reporting,  the  function  prototype for </p>
<p>reporting the error can be configured by the integrator, but must have the same signature </p>
<p>as the service </p>
<p>Dem_ReportErrorStatus()</p>
<p>. </p>
<p>The errors reported to Dem are described in the following table: </p>
<p><b>Error Code </b></p>
<p><b>Description </b></p>
<p>FRSM_E_CLUSTER_STARTUP </p>
<p>Value  to  identify  the  FrSM  to  the  Dem. A </p>
<p>failed </p>
<p>message </p>
<p>is </p>
<p>sent </p>
<p>if </p>
<p>the </p>
<p>FlexRay </p>
<p>could  not  reach  the  state  normal  active </p>
<p>within  the  configured  time  or  a  passed </p>
<p>message if the startup worked. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>17 </p>
<p>based on template version 4.9.2 </p>
<p>FRSM_E_CLUSTER_SYNC_LOSS</p>
<p> </p>
<p>Value  to  identify  the  FrSM  to  the  Dem. A </p>
<p>failed  message  is  sent  if  the  FrSM  is  in </p>
<p>state  ONLINE  and  the  POC  state  of  the </p>
<p>FlexRay </p>
<p>controller </p>
<p>has </p>
<p>been </p>
<p>changed </p>
<p>automatically  (NORMAL_PASSIVE,  HALT </p>
<p>or </p>
<p>FREEZE) </p>
<p>(T10, </p>
<p>T16). </p>
<p>The </p>
<p>corresponding passed message is sent in </p>
<p>the  transitions.  T08,  T12,  T13,  T14  and </p>
<p>T15. </p>
<p>Table 3-6  </p>
<p>Errors reported to Dem </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>18 </p>
<p>based on template version 4.9.2 </p>
<p><b>4 </b></p>
<p><b>Integration </b></p>
<p>This chapter gives necessary information for the integration of the MICROSAR FrSM into </p>
<p>an application environment of an ECU. </p>
<p><b>4.1 </b></p>
<p><b>Scope of Delivery </b></p>
<p>The delivery of the FrSM contains the files which are described in the chapters 4.1.1 and </p>
<p>4.1.2: </p>
<p><b>4.1.1 </b></p>
<p><b>Static Files </b></p>
<p><b>File Name </b></p>
<p><b>Source </b></p>
<p><b>Code </b></p>
<p><b>Deliver</b></p>
<p><b>y </b></p>
<p><b>Object </b></p>
<p><b>Code </b></p>
<p><b>Delive</b></p>
<p><b>ry </b></p>
<p><b>Description </b></p>
<p>FrSM.c </p>
<p></p>
<p> </p>
<p> </p>
<p>This is the source file of the FrSM, which contains all API </p>
<p>functions and algorithms of the FrSM. (not available if </p>
<p>libraries are delivered) </p>
<p>FrSM.h </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p>This is the header file of the FrSM, which contains the API </p>
<p>prototypes and definitions. </p>
<p>FrSM_Types.h </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p>This header file contains the global data types of the FrSM. </p>
<p>Table 4-1  </p>
<p>Static files </p>
<p><b>4.1.2 </b></p>
<p><b>Dynamic Files </b></p>
<p>The dynamic files are generated by the configuration tool [config tool]. </p>
<p><b>File Name </b></p>
<p><b>Description </b></p>
<p>FrSM_Cfg.h </p>
<p>This is the configuration header file of the FrSM, which contains the configurable </p>
<p>parameters. The setup has to be made before compiling the FrSM sources. </p>
<p>FrSM_Lcfg.c </p>
<p>This is the link time configuration file of the FrSM. The type declarations which </p>
<p>are made in the FrSM_Types.h header can be defined with the currently needed </p>
<p>values. The file may be implemented, compiled after the FrSM sources and </p>
<p>linked to the object code. </p>
<p>FrSM_PBcfg.c </p>
<p>This is the post-build time configuration file of the FrSM. The type declarations </p>
<p>which are made in the FrSM_Types.h header may be defined with the currently </p>
<p>needed values. The file is handled in the same way as the link time configuration </p>
<p>file. Additionally the memory addresses of the values are known and fix. So the </p>
<p>values can be replaced after the build process too. </p>
<p>Table 4-2  </p>
<p>Generated files </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>19 </p>
<p>based on template version 4.9.2 </p>
<p><b>4.2 </b></p>
<p><b>Include Structure </b></p>
<p> </p>
<p> </p>
<p>Figure 4-1 </p>
<p>Include structure </p>
<p><b>4.3 </b></p>
<p><b>Compiler Abstraction and Memory Mapping </b></p>
<p>The  objects  (e.g.  variables,  functions,  constants)  are  declared  by  compiler  independent </p>
<p>definitions  –  the  compiler  abstraction  definitions.  Each  compiler  abstraction  definition  is </p>
<p>assigned to a memory section. </p>
<p>The  following  table  contains  the  memory  section  names  and  the  compiler  abstraction </p>
<p>definitions of the FrSM and illustrates their assignment among each other. </p>
<p><b>class IncludeStructure</b></p>
<p>FrSM.h</p>
<p>FrSM_Cfg.h</p>
<p>FrSM_Lcfg.c</p>
<p>FrSM_PBcfg.c</p>
<p>FrSM_Types.h</p>
<p>Fr_GeneralTypes.h</p>
<p>ComM_Types.h</p>
<p>FrSM.c</p>
<p>SchM_FrSM.h</p>
<p>Std_Types.h</p>
<p>Dem.h</p>
<p>BswM.h</p>
<p>FrIf.h</p>
<p>Det.h</p>
<p>ComM_BusSM.h</p>
<p>FrTrcv.h</p>
<p>ComM_GenTypes.h</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>20 </p>
<p>based on template version 4.9.2 </p>
<p><b>Compiler Abstraction </b></p>
<p><b>Definitions </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Memory Mapping </b></p>
<p><b>Sections </b></p>
<p>FRSM_VAR_NOINIT</p>
<p> </p>
<p>FRSM_VAR_ZERO_INI</p>
<p>T</p>
<p> </p>
<p>FRSM_CONST</p>
<p> </p>
<p>FRSM_PBCFG </p>
<p>FRSM_CODE</p>
<p> </p>
<p>FRSM_APPL_VAR </p>
<p>FRSM_APPL_CODE </p>
<p>FRSM_START_SEC_PBCFG_ROOT </p>
<p>FRSM_STOP_SEC_PBCFG_ROOT</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>FRSM_START_SEC_PBCFG </p>
<p>FRSM_STOP_SEC_PBCFG </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>FRSM_START_SEC_CONST_8BIT </p>
<p>FRSM_STOP_SEC_CONST_8BIT </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>FRSM_START_SEC_CONST_32BIT </p>
<p>FRSM_STOP_SEC_CONST_32BIT </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>FRSM_START_SEC_CONST_UNSPECIFIED </p>
<p>FRSM_STOP_SEC_CONST_UNSPECIFIED </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>FRSM_START_SEC_VAR_ZERO_INIT_8BIT </p>
<p>FRSM_STOP_SEC_VAR_ZERO_INIT_8BIT </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>FRSM_START_SEC_VAR_NOINIT_8BIT </p>
<p>FRSM_STOP_SEC_VAR_NOINIT_8BIT </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>FRSM_START_SEC_VAR_NOINIT_16BIT </p>
<p>FRSM_STOP_SEC_VAR_NOINIT_16BIT </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>FRSM_START_SEC_VAR_NOINIT_UNSPECIFIED </p>
<p>FRSM_STOP_SEC_VAR_NOINIT_UNSPECIFIED </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>FRSM_START_SEC_CODE </p>
<p>FRSM_STOP_SEC_CODE </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p>Table 4-3  </p>
<p>Compiler abstraction and memory mapping </p>
<p><b>4.4 </b></p>
<p><b>Critical Sections </b></p>
<p>Critical sections are handled by the BSW Scheduler.  To ensure data consistency and a </p>
<p>correct function of the FrSM the following exclusive areas have to be provided during the </p>
<p>integration. The chosen critical section solution has to be configured that it’s ensured that </p>
<p>the API functions do not interrupt each other. </p>
<p><b>&gt; </b></p>
<p>The </p>
<p>FRSM_EXCLUSIVE_AREA_0</p>
<p> has to be used if it is possible that the function </p>
<p>FrSM_MainFunction_&lt;Idx&gt;()</p>
<p> is interrupted by the function</p>
<p> </p>
<p>FrSM_RequestComMode()</p>
<p>. It is recommended to use AUTOSAR OS ‘Resources’ for </p>
<p>these exclusive areas to prevent priority inversions and dead-locks. </p>
<p><b>&gt; </b></p>
<p>The </p>
<p>FRSM_EXCLUSIVE_AREA_1</p>
<p> has to be used if it is possible that the function </p>
<p>FrSM_MainFunction_&lt;Idx&gt;()</p>
<p> is interrupted by the function </p>
<p>FrSM_SetEcuPassive()</p>
<p>. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>21 </p>
<p>based on template version 4.9.2 </p>
<p><b>&gt; </b></p>
<p>The </p>
<p>FRSM_EXCLUSIVE_AREA_2</p>
<p> has to be used if it is possible that the function </p>
<p>FrSM_RequestComMode() </p>
<p>is interrupted by any of the functions </p>
<p>FrSM_SetEcuPassive()</p>
<p> or </p>
<p>FrSM_MainFunction_&lt;Idx&gt;()</p>
<p>. </p>
<p><b>&gt; </b></p>
<p>The </p>
<p>FRSM_EXCLUSIVE_AREA_3</p>
<p> has to be used if it is possible that the function </p>
<p>FrSM_SetEcuPassive()</p>
<p> is interrupted by the function </p>
<p>FrSM_RequestComMode()</p>
<p>. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>22 </p>
<p>based on template version 4.9.2 </p>
<p><b>5 </b></p>
<p><b>API Description </b></p>
<p>For an interfaces overview please see Figure 2-2. </p>
<p><b>5.1 </b></p>
<p><b>Type Definitions </b></p>
<p>The types defined by the FrSM are described in this chapter. </p>
<p><b>Type Name </b></p>
<p><b>C-Type </b></p>
<p><b>Description </b></p>
<p><b>Value Range </b></p>
<p>FrSM_BswM_StateType </p>
<p>uint8 </p>
<p>This type defines the </p>
<p>states of the FrSM </p>
<p>state machine which </p>
<p>are indicated to the </p>
<p>BswM. </p>
<p>FRSM_INITIAL </p>
<p>FrSM is not initialized in this </p>
<p>state </p>
<p>FRSM_BSWM_READY </p>
<p>Mapped FlexRay CC state </p>
<p>POC:ready or (transitional) </p>
<p>POC:default config or </p>
<p>(transitional) POC:config or </p>
<p>(transitional) POC:halt </p>
<p>FRSM_BSWM_STARTUP </p>
<p>Mapped FlexRay CC state </p>
<p>POC:start-up</p>
<p> </p>
<p>FRSM_BSWM_WAKEUP </p>
<p>Mapped FlexRay CC state </p>
<p>POC:wake-up </p>
<p>FRSM_BSWM_HALT_REQ </p>
<p>Mapped FlexRay CC state </p>
<p>POC:normal active or </p>
<p>POC:normal passive </p>
<p>FRSM_BSWM_KEYSLOT_ONLY </p>
<p>Mapped FlexRay CC state </p>
<p>POC:normal active but the </p>
<p>SlotMode is not </p>
<p>FR_SLOTMODE_ALL</p>
<p> </p>
<p>FRSM_BSWM_ONLINE </p>
<p>Mapped FlexRay CC state </p>
<p>POC:normal active </p>
<p>Part of the Meta state </p>
<p>FullCom</p>
<p> </p>
<p>Requested by ComM </p>
<p>COMM_FULL_COMMUNICATION </p>
<p>FRSM_BSWM_ONLINE_PASSIVE </p>
<p>Mapped FlexRay CC state </p>
<p>POC:normal passive</p>
<p> </p>
<p>NoCom</p>
<p> </p>
<p>Meta state contains each state </p>
<p>except </p>
<p>FRSM_BSWM_ONLINE.</p>
<p> </p>
<p>Requested by ComM </p>
<p>COMM_NO_COMMUNICATION </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>23 </p>
<p>based on template version 4.9.2 </p>
<p><b>Type Name </b></p>
<p><b>C-Type </b></p>
<p><b>Description </b></p>
<p><b>Value Range </b></p>
<p>FrSM_ConfigType </p>
<p>struct </p>
<p>Structure which </p>
<p>contains the global </p>
<p>configuration data. </p>
<p> </p>
<p>FrSMSyncLossError</p>
<p>IndicationFctPtrT</p>
<p>ype </p>
<p>pointer </p>
<p>Specifies the function </p>
<p>that shall be called on  </p>
<p>“loss of </p>
<p>synchronization”. </p>
<p> </p>
<p>Table 5-1  </p>
<p>Type definitions </p>
<p> </p>
<p><b>5.2 </b></p>
<p><b>Services Provided by FrSM </b></p>
<p><b>5.2.1 </b></p>
<p><b>FrSM_InitMemory </b></p>
<p><b>Prototype </b></p>
<p>void <b>FrSM_InitMemory </b>(void) </p>
<p><b>Parameter </b></p>
<p>void </p>
<p>none </p>
<p><b>Return code </b></p>
<p>void </p>
<p>none </p>
<p><b>Functional Description </b></p>
<p>Function for *_INIT_*-variable initialization. </p>
<p><b>Particularities and Limitations </b></p>
<p>Module must not be initialized </p>
<p>Service to initialize module global variables at power up. This function can be used to initialize the Variables </p>
<p>in *_INIT_* sections in case they are not initialized by the startup code.  </p>
<p>Call context </p>
<p>&gt; </p>
<p>TASK </p>
<p>&gt; </p>
<p>This function is Synchronous </p>
<p>&gt; </p>
<p>This function is Non-Reentrant </p>
<p>Table 5-2  </p>
<p>FrSM_InitMemory </p>
<p><b>5.2.2 </b></p>
<p><b>FrSM_Init </b></p>
<p><b>Prototype </b></p>
<p>void <b>FrSM_Init </b>(const FrSM_ConfigType *const ConfigPtr) </p>
<p><b>Parameter </b></p>
<p>ConfigPtr [in] </p>
<p>Configuration structure for initializing the module </p>
<p><b>Return code </b></p>
<p>void </p>
<p>none </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>24 </p>
<p>based on template version 4.9.2 </p>
<p><b>Functional Description </b></p>
<p>Initialization function. </p>
<p><b>Particularities and Limitations </b></p>
<p>&gt; </p>
<p>Interrupts are disabled. FrSM_InitMemory has been called unless FRSM_Initialized is initialized by start-</p>
<p>up code. </p>
<p>This function initializes the module. It initializes all variables and sets the module state to READY.  </p>
<p>Call context </p>
<p>&gt; </p>
<p>TASK </p>
<p>&gt; </p>
<p>This function is Synchronous </p>
<p>&gt; </p>
<p>This function is Non-Reentrant </p>
<p>Table 5-3  </p>
<p>FrSM_Init </p>
<p><b>5.2.3 </b></p>
<p><b>FrSM_MainFunction_&lt;Cluster Id&gt; </b></p>
<p><b>Prototype </b></p>
<p>void <b>FrSM_MainFunction_&lt;Cluster Id&gt;</b>( void ) </p>
<p><b>Parameter </b></p>
<p>None </p>
<p>- </p>
<p><b>Return code </b></p>
<p>None </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>The main function of the FrSM triggers the state functions according to the current state. The function must </p>
<p>be called cyclically with the configured cycle time. </p>
<p><b>Particularities and Limitations </b></p>
<p></p>
<p> </p>
<p>Service ID: see table 'Service IDs'  </p>
<p></p>
<p> </p>
<p>FrSM has to be initialized. Function has to be called cyclically. The cycle time is set in the </p>
<p>configuration tool.  </p>
<p></p>
<p> </p>
<p>Reentrant for different FlexRay cluster ID suffix </p>
<p>Expected Caller Context </p>
<p></p>
<p> </p>
<p>Cyclically on task level </p>
<p>Table 5-4  </p>
<p>FrSM_MainFunction_&lt;Cluster Id&gt; </p>
<p><b>5.2.4 </b></p>
<p><b>FrSM_RequestComMode </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>FrSM_RequestComMode </b>(NetworkHandleType NetworkHandle, </p>
<p>ComM_ModeType ComM_Mode) </p>
<p><b>Parameter </b></p>
<p>NetworkHandle [in] </p>
<p>FlexRay cluster for which a communication mode is requested </p>
<p>ComM_Mode [in] </p>
<p>Requested communication mode (Range: COMM_NO_COMMUNICATION, </p>
<p>COMM_FULL_COMMUNICATION) </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>25 </p>
<p>based on template version 4.9.2 </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_NOT_OK - function has been called with invalid parameters </p>
<p>E_OK - request accepted </p>
<p><b>Functional Description </b></p>
<p>Initiates the sequence to reach the requested communication mode. </p>
<p><b>Particularities and Limitations </b></p>
<p>This API function is used by the ComM to startup or shutdown the communication on a FlexRay cluster.  </p>
<p>Call context </p>
<p>&gt; </p>
<p>ANY </p>
<p>&gt; </p>
<p>This function is Reentrant </p>
<p>Table 5-5  </p>
<p>FrSM_RequestComMode </p>
<p><b>5.2.5 </b></p>
<p><b>FrSM_GetCurrentComMode </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>FrSM_GetCurrentComMode </b>(NetworkHandleType NetworkHandle, </p>
<p>ComM_ModeType *ComM_ModePtr) </p>
<p><b>Parameter </b></p>
<p>NetworkHandle [in] </p>
<p>FlexRay cluster for which a communication mode is requested </p>
<p>ComM_ModePtr [out] </p>
<p>Pointer to the memory location where the current communication mode shall </p>
<p>be stored </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK Request was accepted </p>
<p>E_NOT_OK Request was not accepted </p>
<p><b>Functional Description </b></p>
<p>Reports the communication mode. </p>
<p><b>Particularities and Limitations </b></p>
<p>-Reports the last communication mode which has been passed to the ComM </p>
<p>Call context </p>
<p>&gt; </p>
<p>ANY </p>
<p>&gt; </p>
<p>This function is Synchronous </p>
<p>&gt; </p>
<p>This function is Reentrant </p>
<p>Table 5-6  </p>
<p>FrSM_GetCurrentComMode </p>
<p><b>5.2.6 </b></p>
<p><b>FrSM_GetVersionInfo </b></p>
<p><b>Prototype </b></p>
<p>void <b>FrSM_GetVersionInfo </b>(Std_VersionInfoType *versioninfo) </p>
<p><b>Parameter </b></p>
<p>versioninfo [out] </p>
<p>Pointer to version information. Parameter must not be NULL (BSW00407). </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>26 </p>
<p>based on template version 4.9.2 </p>
<p><b>Return code </b></p>
<p>void </p>
<p>none </p>
<p><b>Functional Description </b></p>
<p>Returns the version information. </p>
<p><b>Particularities and Limitations </b></p>
<p>-Returns the software version, vendor ID and AUTOSAR module ID of the component. </p>
<p>Configuration Variant(s): FRSM_VERSION_INFO_API </p>
<p>Call context </p>
<p>&gt; </p>
<p>ANY </p>
<p>&gt; </p>
<p>This function is Synchronous </p>
<p>&gt; </p>
<p>This function is Reentrant </p>
<p>Table 5-7  </p>
<p>FrSM_GetVersionInfo </p>
<p><b>5.2.7 </b></p>
<p><b>FrSM_AllSlots </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>FrSM_AllSlots </b>(NetworkHandleType NetworkHandle) </p>
<p><b>Parameter </b></p>
<p>NetworkHandle [in] </p>
<p>FlexRay cluster for which a communication mode is requested </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK Request was successful </p>
<p>E_NOT_OK Request was not successful, any error occurred </p>
<p><b>Functional Description </b></p>
<p>Calls the all slot function. </p>
<p><b>Particularities and Limitations </b></p>
<p>FrSM initialization </p>
<p>Forwarding the function call to the FrIf </p>
<p>Configuration Variant(s): FRSM_ALLSLOTS_SUPPORT  - </p>
<p>Call context </p>
<p>&gt; </p>
<p>ANY </p>
<p>&gt; </p>
<p>This function is Synchronous </p>
<p>&gt; </p>
<p>This function is Reentrant </p>
<p>Table 5-8  </p>
<p>FrSM_AllSlots </p>
<p><b>5.2.8 </b></p>
<p><b>FrSM_SetEcuPassive </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>FrSM_SetEcuPassive </b>(boolean FrSM_Passive) </p>
<p><b>Parameter </b></p>
<p>FrSM_Passive [in] </p>
<p>parameter is true if Ecu Mode should be passive </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>27 </p>
<p>based on template version 4.9.2 </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK Request was successful </p>
<p>E_NOT_OK Request was not successful, any error occurred </p>
<p><b>Functional Description </b></p>
<p>This API function notifies the FrSM if ECU has to be set in passive mode. </p>
<p><b>Particularities and Limitations </b></p>
<p>FrSM initialization </p>
<p>Transceiver is set to mode receive only if passive mode is activated. Each cluster needs transceivers to set </p>
<p>the whole ECU in passive mode. Otherwise the clusters without transceivers may still be able to transmit </p>
<p>messages. </p>
<p>Configuration Variant(s): FRSM_ECU_PASSIVE_MODE </p>
<p>Call context </p>
<p>&gt; </p>
<p>ANY </p>
<p>&gt; </p>
<p>This function is Synchronous </p>
<p>&gt; </p>
<p>This function is Non-Reentrant </p>
<p>Table 5-9  </p>
<p>FrSM_SetEcuPassive </p>
<p><b>5.3 </b></p>
<p><b>Services Used by FrSM </b></p>
<p>In the following table services provided by other components, which are used by the FrSM </p>
<p>are listed. For details about prototype and functionality refer to the documentation of the </p>
<p>providing component. </p>
<p><b>Component </b></p>
<p><b>API </b></p>
<p>BswM </p>
<p>BswM_FrSM_CurrentState </p>
<p>FrIf </p>
<p>FrIf_ControllerInit </p>
<p>FrIf </p>
<p>FrIf_StartCommunication </p>
<p>FrIf </p>
<p>FrIf_HaltCommunication </p>
<p>FrIf </p>
<p>FrIf_SetWakeupChannel </p>
<p>FrIf </p>
<p>FrIf_SendWUP </p>
<p>FrIf </p>
<p>FrIf_SetState </p>
<p>FrIf </p>
<p>FrIf_SetTransceiverMode </p>
<p>FrIf </p>
<p>FrIf_GetWakeupRxStatus </p>
<p>FrIf </p>
<p>FrIf_GetTransceiverWUReason </p>
<p>FrIf </p>
<p>FrIf_ClearTransceiverWakeup </p>
<p>FrIf </p>
<p>FrIf_GetPOCStatus </p>
<p>FrIf </p>
<p>FrIf_AllowColdstart </p>
<p>FrIf </p>
<p>FrIf_AllSlots </p>
<p>FrIf </p>
<p>FrIf_GetState </p>
<p>&lt;Cdd&gt; </p>
<p>&lt;Cdd&gt;_SyncLossErrorIndication </p>
<p>ComM </p>
<p>ComM_BusSM_ModeIndication </p>
<p>Dem </p>
<p>Dem_ReportErrorStatus </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>28 </p>
<p>based on template version 4.9.2 </p>
<p><b>Component </b></p>
<p><b>API </b></p>
<p>Det </p>
<p>Det_ReportError </p>
<p>Table 5-10  </p>
<p>Services used by the FrSM </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>29 </p>
<p>based on template version 4.9.2 </p>
<p><b>6 </b></p>
<p><b>AUTOSAR Standard Compliance </b></p>
<p><b>6.1 </b></p>
<p><b>Additions/ Extensions </b></p>
<p><b>6.1.1 </b></p>
<p><b>API FrSM_InitMemory() </b></p>
<p>This service function was added to be called at Power On or after reset to set the global </p>
<p>FrSM state, afterwards the FrSM can be initialized correctly. </p>
<p><b>6.1.2 </b></p>
<p><b>Configuration Options </b></p>
<p>It’s possible to (de)activate the Dem at pre-compile time, like Det.  </p>
<p><b>6.1.3 </b></p>
<p><b>Post-Build Selectable (Identity Manager)  </b></p>
<p>The code generator and the static code supports Post-Build Selectable configuration. </p>
<p><b>6.2 </b></p>
<p><b>Limitations </b></p>
<p><b>6.2.1 </b></p>
<p><b>Controllers </b></p>
<p>The FrSM supports only one controller per cluster. </p>
<p><b>6.2.2 </b></p>
<p><b>Shy of Coldstarter </b></p>
<p>The detection of low number of coldstarters is not supported. </p>
<p><b>6.2.3 </b></p>
<p><b>Configuration Class </b></p>
<p>Only VARIANT-PRE-COMPILE and Post-Build Selectable are supported. </p>
<p><b>6.2.4 </b></p>
<p><b>No Dual Channel Wake-up Echo </b></p>
<p>In  case  of  a  PARTIAL_WU_BY_BUS  the  WUP  is  not  echoed  to  the  waking  channel. </p>
<p>Instead of the echo the wake-up channel forward is performed. If multiple WUPs on the </p>
<p>wake-up channel are needed the </p>
<p>FrSMNumWakeupPatterns</p>
<p> can be increased. </p>
<p><b>6.2.5 </b></p>
<p><b>Delayed FlexRay transceiver deactivation at Shutdown </b></p>
<p>The  transition  (T11)  from  FRSM_HALT_REQ  to  FRSM_READY  may  be  delayed  by  a </p>
<p>configured timer value see 3.3.8. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>30 </p>
<p>based on template version 4.9.2 </p>
<p><b>7 </b></p>
<p><b>Glossary and Abbreviations </b></p>
<p><b>7.1 </b></p>
<p><b>Glossary </b></p>
<p><b>Term </b></p>
<p><b>Description </b></p>
<p>DaVinci Configurator </p>
<p>Generation tool for MICROSAR components </p>
<p>FIBEX </p>
<p>Field Bus EXchange format a bus system specific container for PDUs </p>
<p>Cold-Start node </p>
<p>ECU has an active part at the timing synchronization at Startup </p>
<p>Wake-up node </p>
<p>ECU which has the permission to wake up a FlexRay channel by sending </p>
<p>a WUP </p>
<p>Table 7-1  </p>
<p>Glossary </p>
<p><b>7.2 </b></p>
<p><b>Abbreviations </b></p>
<p><b>Abbreviation </b></p>
<p><b>Description </b></p>
<p>API </p>
<p>Application Programming Interface </p>
<p>AUTOSAR </p>
<p>Automotive Open System Architecture </p>
<p>BSW </p>
<p>Basis Software </p>
<p>BswM </p>
<p>Basic SW Manager </p>
<p>CC </p>
<p>Communication Controller </p>
<p>Cdd </p>
<p>Complex Device Driver </p>
<p>Cfg </p>
<p>configuration </p>
<p>ComM </p>
<p>Communication Manager </p>
<p>Dem </p>
<p>Diagnostic Event Manager </p>
<p>Det </p>
<p>Development Error Tracer </p>
<p>ECU </p>
<p>Electronic Control Unit </p>
<p>FullCom </p>
<p>COMM_FULL_COMMUNICATION</p>
<p> </p>
<p>Fr </p>
<p>FlexRay </p>
<p>FrIf </p>
<p>FlexRay Interface </p>
<p>FrSM </p>
<p>FlexRay State Manager </p>
<p>FrNm </p>
<p>FlexRay Network Management </p>
<p>MICROSAR </p>
<p>Microcontroller Open System Architecture (the Vector AUTOSAR </p>
<p>solution) </p>
<p>NoCom </p>
<p>COMM_NO_COMMUNICATION</p>
<p> </p>
<p>OS </p>
<p>Operating System</p>
<p> </p>
<p>POC </p>
<p>Protocol Operation Control </p>
<p>SchM </p>
<p>BSW Schedule Manager </p>
<p>SW  </p>
<p>Soft Ware </p>
<p>SWC </p>
<p>Software Component </p>
<p>WU </p>
<p>Wake-Up </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>31 </p>
<p>based on template version 4.9.2 </p>
<p>WUP </p>
<p>Wake-Up Pattern </p>
<p>WUS </p>
<p>Wake-Up Sequence </p>
<p>Table 7-2  </p>
<p>Abbreviations </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR FlexRay State Manager </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 1.2.0 </p>
<p>32 </p>
<p>based on template version 4.9.2 </p>
<p><b>8 </b></p>
<p><b>Contact </b></p>
<p>Visit our website for more information on </p>
<p> </p>
<p><b>&gt; </b></p>
<p>News </p>
<p><b>&gt; </b></p>
<p>Products </p>
<p><b>&gt; </b></p>
<p>Demo software </p>
<p><b>&gt; </b></p>
<p>Support </p>
<p><b>&gt; </b></p>
<p>Training data </p>
<p><b>&gt; </b></p>
<p>Addresses </p>
<p> </p>
<p>www.vector.com </p>
</body>
</html>
{% endraw %}