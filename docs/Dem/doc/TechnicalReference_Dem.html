---
layout: default
title: TechnicalReference_Dem
nav_order: 2
parent: Diagnostic Event Manager
---
{% raw %}
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
     "http://www.w3.org/TR/html4/transitional.dtd">
<html>
<head>

  <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
  <title></title>
  <meta name="generator" content="LibreOffice 24.2.7.2 (Linux)"/>
  <meta name="created" content="00:00:00"/>
  <meta name="changed" content="00:00:00"/>
</head>
<body>
<h1></h1>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><b>MICROSAR Diagnostic Event Manager </b></p>
<p><b>(Dem) </b></p>
<p>Technical Reference </p>
<p> </p>
<p>  </p>
<p>Version 7.6.1 </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Authors </p>
<p>Thomas Dedler, Alexander Ditte, Matthias Heil, Anna Bosch, Erik Jeglorz, </p>
<p>Stefan Hübner, Aswin Vijayamohanan Nair, Savas Ates </p>
<p>Status </p>
<p>Released </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>2 </p>
<p>based on template version 5.0.0 </p>
<p><b>Document Information </b></p>
<p><b>History </b></p>
<p><b>Author </b></p>
<p><b>Date </b></p>
<p><b>Version </b></p>
<p><b>Remarks </b></p>
<p>A. Ditte </p>
<p>2012-05-04 </p>
<p>1.0.0 </p>
<p><b>&gt; </b></p>
<p>Initial Version </p>
<p>A. Ditte </p>
<p>2012-10-09 </p>
<p>1.0.1 </p>
<p><b>&gt; </b></p>
<p>Add chapter 6.2.6.20 and 6.6.1.2.11 </p>
<p><b>&gt; </b></p>
<p>Add GetEventEnableCondition to chapter 6.6.1.1.2 </p>
<p>M. Heil </p>
<p>2012-11-02 </p>
<p>1.1.0 </p>
<p><b>&gt; </b></p>
<p>Architecture Update </p>
<p>A. Ditte,  </p>
<p>M. Heil </p>
<p>2013-02-15 </p>
<p>1.2.0 </p>
<p><b>&gt; </b></p>
<p>Introduced Measurement and Calibration (chapter 5) </p>
<p><b>&gt; </b></p>
<p>Extended chapters 3.4, 3.6, 3.16, 4.3 and 4.3.1 </p>
<p><b>&gt; </b></p>
<p>Added User Controlled WarningIndicatorRequest </p>
<p>(chapter 3.17.1) </p>
<p><b>&gt; </b></p>
<p>Added chapters 6.2.6.24, 6.2.6.25, 6.6.1.1.9 </p>
<p>M. Heil </p>
<p>2013-04-05 </p>
<p>1.3.0 </p>
<p><b>&gt; </b></p>
<p>Support for feature ‘DTC suppression’ </p>
<p><b>&gt; </b></p>
<p>Added chapter 3.10, APIs 6.2.6.26 </p>
<p><b>&gt; </b></p>
<p>Reworked table layout in chapters 4.3, 5.2 </p>
<p><b>&gt; </b></p>
<p>Reworked Measurement and Calibration (chapter 5) </p>
<p><b>&gt; </b></p>
<p>Added measurable items (chapter 5.1)  </p>
<p>M. Heil </p>
<p>2013-06-17 </p>
<p>1.4.0 </p>
<p><b>&gt; </b></p>
<p>Added combined events </p>
<p><b>&gt; </b></p>
<p>Reworked suppression </p>
<p>T. Dedler </p>
<p>2013-07-22 </p>
<p>1.4.1 </p>
<p><b>&gt; </b></p>
<p>critical section description extended </p>
<p>T. Dedler,  </p>
<p>M. Heil </p>
<p>2013-09-04 </p>
<p>2.0.0 </p>
<p><b>&gt; </b></p>
<p>Service ID definition changed </p>
<p><b>&gt; </b></p>
<p>Post-Build Loadable </p>
<p>A. Ditte </p>
<p>2013-11-05 </p>
<p>2.1.0 </p>
<p><b>&gt; </b></p>
<p>Added OBD DTC and Root cause EventId to chapter </p>
<p>3.11.2 </p>
<p><b>&gt; </b></p>
<p>Added limitation for internal data elements in chapter </p>
<p>8.3 </p>
<p>A. Ditte, </p>
<p>M. Heil </p>
<p>2014-01-14 </p>
<p>3.0.0 </p>
<p><b>&gt; </b></p>
<p>Added J1939 (chapters 3.20, 6.2.9) </p>
<p><b>&gt; </b></p>
<p>Adapted DCM interfaces (chapter 6.2.8) according </p>
<p>AUTOSAR 4.1.2 </p>
<p><b>&gt; </b></p>
<p>Added chapter 4.3.1 </p>
<p><b>&gt; </b></p>
<p>Fixed ESCAN00071673: NvM configuration is not </p>
<p>described </p>
<p><b>&gt; </b></p>
<p>Fixed ESCAN00071511: Missing hint for supported </p>
<p>feature 'individual post-build loadable' </p>
<p><b>&gt; </b></p>
<p>Fixed ESCAN00073677: Incorrect figure for DEM </p>
<p>initialization states </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>3 </p>
<p>based on template version 5.0.0 </p>
<p>M. Heil </p>
<p>2014-03-27 </p>
<p>3.1.0 </p>
<p><b>&gt; </b></p>
<p>Describe deviation in handling operation cycles before </p>
<p>module initialization. </p>
<p><b>&gt; </b></p>
<p>Add dependency to configuration to Dcm APIs. </p>
<p><b>&gt; </b></p>
<p>Added warning about time-based de-bouncing and </p>
<p>maximum fault detection counter in current cycle </p>
<p>M. Heil </p>
<p>2014-05-08 </p>
<p>3.2.0 </p>
<p><b>&gt; </b></p>
<p>Added Event Availability (chapters 3.10.1, 6.2.6.27) </p>
<p><b>&gt; </b></p>
<p>Added freeze frame pre-storage (chapters 3.12, 6.2.6.4, </p>
<p>6.2.6.5) </p>
<p><b>&gt; </b></p>
<p>Corrected description of Event and DTC suppression </p>
<p>(chapters 3.10, 6.2.6.4, 6.2.6.5) </p>
<p><b>&gt; </b></p>
<p>Introduced chapter 3.4.4.2 </p>
<p><b>&gt; </b></p>
<p>Clarified usage of DTC groups (chapter 8.3) </p>
<p>M. Heil </p>
<p>A. Ditte </p>
<p>2014-10-14 </p>
<p>4.0.0 </p>
<p><b>&gt; </b></p>
<p>Moved Initialization Pointer (see Dem_PreInit(), </p>
<p>Dem_Init()) </p>
<p><b>&gt; </b></p>
<p>Added API Dem_RequestNvSynchronization() </p>
<p><b>&gt; </b></p>
<p>Added de-bounce values in NVRAM and  API </p>
<p>Dem_NvM_InitDebounceData() </p>
<p><b>&gt; </b></p>
<p>Added additional aging variant (chapter 3.6), added </p>
<p>Figure 3-4 </p>
<p><b>&gt; </b></p>
<p>Added missing configuration variants (chapter 2, </p>
<p>ESCAN00076237) </p>
<p><b>&gt; </b></p>
<p>Added description for NVRAM write frequency (chapter </p>
<p>3.14.2, ESCAN00078587) </p>
<p><b>&gt; </b></p>
<p>Added description for NVRAM recovery (chapter 3.14.3, </p>
<p>ESCAN00078582) </p>
<p><b>&gt; </b></p>
<p>Added support of J1939 nodes </p>
<p>M. Heil </p>
<p>2015-02-27 </p>
<p>4.1.0 </p>
<p><b>&gt; </b></p>
<p>Added APIs, chapters 6.2.6.3, 6.2.6.22 </p>
<p><b>&gt; </b></p>
<p>Support EnableCondition notification, 3.16.5 </p>
<p><b>&gt; </b></p>
<p>Added explanation of Dem task mapping, chapter 4.9 </p>
<p><b>&gt; </b></p>
<p>Added note of reduced queue depth for some events, </p>
<p>chapter no longer available </p>
<p><b>&gt; </b></p>
<p>Updated critical sections, chapter 4.4 </p>
<p>M. Heil </p>
<p>2015-04-20 </p>
<p>4.1.1 </p>
<p><b>&gt; </b></p>
<p>Added deviation regarding notification signatures </p>
<p>(chapters 6.5.1, 8.1) </p>
<p><b>&gt; </b></p>
<p>Reworked chapter 3.1 according ESCAN00082555  </p>
<p>M. Heil </p>
<p>2015-06-17 </p>
<p>4.2.0 </p>
<p><b>&gt; </b></p>
<p>Extended data callback support (chapters 3.11.3, </p>
<p>6.5.1.6) </p>
<p><b>&gt; </b></p>
<p>Described FDC statistics for DTCs using internal de-</p>
<p>bouncing (chapter 3.11.2) </p>
<p><b>&gt; </b></p>
<p>Described aging target 0 (chapter 3.6.1) </p>
<p><b>&gt; </b></p>
<p>Described effect of asynchronous behavior of $85 </p>
<p>(chapter 3.8) </p>
<p><b>&gt; </b></p>
<p>Described different aging behavior (chapter 3.6.5) </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>4 </p>
<p>based on template version 5.0.0 </p>
<p>M. Heil </p>
<p>2015-09-14 </p>
<p>4.3.0 </p>
<p><b>&gt; </b></p>
<p>More information about NVRam setup (chapter 4.5 ff) </p>
<p><b>&gt; </b></p>
<p>Changes due to new option to persist event availability </p>
<p>(chapters 3.10.1, 6.2.6.27, 6.2.6.13) </p>
<p>M. Heil </p>
<p>2015-11-26 </p>
<p>5.0.0 </p>
<p><b>&gt; </b></p>
<p>Reworked aging behavior, added new behavior (Table </p>
<p>3-5, Figure 3-4) </p>
<p><b>&gt; </b></p>
<p>Clarifications on feature support </p>
<p><b>&gt; </b></p>
<p>Fixed ESCAN00086243 (chapter 4.5.1) </p>
<p><b>&gt; </b></p>
<p>Fixed ESCAN00086483 (chapter 4.5.2.2) </p>
<p>M. Heil </p>
<p>2016-01-20 </p>
<p>5.0.1 </p>
<p><b>&gt; </b></p>
<p>No changes </p>
<p>M. Heil </p>
<p>2016-02-03 </p>
<p>6.0.0 </p>
<p><b>&gt; </b></p>
<p>Change Dcm notification handling (chapters 3.16.3, </p>
<p>chapter no longer available) </p>
<p><b>&gt; </b></p>
<p>Fixed ESCAN00087584 (chapter 4.5.2) </p>
<p><b>&gt; </b></p>
<p>Fixed ESCAN00088862 (chapter 5) </p>
<p><b>&gt; </b></p>
<p>Reworked NV write frequency Table 3-8 </p>
<p><b>&gt; </b></p>
<p>Changed APIs according to RfC72121(chapters 6.2.9.1, </p>
<p>6.2.9.8) </p>
<p><b>&gt; </b></p>
<p>Reworked Autosar deviation Table 3-2 </p>
<p><b>&gt; </b></p>
<p>Added new header files to Table 4-1 </p>
<p>A. Ditte </p>
<p>2016-04-19 </p>
<p>6.0.1 </p>
<p><b>&gt; </b></p>
<p>Added internal data element DEM_OBD_RATIO in </p>
<p>chapter 3.11.2 </p>
<p>M. Heil </p>
<p>2016-04-22 </p>
<p><b>&gt; </b></p>
<p>Fixed ESCAN00089671 (chapter 4.5) </p>
<p>M. Heil </p>
<p>- </p>
<p>6.1.0 </p>
<p><b>&gt; </b></p>
<p>Version skipped </p>
<p>A. Bosch </p>
<p>2016-05-04 </p>
<p>6.2.0 </p>
<p><b>&gt; </b></p>
<p>Extended number of supported enable and storage </p>
<p>conditions (chapter 3.8, 3.9) </p>
<p><b>&gt; </b></p>
<p>Added API Dem_GetDebouncingOfEvent() </p>
<p><b>&gt; </b></p>
<p>Extended EventStatus values for API </p>
<p>Dem_SetEventStatus() </p>
<p><b>&gt; </b></p>
<p>Fixed ESCAN00089498 (Table 3-7  DTC status </p>
<p>combination) </p>
<p>M. Heil </p>
<p>2016-07-12 </p>
<p><b>&gt; </b></p>
<p>Explicitly mention that NVRAM needs to be initialized </p>
<p>after a SW update (chapter 4.5.2.3) </p>
<p><b>&gt; </b></p>
<p>Added clarification for combined events to </p>
<p>DEM_OBD_RATIO in chapter 3.11.2 </p>
<p>A. Bosch </p>
<p>2016-10-25 </p>
<p>6.3.0 </p>
<p><b>&gt; </b></p>
<p>Support for S/R callbacks </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>5 </p>
<p>based on template version 5.0.0 </p>
<p>M. Heil </p>
<p>2016-11-15 </p>
<p>7.0.0 </p>
<p><b>&gt; </b></p>
<p>MultiCore/MultiPartition support </p>
<p><b>&gt; </b></p>
<p>API change to ASR4.3 (chapters 3.4.1 including all </p>
<p>subchapters, 3.4.2, 3.4.3, 3.4.4, 3.13.2, 3.15, 3.16, </p>
<p>3.19.1, 3.21, 4.6.3, 6.2.6.1, 6.2.6.8, 6.2.6.9, 6.2.6.18, </p>
<p>6.2.6.19, 6.2.6.21, 6.2.6.22, 6.2.6.28, 6.2.6.31, 6.2.6.32, </p>
<p>6.2.6.33, 6.2.7.1, 6.2.8 including all subchapters, 8.1, </p>
<p>8.3) </p>
<p> </p>
<p>A. Bosch </p>
<p>2016-12-15 </p>
<p><b>&gt; </b></p>
<p>Reworked initialization sequence (chapter 3.2) </p>
<p><b>&gt; </b></p>
<p>Added and adapted APIs in chapter 6.2 </p>
<p>E. Jeglorz </p>
<p>2017-01-12 </p>
<p><b>&gt; </b></p>
<p>Rework of API Dem_SetEventStatus() and Storage </p>
<p>Trigger (chapter 3.11.1) due to support of </p>
<p>DEM_EVENT_STATUS_FDC_THRESHOLD_REACHED</p>
<p> </p>
<p>M. Heil </p>
<p>2017-04-10 </p>
<p>7.1.0 </p>
<p><b>&gt; </b></p>
<p>Added ClearDTC notifications (chapters 3.16.6, </p>
<p>6.5.1.12, 6.6.1.2.13) </p>
<p>A. Bosch </p>
<p>2017-04-18 </p>
<p>7.2.0 </p>
<p><b>&gt; </b></p>
<p>Fixed ESCAN00094549 (chapter 3.16) </p>
<p>S. Hübner </p>
<p>2017-05-02 </p>
<p><b>&gt; </b></p>
<p>Added TriggerOnMonitorStatus notification </p>
<p>(chapters 3.16.1, 4.1.2, 6.5.1.13 and Figure 4-1) </p>
<p>A. Bosch </p>
<p>2017-05-04 </p>
<p><b>&gt; </b></p>
<p>Adapted chapter 3.21 for multiple clients </p>
<p>A. Nair </p>
<p>2017-05-18 </p>
<p>7.3.0 </p>
<p><b>&gt; </b></p>
<p>Rework of API Dem_SetDTCSuppression() </p>
<p><b>&gt; </b></p>
<p>Added API Dem_GetDTCSuppression() </p>
<p>S. Hübner </p>
<p>2017-05-22 </p>
<p><b>&gt; </b></p>
<p>Rework include structure of RTE files in chapters 4.1.2 </p>
<p>and 4.2 </p>
<p>A. Bosch </p>
<p>2017-05-23 </p>
<p><b>&gt; </b></p>
<p>Added API Dem_GetEventStatus() to chapter 6.2.6.8 for </p>
<p>compatibility reasons. </p>
<p>E. Jeglorz </p>
<p>2017-06-14 </p>
<p>7.4.0 </p>
<p><b>&gt; </b></p>
<p>Added API Dem_GetOperationCycleState() to chapter </p>
<p>6.2.6.7 </p>
<p>A. Bosch </p>
<p>2017-06-20 </p>
<p><b>&gt; </b></p>
<p>Added healing counters to chapter 3.11.2 </p>
<p>S. Ates </p>
<p>2017-06-21 </p>
<p><b>&gt; </b></p>
<p>Rework of API Dem_SelectDTC() </p>
<p>S. Hübner </p>
<p>2017-07-03 </p>
<p><b>&gt; </b></p>
<p>Rework argument description and return values of </p>
<p>ch 6.2.6.18 Dem_GetEventFreezeFrameDataEx() and </p>
<p>ch 6.2.6.19 Dem_GetEventExtendedDataRecordEx() </p>
<p>A. Nair </p>
<p>2017-07-04 </p>
<p><b>&gt; </b></p>
<p>Added description for Dem_MemMap.h </p>
<p>A. Bosch </p>
<p>2017-07-12 </p>
<p>7.5.0 </p>
<p><b>&gt; </b></p>
<p>Adapt API description due to changes with ASR4.3in </p>
<p>chapters 6.2.6.8, 6.2.6.18 and 6.2.8.17 </p>
<p><b>&gt; </b></p>
<p>Fixed ESCAN00096024 (chapter 6.2.6.23) </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>6 </p>
<p>based on template version 5.0.0 </p>
<p>A.Nair </p>
<p>2017-08-25 </p>
<p>7.6.0 </p>
<p><b>&gt; </b></p>
<p>Updated the list of functions using Exclusive Area 0 </p>
<p>M.Heil </p>
<p>2017-08-30 </p>
<p><b>&gt; </b></p>
<p>Break down the multi partition concept in sub-chapters </p>
<p>(chapter 3.2) </p>
<p>M.Heil </p>
<p>2017-09-11 </p>
<p>7.6.1 </p>
<p><b>&gt; </b></p>
<p>Fixed ESCAN00096543 (chapters 4.1, 4.2) </p>
<p> </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>7 </p>
<p>based on template version 5.0.0 </p>
<p><b>Reference Documents </b></p>
<p><b>No. </b></p>
<p><b>Source </b></p>
<p><b>Title </b></p>
<p><b>Version </b></p>
<p>[1] </p>
<p> AUTOSAR </p>
<p>AUTOSAR_SWS_DiagnosticEventManager.pdf </p>
<p>V4.2.0,  </p>
<p>V4.3.0, </p>
<p>V5.1.0 </p>
<p>[2] </p>
<p> AUTOSAR </p>
<p>AUTOSAR_SWS_DevelopmentErrorTracer.pdf </p>
<p>V3.2.0 </p>
<p>[3] </p>
<p> AUTOSAR </p>
<p>AUTOSAR_SWS_DiagnosticCommunicationManager.pdf </p>
<p>V4.2.0 </p>
<p>[4] </p>
<p> AUTOSAR </p>
<p>AUTOSAR_SWS_NVRAMManager.pdf </p>
<p>V3.2.0 </p>
<p>[5] </p>
<p> AUTOSAR </p>
<p>AUTOSAR_SWS_StandardTypes.pdf </p>
<p>V1.3.0 </p>
<p>[6] </p>
<p> AUTOSAR </p>
<p>AUTOSAR_TR_BSWModuleList.pdf </p>
<p>V1.6.0 </p>
<p>[7] </p>
<p> ISO </p>
<p>14229-1 Road vehicles – Unified diagnostic services (UDS) </p>
<p>– Part 1: Specification and requirements </p>
<p>- </p>
<p>[8] </p>
<p> Vector </p>
<p>TechnicalReference_PostBuildLoadable.pdf </p>
<p>See delivery </p>
<p>[9] </p>
<p> Vector </p>
<p>TechnicalReference_IdentityManager.pdf </p>
<p>See delivery </p>
<p>[10]  Vector </p>
<p>TechnicalReference_Dem_Obd.pdf </p>
<p>(only available if OBD is licensed) </p>
<p>See delivery </p>
<p> </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>We have configured the programs in accordance with your specifications in the </p>
<p>questionnaire. Whereas the programs do support other configurations than the one </p>
<p>specified in your questionnaire, Vector´s release of the programs delivered to your </p>
<p>company is expressly restricted to the configuration you have specified in the </p>
<p>questionnaire. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>8 </p>
<p>based on template version 5.0.0 </p>
<p><b>Contents </b></p>
<p><b>1</b></p>
<p> </p>
<p><b>Component History .................................................................................................... 20</b></p>
<p> </p>
<p><b>2</b></p>
<p> </p>
<p><b>Introduction................................................................................................................. 21</b></p>
<p> </p>
<p>2.1</p>
<p> </p>
<p>How to Read this Document ............................................................................ 21</p>
<p> </p>
<p>2.1.1</p>
<p> </p>
<p>API Definitions ................................................................................. 21</p>
<p> </p>
<p>2.1.2</p>
<p> </p>
<p>Configuration References ................................................................ 22</p>
<p> </p>
<p>2.2</p>
<p> </p>
<p>Architecture Overview ...................................................................................... 22</p>
<p> </p>
<p><b>3</b></p>
<p> </p>
<p><b>Functional Description ............................................................................................... 24</b></p>
<p> </p>
<p>3.1</p>
<p> </p>
<p>Features .......................................................................................................... 24</p>
<p> </p>
<p>3.2</p>
<p> </p>
<p>Dem Module Architecture ................................................................................. 27</p>
<p> </p>
<p>3.2.1</p>
<p> </p>
<p>Dem Satellite(s) ............................................................................... 28</p>
<p> </p>
<p>3.2.2</p>
<p> </p>
<p>Dem Master ..................................................................................... 28</p>
<p> </p>
<p>3.2.3</p>
<p> </p>
<p>Communication constraints .............................................................. 29</p>
<p> </p>
<p>3.3</p>
<p> </p>
<p>Initialization ...................................................................................................... 29</p>
<p> </p>
<p>3.3.1</p>
<p> </p>
<p>Initialization States ........................................................................... 30</p>
<p> </p>
<p>3.4</p>
<p> </p>
<p>Diagnostic Event Processing ........................................................................... 33</p>
<p> </p>
<p>3.4.1</p>
<p> </p>
<p>Event De-bouncing .......................................................................... 33</p>
<p> </p>
<p>3.4.1.1</p>
<p> </p>
<p>Counter Based Algorithm ............................................... 33</p>
<p> </p>
<p>3.4.1.2</p>
<p> </p>
<p>Time Based Algorithm .................................................... 33</p>
<p> </p>
<p>3.4.1.3</p>
<p> </p>
<p>Monitor internal de-bouncing .......................................... 34</p>
<p> </p>
<p>3.4.2</p>
<p> </p>
<p>Event Reporting ............................................................................... 34</p>
<p> </p>
<p>3.4.3</p>
<p> </p>
<p>Monitor Status .................................................................................. 35</p>
<p> </p>
<p>3.4.4</p>
<p> </p>
<p>Event Status .................................................................................... 35</p>
<p> </p>
<p>3.4.4.1</p>
<p> </p>
<p>Event Storage modifying Status Bits .............................. 36</p>
<p> </p>
<p>3.4.4.2</p>
<p> </p>
<p>Lightweight Multiple Trips </p>
<p>(FailureCycleCounterThreshold) .................................... 37</p>
<p> </p>
<p>3.5</p>
<p> </p>
<p>Event Displacement ......................................................................................... 37</p>
<p> </p>
<p>3.6</p>
<p> </p>
<p>Event Aging ...................................................................................................... 38</p>
<p> </p>
<p>3.6.1</p>
<p> </p>
<p>Aging Target ‘0’ ................................................................................ 40</p>
<p> </p>
<p>3.6.2</p>
<p> </p>
<p>Aging Counter Reallocation .............................................................. 40</p>
<p> </p>
<p>3.6.3</p>
<p> </p>
<p>Aging of Environmental Data ............................................................ 40</p>
<p> </p>
<p>3.6.4</p>
<p> </p>
<p>Aging of TestFailedSinceLastClear ................................................... 41</p>
<p> </p>
<p>3.6.5</p>
<p> </p>
<p>Aging and Healing ............................................................................ 41</p>
<p> </p>
<p>3.7</p>
<p> </p>
<p>Operation Cycles ............................................................................................. 41</p>
<p> </p>
<p>3.7.1</p>
<p> </p>
<p>Persistent Storage of Operation Cycle State .................................... 42</p>
<p> </p>
<p>3.7.2</p>
<p> </p>
<p>Automatic Operation Cycle Restart .................................................. 42</p>
<p> </p>
<p>3.8</p>
<p> </p>
<p>Enable Conditions and Control DTC Setting .................................................... 43</p>
<p> </p>
<p>3.8.1</p>
<p> </p>
<p>Effects on de-bouncing and FDC ..................................................... 44</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>9 </p>
<p>based on template version 5.0.0 </p>
<p>3.9</p>
<p> </p>
<p>Storage Conditions .......................................................................................... 44</p>
<p> </p>
<p>3.10</p>
<p> </p>
<p>DTC Suppression ............................................................................................. 45</p>
<p> </p>
<p>3.10.1</p>
<p> </p>
<p>Event Availability .............................................................................. 45</p>
<p> </p>
<p>3.10.2</p>
<p> </p>
<p>Suppress DTC ................................................................................. 46</p>
<p> </p>
<p>3.11</p>
<p> </p>
<p>Environmental Data ......................................................................................... 46</p>
<p> </p>
<p>3.11.1</p>
<p> </p>
<p>Storage Trigger ................................................................................ 47</p>
<p> </p>
<p>3.11.1.1</p>
<p> </p>
<p>Storage Trigger ‘FDC Threshold’ .................................... 47</p>
<p> </p>
<p>3.11.2</p>
<p> </p>
<p>Internal Data Elements ..................................................................... 48</p>
<p> </p>
<p>3.11.3</p>
<p> </p>
<p>External Data Elements ................................................................... 50</p>
<p> </p>
<p>3.11.3.1</p>
<p> </p>
<p>NVRAM storage ............................................................. 50</p>
<p> </p>
<p>3.12</p>
<p> </p>
<p>Freeze Frame Pre-Storage .............................................................................. 50</p>
<p> </p>
<p>3.13</p>
<p> </p>
<p>Combined Events............................................................................................. 51</p>
<p> </p>
<p>3.13.1</p>
<p> </p>
<p>Configuration.................................................................................... 51</p>
<p> </p>
<p>3.13.2</p>
<p> </p>
<p>Event Reporting ............................................................................... 52</p>
<p> </p>
<p>3.13.3</p>
<p> </p>
<p>DTC Status ...................................................................................... 52</p>
<p> </p>
<p>3.13.4</p>
<p> </p>
<p>Environmental Data Update ............................................................. 52</p>
<p> </p>
<p>3.13.5</p>
<p> </p>
<p>Aging ............................................................................................... 53</p>
<p> </p>
<p>3.13.6</p>
<p> </p>
<p>Clear DTC ........................................................................................ 53</p>
<p> </p>
<p>3.14</p>
<p> </p>
<p>Non-Volatile Data Management ....................................................................... 53</p>
<p> </p>
<p>3.14.1</p>
<p> </p>
<p>NvM Interaction ................................................................................ 53</p>
<p> </p>
<p>3.14.2</p>
<p> </p>
<p>NVRAM Write Frequency ................................................................. 53</p>
<p> </p>
<p>3.14.3</p>
<p> </p>
<p>Data Recovery ................................................................................. 54</p>
<p> </p>
<p>3.15</p>
<p> </p>
<p>Diagnostic Interfaces ....................................................................................... 55</p>
<p> </p>
<p>3.16</p>
<p> </p>
<p>Notifications ..................................................................................................... 55</p>
<p> </p>
<p>3.16.1</p>
<p> </p>
<p>Monitor Status Changed .................................................................. 55</p>
<p> </p>
<p>3.16.2</p>
<p> </p>
<p>Event Status Changed ..................................................................... 55</p>
<p> </p>
<p>3.16.3</p>
<p> </p>
<p>DTC Status Changed ....................................................................... 56</p>
<p> </p>
<p>3.16.4</p>
<p> </p>
<p>Event Data Changed ........................................................................ 56</p>
<p> </p>
<p>3.16.5</p>
<p> </p>
<p>Monitor Re-Initialization .................................................................... 57</p>
<p> </p>
<p>3.16.6</p>
<p> </p>
<p>ClearDTC Notification ...................................................................... 57</p>
<p> </p>
<p>3.17</p>
<p> </p>
<p>Indicators ......................................................................................................... 57</p>
<p> </p>
<p>3.17.1</p>
<p> </p>
<p>User Controlled WarningIndicatorRequest ....................................... 57</p>
<p> </p>
<p>3.18</p>
<p> </p>
<p>Interface to the Runtime Environment .............................................................. 58</p>
<p> </p>
<p>3.19</p>
<p> </p>
<p>Error Handling .................................................................................................. 58</p>
<p> </p>
<p>3.19.1</p>
<p> </p>
<p>Development Error Reporting ........................................................... 58</p>
<p> </p>
<p>3.19.1.1</p>
<p> </p>
<p>Parameter Checking ...................................................... 63</p>
<p> </p>
<p>3.19.1.2</p>
<p> </p>
<p>SilentBSW run-time checks ............................................ 63</p>
<p> </p>
<p>3.19.2</p>
<p> </p>
<p>Production Code Error Reporting ..................................................... 63</p>
<p> </p>
<p>3.20</p>
<p> </p>
<p>J1939 ............................................................................................................... 63</p>
<p> </p>
<p>3.20.1</p>
<p> </p>
<p>J1939 Freeze Frame and J1939 Expanded Freeze Frame .............. 64</p>
<p> </p>
<p>3.20.2</p>
<p> </p>
<p>Indicators ......................................................................................... 64</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>10 </p>
<p>based on template version 5.0.0 </p>
<p>3.20.3</p>
<p> </p>
<p>Clear DTC ........................................................................................ 65</p>
<p> </p>
<p>3.20.4</p>
<p> </p>
<p>Service Only DTCs........................................................................... 65</p>
<p> </p>
<p>3.21</p>
<p> </p>
<p>Clear DTC APIs ............................................................................................... 65</p>
<p> </p>
<p><b>4</b></p>
<p> </p>
<p><b>Integration ................................................................................................................... 67</b></p>
<p> </p>
<p>4.1</p>
<p> </p>
<p>Scope of Delivery ............................................................................................. 67</p>
<p> </p>
<p>4.1.1</p>
<p> </p>
<p>Static Files ....................................................................................... 67</p>
<p> </p>
<p>4.1.2</p>
<p> </p>
<p>Dynamic Files .................................................................................. 68</p>
<p> </p>
<p>4.2</p>
<p> </p>
<p>Include Structure .............................................................................................. 70</p>
<p> </p>
<p>4.3</p>
<p> </p>
<p>Compiler Abstraction and Memory Mapping ..................................................... 70</p>
<p> </p>
<p>4.3.1</p>
<p> </p>
<p>Copy Routines ................................................................................. 72</p>
<p> </p>
<p>4.3.2</p>
<p> </p>
<p>Memory Map with multiple partitions ................................................ 72</p>
<p> </p>
<p>4.4</p>
<p> </p>
<p>Synchronization ............................................................................................... 72</p>
<p> </p>
<p>4.4.1</p>
<p> </p>
<p>Atomic Compare/Exchange .............................................................. 73</p>
<p> </p>
<p>4.4.2</p>
<p> </p>
<p>Critical Sections ............................................................................... 73</p>
<p> </p>
<p>4.4.2.1</p>
<p> </p>
<p>Exclusive Area 0 ............................................................ 73</p>
<p> </p>
<p>4.4.2.2</p>
<p> </p>
<p>Exclusive Area 1 ............................................................ 74</p>
<p> </p>
<p>4.4.2.3</p>
<p> </p>
<p>Exclusive Area 2 ............................................................ 75</p>
<p> </p>
<p>4.4.2.4</p>
<p> </p>
<p>Exclusive Area 3 ............................................................ 76</p>
<p> </p>
<p>4.5</p>
<p> </p>
<p>NvM Integration ............................................................................................... 76</p>
<p> </p>
<p>4.5.1</p>
<p> </p>
<p>NVRAM Demand ............................................................................. 77</p>
<p> </p>
<p>4.5.2</p>
<p> </p>
<p>NVRAM Initialization ........................................................................ 78</p>
<p> </p>
<p>4.5.2.1</p>
<p> </p>
<p>Controlled Re-initialization ............................................. 78</p>
<p> </p>
<p>4.5.2.2</p>
<p> </p>
<p>Manual Re-initialization .................................................. 78</p>
<p> </p>
<p>4.5.2.3</p>
<p> </p>
<p>Initialization and ECU Reset .......................................... 79</p>
<p> </p>
<p>4.5.2.4</p>
<p> </p>
<p>Common Errors ............................................................. 79</p>
<p> </p>
<p>4.5.3</p>
<p> </p>
<p>Expected NvM Behavior ................................................................... 80</p>
<p> </p>
<p>4.5.4</p>
<p> </p>
<p>Flash Lifetime Considerations .......................................................... 81</p>
<p> </p>
<p>4.6</p>
<p> </p>
<p>Rte Integration ................................................................................................. 81</p>
<p> </p>
<p>4.6.1</p>
<p> </p>
<p>Runnable Entities ............................................................................. 81</p>
<p> </p>
<p>4.6.2</p>
<p> </p>
<p>Application Port Interface ................................................................. 82</p>
<p> </p>
<p>4.6.3</p>
<p> </p>
<p>DcmIf ............................................................................................... 82</p>
<p> </p>
<p>4.7</p>
<p> </p>
<p>Post-Run requirements .................................................................................... 83</p>
<p> </p>
<p>4.8</p>
<p> </p>
<p>Run-Time limitation .......................................................................................... 83</p>
<p> </p>
<p>4.9</p>
<p> </p>
<p>Split main function ............................................................................................ 83</p>
<p> </p>
<p>4.10</p>
<p> </p>
<p>Multi-Partition setup ......................................................................................... 84</p>
<p> </p>
<p><b>5</b></p>
<p> </p>
<p><b>Measurement and Calibration .................................................................................... 85</b></p>
<p> </p>
<p>5.1</p>
<p> </p>
<p>Measurable Data.............................................................................................. 85</p>
<p> </p>
<p>5.1.1</p>
<p> </p>
<p>Dem_Cfg_StatusData ...................................................................... 85</p>
<p> </p>
<p>5.1.2</p>
<p> </p>
<p>Dem_Cfg_EventDebounceValue ...................................................... 85</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>11 </p>
<p>based on template version 5.0.0 </p>
<p>5.1.3</p>
<p> </p>
<p>Dem_Cfg_EventMaxDebounceValues ............................................. 86</p>
<p> </p>
<p>5.1.4</p>
<p> </p>
<p>Dem_Cfg_PrimaryEntry_&lt;Number&gt; ................................................. 86</p>
<p> </p>
<p>5.2</p>
<p> </p>
<p>Post-Build Support ........................................................................................... 86</p>
<p> </p>
<p>5.2.1</p>
<p> </p>
<p>Initialization ...................................................................................... 86</p>
<p> </p>
<p>5.2.2</p>
<p> </p>
<p>Post-Build Loadable ......................................................................... 88</p>
<p> </p>
<p>5.2.3</p>
<p> </p>
<p>Post-Build Selectable ....................................................................... 88</p>
<p> </p>
<p><b>6</b></p>
<p> </p>
<p><b>API Description ........................................................................................................... 89</b></p>
<p> </p>
<p>6.1</p>
<p> </p>
<p>Type Definitions ............................................................................................... 89</p>
<p> </p>
<p>6.2</p>
<p> </p>
<p>Services provided by Dem ............................................................................... 90</p>
<p> </p>
<p>6.2.1</p>
<p> </p>
<p>Dem_GetVersionInfo() ..................................................................... 90</p>
<p> </p>
<p>6.2.2</p>
<p> </p>
<p>Dem_MasterMainFunction() ............................................................. 91</p>
<p> </p>
<p>6.2.3</p>
<p> </p>
<p>Dem_SatelliteMainFunction() ........................................................... 91</p>
<p> </p>
<p>6.2.4</p>
<p> </p>
<p>Dem_MainFunction() ........................................................................ 92</p>
<p> </p>
<p>6.2.5</p>
<p> </p>
<p>Interface EcuM ................................................................................. 93</p>
<p> </p>
<p>6.2.5.1</p>
<p> </p>
<p>Dem_MasterPreInit() ...................................................... 93</p>
<p> </p>
<p>6.2.5.2</p>
<p> </p>
<p>Dem_SatellitePreInit() .................................................... 94</p>
<p> </p>
<p>6.2.5.3</p>
<p> </p>
<p>Dem_PreInit() ................................................................ 95</p>
<p> </p>
<p>6.2.5.4</p>
<p> </p>
<p>Dem_MasterInit() ........................................................... 96</p>
<p> </p>
<p>6.2.5.5</p>
<p> </p>
<p>Dem_SatelliteInit() ......................................................... 97</p>
<p> </p>
<p>6.2.5.6</p>
<p> </p>
<p>Dem_Init() ...................................................................... 98</p>
<p> </p>
<p>6.2.5.7</p>
<p> </p>
<p>Dem_InitMemory() ......................................................... 99</p>
<p> </p>
<p>6.2.5.8</p>
<p> </p>
<p>Dem_Shutdown() ......................................................... 100</p>
<p> </p>
<p>6.2.6</p>
<p> </p>
<p>Interface SWC and CDD ................................................................ 101</p>
<p> </p>
<p>6.2.6.1</p>
<p> </p>
<p>Dem_SetEventStatus() ................................................ 101</p>
<p> </p>
<p>6.2.6.2</p>
<p> </p>
<p>Dem_ResetEventStatus() ............................................ 102</p>
<p> </p>
<p>6.2.6.3</p>
<p> </p>
<p>Dem_ResetEventDebounceStatus() ............................ 103</p>
<p> </p>
<p>6.2.6.4</p>
<p> </p>
<p>Dem_PrestoreFreezeFrame() ...................................... 104</p>
<p> </p>
<p>6.2.6.5</p>
<p> </p>
<p>Dem_ClearPrestoredFreezeFrame() ............................ 105</p>
<p> </p>
<p>6.2.6.6</p>
<p> </p>
<p>Dem_SetOperationCycleState() ................................... 106</p>
<p> </p>
<p>6.2.6.7</p>
<p> </p>
<p>Dem_GetOperationCycleState() .................................. 107</p>
<p> </p>
<p>6.2.6.8</p>
<p> </p>
<p>Dem_GetEventUdsStatus() .......................................... 108</p>
<p> </p>
<p>6.2.6.9</p>
<p> </p>
<p>Dem_GetMonitorStatus() ............................................. 109</p>
<p> </p>
<p>6.2.6.10</p>
<p> </p>
<p>Dem_GetEventFailed() ................................................ 110</p>
<p> </p>
<p>6.2.6.11</p>
<p> </p>
<p>Dem_GetEventTested() ................................................ 111</p>
<p> </p>
<p>6.2.6.12</p>
<p> </p>
<p>Dem_GetDTCOfEvent() ............................................... 112</p>
<p> </p>
<p>6.2.6.13</p>
<p> </p>
<p>Dem_GetEventAvailable() ............................................ 113</p>
<p> </p>
<p>6.2.6.14</p>
<p> </p>
<p>Dem_SetEnableCondition() ......................................... 114</p>
<p> </p>
<p>6.2.6.15</p>
<p> </p>
<p>Dem_SetStorageCondition() ........................................ 115</p>
<p> </p>
<p>6.2.6.16</p>
<p> </p>
<p>Dem_GetFaultDetectionCounter() ................................ 116</p>
<p> </p>
<p>6.2.6.17</p>
<p> </p>
<p>Dem_GetIndicatorStatus() ........................................... 117</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>12 </p>
<p>based on template version 5.0.0 </p>
<p>6.2.6.18</p>
<p> </p>
<p>Dem_GetEventFreezeFrameDataEx() ......................... 118</p>
<p> </p>
<p>6.2.6.19</p>
<p> </p>
<p>Dem_GetEventExtendedDataRecordEx() .................... 119</p>
<p> </p>
<p>6.2.6.20</p>
<p> </p>
<p>Dem_GetEventEnableCondition() ................................ 120</p>
<p> </p>
<p>6.2.6.21</p>
<p> </p>
<p>Dem_GetEventMemoryOverflow() ............................... 121</p>
<p> </p>
<p>6.2.6.22</p>
<p> </p>
<p>Dem_GetNumberOfEventMemoryEntries() .................. 122</p>
<p> </p>
<p>6.2.6.23</p>
<p> </p>
<p>Dem_PostRunRequested() .......................................... 123</p>
<p> </p>
<p>6.2.6.24</p>
<p> </p>
<p>Dem_SetWIRStatus() .................................................. 124</p>
<p> </p>
<p>6.2.6.25</p>
<p> </p>
<p>Dem_GetWIRStatus() .................................................. 125</p>
<p> </p>
<p>6.2.6.26</p>
<p> </p>
<p>Dem_SetDTCSuppression() ........................................ 126</p>
<p> </p>
<p>6.2.6.27</p>
<p> </p>
<p>Dem_SetEventAvailable() ............................................ 127</p>
<p> </p>
<p>6.2.6.28</p>
<p> </p>
<p>Dem_ClearDTC() ......................................................... 128</p>
<p> </p>
<p>6.2.6.29</p>
<p> </p>
<p>Dem_RequestNvSynchronization() .............................. 129</p>
<p> </p>
<p>6.2.6.30</p>
<p> </p>
<p>Dem_GetDebouncingOfEvent() ................................... 130</p>
<p> </p>
<p>6.2.6.31</p>
<p> </p>
<p>Dem_SelectDTC() ....................................................... 131</p>
<p> </p>
<p>6.2.6.32</p>
<p> </p>
<p>Dem_GetDTCSelectionResult() ................................... 133</p>
<p> </p>
<p>6.2.6.33</p>
<p> </p>
<p>Dem_GetEventIdOfDTC() ............................................ 134</p>
<p> </p>
<p>6.2.6.34</p>
<p> </p>
<p>Dem_GetDTCSuppression() ........................................ 135</p>
<p> </p>
<p>6.2.7</p>
<p> </p>
<p>Interface BSW ................................................................................ 136</p>
<p> </p>
<p>6.2.7.1</p>
<p> </p>
<p>Dem_ReportErrorStatus() ............................................ 136</p>
<p> </p>
<p>6.2.8</p>
<p> </p>
<p>Interface Dcm................................................................................. 137</p>
<p> </p>
<p>6.2.8.1</p>
<p> </p>
<p>Dem_SetDTCFilter() .................................................... 137</p>
<p> </p>
<p>6.2.8.2</p>
<p> </p>
<p>Dem_GetNumberOfFilteredDTC() ................................ 139</p>
<p> </p>
<p>6.2.8.3</p>
<p> </p>
<p>Dem_GetNextFilteredDTC() ......................................... 140</p>
<p> </p>
<p>6.2.8.4</p>
<p> </p>
<p>Dem_GetNextFilteredDTCAndFDC() ........................... 141</p>
<p> </p>
<p>6.2.8.5</p>
<p> </p>
<p>Dem_GetNextFilteredDTCAndSeverity() ...................... 142</p>
<p> </p>
<p>6.2.8.6</p>
<p> </p>
<p>Dem_SetFreezeFrameRecordFilter() ........................... 143</p>
<p> </p>
<p>6.2.8.7</p>
<p> </p>
<p>Dem_GetNextFilteredRecord() .................................... 144</p>
<p> </p>
<p>6.2.8.8</p>
<p> </p>
<p>Dem_GetStatusOfDTC() .............................................. 145</p>
<p> </p>
<p>6.2.8.9</p>
<p> </p>
<p>Dem_GetDTCStatusAvailabilityMask() ......................... 146</p>
<p> </p>
<p>6.2.8.10</p>
<p> </p>
<p>Dem_GetDTCByOccurrenceTime() .............................. 147</p>
<p> </p>
<p>6.2.8.11</p>
<p> </p>
<p>Dem_GetTranslationType() .......................................... 148</p>
<p> </p>
<p>6.2.8.12</p>
<p> </p>
<p>Dem_GetSeverityOfDTC() ........................................... 149</p>
<p> </p>
<p>6.2.8.13</p>
<p> </p>
<p>Dem_GetFunctionalUnitOfDTC() ................................. 150</p>
<p> </p>
<p>6.2.8.14</p>
<p> </p>
<p>Dem_DisableDTCRecordUpdate() ............................... 151</p>
<p> </p>
<p>6.2.8.15</p>
<p> </p>
<p>Dem_EnableDTCRecordUpdate() ................................ 152</p>
<p> </p>
<p>6.2.8.16</p>
<p> </p>
<p>Dem_SelectFreezeFrameData() .................................. 153</p>
<p> </p>
<p>6.2.8.17</p>
<p> </p>
<p>Dem_GetNextFreezeFrameData() ............................... 154</p>
<p> </p>
<p>6.2.8.18</p>
<p> </p>
<p>Dem_GetSizeOfFreezeFrameSelection() ..................... 155</p>
<p> </p>
<p>6.2.8.19</p>
<p> </p>
<p>Dem_SelectExtendedDataRecord() ............................. 156</p>
<p> </p>
<p>6.2.8.20</p>
<p> </p>
<p>Dem_GetNextExtendedDataRecord() .......................... 157</p>
<p> </p>
<p>6.2.8.21</p>
<p> </p>
<p>Dem_GetSizeOfExtendedDataRecordSelection() ........ 158</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>13 </p>
<p>based on template version 5.0.0 </p>
<p>6.2.8.22</p>
<p> </p>
<p>Dem_DisableDTCSetting() ........................................... 159</p>
<p> </p>
<p>6.2.8.23</p>
<p> </p>
<p>Dem_EnableDTCSetting() ........................................... 160</p>
<p> </p>
<p>6.2.9</p>
<p> </p>
<p>Interface J1939Dcm ....................................................................... 161</p>
<p> </p>
<p>6.2.9.1</p>
<p> </p>
<p>Dem_J1939DcmClearDTC() ........................................ 161</p>
<p> </p>
<p>6.2.9.2</p>
<p> </p>
<p>Dem_J1939DcmFirstDTCwithLampStatus()................. 163</p>
<p> </p>
<p>6.2.9.3</p>
<p> </p>
<p>Dem_J1939DcmGetNextDTCwithLampStatus () ......... 164</p>
<p> </p>
<p>6.2.9.4</p>
<p> </p>
<p>Dem_J1939DcmGetNextFilteredDTC() ........................ 165</p>
<p> </p>
<p>6.2.9.5</p>
<p> </p>
<p>Dem_J1939DcmGetNextFreezeFrame() ...................... 166</p>
<p> </p>
<p>6.2.9.6</p>
<p> </p>
<p>Dem_J1939DcmGetNextSPNInFreezeFrame() ........... 167</p>
<p> </p>
<p>6.2.9.7</p>
<p> </p>
<p>Dem_J1939DcmGetNumberOfFilteredDTC () .............. 168</p>
<p> </p>
<p>6.2.9.8</p>
<p> </p>
<p>Dem_J1939DcmSetDTCFilter() ................................... 169</p>
<p> </p>
<p>6.2.9.9</p>
<p> </p>
<p>Dem_J1939DcmSetFreezeFrameFilter() ..................... 171</p>
<p> </p>
<p>6.2.9.10</p>
<p> </p>
<p>Dem_J1939DcmReadDiagnosticReadiness1() ............ 172</p>
<p> </p>
<p>6.3</p>
<p> </p>
<p>Services used by Dem ................................................................................... 173</p>
<p> </p>
<p>6.3.1</p>
<p> </p>
<p>EcuM_BswErrorHook() .................................................................. 173</p>
<p> </p>
<p>6.4</p>
<p> </p>
<p>Callback Functions ......................................................................................... 174</p>
<p> </p>
<p>6.4.1</p>
<p> </p>
<p>Dem_NvM_JobFinished() .............................................................. 175</p>
<p> </p>
<p>6.4.2</p>
<p> </p>
<p>Dem_NvM_InitAdminData() ........................................................... 176</p>
<p> </p>
<p>6.4.3</p>
<p> </p>
<p>Dem_NvM_InitStatusData() ........................................................... 177</p>
<p> </p>
<p>6.4.4</p>
<p> </p>
<p>Dem_NvM_InitDebounceData() ..................................................... 178</p>
<p> </p>
<p>6.4.5</p>
<p> </p>
<p>Dem_NvM_InitEventAvailableData() .............................................. 179</p>
<p> </p>
<p>6.5</p>
<p> </p>
<p>Configurable Interfaces .................................................................................. 180</p>
<p> </p>
<p>6.5.1</p>
<p> </p>
<p>Callouts .......................................................................................... 180</p>
<p> </p>
<p>6.5.1.1</p>
<p> </p>
<p>CBClrEvt_&lt;EventName&gt;() ........................................... 180</p>
<p> </p>
<p>6.5.1.2</p>
<p> </p>
<p>CBDataEvt_&lt;EventName&gt;() ........................................ 181</p>
<p> </p>
<p>6.5.1.3</p>
<p> </p>
<p>CBFaultDetectCtr_&lt;EventName&gt;() .............................. 182</p>
<p> </p>
<p>6.5.1.4</p>
<p> </p>
<p>CBInitEvt_&lt;EventName&gt;() ........................................... 183</p>
<p> </p>
<p>6.5.1.5</p>
<p> </p>
<p>CBInitFct_&lt;N&gt;() ........................................................... 183</p>
<p> </p>
<p>6.5.1.6</p>
<p> </p>
<p>CBReadData_&lt;SyncDataElement&gt;() ........................... 184</p>
<p> </p>
<p>6.5.1.7</p>
<p> </p>
<p>CBStatusDTC_&lt;N&gt;() ................................................... 185</p>
<p> </p>
<p>6.5.1.8</p>
<p> </p>
<p>CBStatusJ1939DTC_&lt;N&gt;() .......................................... 186</p>
<p> </p>
<p>6.5.1.9</p>
<p> </p>
<p>CBStatusEvt_&lt;EventName&gt;_&lt;N&gt;() ............................. 186</p>
<p> </p>
<p>6.5.1.10</p>
<p> </p>
<p>GeneralCBDataEvt() .................................................... 187</p>
<p> </p>
<p>6.5.1.11</p>
<p> </p>
<p>GeneralCBStatusEvt() ................................................. 187</p>
<p> </p>
<p>6.5.1.12</p>
<p> </p>
<p>&lt;Module&gt;_ClearDtcNotification </p>
<p>_&lt;DemEventMemorySet&gt;_&lt;ShortName&gt;() ................. 188</p>
<p> </p>
<p>6.5.1.13</p>
<p> </p>
<p>&lt;Module&gt;_DemTriggerOnMonitorStatus() ................... 189</p>
<p> </p>
<p>6.5.1.14</p>
<p> </p>
<p>ApplDem_SyncCompareAndSwap() ............................ 190</p>
<p> </p>
<p>6.6</p>
<p> </p>
<p>Service Ports ................................................................................................. 190</p>
<p> </p>
<p>6.6.1</p>
<p> </p>
<p>Client Server Interface ................................................................... 190</p>
<p> </p>
<p>6.6.1.1</p>
<p> </p>
<p>Provide Ports on Dem Side .......................................... 191</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>14 </p>
<p>based on template version 5.0.0 </p>
<p>6.6.1.1.1</p>
<p> </p>
<p>DiagnosticMonitor .................................... 191</p>
<p> </p>
<p>6.6.1.1.2</p>
<p> </p>
<p>DiagnosticInfo and </p>
<p>GeneralDiagnosticInfo ............................. 191</p>
<p> </p>
<p>6.6.1.1.3</p>
<p> </p>
<p>OperationCycle ........................................ 192</p>
<p> </p>
<p>6.6.1.1.4</p>
<p> </p>
<p>AgingCycle .............................................. 193</p>
<p> </p>
<p>6.6.1.1.5</p>
<p> </p>
<p>ExternalAgingCycle .................................. 193</p>
<p> </p>
<p>6.6.1.1.6</p>
<p> </p>
<p>EnableCondition ...................................... 193</p>
<p> </p>
<p>6.6.1.1.7</p>
<p> </p>
<p>StorageCondition ..................................... 193</p>
<p> </p>
<p>6.6.1.1.8</p>
<p> </p>
<p>IndicatorStatus ......................................... 193</p>
<p> </p>
<p>6.6.1.1.9</p>
<p> </p>
<p>EventStatus ............................................. 193</p>
<p> </p>
<p>6.6.1.1.10</p>
<p> </p>
<p>EvMemOverflowIndication ....................... 193</p>
<p> </p>
<p>6.6.1.1.11</p>
<p> </p>
<p>DTCSuppression ..................................... 194</p>
<p> </p>
<p>6.6.1.1.12</p>
<p> </p>
<p>DemServices ........................................... 194</p>
<p> </p>
<p>6.6.1.1.13</p>
<p> </p>
<p>DcmIf ....................................................... 194</p>
<p> </p>
<p>6.6.1.1.14</p>
<p> </p>
<p>ClearDTC ................................................. 195</p>
<p> </p>
<p>6.6.1.2</p>
<p> </p>
<p>Require Ports on Dem Side ......................................... 195</p>
<p> </p>
<p>6.6.1.2.1</p>
<p> </p>
<p>CBInitEvt_&lt;EventName&gt; ......................... 195</p>
<p> </p>
<p>6.6.1.2.2</p>
<p> </p>
<p>CBInitFct_&lt;DtcName&gt;_ ........................... 195</p>
<p> </p>
<p>6.6.1.2.3</p>
<p> </p>
<p>CBEventUdsStatusChanged </p>
<p>_&lt;EventName&gt;_&lt;CallbackName&gt; ........... 196</p>
<p> </p>
<p>6.6.1.2.4</p>
<p> </p>
<p>GeneralCBStatusEvt ................................ 196</p>
<p> </p>
<p>6.6.1.2.5</p>
<p> </p>
<p>CBStatusDTC_&lt;CallbackName&gt; ............. 196</p>
<p> </p>
<p>6.6.1.2.6</p>
<p> </p>
<p>CBDataEvt_&lt;EventName&gt; ...................... 196</p>
<p> </p>
<p>6.6.1.2.7</p>
<p> </p>
<p>GeneralCBDataEvt .................................. 196</p>
<p> </p>
<p>6.6.1.2.8</p>
<p> </p>
<p>CBClrEvt_&lt;EventName&gt; ......................... 196</p>
<p> </p>
<p>6.6.1.2.9</p>
<p> </p>
<p>CBReadData_&lt;SyncDataElement&gt; ......... 197</p>
<p> </p>
<p>6.6.1.2.10</p>
<p> </p>
<p>CBFaultDetectCtr_&lt;EventName&gt; ............ 197</p>
<p> </p>
<p>6.6.1.2.11</p>
<p> </p>
<p>CBControlDTCSetting .............................. 197</p>
<p> </p>
<p>6.6.1.2.12</p>
<p> </p>
<p>DemSc ..................................................... 197</p>
<p> </p>
<p>6.6.1.2.13</p>
<p> </p>
<p>ClearDtcNotification </p>
<p>_&lt;EventMemorySet&gt;_&lt;Notification&gt; ........ 197</p>
<p> </p>
<p>6.7</p>
<p> </p>
<p>Not Supported APIs ....................................................................................... 197</p>
<p> </p>
<p><b>7</b></p>
<p> </p>
<p><b>Configuration ............................................................................................................ 199</b></p>
<p> </p>
<p>7.1</p>
<p> </p>
<p>Configuration Variants .................................................................................... 199</p>
<p> </p>
<p>7.2</p>
<p> </p>
<p>Configurable Attributes ................................................................................... 199</p>
<p> </p>
<p>7.3</p>
<p> </p>
<p>Configuration of Post-Build Loadable ............................................................. 199</p>
<p> </p>
<p>7.3.1</p>
<p> </p>
<p>Supported Variance ........................................................................ 200</p>
<p> </p>
<p><b>8</b></p>
<p> </p>
<p><b>AUTOSAR Standard Compliance............................................................................. 201</b></p>
<p> </p>
<p>8.1</p>
<p> </p>
<p>Deviations ...................................................................................................... 201</p>
<p> </p>
<p>Dem_J1939DcmClearDTC()</p>
<p> ........................................................ 201</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>15 </p>
<p>based on template version 5.0.0 </p>
<p>Dem_J1939DcmSetDTCFilter()</p>
<p> ............................................... 201</p>
<p> </p>
<p>8.2</p>
<p> </p>
<p>Additions/ Extensions ..................................................................................... 201</p>
<p> </p>
<p>8.3</p>
<p> </p>
<p>Limitations...................................................................................................... 201</p>
<p> </p>
<p>8.4</p>
<p> </p>
<p>Not Supported Service Interfaces .................................................................. 202</p>
<p> </p>
<p><b>9</b></p>
<p> </p>
<p><b>Glossary and Abbreviations .................................................................................... 204</b></p>
<p> </p>
<p>9.1</p>
<p> </p>
<p>Glossary ........................................................................................................ 204</p>
<p> </p>
<p>9.2</p>
<p> </p>
<p>Abbreviations ................................................................................................. 204</p>
<p> </p>
<p><b>10</b></p>
<p> </p>
<p><b>Contact ...................................................................................................................... 206</b></p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>16 </p>
<p>based on template version 5.0.0 </p>
<p><b>Illustrations </b></p>
<p>Figure 2-1</p>
<p> </p>
<p>AUTOSAR 4.1 Architecture Overview ....................................................... 22</p>
<p> </p>
<p>Figure 2-2</p>
<p> </p>
<p>Interfaces to adjacent modules of the Dem ............................................... 23</p>
<p> </p>
<p>Figure 3-1</p>
<p> </p>
<p>Dem Architecture Overview ...................................................................... 27</p>
<p> </p>
<p>Figure 3-2</p>
<p> </p>
<p>Dem states ............................................................................................... 32</p>
<p> </p>
<p>Figure 3-3</p>
<p> </p>
<p>Effect of Precondition ‘Event Storage’ and Displacement on Status Bits ... 36</p>
<p> </p>
<p>Figure 3-4</p>
<p> </p>
<p>Behavior of the Aging Counter .................................................................. 39</p>
<p> </p>
<p>Figure 3-5</p>
<p> </p>
<p>Environmental Data Layout ....................................................................... 47</p>
<p> </p>
<p>Figure 3-6</p>
<p> </p>
<p>User Controlled WarningIndicatorRequest ................................................ 58</p>
<p> </p>
<p>Figure 3-7</p>
<p> </p>
<p>Concurrent Clear Requests ...................................................................... 66</p>
<p> </p>
<p>Figure 4-1</p>
<p> </p>
<p>Include structure ....................................................................................... 70</p>
<p> </p>
<p>Figure 4-2</p>
<p> </p>
<p>NvM behavior ........................................................................................... 80</p>
<p> </p>
<p>Figure 4-3</p>
<p> </p>
<p>Multi-Partition memory write access ......................................................... 84</p>
<p> </p>
<p><b> </b></p>
<p><b>Tables </b></p>
<p>Table 1-1 </p>
<p> </p>
<p>Component history.................................................................................... 20</p>
<p> </p>
<p>Table 3-1 </p>
<p> </p>
<p>Supported AUTOSAR standard conform features ..................................... 24</p>
<p> </p>
<p>Table 3-2 </p>
<p> </p>
<p>Not supported AUTOSAR standard conform features ............................... 26</p>
<p> </p>
<p>Table 3-3 </p>
<p> </p>
<p>Features provided beyond the AUTOSAR standard .................................. 27</p>
<p> </p>
<p>Table 3-4 </p>
<p> </p>
<p>Configuration of status bit processing ....................................................... 37</p>
<p> </p>
<p>Table 3-5 </p>
<p> </p>
<p>Aging algorithms ....................................................................................... 39</p>
<p> </p>
<p>Table 3-6 </p>
<p> </p>
<p>Immediate aging ....................................................................................... 40</p>
<p> </p>
<p>Table 3-7 </p>
<p> </p>
<p>DTC status combination ........................................................................... 52</p>
<p> </p>
<p>Table 3-8 </p>
<p> </p>
<p>NVRAM write frequency ........................................................................... 54</p>
<p> </p>
<p>Table 3-9 </p>
<p> </p>
<p>Service IDs ............................................................................................... 61</p>
<p> </p>
<p>Table 3-10 </p>
<p> </p>
<p>Additional Service IDs ............................................................................... 62</p>
<p> </p>
<p>Table 3-11 </p>
<p> </p>
<p>Errors reported to Det ............................................................................... 62</p>
<p> </p>
<p>Table 3-12 </p>
<p> </p>
<p>Diagnostic messages where content is provided by Dem ......................... 64</p>
<p> </p>
<p>Table 3-13 </p>
<p> </p>
<p>J1939 DTC Status to be cleared ............................................................... 65</p>
<p> </p>
<p>Table 4-1 </p>
<p> </p>
<p>Static files ................................................................................................. 68</p>
<p> </p>
<p>Table 4-2 </p>
<p> </p>
<p>Generated files ......................................................................................... 69</p>
<p> </p>
<p>Table 4-3 </p>
<p> </p>
<p>Compiler abstraction and memory mapping, constant sections ................ 71</p>
<p> </p>
<p>Table 4-4 </p>
<p> </p>
<p>Compiler abstraction and memory mapping, variable sections ................. 72</p>
<p> </p>
<p>Table 4-5 </p>
<p> </p>
<p>Exclusive Area 0 ....................................................................................... 74</p>
<p> </p>
<p>Table 4-6 </p>
<p> </p>
<p>Exclusive Area 1 ....................................................................................... 74</p>
<p> </p>
<p>Table 4-7 </p>
<p> </p>
<p>Exclusive Area 2 ....................................................................................... 75</p>
<p> </p>
<p>Table 4-8 </p>
<p> </p>
<p>NvRam blocks .......................................................................................... 77</p>
<p> </p>
<p>Table 4-9 </p>
<p> </p>
<p>NvRam initialization .................................................................................. 78</p>
<p> </p>
<p>Table 4-10 </p>
<p> </p>
<p>Dem runnable entities ............................................................................... 82</p>
<p> </p>
<p>Table 5-1 </p>
<p> </p>
<p>Measurement item Dem_Cfg_StatusData ................................................. 85</p>
<p> </p>
<p>Table 5-2 </p>
<p> </p>
<p>Measurement item Dem_Cfg_EventDebounceValue ................................ 85</p>
<p> </p>
<p>Table 5-3 </p>
<p> </p>
<p>Measurement item Dem_Cfg_EventMaxDebounceValues[] ...................... 86</p>
<p> </p>
<p>Table 5-4 </p>
<p> </p>
<p>Measurement item Dem_Cfg_PrimaryEntry_&lt;Number&gt; ........................... 86</p>
<p> </p>
<p>Table 5-5 </p>
<p> </p>
<p>Error Codes possible during Post-Build initialization failure ....................... 87</p>
<p> </p>
<p>Table 6-1 </p>
<p> </p>
<p>Dem_GetVersionInfo() .............................................................................. 90</p>
<p> </p>
<p>Table 6-2 </p>
<p> </p>
<p>Dem_MasterMainFunction() ..................................................................... 91</p>
<p> </p>
<p>Table 6-3 </p>
<p> </p>
<p>Dem_SatelliteMainFunction() .................................................................... 91</p>
<p> </p>
<p>Table 6-4 </p>
<p> </p>
<p>Dem_MainFunction() ................................................................................ 92</p>
<p> </p>
<p>Table 6-5</p>
<p> </p>
<p>Dem_MasterPreInit() ................................................................................ 93</p>
<p> </p>
<p>Table 6-6</p>
<p> </p>
<p>Dem_SatellitePreInit() ............................................................................... 94</p>
<p> </p>
<p>Table 6-7 </p>
<p> </p>
<p>Dem_PreInit() ........................................................................................... 95</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>17 </p>
<p>based on template version 5.0.0 </p>
<p>Table 6-8</p>
<p> </p>
<p>Dem_MasterInit() ...................................................................................... 96</p>
<p> </p>
<p>Table 6-9</p>
<p> </p>
<p>Dem_SatelliteInit() .................................................................................... 97</p>
<p> </p>
<p>Table 6-10 </p>
<p> </p>
<p>Dem_Init() ................................................................................................. 98</p>
<p> </p>
<p>Table 6-11 </p>
<p> </p>
<p>Dem_InitMemory() .................................................................................... 99</p>
<p> </p>
<p>Table 6-12 </p>
<p> </p>
<p>Dem_Shutdown() .................................................................................... 100</p>
<p> </p>
<p>Table 6-13 </p>
<p> </p>
<p>Dem_SetEventStatus() ........................................................................... 101</p>
<p> </p>
<p>Table 6-14 </p>
<p> </p>
<p>Dem_ResetEventStatus() ....................................................................... 102</p>
<p> </p>
<p>Table 6-15 </p>
<p> </p>
<p>Dem_ResetEventDebounceStatus() ....................................................... 103</p>
<p> </p>
<p>Table 6-16 </p>
<p> </p>
<p>Dem_PrestoreFreezeFrame() ................................................................. 104</p>
<p> </p>
<p>Table 6-17 </p>
<p> </p>
<p>Dem_ClearPrestoredFreezeFrame() ...................................................... 105</p>
<p> </p>
<p>Table 6-18 </p>
<p> </p>
<p>Dem_SetOperationCycleState().............................................................. 106</p>
<p> </p>
<p>Table 6-19 </p>
<p> </p>
<p>Dem_GetOperationCycleState ............................................................... 107</p>
<p> </p>
<p>Table 6-20 </p>
<p> </p>
<p>Dem_GetEventUdsStatus() .................................................................... 108</p>
<p> </p>
<p>Table 6-21 </p>
<p> </p>
<p>Dem_GetMonitorStatus() ........................................................................ 109</p>
<p> </p>
<p>Table 6-22 </p>
<p> </p>
<p>Dem_GetEventFailed() ........................................................................... 110</p>
<p> </p>
<p>Table 6-23 </p>
<p> </p>
<p>Dem_GetEventTested() ........................................................................... 111</p>
<p> </p>
<p>Table 6-24 </p>
<p> </p>
<p>Dem_GetDTCOfEvent() .......................................................................... 112</p>
<p> </p>
<p>Table 6-25 </p>
<p> </p>
<p>Dem_GetEventAvailable() ...................................................................... 113</p>
<p> </p>
<p>Table 6-26 </p>
<p> </p>
<p>Dem_SetEnableCondition() .................................................................... 114</p>
<p> </p>
<p>Table 6-27 </p>
<p> </p>
<p>Dem_SetStorageCondition() ................................................................... 115</p>
<p> </p>
<p>Table 6-28 </p>
<p> </p>
<p>Dem_GetFaultDetectionCounter() .......................................................... 116</p>
<p> </p>
<p>Table 6-29 </p>
<p> </p>
<p>Dem_GetIndicatorStatus() ...................................................................... 117</p>
<p> </p>
<p>Table 6-30 </p>
<p> </p>
<p>Dem_GetEventFreezeFrameDataEx() .................................................... 118</p>
<p> </p>
<p>Table 6-31 </p>
<p> </p>
<p>Dem_GetEventExtendedDataRecordEx() ............................................... 119</p>
<p> </p>
<p>Table 6-32 </p>
<p> </p>
<p>Dem_GetEventEnableCondition() ........................................................... 120</p>
<p> </p>
<p>Table 6-33 </p>
<p> </p>
<p>Dem_GetEventMemoryOverflow() .......................................................... 121</p>
<p> </p>
<p>Table 6-34 </p>
<p> </p>
<p>Dem_GetNumberOfEventMemoryEntries() ............................................. 122</p>
<p> </p>
<p>Table 6-35 </p>
<p> </p>
<p>Dem_PostRunRequested() ..................................................................... 123</p>
<p> </p>
<p>Table 6-36 </p>
<p> </p>
<p>Dem_SetWIRStatus () ............................................................................ 124</p>
<p> </p>
<p>Table 6-37 </p>
<p> </p>
<p>Dem_GetWIRStatus () ............................................................................ 125</p>
<p> </p>
<p>Table 6-38 </p>
<p> </p>
<p>Dem_SetDTCSuppression() ................................................................... 126</p>
<p> </p>
<p>Table 6-39 </p>
<p> </p>
<p>Dem_SetEventAvailable() ....................................................................... 127</p>
<p> </p>
<p>Table 6-40 </p>
<p> </p>
<p>Dem_ClearDTC() .................................................................................... 128</p>
<p> </p>
<p>Table 6-41 </p>
<p> </p>
<p>Dem_RequestNvSynchronization() ......................................................... 129</p>
<p> </p>
<p>Table 6-42 </p>
<p> </p>
<p>Dem_GetDebouncingOfEvent() .............................................................. 130</p>
<p> </p>
<p>Table 6-43 </p>
<p> </p>
<p>Dem_SelectDTC() .................................................................................. 132</p>
<p> </p>
<p>Table 6-44 </p>
<p> </p>
<p>Dem_GetDTCSelectionResult() .............................................................. 133</p>
<p> </p>
<p>Table 6-45 </p>
<p> </p>
<p>Dem_GetEventIdOfDTC() ....................................................................... 134</p>
<p> </p>
<p>Table 6-46 </p>
<p> </p>
<p>Dem_GetDTCSuppression() ................................................................... 135</p>
<p> </p>
<p>Table 6-47 </p>
<p> </p>
<p>Dem_ReportErrorStatus() ....................................................................... 136</p>
<p> </p>
<p>Table 6-48 </p>
<p> </p>
<p>Dem_SetDTCFilter() ............................................................................... 138</p>
<p> </p>
<p>Table 6-49 </p>
<p> </p>
<p>Dem_GetNumberOfFilteredDTC() .......................................................... 139</p>
<p> </p>
<p>Table 6-50 </p>
<p> </p>
<p>Dem_GetNextFilteredDTC() ................................................................... 140</p>
<p> </p>
<p>Table 6-51 </p>
<p> </p>
<p>Dem_GetNextFilteredDTCAndFDC() ...................................................... 141</p>
<p> </p>
<p>Table 6-52 </p>
<p> </p>
<p>Dem_GetNextFilteredDTCAndSeverity() ................................................ 142</p>
<p> </p>
<p>Table 6-53 </p>
<p> </p>
<p>Dem_SetFreezeFrameRecordFilter() ...................................................... 143</p>
<p> </p>
<p>Table 6-54 </p>
<p> </p>
<p>Dem_GetNextFilteredRecord() ............................................................... 144</p>
<p> </p>
<p>Table 6-55 </p>
<p> </p>
<p>Dem_GetStatusOfDTC() ......................................................................... 145</p>
<p> </p>
<p>Table 6-56 </p>
<p> </p>
<p>Dem_GetDTCStatusAvailabilityMask() ................................................... 146</p>
<p> </p>
<p>Table 6-57 </p>
<p> </p>
<p>Dem_GetDTCByOccurrenceTime() ........................................................ 147</p>
<p> </p>
<p>Table 6-58 </p>
<p> </p>
<p>Dem_GetTranslationType() ..................................................................... 148</p>
<p> </p>
<p>Table 6-59 </p>
<p> </p>
<p>Dem_GetSeverityOfDTC() ...................................................................... 149</p>
<p> </p>
<p>Table 6-60 </p>
<p> </p>
<p>Dem_GetFunctionalUnitOfDTC() ............................................................ 150</p>
<p> </p>
<p>Table 6-61 </p>
<p> </p>
<p>Dem_DisableDTCRecordUpdate() .......................................................... 151</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>18 </p>
<p>based on template version 5.0.0 </p>
<p>Table 6-62 </p>
<p> </p>
<p>Dem_EnableDTCRecordUpdate() .......................................................... 152</p>
<p> </p>
<p>Table 6-63 </p>
<p> </p>
<p>Dem_SelectFreezeFrameData () ............................................................ 153</p>
<p> </p>
<p>Table 6-64 </p>
<p> </p>
<p>Dem_GetFreezeFrameDataByDTC() ...................................................... 154</p>
<p> </p>
<p>Table 6-65 </p>
<p> </p>
<p>Dem_GetSizeOfFreezeFrameByDTC() ................................................... 155</p>
<p> </p>
<p>Table 6-66 </p>
<p> </p>
<p>Dem_SelectExtendedDataRecordBy() .................................................... 156</p>
<p> </p>
<p>Table 6-67 </p>
<p> </p>
<p>Dem_GetNextExtendedDataRecord () .................................................... 157</p>
<p> </p>
<p>Table 6-68 </p>
<p> </p>
<p>Dem_GetSizeOfExtendedDataRecordByDTC() ...................................... 158</p>
<p> </p>
<p>Table 6-69 </p>
<p> </p>
<p>Dem_DisableDTCSetting() ..................................................................... 159</p>
<p> </p>
<p>Table 6-70 </p>
<p> </p>
<p>Dem_EnableDTCSetting() ...................................................................... 160</p>
<p> </p>
<p>Table 6-71 </p>
<p> </p>
<p>Dem_J1939DcmClearDTC() ................................................................... 162</p>
<p> </p>
<p>Table 6-72 </p>
<p> </p>
<p>Dem_J1939DcmFirstDTCwithLampStatus() ........................................... 163</p>
<p> </p>
<p>Table 6-73 </p>
<p> </p>
<p>Dem_J1939DcmGetNextDTCwithLampStatus () .................................... 164</p>
<p> </p>
<p>Table 6-74 </p>
<p> </p>
<p>Dem_J1939DcmGetNextFilteredDTC() ................................................... 165</p>
<p> </p>
<p>Table 6-75 </p>
<p> </p>
<p>Dem_J1939DcmGetNextFreezeFrame() ................................................ 166</p>
<p> </p>
<p>Table 6-76 </p>
<p> </p>
<p>Dem_J1939DcmGetNextSPNInFreezeFrame() ...................................... 167</p>
<p> </p>
<p>Table 6-77 </p>
<p> </p>
<p>Dem_J1939DcmGetNumberOfFilteredDTC () ......................................... 168</p>
<p> </p>
<p>Table 6-78 </p>
<p> </p>
<p>Dem_J1939DcmSetDTCFilter() .............................................................. 170</p>
<p> </p>
<p>Table 6-79 </p>
<p> </p>
<p>Dem_J1939DcmSetFreezeFrameFilter() ................................................ 171</p>
<p> </p>
<p>Table 6-80 </p>
<p> </p>
<p>Dem_J1939DcmReadDiagnosticReadiness1() ....................................... 172</p>
<p> </p>
<p>Table 6-81 </p>
<p> </p>
<p>Services used by the Dem ...................................................................... 173</p>
<p> </p>
<p>Table 6-82 </p>
<p> </p>
<p>EcuM_BswErrorHook() ........................................................................... 173</p>
<p> </p>
<p>Table 6-83 </p>
<p> </p>
<p>Dem_NvM_JobFinished() ....................................................................... 175</p>
<p> </p>
<p>Table 6-84 </p>
<p> </p>
<p>Dem_NvM_InitAdminData() .................................................................... 176</p>
<p> </p>
<p>Table 6-85 </p>
<p> </p>
<p>Dem_NvM_InitStatusData() .................................................................... 177</p>
<p> </p>
<p>Table 6-86 </p>
<p> </p>
<p>Dem_NvM_InitDebounceData() .............................................................. 178</p>
<p> </p>
<p>Table 6-87 </p>
<p> </p>
<p>Dem_NvM_InitEventAvailableData() ....................................................... 179</p>
<p> </p>
<p>Table 6-88 </p>
<p> </p>
<p>CBClrEvt_&lt;EventName&gt;() ...................................................................... 180</p>
<p> </p>
<p>Table 6-89 </p>
<p> </p>
<p>CBDataEvt_&lt;EventName&gt;() ................................................................... 181</p>
<p> </p>
<p>Table 6-90 </p>
<p> </p>
<p>CBFaultDetectCtr_&lt;EventName&gt;() ......................................................... 182</p>
<p> </p>
<p>Table 6-91 </p>
<p> </p>
<p>CBInitEvt_&lt;EventName&gt;() ...................................................................... 183</p>
<p> </p>
<p>Table 6-92 </p>
<p> </p>
<p>CBInitFct_&lt;N&gt;() ...................................................................................... 183</p>
<p> </p>
<p>Table 6-93 </p>
<p> </p>
<p>CBReadData_&lt;SyncDataElement&gt;() ...................................................... 184</p>
<p> </p>
<p>Table 6-94 </p>
<p> </p>
<p>CBStatusDTC_&lt;N&gt;() .............................................................................. 185</p>
<p> </p>
<p>Table 6-95 </p>
<p> </p>
<p>CBStatusJ1939DTC_&lt;N&gt;() .................................................................... 186</p>
<p> </p>
<p>Table 6-96 </p>
<p> </p>
<p>CBStatusEvt_&lt;EventName&gt;_&lt;N&gt;() ........................................................ 186</p>
<p> </p>
<p>Table 6-97 </p>
<p> </p>
<p>GeneralCBDataEvt() ............................................................................... 187</p>
<p> </p>
<p>Table 6-98 </p>
<p> </p>
<p>GeneralCBStatusEvt() ............................................................................ 187</p>
<p> </p>
<p>Table 6-99 </p>
<p> </p>
<p>&lt;Module&gt;_ClearDtcNotification_&lt;DemEventMemorySet&gt; </p>
<p>_&lt;ShortName&gt;() ..................................................................................... 188</p>
<p> </p>
<p>Table 6-100 </p>
<p> </p>
<p>&lt;Module&gt;_ DemTriggerOnMonitorStatus() ............................................. 189</p>
<p> </p>
<p>Table 6-101 </p>
<p> </p>
<p>ApplDem_SyncCompareAndSwap() ....................................................... 190</p>
<p> </p>
<p>Table 6-102 </p>
<p> </p>
<p>DiagnosticMonitor ................................................................................... 191</p>
<p> </p>
<p>Table 6-103 </p>
<p> </p>
<p>DiagnosticInfo and GeneralDiagnosticInfo .............................................. 192</p>
<p> </p>
<p>Table 6-104 </p>
<p> </p>
<p>OperationCycle ....................................................................................... 192</p>
<p> </p>
<p>Table 6-105 </p>
<p> </p>
<p>EnableCondition ..................................................................................... 193</p>
<p> </p>
<p>Table 6-106 </p>
<p> </p>
<p>StorageCondition .................................................................................... 193</p>
<p> </p>
<p>Table 6-107 </p>
<p> </p>
<p>IndicatorStatus ........................................................................................ 193</p>
<p> </p>
<p>Table 6-108 </p>
<p> </p>
<p>EventStatus ............................................................................................ 193</p>
<p> </p>
<p>Table 6-109 </p>
<p> </p>
<p>EvMemOverflowIndication ...................................................................... 194</p>
<p> </p>
<p>Table 6-110 </p>
<p> </p>
<p>DTCSuppression .................................................................................... 194</p>
<p> </p>
<p>Table 6-111 </p>
<p> </p>
<p>DemServices .......................................................................................... 194</p>
<p> </p>
<p>Table 6-112 </p>
<p> </p>
<p>CBInitEvt_&lt;EventName&gt; ........................................................................ 195</p>
<p> </p>
<p>Table 6-113 </p>
<p> </p>
<p>CBInitFct_&lt;DtcName&gt;_&lt;N&gt; ................................................................... 195</p>
<p> </p>
<p>Table 6-114 </p>
<p> </p>
<p>CBEventUdsStatusChanged_&lt;EventName&gt;_&lt;CallbackName&gt; ............. 196</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>19 </p>
<p>based on template version 5.0.0 </p>
<p>Table 6-115 </p>
<p> </p>
<p>GeneralCBStatusEvt ............................................................................... 196</p>
<p> </p>
<p>Table 6-116 </p>
<p> </p>
<p>CBStatusDTC_&lt;CallbackName&gt; ............................................................ 196</p>
<p> </p>
<p>Table 6-117 </p>
<p> </p>
<p>CBDataEvt_&lt;EventName&gt; ..................................................................... 196</p>
<p> </p>
<p>Table 6-118 </p>
<p> </p>
<p>GeneralCBDataEvt ................................................................................. 196</p>
<p> </p>
<p>Table 6-119 </p>
<p> </p>
<p>CBClrEvt_&lt;EventName&gt; ........................................................................ 196</p>
<p> </p>
<p>Table 6-120 </p>
<p> </p>
<p>CBReadData_&lt;SyncDataElement&gt; ........................................................ 197</p>
<p> </p>
<p>Table 6-121 </p>
<p> </p>
<p>CBFaultDetectCtr_&lt;EventName&gt; ........................................................... 197</p>
<p> </p>
<p>Table 6-122 </p>
<p> </p>
<p>CBControlDTCSetting ............................................................................. 197</p>
<p> </p>
<p>Table 6-123 </p>
<p> </p>
<p>DemSc.................................................................................................... 197</p>
<p> </p>
<p>Table 6-124 </p>
<p> </p>
<p>ClearDtcNotification_&lt;EventMemorySet&gt;_&lt;Notification&gt; ....................... 197</p>
<p> </p>
<p>Table 6-125 </p>
<p> </p>
<p>Not Supported APIs ................................................................................ 198</p>
<p> </p>
<p>Table 8-1 </p>
<p> </p>
<p>Deviations ............................................................................................... 201</p>
<p> </p>
<p>Table 8-2 </p>
<p> </p>
<p>Extensions .............................................................................................. 201</p>
<p> </p>
<p>Table 8-3</p>
<p> </p>
<p>Limitations .............................................................................................. 202</p>
<p> </p>
<p>Table 8-4 </p>
<p> </p>
<p>Service Interfaces which are not supported ............................................ 202</p>
<p> </p>
<p>Table 9-1 </p>
<p> </p>
<p>Glossary ................................................................................................. 204</p>
<p> </p>
<p>Table 9-2 </p>
<p> </p>
<p>Abbreviations .......................................................................................... 205</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>20 </p>
<p>based on template version 5.0.0 </p>
<p><b>1 </b></p>
<p><b>Component History </b></p>
<p>The </p>
<p>component </p>
<p>history </p>
<p>gives </p>
<p>an </p>
<p>overview </p>
<p>over </p>
<p>the </p>
<p>important </p>
<p>milestones </p>
<p>that </p>
<p>are </p>
<p>supported in the different versions of the component.  </p>
<p><b>Component Version </b></p>
<p><b>New Features </b></p>
<p>4.00.00 </p>
<p>1</p>
<p>st</p>
<p> Release Version  </p>
<p>4.03.00 </p>
<p>Production Release </p>
<p>5.00.00 </p>
<p>Post-Build support </p>
<p>6.00.00 </p>
<p>J1939 support, API according to ASR 4.1.2 </p>
<p>7.00.00 </p>
<p>Change of initialization to allow Postbuild-Selectable </p>
<p>8.00.00 </p>
<p>Support API according to ASR 4.2.1 </p>
<p>9.00.00 </p>
<p>Technical completion of WWH-OBD </p>
<p>10.00.00 </p>
<p>Configuration tool migration to Java 8 </p>
<p>11.00.00 </p>
<p>Preparation for Silent BSW </p>
<p>13.00.00 </p>
<p>Multi-Partition Support, Autosar 4.3.0 </p>
<p>Table 1-1  </p>
<p>Component history </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>21 </p>
<p>based on template version 5.0.0 </p>
<p><b>2 </b></p>
<p><b>Introduction </b></p>
<p>This document describes the functionality, API and configuration of the AUTOSAR BSW </p>
<p>module Diagnostic Event Manager “Dem” as specified in [1].  </p>
<p> </p>
<p><b>Supported AUTOSAR </b></p>
<p><b>Release*: </b></p>
<p>4 </p>
<p><b>Supported Configuration </b></p>
<p><b>Variants: </b></p>
<p>pre-compile, post-build loadable, post-build selectable </p>
<p><b>Vendor ID: </b></p>
<p>DEM_VENDOR_ID </p>
<p>30 decimal </p>
<p>(= Vector-Informatik, </p>
<p>according to HIS) </p>
<p><b>Module ID: </b></p>
<p>DEM_MODULE_ID   </p>
<p>54 decimal </p>
<p>(according to ref. [6]) </p>
<p><b>Version Information </b></p>
<p>DEM_AR_RELEASE_MAJOR_VERSION </p>
<p>DEM_AR_RELEASE_MINOR_VERSION </p>
<p>DEM_AR_RELEASE_REVISION_VERSION </p>
<p>DEM_SW_MAJOR_VERSION </p>
<p>DEM_SW_MINOR_VERSION </p>
<p>DEM_SW_PATCH_VERSION </p>
<p>version literal, </p>
<p>decimal </p>
<p>* For the precise AUTOSAR Release 4.x please see the release specific documentation.  </p>
<p> </p>
<p>The  Dem  is  responsible  for  processing  and  storing  diagnostic  events  (both  externally </p>
<p>visible </p>
<p>DTCs  and </p>
<p>internal </p>
<p>events </p>
<p>reported  by  other  BSW  modules)  and  associated </p>
<p>environmental data.  In addition, the  Dem provides the fault information data to the Dcm </p>
<p>and J1939Dcm (if applicable). </p>
<p><b>2.1 </b></p>
<p><b>How to Read this Document </b></p>
<p>Here are some basic hints on how to navigate this document. </p>
<p><b>2.1.1 </b></p>
<p><b>API Definitions </b></p>
<p>The application API of the Dem is usually never called directly. The functions declarations </p>
<p>here  are  given  for  documentation  purposes.  Parts  of  the  function  signatures  are  not </p>
<p>exposed to the actual caller, and represent an implementation detail. </p>
<p>Nonetheless,  this  documentation  refers  to  the  Dem  API  directly  when  describing  the </p>
<p>different features, as the actual name of the API called by the application is defined by the </p>
<p>application itself. Instead of a sentence referring to this fact the underlying Dem function </p>
<p>name is mentioned directly. </p>
<p>E.g.  If  the  documentation  mentions  the API </p>
<p>Dem_SetOperationCycleState</p>
<p>,  a  client </p>
<p>module </p>
<p>would </p>
<p>call </p>
<p>a </p>
<p>service </p>
<p>function </p>
<p>resembling </p>
<p>Rte_Call_&lt;APPLDEFINED&gt;-</p>
<p>_SetOperationCycleState.</p>
<p> </p>
<p>An application is strongly advised to never call the Dem API directly, but to use the service </p>
<p>interface instead. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>22 </p>
<p>based on template version 5.0.0 </p>
<p><b>2.1.2 </b></p>
<p><b>Configuration References </b></p>
<p>When this text references a configuration parameter or container, the references are given </p>
<p>in the format of a navigation path: </p>
<p><b>&gt; </b></p>
<p>/ModuleDefinition/ContainerDefinition/Definition:  </p>
<p>The absolute variant is used for references in a different module. These references </p>
<p>start with a slash and the module definition. E.g. /NvM/NvMBlockDescriptor </p>
<p><b>&gt; </b></p>
<p>ContainerDefinition/Definition:  </p>
<p>The relative variant is used for references to parameters of the Dem itself. For brevity </p>
<p>the module definition has been omitted. </p>
<p>In both variants the last definition can be either of type container, parameter or reference. </p>
<p>This document does not duplicate the parameter description, so please also refer to the </p>
<p>module’s  parameter  definition  file  (BSWMD-file)  for  an  exhaustive  description  of  the </p>
<p>available configuration parameters. </p>
<p><b>2.2 </b></p>
<p><b>Architecture Overview </b></p>
<p>The following figure shows where the Dem is located in the AUTOSAR architecture. </p>
<p> </p>
<p>Figure 2-1 </p>
<p>AUTOSAR 4.1 Architecture Overview   </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>23 </p>
<p>based on template version 5.0.0 </p>
<p>The next figure shows the interfaces to adjacent modules of the Dem. These interfaces are </p>
<p>described in chapter 5.2.3.  </p>
<p>  </p>
<p>Figure 2-2 </p>
<p>Interfaces to adjacent modules of the Dem </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Applications do not access the services of the BSW modules directly. They use </p>
<p>the service ports provided by the BSW modules via the RTE. The service ports </p>
<p>provided by the Dem are listed in chapter 6.6 and are defined in [1]. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b> class Architecture</b></p>
<p><b>EcuM</b></p>
<p><b>Nv M</b></p>
<p><b>Dlt</b></p>
<p><b>SchM</b></p>
<p><b>Det</b></p>
<p><b>BSW</b></p>
<p><b>Dcm</b></p>
<p><b>J1939Dcm</b></p>
<p><b>FiM</b></p>
<p><b>Rte</b></p>
<p><b>Dem</b></p>
<p><b>Os</b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>24 </p>
<p>based on template version 5.0.0 </p>
<p><b>3 </b></p>
<p><b>Functional Description </b></p>
<p><b>3.1 </b></p>
<p><b>Features </b></p>
<p>The features listed in the following tables cover the complete functionality specified for the </p>
<p>Dem. </p>
<p>The AUTOSAR  standard  functionality  is  specified  in  [1],  the  corresponding  features  are </p>
<p>listed in the tables </p>
<p><b>&gt; </b></p>
<p>Table 3-1   Supported AUTOSAR standard conform features </p>
<p><b>&gt; </b></p>
<p>Table 3-2   Not supported AUTOSAR standard conform features </p>
<p>For further information of not supported features see also chapter 7.3.1. </p>
<p>Vector Informatik provides further Dem functionality beyond the AUTOSAR standard. The </p>
<p>corresponding features are listed in the table </p>
<p><b>&gt; </b></p>
<p>Table 3-3   Features provided beyond the AUTOSAR standard </p>
<p> </p>
<p>The following features specified in [1] are supported: </p>
<p><b>Supported AUTOSAR Standard Conform Features </b></p>
<p><b>Post-Build Loadable </b></p>
<p><b>MICROSAR Identity Manager using Post-Build Selectable </b></p>
<p><b>Module individual post-build loadable update </b></p>
<p>OBD II / WWH-OBD functionalities and APIs, only if licensed accordingly. </p>
<p>All non-optional features described in [1], except features described below </p>
<p>Table 3-1  </p>
<p>Supported AUTOSAR standard conform features </p>
<p>The following features specified in [1] are not supported: </p>
<p><b>Category </b></p>
<p><b>Description </b></p>
<p><b>ASR version </b></p>
<p>Configuration </p>
<p>Config </p>
<p>/AUTOSAR/EcucDefs/Dem/DemGeneral/DemFreezeFrameRecNumClass/De</p>
<p>mFreezeFrameRecordClassRef </p>
<p>Configuration of configured snapshot records is based on 4.0.3. For details </p>
<p>please refer to the Module Parameter Description (BSWMD). </p>
<p>4.1.2 </p>
<p>Config </p>
<p>/AUTOSAR/EcucDefs/Dem/DemGeneral/DemOperationCycle/DemOperationC</p>
<p>ycleAutostart </p>
<p>Configuration of automatic start of an operation cycle is only possible for one </p>
<p>cycle. For details please refer to the Module Parameter Description (BSWMD). </p>
<p>4.1.2 </p>
<p>Config </p>
<p>Service Needs are neither provided nor evaluated. </p>
<p>4.0.3 </p>
<p>Config </p>
<p>Multiplicity of some elements is restricted. For details please refer to the </p>
<p>Module Parameter Description (BSWMD). </p>
<p>4.0.3 </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>25 </p>
<p>based on template version 5.0.0 </p>
<p>Config </p>
<p>/AUTOSAR/EcucDefs/Dem/DemGeneral/DemEventMemorySet and </p>
<p>references to these EventMemorySets are not supported. The Dem only </p>
<p>provides one Primary memory and one optional Secondary memory. </p>
<p>4.3.0 </p>
<p>OperationCyles </p>
<p>Functional </p>
<p>AgingCycles </p>
<p>Aging cycles which are only used for aging and the corresponding API </p>
<p>Dem_SetAgingCycleState()</p>
<p>. Use operation cycles instead. </p>
<p>4.0.3 – 4.2.1 </p>
<p>Functional </p>
<p>Chapter 7.3.9.2 (4.0.3) resp. 7.6.10.2 (since 4.1.2) External aging </p>
<p>Centralized operation cycles and corresponding APIs are not available. </p>
<p>4.0.3 – 4.2.1 </p>
<p>Functional </p>
<p>Chapter 7.7 BSW Error Handling </p>
<p>All operation cycles are evaluated before initialization. To be able to report </p>
<p>BSW errors, these need to use a cycle which is automatically started. </p>
<p>4.0.3 </p>
<p>Functional </p>
<p>Chapter 7.3.8 (4.1.2) resp. 7.6.8 (4.2.1) Operation Cycle Management </p>
<p>The Dem implicitly stops volatile cycles during shutdown. No DET is called in </p>
<p>this situation. </p>
<p>4.1.2 </p>
<p>ClearDTC </p>
<p>Functional </p>
<p>Chapter 7.3.2.2 (4.1.2) resp. 7.6.2.2 (4.2.1) Clearing event memory entries </p>
<p>Partial status clear is not supported. Clearing a DTC is either completely </p>
<p>blocked, or the DTC is completely removed from memory. </p>
<p>4.1.2 </p>
<p>Application integration </p>
<p>Functional </p>
<p>Chapter 7.3.7.1 (4.0.3, 4.1.2) resp. 7.6.7.1 (4.2.1) Storage of freeze frame data </p>
<p>Chapter 7.3.7.3 (4.0.3, 4.1.2) resp. 7.6.7.3 (4.2.1) Storage of extended data </p>
<p>Data collection is always performed on task level, never in the context of the </p>
<p>caller of Dem_SetEventStatus or Dem_ReportErrorStatus. </p>
<p>4.0.3 </p>
<p>Functional </p>
<p>Chapter 7.3.7.3 (4.1.2) resp. 7.6.7.3 (4.2.1) Storage of extended data </p>
<p>For extended records collected from a user callback with NV storage, the Dem </p>
<p>only supports the data collection trigger ‘on Test Failed’. </p>
<p>4.1.2 </p>
<p>Functional </p>
<p>Chapter 7.3.1.2 through 7.3.1.3 (4.0.3, 4.1.2) resp. 7.6.1.2 through 7.6.1.3 </p>
<p>(4.2.1) </p>
<p>Status bit transitions are implemented asynchronously according to 4.3.0. UDS </p>
<p>Bit transitions will be performed only on the Dem main function. </p>
<p>4.0.3-4.2.1 </p>
<p>Functional </p>
<p>Chapters 7.3.6, 7.3.7, 7.5 </p>
<p>Components and Event Dependencies are not implemented. Similar </p>
<p>functionality can be achieved using the FiM module. </p>
<p>4.1.2-4.3.0 </p>
<p>Functional </p>
<p>Chapter 7.6 (4.2.1) resp. 7.7 </p>
<p>Limited support for multiple event memories. The Dem only supports one </p>
<p>primary memory and one secondary memory. Multiple user-defined memories </p>
<p>and EventMemorySets are not supported. </p>
<p>4.2.1-4.3.0 </p>
<p>Functional </p>
<p>Chapter 7.8 </p>
<p>Report of DEM_EVENT_STATUS_FDC_THRESHOLD_REACHED is queued </p>
<p>before Dem_Init. </p>
<p>4.3.0 </p>
<p>API </p>
<p>Chapter 8.3.3 Dem_GetEventStatus </p>
<p>Application interfaces are implemented according to 4.3.0, the old interfaces </p>
<p>are not supported. Use GetEventUdsStatus instead. </p>
<p>4.0.3-4.2.1 </p>
<p>API </p>
<p>Chapter 8.3.3 Dem_GetEventExtendedDataRecord, </p>
<p>Dem_GetEventFreezeFrameData </p>
<p>Application interfaces are implemented according to 4.3.0, the old interfaces </p>
<p>are not supported. Use Dem_GetEventExtendedDataRecordEx and </p>
<p>Dem_GetEventFreezeFrameDataEx instead. </p>
<p>4.1.2-4.2.1 </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>26 </p>
<p>based on template version 5.0.0 </p>
<p>API </p>
<p>Chapter 8.3.3 Dem_GetEventMemoryOverflow, </p>
<p>Dem_GetNumberOfEventMemoryEntries </p>
<p>Application interfaces are implemented according to 4.3.0, the old interfaces </p>
<p>are not supported. </p>
<p>4.0.3-4.2.1 </p>
<p>API </p>
<p>Chapter 8.3.3 Dem_ClearDTC </p>
<p>Application interfaces are implemented according to 4.3.0, the old interfaces </p>
<p>are not supported. </p>
<p>4.1.2-4.2.1 </p>
<p>API </p>
<p>Chapter 7.3.1.5 (4.0.3, 4.1.2) resp. 7.6.1.5 (4.2.1) </p>
<p>Status notifications are called from the Dem MainFunction only, never </p>
<p>synchronously in context of the monitor report. </p>
<p>4.0.3-4.2.1 </p>
<p>BSW integration </p>
<p>Functional </p>
<p>Chapter 7.8.6 (4.0.3), 7.9.7(4.1.2) resp. 7.10.7 (4.2.1) Interaction with </p>
<p>Diagnostic Log &amp; Trace (Dlt) </p>
<p>The APIs to read snapshot and extended data from DLT are not supported. </p>
<p>4.0.3 </p>
<p>Functional </p>
<p>Chapter 7.13 (4.0.3), 7.14 (4.1.2), resp 7.15 (4.2.1) Debugging Support </p>
<p>No support for public access to internal variables is provided. </p>
<p>4.0.3 </p>
<p>API </p>
<p>FiM_DemInit() </p>
<p>This API is never called by the Dem. </p>
<p>4.0.3 </p>
<p>API </p>
<p>FiM_DemTriggerOnMonitorStatus() </p>
<p>This API is never called by the Dem. Instead, the Dem calls the prior API </p>
<p>FiM_DemTriggerOnEventStatus </p>
<p>4.3.0 </p>
<p>API, </p>
<p>Functional </p>
<p>Chapter 8.3.4 Dcm Interfaces </p>
<p>The Dcm interfaces are implemented according to 4.3.0, including RfC#76727. </p>
<p>The old interfaces are not supported. This includes asynchronous behavior of </p>
<p>most APIs. </p>
<p>4.0.3-4.2.1 </p>
<p>API </p>
<p>Chapter 8.3.5 (4.1.2) resp. 8.3.6 (4.2.1) J1939Dcm Interfaces </p>
<p>The J1939Dcm interfaces are based on 4.2.1 and incorporate the changes of </p>
<p>RfC#72121. </p>
<p>4.1.2 </p>
<p>Miscellaneous </p>
<p>Functional </p>
<p>Mirror Memory </p>
<p>Mirror Memory solutions are manufacturer specific and not supported. </p>
<p>4.0.3 </p>
<p>Functional </p>
<p>Chapter 7.3.5 (4.0.3), 7.3.5.2 (4.1.2) resp. 7.6.5.2 (4.2.1) Event Combination </p>
<p>Type 2 / Event Combination on Retrieval </p>
<p>Only combination Type 1 / On Storage is supported. </p>
<p>4.0.3 </p>
<p>Functional </p>
<p>Indicator-Event specific set and reset condition </p>
<p>Indicators are enabled together with the event confirmation, i.e. when bit 3 is </p>
<p>set. Healing is always done based on the event status byte (UDS status). </p>
<p>4.0.3 </p>
<p>Table 3-2  </p>
<p>Not supported AUTOSAR standard conform features </p>
<p>The following features are provided beyond the AUTOSAR standard: </p>
<p><b>Features Provided Beyond The AUTOSAR Standard </b></p>
<p>Interface </p>
<p>Dem_InitMemory() </p>
<p>This function can be used to initialize static RAM variables in case the start-up code is not used </p>
<p>to initialize RAM. Refer to chapter 6.2.5.7</p>
<p>.</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>27 </p>
<p>based on template version 5.0.0 </p>
<p><b>Features Provided Beyond The AUTOSAR Standard </b></p>
<p>Interface </p>
<p>Dem_PostRunRequested() </p>
<p>Allows the application to test if the Dem can be shut down safely. For details refer to chapter </p>
<p>6.2.6.23. </p>
<p>Selective non-volatile mirror invalidation on configuration change </p>
<p>Allows the controlled reset of the Dem non-volatile data, without invalidating the whole non-</p>
<p>volatile data or manual initialization algorithms. For details refer to chapter 4.5.2.1 </p>
<p>Extended set of internal data elements </p>
<p>In addition to the set defined in [1], the Dem provides additional internal data elements. Refer to </p>
<p>chapter 3.11.1 for the complete list. </p>
<p>Extended support for ClientServer Data callbacks, see chapter 3.11.3 </p>
<p>Variants on status bit handling in case of memory overflow, see chapter 3.4.4.1 </p>
<p>Option to prevent aging of event entries to remove stored environment data (e.g. snapshot </p>
<p>records) </p>
<p>Multiple variants for aging behavior regarding healing, see chapter 3.6.5 </p>
<p>Option to distribute runtime of ClearDTC operation across multiple tasks </p>
<p>Configurable copy routine, see chapter 4.3.1 </p>
<p>Request for NV data synchronization, see Dem_RequestNvSynchronization() </p>
<p>Table 3-3  </p>
<p>Features provided beyond the AUTOSAR standard </p>
<p> </p>
<p> </p>
<p><b>3.2 </b></p>
<p><b>Dem Module Architecture </b></p>
<p> </p>
<p>Figure 3-1 </p>
<p>Dem Architecture Overview </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>28 </p>
<p>based on template version 5.0.0 </p>
<p>The Dem is separated logically into multiple interacting software components: </p>
<p><b>&gt; </b></p>
<p>For each OS partition configured with Dem access, a dedicated DemSatellite service </p>
<p>SWC provides the interfaces DiagnosticMonitor (chapter 6.6.1.1.1) and DiagnosticInfo </p>
<p>(chapter 6.6.1.1.2). </p>
<p><b>&gt; </b></p>
<p>For  one  OS  partition,  a  DemMaster  service  SWC  provides  the  remainder  of  the </p>
<p>AUTOSAR interfaces. </p>
<p> </p>
<p> </p>
<p><b>3.2.1 </b></p>
<p><b>Dem Satellite(s) </b></p>
<p>A </p>
<p>DemSatellite </p>
<p>performs </p>
<p>de-bouncing </p>
<p>locally; </p>
<p>this </p>
<p>includes </p>
<p>counter- </p>
<p>and </p>
<p>timebased </p>
<p>debouncing. Also, the DemSatellite provides access to the MonitorStatus introduced in [1] </p>
<p>(4.3.0). </p>
<p>As  long  as  application  ports  only  connect  to  the  local  DemSatellite  there  is  no  runtime </p>
<p>overhead for Dem calls. </p>
<p><b>3.2.2 </b></p>
<p><b>Dem Master </b></p>
<p>The </p>
<p>actual </p>
<p>event </p>
<p>processing </p>
<p>like </p>
<p>UDS </p>
<p>status, </p>
<p>storage </p>
<p>of </p>
<p>environmental </p>
<p>data </p>
<p>and </p>
<p>notification </p>
<p>handling </p>
<p>is </p>
<p>performed </p>
<p>on </p>
<p>the </p>
<p>DemMaster </p>
<p>service </p>
<p>component.  Also, </p>
<p>the </p>
<p>DemMaster is the source of all configured callbacks or notifications. </p>
<p>Please be aware that while it is possible to call operations on the DemMaster across OS </p>
<p>partitions, this can incur additional cost introduced by the RTE to implement the necessary </p>
<p>synchronization. </p>
<p>Map the DemMaster to the OS partition from where most accesses originate to minimize </p>
<p>this runtime overhead. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>To  correctly  notify  SWCs  mapped  to  a  different  OS  partition,  you  could  use  an  RTE </p>
<p>port.  If  you  configure  callbacks  as  direct  function  call,  you  have  to  implement  the </p>
<p>necessary </p>
<p>mechanisms </p>
<p>(trusted </p>
<p>function </p>
<p>call, </p>
<p>OsSetEvent/WaitEvent… </p>
<p>inside </p>
<p>the </p>
<p>callback function. </p>
<p>While  this  is  more  complicated,  an  implementation  might  simply  set  a  flag  in  the </p>
<p>configured  callback  which  is  polled  by  the  SWC  to  notify. This  can  be more  efficient </p>
<p>than the generic code generated by the RTE. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Changes </b></p>
<p>To support the decomposition into Master and Satellite, the Dem implementation </p>
<p>follows the Autosar 4.3 architecture. Event status updates are handled asynchronously </p>
<p>for all events, not only BSW events. </p>
<p><b> </b></p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>29 </p>
<p>based on template version 5.0.0 </p>
<p><b>3.2.3 </b></p>
<p><b>Communication constraints </b></p>
<p>To circumvent expensive general cross-partition communication implemented by the RTE, </p>
<p>the </p>
<p>Dem </p>
<p>uses </p>
<p>internal </p>
<p>data </p>
<p>exchange </p>
<p>based </p>
<p>on </p>
<p>shared </p>
<p>memory </p>
<p>and </p>
<p>atomic </p>
<p>compare/exchange instructions. </p>
<p>This requires the following access permissions: </p>
<p><b>&gt; </b></p>
<p>The </p>
<p>DemMaster </p>
<p>requires </p>
<p>Read/Write </p>
<p>access </p>
<p>to </p>
<p>its </p>
<p>own </p>
<p>data </p>
<p>and </p>
<p>that </p>
<p>of </p>
<p>all </p>
<p>DemSatellites. </p>
<p><b>&gt; </b></p>
<p>Each DemSatellite requires Read/Write access to its own data only, and requires Read </p>
<p>access to the data of all other satellites and the DemMaster. </p>
<p>This memory mapping requires a customized MemMap.h, please refer to chapter  4.3 for </p>
<p>common integration tasks. </p>
<p>Instructions for efficient synchronization are provided by all multi-core platforms. However, </p>
<p>due  to  the  lack  of  a  common  library  an  implementation  needs  to  be  provided  during </p>
<p>integration. For details please refer to chapter 4.4. </p>
<p><b>3.3 </b></p>
<p><b>Initialization </b></p>
<p>Initialization of the Dem module is a multiple-step process. </p>
<p>First,  using  the  interface </p>
<p>Dem_MasterPreInit() </p>
<p>from  the  master  partition,  the  Dem </p>
<p>loads a preliminary configuration.  </p>
<p>After that the NvM can begin to restore the Dem state from the NvRAM and all satellites </p>
<p>can  be  set  to  a  state  of  reduced  functionality  using </p>
<p>Dem_SatellitePreInit()</p>
<p>.  After </p>
<p>this step, events assigned to the respective satellite can report monitor results to the Dem </p>
<p>using </p>
<p>Dem_SetEventStatus()</p>
<p>.</p>
<p> </p>
<p>After the satellites have been pre-initialized and after the NvM has finished the restoration </p>
<p>of  the  NVRAM  mirror  data,  the  Dem  master  can  be  brought  to  full  function  using  the </p>
<p>interface </p>
<p>Dem_MasterInit(),</p>
<p>  followed  by  the  initialization  of  the  satellites  per  call  of </p>
<p>Dem_SatelliteInit()</p>
<p>. Additionally, the interface </p>
<p>Dem_MasterInit()</p>
<p> can be used to </p>
<p>reinitialize the master after </p>
<p>Dem_Shutdown()</p>
<p> was called. </p>
<p>For </p>
<p>configurations  using  a  single </p>
<p>OS  partition, </p>
<p>the  standard  AUTOSAR  initialization </p>
<p>sequence  is  still  supported.  Please  refer  to  [1],  Dem_PreInit()  (chapter  6.2.5.3)  and </p>
<p>Dem_Init() (chapter 6.2.5.6) for more information. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>This Dem implementation is not consistent with Autosar regarding the initialization API. </p>
<p>Both </p>
<p>Dem_PreInit()</p>
<p> </p>
<p>and </p>
<p>Dem_Init()</p>
<p> </p>
<p>take a configuration pointer. Please adapt </p>
<p>your initialization sequence accordingly. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>30 </p>
<p>based on template version 5.0.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The  APIs </p>
<p>Dem_PreInit()</p>
<p>  and </p>
<p>Dem_Init()</p>
<p>  can  be  used  to  combine  the </p>
<p>initialization  of  master  and  satellite,  but  only  in  configurations  with  a  single </p>
<p>partition. After calling </p>
<p>Dem_Shutdown()</p>
<p> always</p>
<p> Dem_MasterInit()</p>
<p> has to </p>
<p>be used to reinitialize the Dem.</p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>If a changed configuration set is flashed to an existing ECU, the NVRAM mirror </p>
<p>variables of the Dem must be re-initialized before </p>
<p>Dem_MasterInit</p>
<p>() is called. </p>
<p>There are several ways how this can be implemented. Please also refer to </p>
<p>chapter 4.5 regarding the correct setup. </p>
<p><b></b></p>
<p><b> </b></p>
<p>Using the NvM which can be configured to invalidate data on configuration </p>
<p>change. </p>
<p><b></b></p>
<p><b> </b></p>
<p>Using the Dem which supports a similar feature as the NvM using the </p>
<p>configuration option ‘DemCompiledConfigId’. In this case </p>
<p>Dem_MasterInit()</p>
<p> will take care of the re-initialization. </p>
<p><b></b></p>
<p><b> </b></p>
<p>Before calling </p>
<p>Dem_MasterInit</p>
<p>() it is safe to call the initialization functions </p>
<p>configured for usage by the NvM. Additionally, all primary and secondary </p>
<p>data can to be cleared by overwriting each RAM variable </p>
<p>Dem_Cfg_[Primary|Secondary]Entry_&lt;N&gt;</p>
<p> with the contents of </p>
<p>Dem_MemoryEntryInit</p>
<p>. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>3.3.1 </b></p>
<p><b>Initialization States </b></p>
<p>After the (re)start of the ECU the Dem is in state “UNINITIALIZED”. In this state the Dem is </p>
<p>not operable until the interface </p>
<p>Dem_MasterPreInit()</p>
<p> was called. </p>
<p>Dem_MasterPreInit()</p>
<p> will change the state of the master  to “PREINITIALIZED”. The </p>
<p>state </p>
<p>of </p>
<p>each </p>
<p>satellite </p>
<p>is </p>
<p>set </p>
<p>to </p>
<p>“PREINITIALIZED” </p>
<p>by </p>
<p>the </p>
<p>call </p>
<p>of </p>
<p>Dem_SatellitePreInit()</p>
<p>.  Within  this  state  only  BSW  errors  from  the  respective </p>
<p>satellite </p>
<p>can </p>
<p>be </p>
<p>reported </p>
<p>via </p>
<p>Dem_SetEventStatus()</p>
<p>. </p>
<p>Enable </p>
<p>conditions </p>
<p>are </p>
<p>not </p>
<p>considered in this phase. </p>
<p>During  initialization  via </p>
<p>Dem_MasterInit()</p>
<p>  resp. </p>
<p>Dem_SatelliteInit()</p>
<p>the  state  of </p>
<p>the master resp. satellite is set to “INITIALIZED” and the Dem is fully operable afterwards. </p>
<p>In this phase enable conditions are initialized to their configured default state and can take </p>
<p>effect. </p>
<p>Dem_Shutdown()</p>
<p>  will  finalize  all  pending  operations  in  the  Dem,  deactivate  the  event </p>
<p>processing done by the master and change the state of the master to “SHUTDOWN”. If the </p>
<p>master is in state “SHUTDOWN” events can still be reported, as they are handled by the </p>
<p>respective satellite.  </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>31 </p>
<p>based on template version 5.0.0 </p>
<p>The  function</p>
<p> Dem_MasterMainFunction()</p>
<p>  resp. </p>
<p>Dem_SatelliteMainFunction()</p>
<p> </p>
<p>can be called as long as the master resp. the related satellite is in state “INITIALIZED”.  </p>
<p>In case SilentBSW checks are enabled, failing run-time checks will cause the Dem to enter </p>
<p>state ‘HALTED_AFTER_ERROR’. Please refer to chapter 3.19.1.2 for more details. </p>
<p>Figure 3-2 provides an overview of the described behavior. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Changes </b></p>
<p>Prior versions (Implementation version &lt; 7.00.00) did consider the configured enable </p>
<p>conditions during the pre-initialization phase. </p>
<p><b> </b></p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>32 </p>
<p>based on template version 5.0.0 </p>
<p> </p>
<p>Figure 3-2 Dem states</p>
<p><b> stm Module Initialization</b></p>
<p><b>Normal Operation</b></p>
<p>Ini ti al</p>
<p><b>PREINITIALIZED (Master)</b></p>
<p><b>notes</b></p>
<p><i>- APIs will throw a DET </i></p>
<p><i>error</i></p>
<p><i>- Initial Dem configuration</i></p>
<p><i>is available</i></p>
<p><b>UNINITIALIZED</b></p>
<p><b>notes</b></p>
<p><i>- Dem is not initialized</i></p>
<p><i>- APIs will throw a DET </i></p>
<p><i>error</i></p>
<p><i>- Dem internal variables </i></p>
<p><i>have random value</i></p>
<p><b>Restored Nv RAM</b></p>
<p><b>notes</b></p>
<p><i>- all blocks used by Dem are </i></p>
<p><i>restored</i></p>
<p><b>PREINITIALIZED (Satellite 1)</b></p>
<p><b>notes</b></p>
<p><i>- This Dem Satellite is </i></p>
<p><i>pre-initialized</i></p>
<p><i>- Most APIs will throw a DET </i></p>
<p><i>error</i></p>
<p><i>- API Dem_SetEventStatus </i></p>
<p><i>can be used on this satellite</i></p>
<p><b>PREINITIALIZED (Satellite 2)</b></p>
<p><b>notes</b></p>
<p><i>- This Dem Satellite is </i></p>
<p><i>pre-initialized</i></p>
<p><i>- Most APIs will throw a DET </i></p>
<p><i>error</i></p>
<p><i>- API Dem_SetEventStatus </i></p>
<p><i>can be used on this satellite</i></p>
<p><b>PREINITIALIZED (Satellite N)</b></p>
<p><b>notes</b></p>
<p><i>- This Dem Satellite is </i></p>
<p><i>pre-initialized</i></p>
<p><i>- Most APIs will throw a DET </i></p>
<p><i>error</i></p>
<p><i>- API Dem_SetEventStatus </i></p>
<p><i>can be used on this satellite</i></p>
<p><b>INITIALIZED (Master)</b></p>
<p><b>notes</b></p>
<p><i>- All Master APIs can be </i></p>
<p><i>accessed without a DET </i></p>
<p><i>error</i></p>
<p><i>- Dem does access (and </i></p>
<p><i>modify) the NVRAM mirror</i></p>
<p><i>- NV content is validated</i></p>
<p><i>- Final Dem configuration is</i></p>
<p><i>available</i></p>
<p><b>INITIALIZED (Satellite 1)</b></p>
<p><b>notes</b></p>
<p><i>- All APIs can be used on this</i></p>
<p><i>satel l i te</i></p>
<p><b>INITIALIZED (Satellite 2)</b></p>
<p><b>notes</b></p>
<p><i>- All APIs can be used on this</i></p>
<p><i>satel l i te</i></p>
<p><b>INITIALIZED (Satellite N)</b></p>
<p><b>notes</b></p>
<p><i>- All APIs can be used on this</i></p>
<p><i>satel l i te</i></p>
<p><b>SHUTDOWN (Master)</b></p>
<p><b>notes</b></p>
<p><i>- Master APIs will throw a </i></p>
<p><i>DET</i></p>
<p><i>- Dem Master will no longer</i></p>
<p><i>process the satellite event </i></p>
<p><i>queues</i></p>
<p><i>- Dem will not modify the </i></p>
<p><i>NVRAM mirror</i></p>
<p><i>- Dem has updated the NvM</i></p>
<p><i>block modification state</i></p>
<p>Without configuration </p>
<p>change</p>
<p><b>HALTED_AFTER_ERROR</b></p>
<p><b>notes</b></p>
<p><i>Dem is disabled due to failed run-time checks</i></p>
<p>Power</p>
<p>Down</p>
<p>Dem_MasterPreInit</p>
<p>Dem_MemoryInit,</p>
<p>Startup Code</p>
<p>NvM_ReadAll</p>
<p>Dem_SatellitePreInit</p>
<p>Dem_SatellitePreInit</p>
<p>Dem_SatellitePreInit</p>
<p>Dem_MasterInit</p>
<p>Dem_SatelliteInit</p>
<p>Dem_SatelliteInit</p>
<p>Dem_SatelliteInit</p>
<p>Dem_Shutdown</p>
<p>Dem_MasterInit</p>
<p>Run-time check</p>
<p>fai l s</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>33 </p>
<p>based on template version 5.0.0 </p>
<p><b>3.4 </b></p>
<p><b>Diagnostic Event Processing </b></p>
<p>A  diagnostic  event  defines  the  result  of  a  monitor  which  can  be  located  in  a  SWC  or a </p>
<p>BSW  module.  These  monitors  can  report  an  event  as  a  qualified  test  result  by  calling </p>
<p>Dem_ReportErrorStatus()</p>
<p> or </p>
<p>Dem_SetEventStatus()</p>
<p> with “Failed” or “Passed” or </p>
<p>as </p>
<p>a </p>
<p>pre-qualified </p>
<p>test </p>
<p>result </p>
<p>by </p>
<p>using </p>
<p>the </p>
<p>event </p>
<p>de-bouncing </p>
<p>with </p>
<p>“PreFailed” </p>
<p>or </p>
<p>“PrePassed”. </p>
<p>In order to use pre-qualified test results the reported event must be configured with a de-</p>
<p>bounce algorithm. Otherwise (using monitor internal de-bouncing) pre-qualified results will </p>
<p>cause a DET report and are ignored.  </p>
<p><b>3.4.1 </b></p>
<p><b>Event De-bouncing </b></p>
<p>The Dem implements the mechanisms described below: </p>
<p><b>3.4.1.1 </b></p>
<p><b>Counter Based Algorithm </b></p>
<p>A  monitor must  trigger  the  Dem  actively,  usually  multiple  times,  before  an  event  will  be </p>
<p>qualified as passed or failed. Each separate trigger will add (or subtract) a configured step </p>
<p>size value to a counter value, and the event will be qualified as ‘failed’ or ‘passed’ once this </p>
<p>de-bounce counter reaches the respective configured threshold value. </p>
<p>The  configurable  thresholds  support  a  range  for  the  de-bounce  counter  of  -32768  … </p>
<p>32767.  For  external  reports  its  current  value  will  be  mapped  linearly  to  the  UDS  fault </p>
<p>detection counter which supports a range of -128 … 127. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Threshold values of 0 to detect a qualified failed or qualified passed result are allowed </p>
<p>in some Autosar versions, but this implementation does not support such a setting. </p>
<p><b> </b></p>
<p><b> </b></p>
<p>If  enabled,  counter  based  de-bounced  events  can  de-bounce  across  multiple  power </p>
<p>cycles. Therefore the counter value is persisted into non-volatile memory during shutdown </p>
<p>of the ECU. </p>
<p><b>3.4.1.2 </b></p>
<p><b>Time Based Algorithm </b></p>
<p>For events using time based de-bouncing, the application only needs to trigger the Dem </p>
<p>once in order to set a qualification direction. The event will be qualified after the configured </p>
<p>de-bounce time has elapsed. Multiple triggers for the same event and same qualification </p>
<p>direction have no effect. </p>
<p>Each event report results at most in reloading a software timer due to a direction change. </p>
<p>Once an event was reported, the timer is stopped by </p>
<p><b>&gt; </b></p>
<p>A “clear DTC” command </p>
<p><b>&gt; </b></p>
<p>The restart of the event’s associated “Operation cycle” </p>
<p><b>&gt; </b></p>
<p>Deactivation of (one of) the event’s associated enable condition </p>
<p><b>&gt; </b></p>
<p>API Dem_ResetEventStatus() </p>
<p><b>&gt; </b></p>
<p>API Dem_ResetEventDebounceStatus(). </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>34 </p>
<p>based on template version 5.0.0 </p>
<p>Event  de-bouncing  via  time  based  algorithm  requires  comparatively  high  CPU  runtime </p>
<p>usage.  To  alleviate  this,  the  Dem  supports  both  a  high  resolution  timer  (a  Dem  main </p>
<p>function call equals a timer tick) and a low resolution timer (e.g. 150ms equals a timer tick). </p>
<p>Events which have a de-bounce time greater than 5 seconds will use the low resolution </p>
<p>timer per default. Still, software timers are expensive and should be used sparingly. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>The timer ticks are processed on the Dem main task. If you report an event using time-</p>
<p>based de-bouncing before the Dem is initialized, the timer will only start running when </p>
<p>the system has reached the point where cyclic tasks are served. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Note </b></p>
<p>Time based de-bouncing is processed for each satellite individually. Each satellite has </p>
<p>its own timer. On call of </p>
<p>Dem_SatelliteMainFunction()</p>
<p> for the respective satellite </p>
<p>this timer is processed and de-bouncing for all events assigned to the satellite is </p>
<p>continued. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.4.1.3 </b></p>
<p><b>Monitor internal de-bouncing </b></p>
<p>If the application implements the de-bouncing algorithm itself, a callback function can be </p>
<p>provided,  which  is used for  reporting  the  current fault detection value  to  the diagnostics </p>
<p>layer. </p>
<p>These  functions  should  not  implement  logic,  since  they  are  called  in  runtime  extensive </p>
<p>context. </p>
<p>If monitor internal de-bouncing is configured for an event, its monitor cannot request de-</p>
<p>bouncing  by  the  Dem  (i.e. </p>
<p>trigger  operation </p>
<p>SetEventStatus</p>
<p> </p>
<p>with  monitor  results </p>
<p>DEM_STATUS_PRE_FAILED or DEM_STATUS_PRE_PASSED). This would also result in </p>
<p>a DET report in case development error detection is enabled. The Dem module does not </p>
<p>have the necessary information to process these types of monitor results. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Workaround (before version 6.00.00) </b></p>
<p>If you do not want de-bouncing for an event at all, e.g. only report qualified passed and </p>
<p>failed results, you should consider using counter based de-bouncing for these events. </p>
<p>For efficiency reasons, only choose monitor internal de-bouncing if you need to provide </p>
<p>the callback function.  </p>
<p>Since version 6.00.00 the callback function for internal de-bouncing is optional. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.4.2 </b></p>
<p><b>Event Reporting </b></p>
<p>Monitors  may  report  test  results  either  by  PortInterface  or,  in  case  of  a  complex  device </p>
<p>driver or basic software module, by direct C API. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>35 </p>
<p>based on template version 5.0.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Changes </b></p>
<p>Event processing has changed significantly in Autosar 4.3.0. Since version 13.00.00 all </p>
<p>event reports are processed on task level.  </p>
<p>As a result it is no longer relevant to distinguish between BSW and SWC events, the </p>
<p>API Dem_ReportErrorStatus() is no longer necessary (this implementation still provides </p>
<p>it for compatibility reasons). </p>
<p>Both SWC and CDD modules can call Dem_SetEventStatus(), either via RTE or </p>
<p>directly. Since Dem_ReportErrorStatus() lacks a return code it is recommended to </p>
<p>implement monitors using Dem_SetEventStatus(). </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Status reports do not maintain relative order. I.e. the Dem will not guarantee that </p>
<p>multiple event reports are processed in the same order that they had been reported in. </p>
<p>This is mainly due to the additional resources required for no apparent benefit.  </p>
<p>Reports for the same event are of course processed in order. </p>
<p>Example: Reporting order F</p>
<p>1</p>
<p>, F</p>
<p>2</p>
<p>, P</p>
<p>2</p>
<p>, P</p>
<p>1</p>
<p> would be processed as F</p>
<p>1</p>
<p>, P</p>
<p>1</p>
<p>, F</p>
<p>2</p>
<p>, P</p>
<p>2</p>
<p>, which still </p>
<p>preserves the order per event. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.4.3 </b></p>
<p><b>Monitor Status </b></p>
<p>Every event supports a monitor status information which is updated synchronously with the </p>
<p>monitor reports: </p>
<p><b>&gt; </b></p>
<p>Bit 0 – TestFailed </p>
<p>The bit indicates the last qualified test result (passed or failed) reported by the monitor. </p>
<p><b>&gt; </b></p>
<p>Bit 1 – TestNotCompletedThisOperationCycle </p>
<p>The bit indicates if the monitor has reached a qualified test result (passed or failed) in </p>
<p>the current operation cycle. </p>
<p><b>3.4.4 </b></p>
<p><b>Event Status </b></p>
<p>Every </p>
<p>event </p>
<p>supports </p>
<p>a </p>
<p>status </p>
<p>byte </p>
<p>whereas </p>
<p>each </p>
<p>bit </p>
<p>represents </p>
<p>different </p>
<p>status </p>
<p>information. For detailed information please refer to [7]. Calculation and change notification </p>
<p>(chapter 3.16) of these bits is performed asynchronously on the Dem main function. </p>
<p><b>&gt; </b></p>
<p>Bit 0 – TestFailed </p>
<p>The bit indicates the qualified result of the most recent test. </p>
<p><b>&gt; </b></p>
<p>Bit 1 – TestFailedThisOperationCycle </p>
<p>The bit indicates if during the active operation cycle the event was qualified as failed.  </p>
<p><b>&gt; </b></p>
<p>Bit 2 – PendingDTC </p>
<p>This bit indicates if during a past or current operation cycle the event has been </p>
<p>qualified as failed, and has not tested ‘passed’ for a whole cycle since the failed result </p>
<p>was reported. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>36 </p>
<p>based on template version 5.0.0 </p>
<p><b>&gt; </b></p>
<p>Bit 3 – ConfirmedDTC </p>
<p>The bit indicates that the event has been detected enough times that it was stored in </p>
<p>long term memory. </p>
<p><b>&gt; </b></p>
<p>Bit 4 – TestNotCompletedSinceLastClear </p>
<p>This bit indicates if the event has been qualified (passed or failed) since the fault </p>
<p>memory has been cleared. </p>
<p><b>&gt; </b></p>
<p>Bit 5 – TestFailedSinceLastClear </p>
<p>This bit indicates if the event has been qualified as failed since the fault memory has </p>
<p>been cleared. </p>
<p><b>&gt; </b></p>
<p>Bit 6 – TestNotCompletedThisOperationCycle </p>
<p>This bit indicates if the event has been qualified (passed or failed) during the active </p>
<p>operation cycle. </p>
<p><b>&gt; </b></p>
<p>Bit 7 – WarningIndicatorRequested </p>
<p>The bit indicates if a warning indicator for this event is active. </p>
<p><b>3.4.4.1 </b></p>
<p><b>Event Storage modifying Status Bits </b></p>
<p>Several UDS status bit transitions depend on successful event storage.  The Dem offers </p>
<p>multiple interpretations of these transitions when taking event displacement into account. </p>
<p>For status bits 2 – PendingDTC, 3 – ConfirmedDTC and 7 – WarningIndicatorRequested  </p>
<p>there are two alternatives ‘Stored Only’ and ‘All DTC’ – see Figure 3-3.  </p>
<p>For status bit 5 – TestFailedSinceLastClear the alternatives ‘Stored Only’ and ‘All DTC’ are </p>
<p>supported as well, along with a third option to select different reset conditions for this bit. </p>
<p>Please also see chapter 3.6.4. </p>
<p>The usual bit transitions are not affected by this option. It only selects the behavior in case </p>
<p>of event memory overflow and displacement.  </p>
<p> </p>
<p>Figure 3-3 </p>
<p>Effect of Precondition ‘Event Storage’ and Displacement on Status Bits </p>
<p>Due  to Autosar  standardized  naming  of  configuration  options,  the  settings for these  bits </p>
<p>are named differently for each bit, please refer to Table 3-4  Configuration </p>
<p>of </p>
<p>status </p>
<p>bit </p>
<p>processing for details. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>37 </p>
<p>based on template version 5.0.0 </p>
<p><b>Status Bit </b></p>
<p><b>‘Stored Only’ </b></p>
<p><b>‘All DTC’ </b></p>
<p>Bit 2 – PendingDTC </p>
<p>(Vector Extension) </p>
<p>DemPendingDtcProcessing = </p>
<p>STORED_ONLY </p>
<p>DemPendingDtcProcessing = </p>
<p>ALL_DTC </p>
<p>Bit 3 – ConfirmedDTC </p>
<p>DemResetConfirmedBitOn-</p>
<p>Overflow = TRUE </p>
<p>DemResetConfirmedBitOnOverflow = </p>
<p>FALSE </p>
<p>Bit 5 – FailedSinceLastClear </p>
<p>DemStatusBitHandlingTest-</p>
<p>FailedSinceLastClear = </p>
<p>AGING_AND_DISPLACEMENT </p>
<p>DemStatusBitHandlingTestFailed-</p>
<p>SinceLastClear = NORMAL or AGING </p>
<p>Bit 7 – WarningIndicatorReq </p>
<p>(Vector Extension) </p>
<p>DemWarningIndicatorRequested-</p>
<p>Processing = STORED_ONLY </p>
<p>Note: WIR bit is not reset on </p>
<p>displacement due to additional </p>
<p>requirements </p>
<p>DemWarningIndicatorRequested-</p>
<p>Processing = ALL_DTC </p>
<p>Table 3-4  </p>
<p>Configuration of status bit processing </p>
<p><b>3.4.4.2 </b></p>
<p><b>Lightweight Multiple Trips (FailureCycleCounterThreshold) </b></p>
<p>Enabling  the  feature  for  multiple  trips  (see  DemGeneral/DemMultipleTripSupport)  will </p>
<p>enable the full-fledged support, but at the cost of a non-volatile trip counter per event. The </p>
<p>common requirement of up to 2 trips (DemEventFailureCycleCounterThreshold &lt;= 1) can </p>
<p>work without this added cost. </p>
<p>In case you want to reduce Dem NVRAM consumption, you can <b>disable </b>the full support </p>
<p>for multiple trips, and still have support for up to 2 trips for event confirmation. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Although the UDS status byte normally allows distinguishing the first from the second </p>
<p>trip, it is not sufficient information in all failure scenarios with ConfirmedDTC handled </p>
<p>‘STORED_ONLY’.  </p>
<p>In case an event cannot enter the event memory (e.g. due to storage conditions or </p>
<p>overflow) at the time of the second trip, the Dem loses the information that the event </p>
<p>had already failed in the last operation cycle. </p>
<p>This means that failed event reports and re-occurrences of the DTC will <b>not </b>lead to </p>
<p>confirmation until the next operation cycle. </p>
<p>If this limitation is not acceptable for your ECU, you need to enable the full support for </p>
<p>multiple trips (DemMultipleTripSupport == true). </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.5 </b></p>
<p><b>Event Displacement </b></p>
<p>In case all available memory slots are already used up by past events when a new event </p>
<p>needs to be entered, the Dem can displace a less important event. This is governed by the </p>
<p>following set of rules, in the order of mention: </p>
<p><b>&gt; </b></p>
<p>Dedicated Aging Counters are repurposed first </p>
<p><b>&gt; </b></p>
<p>Aged events are displaced before other events </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>38 </p>
<p>based on template version 5.0.0 </p>
<p><b>&gt; </b></p>
<p>Lower prioritized events will be displaced by higher prioritized events. This step </p>
<p>depends on the configuration of event priorities and is omitted if each event has the </p>
<p>same priority. </p>
<p><b>&gt; </b></p>
<p>Passive events of equal priority (test failed bit is not set) can be displaced if no lower </p>
<p>prioritized event can be found. This step can be omitted by configuration. </p>
<p><b>&gt; </b></p>
<p>An active event of equal priority can be displaced if it has not been tested in the active </p>
<p>operation cycle. This step can be omitted by configuration.  </p>
<p>If multiple events match, the oldest one is displaced. Age in this context is defined by the </p>
<p>point in time the event data was last updated. </p>
<p>If no event matches, an option exists to displace the oldest event whatever its state. </p>
<p><b>3.6 </b></p>
<p><b>Event Aging </b></p>
<p>The process of aging resets status bit 3 – ConfirmedDTC when a sufficient amount of time </p>
<p>has elapsed so that the cause for the error entry is assumedly not relevant anymore. This </p>
<p>is often used as a trigger to also clear stored snapshot or extended data from the event </p>
<p>memory. </p>
<p>In addition to the aging process defined in [1] there are further options. The differences are </p>
<p>summarized in Table 3-5. </p>
<p>In all cases the event ages only if it supports aging, and the aging process continues long </p>
<p>enough so the events aging counter reaches the defined threshold value. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>The Dem supports reporting the aging counter value ‘0x00’ as ‘0x01’. This has no effect </p>
<p>on the actual aging of the DTC – If the aging target is configured to ‘0x01’, the DTC will </p>
<p>age when the aging counter reaches ‘0x01’ (see Figure 3-4), not when the counter </p>
<p>value ‘0x01’ is reported. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>39 </p>
<p>based on template version 5.0.0 </p>
<p><b> </b></p>
<p><b>Aging start condition </b></p>
<p><b>Aging continuation </b></p>
<p><b>Type 1 (Autosar </b></p>
<p><b>Default) </b></p>
<p>An event that is tested passed </p>
<p>immediately starts to age. </p>
<p>At the end of the events aging </p>
<p>cycle, if the event is not currently </p>
<p>active (tested failed). </p>
<p><b>Type 2 </b></p>
<p>At the end of the events </p>
<p>operation cycle, in case the </p>
<p>event is tested and did not test </p>
<p>‘failed’ in that cycle. </p>
<p>At the end of the events aging </p>
<p>cycle, if the event is not currently </p>
<p>active (tested failed). </p>
<p><b>Type 4 </b></p>
<p>An event that is tested passed </p>
<p>immediately starts to age. </p>
<p>At the end of the events aging </p>
<p>cycle, in case the event is tested in </p>
<p>its current operation cycle and is </p>
<p>currently not failed. </p>
<p><b>Types 3, 5 </b></p>
<p>At the end of the events </p>
<p>operation cycle, in case the </p>
<p>event is tested and did not test </p>
<p>‘failed’ in that cycle. </p>
<p>At the end of the events aging </p>
<p>cycle, if the event is tested and not </p>
<p>tested failed in its current operation </p>
<p>cycle. I.e. untested cycles are not </p>
<p>considered. </p>
<p><b>Type 6 </b></p>
<p>An event that is tested passed </p>
<p>and had not been tested failed </p>
<p>immediately starts to age. </p>
<p>At the end of the events aging </p>
<p>cycle, if the event is tested and not </p>
<p>tested failed in its current operation </p>
<p>cycle. I.e. untested cycles are not </p>
<p>considered. </p>
<p>Table 3-5  </p>
<p>Aging algorithms </p>
<p> </p>
<p>Figure 3-4 </p>
<p>Behavior of the Aging Counter </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>40 </p>
<p>based on template version 5.0.0 </p>
<p><b>3.6.1 </b></p>
<p><b>Aging Target ‘0’ </b></p>
<p>Events  aging  ‘immediately’  are  handled  in  a  special  way,  depending  on  the  configured </p>
<p>aging algorithm. </p>
<p>In  general,  they  age  immediately  when  the  aging  start  condition  is  reached.  For  details </p>
<p>refer to Table 3-6. </p>
<p><b> </b></p>
<p><b>Aging with target 0 </b></p>
<p><b>Types 1, 4 and 6 </b></p>
<p>When an event reports a passed result, and the DTC is tested passed  </p>
<p><b>Types 2, 3 </b></p>
<p>At the end of the event’s operation cycle, if the DTC was tested </p>
<p>passed and not tested failed in that cycle. </p>
<p><b>Type 5 </b></p>
<p>When an event reports a passed result, the DTC is tested passed, </p>
<p>and not tested failed in that cycle. </p>
<p>Table 3-6  </p>
<p>Immediate aging </p>
<p><b>3.6.2 </b></p>
<p><b>Aging Counter Reallocation </b></p>
<p>To  implement  aging  of  events,  an  event  requires  an  aging  counter.  This  counter  is </p>
<p>contained within the event memory entry along with stored additional data. If the confirmed </p>
<p>bit is set independently of event storage (see chapter  3.4.4.1) events do not necessarily </p>
<p>have the means to age, even if they meet the precondition (e.g. test completed and not </p>
<p>tested failed for one operation cycle). </p>
<p>In this case the Dem module tries to reallocate a <b>free </b>memory entry for the aging event. </p>
<p>This event entry is used solely for the purpose of aging the confirmed DTC bit. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>In case ConfirmedDTC is set independently of event storage (Setting ‘ALL DTC’, see </p>
<p>chapter 3.4.4.1) DTCs do not necessarily age with the configured number of aging </p>
<p>cycles. This is not a bug, but a result of an insufficient amount of available aging </p>
<p>counters. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.6.3 </b></p>
<p><b>Aging of Environmental Data </b></p>
<p>Stored  data  can  optionally  be  discarded  or  kept  intake  once  a  DTC  has  completed  the </p>
<p>aging process and resets its ConfirmedDTC bit. </p>
<p>If the data is kept intact, it is reported to the Dcm in the same way it is reported for active </p>
<p>events. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>41 </p>
<p>based on template version 5.0.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>This setting has a negative side effect on reallocating aging counters (see chapter </p>
<p>3.6.1), since the Dem prioritizes aged environmental data higher than the need for new </p>
<p>aging counters. There is no displacement of aged data due to a different, aging event.  </p>
<p>Only a number of DTCs up to the available event memory entries can age, unless </p>
<p>events are cleared by other means, e.g. ClearDTC. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.6.4 </b></p>
<p><b>Aging of TestFailedSinceLastClear </b></p>
<p>The general status bit processing for bit 5 is described in chapter 3.4.3. There is however </p>
<p>an additional option to reset this bit when an event ages. </p>
<p>Currently the aging counter value required to reset Bit 5 is the same as for ConfirmedDTC, </p>
<p>so there is no way to age it at a later time. </p>
<p>Please </p>
<p>refer </p>
<p>to </p>
<p>the </p>
<p>configuration </p>
<p>parameter </p>
<p>DemGeneral/DemStatusBitHandlingTest-</p>
<p>FailedSinceLastClear for details. </p>
<p><b>3.6.5 </b></p>
<p><b>Aging and Healing </b></p>
<p>Aging and healing normally happen in parallel. The Dem does not implement safe guards </p>
<p>to prevent aging before healing has occurred. This situation is rather unusual and would </p>
<p>indicate a mistake in the configuration, or how the cycles are reported to the Dem. </p>
<p>For some use-cases like OBD II, it is supported to only start with the aging process once a </p>
<p>configured </p>
<p>indicator </p>
<p>request </p>
<p>has </p>
<p>completed </p>
<p>healing. </p>
<p>In </p>
<p>order </p>
<p>to </p>
<p>achieve </p>
<p>consistent </p>
<p>behavior across all DTC, this can be activated also for events not supporting an indicator. </p>
<p>This aspect of the aging behavior can be selected using the configuration switch </p>
<p>DemGeneral/DemAgingAfterHealing. </p>
<p><b>3.7 </b></p>
<p><b>Operation Cycles </b></p>
<p>Each event is assigned to an operation cycle, e.g. ignition cycle. An operation cycle can be </p>
<p>started and stopped with the function </p>
<p>Dem_SetOperationCycleState()</p>
<p>. Reporting an </p>
<p>event to the Dem is possible only if its corresponding operation cycle is started – otherwise </p>
<p>the report will be discarded. In this regard the operation cycle acts as additional enable </p>
<p>condition which cannot be circumvented. </p>
<p>The operation cycle also is the basis for the status bits referring to ‘this operation cycle’ (Bit </p>
<p>1 and Bit 6), as well as the calculation of events that may or may not have occurred during </p>
<p>the whole cycle, e.g. to calculate the precondition for resetting Bit 2. </p>
<p>Since  operation  cycle  restarts  can  cause  a  lot  of  notification  function  calls,  the  actual </p>
<p>processing  is  done  asynchronously  on  the  Dem_MainFunction().  As  notification  for  the </p>
<p>finished processing, please use InitMonitorForX callbacks. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>42 </p>
<p>based on template version 5.0.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Due to the asynchronous processing, operation cycle changes will get lost if you shut </p>
<p>down the Dem module before a pending change is processed. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.7.1 </b></p>
<p><b>Persistent Storage of Operation Cycle State </b></p>
<p>The  Dem  provides  the  possibility  to  restore  the  state  of  operation  cycles  through  power </p>
<p>down. This feature has its caveats though. </p>
<p>The  persisted  state  of  operation  cycles  is  not  known  in  pre-initialization  state,  since  the </p>
<p>NvM which controls the non-volatile data relies on a pre-initialized Dem!  </p>
<p>Until the Dem is completely initialized all operation cycles are inactive, independently  of </p>
<p>their stored state. The persisted state only becomes active during </p>
<p>Dem_MasterInit()</p>
<p>, </p>
<p>but this state modification is not counted as flank of the operation cycle state and will not </p>
<p>modify the DTC status bytes. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Even with persistent operation cycle storage enabled, during pre-initialization all cycles </p>
<p>are in state ‘stopped’ since their real state is not known until full initialization. This <b>will </b></p>
<p>cause discarded BSW error reports due to unfulfilled preconditions! </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>3.7.2 </b></p>
<p><b>Automatic Operation Cycle Restart </b></p>
<p>Operation cycles automatically count as enable condition for all related events, meaning </p>
<p>that if a cycle is not started, monitor reports are not accepted. During ECU startup, there is </p>
<p>no valid way to start an operation cycle by API. </p>
<p>If you select a cycle to be started automatically, it will be treated as ‘started’ during pre-</p>
<p>initialization, so event reports are possible. </p>
<p>Additionally, </p>
<p>all </p>
<p>calculations </p>
<p>resulting </p>
<p>from </p>
<p>an </p>
<p>operation </p>
<p>cycle </p>
<p>restart </p>
<p>are </p>
<p>done </p>
<p>in </p>
<p>Dem_MasterInit()</p>
<p> – But be aware that all notification functions are skipped, since the </p>
<p>initialization status of the RTE is not known at this point. </p>
<p>The  DTC  status  calculation  is  performed  in </p>
<p>Dem_MasterInit()</p>
<p>  ‘as  if’  the  cycle  had </p>
<p>started before </p>
<p>Dem_MasterPreInit()</p>
<p>. E.g. fault detection counters of related DTCs do </p>
<p>not reset to zero. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>43 </p>
<p>based on template version 5.0.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Since the cycle is already started automatically you may not start it again from your </p>
<p>application. This would be regarded as an additional, completed cycle and would cause </p>
<p>unwanted modifications of the event status, like premature aging of events. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Automatic restart of cycle skips all notifications – including event status change and </p>
<p>monitor initialization callbacks. If you use this feature, your monitors need to initialize </p>
<p>their starting state in an initialization routine and cannot rely on an init-monitor </p>
<p>notification callback alone. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.8 </b></p>
<p><b>Enable Conditions and Control DTC Setting </b></p>
<p>Up  to  254  enable  conditions  can  be  assigned  to  an  event.  Only  if  all  assigned  enable </p>
<p>conditions are fulfilled the respective event reported via </p>
<p>Dem_ReportErrorStatus()</p>
<p> or </p>
<p>Dem_SetEventStatus()</p>
<p> will lead to a change of the event status bits and a storage of </p>
<p>environmental data. Otherwise the event report will be discarded. </p>
<p>A  diagnostic  monitor  using  the  RTE  interfaces  to  report  events  can  evaluate  the  return </p>
<p>value of the SetEventStatus operation. In case event reports are discarded, this operation </p>
<p>will always return E_NOT_OK. It is not possible to tell the exact reason for the discarded </p>
<p>report. </p>
<p>Enable  condition  states  can  be  set  via </p>
<p>Dem_SetEnableCondition() </p>
<p>respectively  by </p>
<p>the corresponding port interface operation. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Changes </b></p>
<p>Since Implementation version 7.00.00, enable conditions do not take effect until after </p>
<p>full initialization (Dem_MasterInit() resp. Dem_Init()) </p>
<p><b> </b></p>
<p><b> </b></p>
<p>When an event’s enable conditions are not fulfilled, the Dem provides the option to reset or </p>
<p>to freeze an ongoing de-bouncing process. Using this feature defers enabling an enable </p>
<p>condition  to  the  Dem  main  function,  because  it  involves  checking  all  events  if  they  are </p>
<p>affected by the change. </p>
<p>As a side effect, it is possible to lose enable condition changes that toggle faster than the </p>
<p>cycle time of the Dem main function. </p>
<p>The same applies to ControlDTCSetting. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>44 </p>
<p>based on template version 5.0.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Changes </b></p>
<p>Since implementation version 8.00.00, enabling enable conditions and </p>
<p>ControlDTCSetting are processed on the Dem main function. Activating an enable </p>
<p>condition will not have immediate effect. This change affects all configurations using </p>
<p>time-based de-bouncing, or the option to reset the de-bounce counters on enable </p>
<p>condition change. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>EnableDTCSettings is processed on the main function, but the API was not changed to </p>
<p>asynchronous by Autosar (RfC 69895). As a result, the Dcm will send the positive </p>
<p>response to service $85 before the DTCSettings have actually been enabled. This can </p>
<p>be observable as DTCs are not entered into the Dem until the Dem task function has </p>
<p>completed. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.8.1 </b></p>
<p><b>Effects on de-bouncing and FDC </b></p>
<p>While enable conditions are disabled, de-bouncing is usually stopped as well. The Dem </p>
<p>allows  configuring  whether  events  continue  de-bouncing  where  they  left  off,  or  whether </p>
<p>they start from the beginning – or even continue de-bouncing. </p>
<p>The point in time of the reset, being either when the enable conditions are disabled or re-</p>
<p>enabled, is also subject to configuration. </p>
<p>In any case, it is not possible for events to qualify during the time enable conditions (or </p>
<p>ControlDTCSetting) are disabled. </p>
<p><b>3.9 </b></p>
<p><b>Storage Conditions </b></p>
<p>Up  to  255  storage  conditions  can  be  assigned  to  an  event.  If  the  assigned  storage </p>
<p>conditions  are  not  fulfilled,  the  respective  event  reported  via </p>
<p>Dem_SetEventStatus()</p>
<p> </p>
<p>will change its status byte, but its environmental data and statistical data (e.g. most recent </p>
<p>failed event) is not stored or updated. </p>
<p>Also, status bits 2, 3, 5 and 7 will not transition while storage conditions are not fulfilled </p>
<p>(depending on configuration options, see chapter 3.4.4.1). </p>
<p>The storage condition state can be set via </p>
<p>Dem_SetStorageCondition()</p>
<p>. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>45 </p>
<p>based on template version 5.0.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>Unfulfilled storage conditions <b>prevent </b>event storage, not postpone it. When storage is </p>
<p>re-enabled, in most configurations the blocked entries will require either a passed </p>
<p></p>
<p>failed transition or a transition of TestFailedThisOperationCycle in order to create a </p>
<p>memory entry. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.10 </b></p>
<p><b>DTC Suppression </b></p>
<p>AUTOSAR provides two mechanisms to disable, hide or otherwise prevent evaluation of </p>
<p>test reports. They differ in the impact of the suppression operation. </p>
<p>This </p>
<p>implementation </p>
<p>allows </p>
<p>calling </p>
<p>the </p>
<p>event </p>
<p>based </p>
<p>suppression </p>
<p>API </p>
<p>before </p>
<p>full </p>
<p>initialization,  and  calls  by  BSW  or  CDD  (i.e.  it  does  not  require  Rte_Call).  Please  be </p>
<p>advised that this is an extension to [1]. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>Suppression / Availability states are not stored in non-volatile RAM – suppression must </p>
<p>be (re)activated in each power cycle. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.10.1 </b></p>
<p><b>Event Availability </b></p>
<p>The </p>
<p>API </p>
<p>Dem_SetEventAvailable() </p>
<p>can </p>
<p>disconnect </p>
<p>the </p>
<p>event </p>
<p>reporting </p>
<p>from </p>
<p>event </p>
<p>processing.  Use  this  mechanism  in  case  the  ECU  has  fault  paths  that  are  supported </p>
<p>conditionally, e.g. due to ECU variants. </p>
<p>Unavailable  events  do  not  track  a  status.  They  cannot  confirm,  cannot  enter  the  event </p>
<p>memory, and attached DTCs are not reported to the outside world, i.e. through Dcm API. </p>
<p>Event reports and the request to suppress the same event do collide. In order to correctly </p>
<p>implement </p>
<p>suppression, </p>
<p>unused </p>
<p>DTCs </p>
<p>should </p>
<p>be </p>
<p>suppressed </p>
<p>before </p>
<p>the  monitor </p>
<p>in </p>
<p>question starts to report test results for it. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The FiM module prior to Autosar 4.2.1 is not able to work with unavailable events. It </p>
<p>can cause runtime errors and/or FID status miscalculations when the FiM module tries </p>
<p>to request the event status of an unavailable event, since that request will return an </p>
<p>unexpected error code. </p>
<p><b> </b></p>
<p><b> </b></p>
<p>DTCs and events already stored in the event memory cannot be made unavailable and the </p>
<p>corresponding API call will fail. </p>
<p>For  combined  events,  the  DTC  will be  hidden  only  after all events  attached  to  the  DTC </p>
<p>have been set to disabled. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>46 </p>
<p>based on template version 5.0.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>A default setting for event availability can be defined. In this case, the API </p>
<p>Dem_SetEventAvailable() may not be called before Dem initialization, as the active </p>
<p>configuration is not known  </p>
<p>Also, the default setting cannot be used in conjunction with DemAvailabilityStorage </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.10.2 </b></p>
<p><b>Suppress DTC </b></p>
<p>The suppression APIs only ‘hide’ DTCs to the outside world. </p>
<p>Event processing and storage are processed normally – this means suppressed DTCs can </p>
<p>use up memory slots, and enable indicators. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>DTC suppression is not possible before full initialization. Dem_MasterInit()</p>
<p> </p>
<p>is the API </p>
<p>that selects the active configuration, so the mapping between EventId and DTC is not </p>
<p>known before then. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Changes </b></p>
<p>API Dem_SetEventSuppression is no longer supported. You can still suppress the DTC </p>
<p>based on the EventId using Dem_GetDTCOfEvent() </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.11 </b></p>
<p><b>Environmental Data </b></p>
<p>The  Dem  supports  storage  of  data  with  each  DTC  in  form  of  snapshot  records  and </p>
<p>extended data records.  </p>
<p>A Snapshot Record is DTC specific and consists of one or more DIDs (Data Identifiers) </p>
<p>which  in  turn  consist  of  one  more  data  elements.  Snapshot  Records  are  collected  and </p>
<p>stored at a configurable point in time during event confirmation, and often multiple times.  </p>
<p>An Extended Data Record is defined globally and consists of one or more data elements. It </p>
<p>is typically used for statistic values like the occurrence counter or aging counter that are </p>
<p>not frozen at storage time. </p>
<p>The content of data elements can be provided by the application or by the Dem itself. </p>
<p>For application defined data the Dem will request the data using callback functions every </p>
<p>time a new value needs to be stored, and supply the stored values to the reading module </p>
<p>(e.g.  the  Dcm).  This  type  of  data  is  comparable  to  snapshot  records  in  that  no  current </p>
<p>value can be supplied to a reader. </p>
<p>To use internal data provided by the Dem, data elements must be mapped by configuration </p>
<p>to the requested statistical value. The Dem will then always supply the current value of the </p>
<p>respective statistic to reading modules. </p>
<p>Figure 3-5 provides an example of the described layout. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>47 </p>
<p>based on template version 5.0.0 </p>
<p>© 2009. Vector Informatik GmbH. All rights reserved. Any distribution or copying is subject to prior written approval by Vector.</p>
<p>Slide: </p>
<p>1</p>
<p>DTC1</p>
<p>DID2</p>
<p>Data1</p>
<p>Data2</p>
<p>DID1</p>
<p>Data3</p>
<p>DTC2</p>
<p>DID3</p>
<p>Data2</p>
<p>Data4</p>
<p>DTCn</p>
<p>DID3</p>
<p>Data2</p>
<p>Data4</p>
<p>DID4</p>
<p>Data5</p>
<p>Data6</p>
<p>Data7</p>
<p>DTC1</p>
<p>Ext1</p>
<p>Aging Cnt </p>
<p>DTC2</p>
<p>Ext10</p>
<p>Data8</p>
<p>Data9</p>
<p>DTCn</p>
<p>Ext1</p>
<p>Aging Cnt </p>
<p>Ext1</p>
<p>Aging Cnt </p>
<p>Ext2</p>
<p>Data10</p>
<p>Ext4</p>
<p>Data11</p>
<p>Snapshot Record Layout</p>
<p>Extended Data Record Layout</p>
<p> </p>
<p>Figure 3-5 </p>
<p>Environmental Data Layout </p>
<p><b>3.11.1 </b></p>
<p><b>Storage Trigger </b></p>
<p>There  are  two  algorithms  how  snapshot  records  are  stored.  One  is  the  ‘calculated </p>
<p>snapshot number’ option, for which snapshots are currently stored with each transition of </p>
<p>the TestFailed bit of an event. </p>
<p>The ‘configured snapshot number’ option allows defining for each snapshot record in detail </p>
<p>when to store it, if its contents may be updated, and what its record number is going to be. </p>
<p>This second option  also  necessitates  defining  when  to  try  and  create an  event memory </p>
<p>entry, for there are some interesting combinations: </p>
<p>A failing DTC will (ideally) create the following triggers, in order: </p>
<p>1. </p>
<p>FDC threshold (&lt; qualified failed) exceeded </p>
<p>2. </p>
<p>FDC qualifies, Bit 0 is set </p>
<p>3. </p>
<p>DTC Pending, Bit 2 is set </p>
<p>4. </p>
<p>DTC Confirmed, Bit 3 is set </p>
<p>Although in reality these can easily all occur at the same time. </p>
<p>Snapshots are stored and updated with each trigger, so e.g. if the snapshot trigger is ‘test </p>
<p>failed’, each of these events will update a corresponding snapshot record – once an event </p>
<p>memory entry is created for the DTC. </p>
<p>The </p>
<p>exact </p>
<p>trigger </p>
<p>that </p>
<p>is </p>
<p>used </p>
<p>to </p>
<p>create </p>
<p>a </p>
<p>memory </p>
<p>entry </p>
<p>is </p>
<p>set </p>
<p>with </p>
<p>option </p>
<p>DemGeneral/DemEventStorageTrigger.  This  way  you  can  realize  ECUs  that  i.e.  update </p>
<p>snapshot data with each Occurrence, but start only once the DTC reaches ConfirmedDTC. </p>
<p><b>3.11.1.1 </b></p>
<p><b>Storage Trigger ‘FDC Threshold’ </b></p>
<p>The storage of a snapshot prior to event qualification can be realized by Dem internal or </p>
<p>monitor  internal  debouncing.  For  an  event  using  a  Dem  internal  debouncing  algorithm </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>48 </p>
<p>based on template version 5.0.0 </p>
<p>threshold values need to be configured. In case of monitor internal debouncing calling API </p>
<p>Dem_SetEventStatus() </p>
<p>or </p>
<p>Dem_ReportErrorStatus() </p>
<p>with </p>
<p>DEM_EVENT_STATUS_FDC_THRESHOLD_REACHED  triggers  the  Dem  to  store  the </p>
<p>snapshot. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>In case of monitor internal debouncing, snapshots with trigger ‘FDC Threshold’ are <b>not </b></p>
<p>stored or updated implicitly by monitor result DEM_EVENT_STATUS_FAILED.  To </p>
<p>achieve the initial storage or update, report the event with monitor result </p>
<p>DEM_EVENT_STATUS_FDC_THRESHOLD_REACHED first. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>If an event cannot be stored due to a full event memory, another attempt is made only </p>
<p>when the FDC threshold is crossed again. If the event’s FDC rests above the threshold </p>
<p>value, no attempt to store data is made, even if another event was cleared in the </p>
<p>meantime, e.g. by ClearDTC. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.11.2 </b></p>
<p><b>Internal Data Elements </b></p>
<p>The Dem provides access to the following values by means of an internal data element. </p>
<p>Internal data is usually not frozen in the primary memory, but rather the current value is </p>
<p>reported. </p>
<p><b>Aging counter </b></p>
<p>Available  both  in  positive  direction,  counting  up  from  0  (event  is  not  aging)  up  to  the </p>
<p>configured threshold value; and in reverse counting down to 0. </p>
<p><b>Healing counter </b></p>
<p>Available both in positive direction, counting up from 0 (event is not healing), latching at </p>
<p>255; and in reverse counting down from the healing threshold (event is not healing) to 0. </p>
<p>The up-counting data element corresponds to ‘Cycles Tested Since Last Failed’ and is also </p>
<p>calculated for events without indicator.  </p>
<p>The  Dem  bases  the  decision  whether  an  event  is  healing  on  status  ‘PendingDTC’  and </p>
<p>‘TestFailedSinceLastClear’.  The  healing  counter  is  only  available  if  these  status  bits  are </p>
<p>maintained for the DTC (i.e. the DTC is currently stored, or option ‘All DTC’ is used – see </p>
<p>chapter 3.4.4.1).  </p>
<p>Otherwise, the event is not considered to be healing and the  respective healing counter </p>
<p>value is reported (0 or healing threshold). </p>
<p><b>Occurrence counter </b></p>
<p>Counts  the  number  of  passed-failed  transitions  since  an  event  has  been  stored.  This </p>
<p>counter is available in 8bit and 16bit variants. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>49 </p>
<p>based on template version 5.0.0 </p>
<p><b>Cycle counters </b></p>
<p>Different  statistics  concerning  the  number  of  operation  cycles:  The  number  of  cycles </p>
<p>completed since the first or last failed result, and the number of cycles during  which an </p>
<p>event has reported a failed result. </p>
<p><b>Overflow indication:  </b></p>
<p>Indicates if the event’s memory destination has overflown. </p>
<p><b>Event priority:  </b></p>
<p>Is set to the configured priority value of the event. </p>
<p><b>Significance: </b></p>
<p>Is set to the configured event significance value. Occurrence is 0, Fault is 1. </p>
<p><b>Root cause EventId </b></p>
<p>The event id that caused the storage/update of the environmental data. Can be used in </p>
<p>context of the feature combined events to store the root cause event id. </p>
<p><b>OBD DTC </b></p>
<p>The OBD DTC for the event id that caused the storage/update of the environmental data. If </p>
<p>no OBD DTC is configured the returned value will be 0. </p>
<p><b>OBD Ratio </b></p>
<p>The  event  specific  numerator  and  denominator  values  if  the  event  has  a  ratio  attached </p>
<p>(see [10]). If no OBD is supported or the event does not support a ratio, the values are </p>
<p>reported as 0. Ratios for combined events are also reported as 0. </p>
<p>To  support  ratios  in  extended  data  records  for  combined  events,  use  a  callback  with </p>
<p>EventId, and without NV storage instead. In this callback you can calculate the combined </p>
<p>ratio. </p>
<p><b>Fault Detection Counter statistics </b></p>
<p>The current fault detection counter can always map. For internally de-bounced events, the </p>
<p>maximum value per operation cycle, and the maximum value since last clear are available </p>
<p>as well. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>50 </p>
<p>based on template version 5.0.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>For time-based events, the maximum FDC in a cycle (or since last clear) are updated </p>
<p>during the Dem task processing. This can result in a current FDC larger than the </p>
<p>displayed maximum FDC when the de-bouncing timer has just started. </p>
<p>This situation will correct itself after the timer has ticked once, but for low resolution </p>
<p>timing this can take up to the configured low resolution tick (which defaults to 150 ms). </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.11.3 </b></p>
<p><b>External Data Elements </b></p>
<p>Data  is  collected through  required port prototypes  and  needs  to be mapped to  the  data </p>
<p>provider  during  Rte  configuration.  Please  note  that  each  data  element  has  its  own  port </p>
<p>interface and port prototype. It is not supported to collect a variety of DIDs or data signals </p>
<p>through a shared callback function by AUTOSAR design. </p>
<p>As a vendor specific extension, the MICROSAR Dem module supports Client/Server data </p>
<p>callbacks that also pass the EventId to the application. This allows scenarios not possible </p>
<p>with a standard Dem: </p>
<p><b></b></p>
<p><b> </b></p>
<p>Application managed data storage: e.g. connecting the Dem to legacy applications that </p>
<p>already store (parts of) the environment data. </p>
<p><b></b></p>
<p><b> </b></p>
<p>Event specific data contents: e.g. storing root cause dependent data. </p>
<p><b>3.11.3.1 </b></p>
<p><b>NVRAM storage </b></p>
<p>The usual AUTOSAR Dem will store all data collected from the application in NVRAM. </p>
<p>For such data elements, data sampling is always processed on the Dem cyclic function. </p>
<p>Queries (e.g. through Dcm UDS diagnostic services) always return the frozen value. </p>
<p>As an extension to AUTOSAR, the Dem also allows to configure data elements to return </p>
<p>‘live’ data. This is useful especially to support statistics data that is not already covered by </p>
<p>the Dem internal data elements. </p>
<p>When  data  elements  are  configured  not  to  be  stored  in  NVRAM,  the  data  is  requested </p>
<p>every  time  a  query  is  processed.  Their  implementation  should  be  reentrant  and  fast  to </p>
<p>allow diagnostic responses to complete in time. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>There is no way to tell the Dem that data is ‘not currently available’ in this case. The </p>
<p>Autosar standard requires to substitute a ‘0xFF’ pattern in case a data callback returns </p>
<p>‘NOT OK’ </p>
<p>Optional data is not possible, especially since a single DID or extended record may </p>
<p>consist of up to 255 callbacks, and optional data right in the middle of a DID makes no </p>
<p>sense. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.12 </b></p>
<p><b>Freeze Frame Pre-Storage </b></p>
<p>The  environmental  data  associated  with  a  DTC  is  collected  when  the  DTC  storage  is </p>
<p>processed  on  the  Dem  task  function. The  delay  between  the  event  report  and  the  data </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>51 </p>
<p>based on template version 5.0.0 </p>
<p>collection can be a problem if fast changing data needs to be captured. In other use-cases </p>
<p>the DTC is supposed to store a snapshot of the system state some time before the event </p>
<p>qualification finishes. </p>
<p>Using  Dem_PrestoreFreezeFrame()  a  monitor  can  request  immediate  data  capture.  If </p>
<p>successful,  this  snapshot  is  used  as  the  data  source  if  the  DTC  is  stored  to  the  event </p>
<p>memory later on. </p>
<p>The Dem captures the following data, if relevant: </p>
<p><b></b></p>
<p><b> </b></p>
<p>A UDS snapshot record </p>
<p><b></b></p>
<p><b> </b></p>
<p>A OBD freeze frame </p>
<p><b></b></p>
<p><b> </b></p>
<p>J1939 freeze frame and expanded freeze frame </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Extended data records are not captured. </p>
<p><b> </b></p>
<p><b> </b></p>
<p>The  Dem  can  only  pre-store  a  limited  number  of  events  (see  configuration  parameter </p>
<p>DemGeneral/DemMaxNumberPrestoredFF). </p>
<p>Once </p>
<p>the </p>
<p>provided </p>
<p>space </p>
<p>is </p>
<p>exhausted </p>
<p>subsequent pre-storage requests will fail until one or more of them are freed. It is always </p>
<p>possible to refresh a pre-stored data set already allocated to an event. </p>
<p>Pre-Stored data is not preserved after shutdown, and will be discarded automatically once </p>
<p>it is used or after a qualified test result has been processed for the respective event. Also </p>
<p>see Dem_ClearPrestoredFreezeFrame() for a way to explicitly discard stale data. </p>
<p><b>3.13 </b></p>
<p><b>Combined Events </b></p>
<p>It is possible to combine the results of multiple monitors to a single DTC. This feature is </p>
<p>referred to as ‘Combined Events’ in this document. </p>
<p>Monitors report events as usual,  events are de-bounced individually, and for each event </p>
<p>the Dem keeps track of its individual status byte. Only when a DTC status is required there </p>
<p>is a visible difference. </p>
<p><b>3.13.1 </b></p>
<p><b>Configuration </b></p>
<p>Currently  the  configuration  format  allows  too  much  freedom  in  configuration  due  to  the </p>
<p>multiple combination types. For Type 1 combination the following restrictions apply: </p>
<p><b></b></p>
<p><b> </b></p>
<p>All events mapped to the same DTC must have identical environmental data </p>
<p>(extended records, number and content of snapshots etc. </p>
<p><b></b></p>
<p><b> </b></p>
<p>All events mapped to the same DTC must use the same cycles (operation, failing, </p>
<p>healing and aging cycles)  </p>
<p><b></b></p>
<p><b> </b></p>
<p>All events mapped to the same DTC must use the same destination, significance, </p>
<p>priority, the same setting for ‘aging allowed’ and the same significance. </p>
<p>The behavior with mixed settings is undefined and not supported by this implementation. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>52 </p>
<p>based on template version 5.0.0 </p>
<p><b>3.13.2 </b></p>
<p><b>Event Reporting </b></p>
<p>Since  version  13.00.00  there  is  no  difference  between  combined  events  and  normal </p>
<p>events. Refer to 3.4.2 for additional information. </p>
<p><b>3.13.3 </b></p>
<p><b>DTC Status </b></p>
<p>If  event  combination  is  used,  the  DTC  status  does  not  correspond  to  the  event  status </p>
<p>directly. Instead, the DTC status is derived from the status of multiple events. </p>
<p>As defined by Autosar (see [1]) this combined status is calculated according to Table 3-7. </p>
<p>Basically the DTC status is a simple OR combination of all events, with the resulting status </p>
<p>byte modified by an additional combination term. This is done such that a failed result will </p>
<p>also reset the ‘test not completed’ bits even if not all contributing monitors have completed </p>
<p>their test cycle. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>A direct effect of event combination is a possible toggle of Bit 4 and Bit 6 during a </p>
<p>single operation cycle. I.e. these bits can become <b>set (test not completed </b></p>
<p><b></b></p>
<p><b> true) </b>as </p>
<p>result of a completed test. This behavior is intended by Autosar and not an </p>
<p>implementation issue. </p>
<p>Applications need to take this into account when reacting on changes of ‘Test not </p>
<p>Completed This Operation Cycle / Since Last Clear’! </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Combined DTC Status Bit </b></p>
<p> </p>
<p>Bit 0 – TestFailed </p>
<p>OR (Event[i].Bit0) </p>
<p>Bit 1 – Test Failed This Operation Cycle </p>
<p>OR (Event[i].Bit1) </p>
<p>Bit 2 – PendingDTC </p>
<p>OR (Event[i].Bit2) </p>
<p>Bit 3 – ConfirmedDTC </p>
<p>OR (Event[i].Bit3) </p>
<p>Bit 4 – Test not Completed Since Last Clear  </p>
<p>OR (Event[i].Bit4) AND NOT Bit5 </p>
<p>Bit 5 – Test Failed Since Last Clear </p>
<p>OR (Event[i].Bit5) </p>
<p>Bit 6 – Test not Completed This Operation Cycle </p>
<p>OR (Event[i].Bit6) AND NOT Bit1 </p>
<p>Bit 7 – Warning Indicator Requested </p>
<p>OR (Event[i].Bit7) </p>
<p>Table 3-7  </p>
<p>DTC status combination </p>
<p><b>3.13.4 </b></p>
<p><b>Environmental Data Update </b></p>
<p>Environment  data  and  statistics  are  calculated  based  on  the  DTC  status,  not  the  event </p>
<p>status of contributing events. </p>
<p>Example:  The  occurrence  counter,  if  configured,  is  not  incremented  with  each  failing </p>
<p>monitor. Instead, the occurrence counter is incremented each time Bit0 of the combined </p>
<p>DTC transitions 0 </p>
<p></p>
<p> 1. </p>
<p>A failed monitor result might therefore not result in an update of event data (nor an event </p>
<p>data changed notification). This behavior is intentional. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>53 </p>
<p>based on template version 5.0.0 </p>
<p><b>3.13.5 </b></p>
<p><b>Aging </b></p>
<p>A combined DTC starts to age once the conditions discussed in chapter 3.6 are fulfilled for </p>
<p>each event, e.g. once all monitors have reported a ‘passed’ result. </p>
<p><b>3.13.6 </b></p>
<p><b>Clear DTC </b></p>
<p>If a  request  to  clear a  combined  DTC is received,  all  monitors  that  define a  ‘clear DTC </p>
<p>allowed’  callback  will  be  notified  by  the  Dem  and  have  a  chance  to  prevent  the  clear </p>
<p>operation. If a single monitor disallows the clear operation, the DTC will be left in the event </p>
<p>memory. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>If an application responds positively to a call to a ‘clear event allowed’ callback, the </p>
<p>DTC is <b>not </b>necessarily cleared as a result! </p>
<p>Another monitor can be combined to the same DTC and disallow the clear operation. </p>
<p>Do <b>not </b>use a clear allowed callback as indication that a DTC was cleared, instead use </p>
<p>the InitMonitorForEvent notification! </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.14 </b></p>
<p><b>Non-Volatile Data Management </b></p>
<p>The Dem uses the standard AUTOSAR data management facilities provided by the NvM </p>
<p>module. </p>
<p><b>3.14.1 </b></p>
<p><b>NvM Interaction </b></p>
<p>If immediate data writes are enabled, the NvM needs to support API configuration class 2. </p>
<p>Otherwise the APIs provided by configuration class 1 are sufficient for Dem operation. </p>
<p>If </p>
<p>you </p>
<p>do </p>
<p>not </p>
<p>use  an  AUTOSAR </p>
<p>NvM </p>
<p>module, </p>
<p>you </p>
<p>have </p>
<p>to  provide </p>
<p>a </p>
<p>compatible </p>
<p>replacement in order to use features related to non-volatile data management. The NvM </p>
<p>module  needs  to  implement  at  least  the  functionality  described  in  chapter  4.5  NvM </p>
<p>Integration. </p>
<p><b>3.14.2 </b></p>
<p><b>NVRAM Write Frequency  </b></p>
<p>The Dem is designed to trigger as less NVRAM writes as possible. Thereto only the data </p>
<p>which typically changes not very often is stored during ECU runtime. The following table </p>
<p>will give you an overview of the NVRAM write frequency. </p>
<p><b>NVRAM Item  </b></p>
<p> </p>
<p> </p>
<p> </p>
<p><b>Write Frequency </b></p>
<p>Admin Data </p>
<p>Status Data </p>
<p>Debounce Data </p>
<p>Primary Entry </p>
<p>Secondary Entry </p>
<p>At shutdown - always </p>
<p></p>
<p> </p>
<p></p>
<p>1</p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p>At shutdown - if content has changed </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p>                                            </p>
<p>1</p>
<p> Only in case of option DemOperationCycleStatusStorage is enabled </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>54 </p>
<p>based on template version 5.0.0 </p>
<p><b>NVRAM Item  </b></p>
<p> </p>
<p> </p>
<p> </p>
<p><b>Write Frequency </b></p>
<p>Admin Data </p>
<p>Status Data </p>
<p>Debounce Data </p>
<p>Primary Entry </p>
<p>Secondary Entry </p>
<p>At clear DTC </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p>Immediately - if immediate NVRAM storage is enabled  </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p>1</p>
<p> </p>
<p></p>
<p>1</p>
<p> </p>
<p>Immediately by Dem_RequestNvSynchronization() – if </p>
<p>content has changed </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p>Table 3-8  </p>
<p>NVRAM write frequency </p>
<p><b>3.14.3 </b></p>
<p><b>Data Recovery </b></p>
<p>As the Dem uses multiple NVRAM blocks to persist its data (refer to 4.5), it might happen </p>
<p>that  correlating  data  becomes  inconsistent  due  to  a  power  loss  or  an  NVRAM  error. To </p>
<p>avoid  restoring  to  an  undefined  state,  during  initialization  some  errors  are  detected  and </p>
<p>corrected, as follows. </p>
<p><b>&gt; </b></p>
<p>Duplicate entries in a memory are resolved by removing the older entry. </p>
<p><b>&gt; </b></p>
<p>Stored-Only/Aging status bits are reset if the respective event is not stored, or aged. </p>
<p><b>&gt; </b></p>
<p>Depending on aging behavior the status bits TestFailed, PendingDTC, </p>
<p>TestFailedThisOperationCycle and WarningIndicatorRequested, are reset for currently </p>
<p>aging events. </p>
<p><b>&gt; </b></p>
<p>Reset status bit TestFailedThisOperationCycle if both TestFailedThisOperationCycle </p>
<p>and TestNotCompletedThisOperationCycle are set. </p>
<p><b>&gt; </b></p>
<p>Reset status bit TestNotCompletedSinceLastClear if both TestFailedSincleLastClear </p>
<p>and TestNotCompletedSinceLastClear are set. </p>
<p><b>&gt; </b></p>
<p>De-bounce counters are reset if they exceed the configured threshold, or the </p>
<p>TestFailed bit does not match a reached threshold (only relevant if de-bounce counters </p>
<p>are stored in NVRAM). </p>
<p><b>&gt; </b></p>
<p>Stored Events have their status bit corrected if: </p>
<p><b>&gt; </b></p>
<p>Events are stored when they reach an fault detection counter limit and if </p>
<p><b>&gt; </b></p>
<p>A consecutive failed cycle counter is supported, and has a value &gt; 0, status bits </p>
<p>PendingDTC and TestFailedSincleLastClear are set. If that counter also exceeds </p>
<p>the failure cycle counter threshold, the ConfirmedDTC status bit is set. </p>
<p><b>&gt; </b></p>
<p>An occurrence counter is supported and has a value &gt; 0, then status bit </p>
<p>TestFailedSincleLastClear is set. </p>
<p><b>&gt; </b></p>
<p>Events are stored with other triggers </p>
<p>                                            </p>
<p>1</p>
<p> Immediate storage is restricted to changes caused by an occurrence, or initial storage. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>55 </p>
<p>based on template version 5.0.0 </p>
<p><b>&gt; </b></p>
<p>The status bit TestFailedSincleLastClear is set. </p>
<p><b>&gt; </b></p>
<p>If a consecutive failed cycle counter is supported, and has a value &gt; 0, the status bit </p>
<p>PendingDTC is set. If that counter also exceeds the failure cycle counter threshold, </p>
<p>the status bit ConfirmedDTC is set. </p>
<p><b>&gt; </b></p>
<p>If the event has a failure cycle counter threshold of 0, the status bit ConfirmedDTC </p>
<p>is set. </p>
<p><b>&gt; </b></p>
<p>If events are stored with trigger ConfirmedDTC, status bit ConfirmedDTC is set. </p>
<p><b>&gt; </b></p>
<p>If a combined event is stored, but the EventId in NVRAM is not the 'master' EventId for </p>
<p>that combination group, the entry is discarded. This happens due to an integration </p>
<p>error, so also a DET error (inconsistent state) will be set. </p>
<p><b>&gt; </b></p>
<p>If the event has no warning indicator configured but the status bit </p>
<p>WarningIndicatorRequested is set, then the status bit WarningIndicatorRequested is </p>
<p>reset. </p>
<p><b>3.15 </b></p>
<p><b>Diagnostic Interfaces </b></p>
<p>To  provide  the  data  maintained  by  the  Dem  to  an  external  tester  the  Dem  supports </p>
<p>interfaces to the Dcm which are described in chapter 6.2.8. </p>
<p>Please note, these API are intended for use by the Dcm module exclusively and may not </p>
<p>be </p>
<p>safe  to  use  otherwise. </p>
<p>In </p>
<p>case  a </p>
<p>replacement  for </p>
<p>the </p>
<p>Dcm  module </p>
<p>has  to  be </p>
<p>implemented, we politely refer to the Autosar Dcm specification [3], and do not elaborate </p>
<p>on the details within the context of this document. </p>
<p><b>3.16 </b></p>
<p><b>Notifications </b></p>
<p>The </p>
<p>Dem </p>
<p>supports </p>
<p>several </p>
<p>configurable </p>
<p>global </p>
<p>and </p>
<p>specific </p>
<p>event </p>
<p>or </p>
<p>DTC </p>
<p>related </p>
<p>notification functions  which  will  be  described  in  the following.  For  details  please  refer to </p>
<p>chapter 6.5.1. </p>
<p>Notification functions will only be called, if the Dem is fully initialized. </p>
<p><b>3.16.1 </b></p>
<p><b>Monitor Status Changed </b></p>
<p>These are notifications for a monitor status change. With the given event ID the receiver is </p>
<p>able to identify what has changed. </p>
<p><b>&gt; </b></p>
<p>General notification:  </p>
<p>This callback function is called from Dem for each event on monitor status change. </p>
<p><b>3.16.2 </b></p>
<p><b>Event Status Changed </b></p>
<p>These  are  notifications  for  an  event  status  change  independent  of  the  DTC  status </p>
<p>availability mask. With the given old and new status the receiver is able to identify what </p>
<p>has changed. </p>
<p><b>&gt; </b></p>
<p>General notification:  </p>
<p>This callback function is called from Dem for each event on status change. </p>
<p><b>&gt; </b></p>
<p>Event specific notifications:  </p>
<p>Each event may have one or more of these callback functions which are called only if </p>
<p>the respective event status has changed. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>56 </p>
<p>based on template version 5.0.0 </p>
<p><b>&gt; </b></p>
<p>FIM notification:  </p>
<p>This callback function is called for each event on status change. Dependent on the </p>
<p>given state the FIM is able to derive the new fault inhibition state. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The event status notifications are triggered from the Dem task function, not directly out </p>
<p>of the context of the monitor. </p>
<p><b>There will be a delay of up to the Dem task cycle time between a monitor report </b></p>
<p><b>and the change notification. </b></p>
<p>This also affects the function permission calculation in the FiM module which is based </p>
<p>on the event status notification. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.16.3 </b></p>
<p><b>DTC Status Changed </b></p>
<p>These are notifications for a DTC status change. The DTC status availability mask is taken </p>
<p>into account, so status bits which are not supported will not cause a notification. It is also </p>
<p>possible that a changed event status does not change the resulting status of a combined </p>
<p>DTC. </p>
<p><b>&gt; </b></p>
<p>Global notifications:  </p>
<p>The configuration can define one or more of these callback functions which are called </p>
<p>only if the respective DTC status has changed. </p>
<p><b>&gt; </b></p>
<p>Dcm notification:  </p>
<p>This callback function is called for each DTC status change. Dependent on the given </p>
<p>state the Dcm is able to decide if a ROE message shall be sent. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Changes </b></p>
<p>Since version 13.00.00, API </p>
<p>Dem_DcmControlDTCStatusChangedNotiﬁcation</p>
<p> is </p>
<p>no longer supported and notifications are called always unless caused by ClearDTC. </p>
<p>To achieve the behavior of earlier versions, disable Dcm notifications and configure the </p>
<p>Dcm callback function as generic C callback: </p>
<p>DemGeneral/DemTriggerDcmReports = False </p>
<p>DemGeneral/DemCallbackDTCStatusChanged/DemCallbackDTCStatusChangedFnc = </p>
<p>&lt;Symbol of Dcm notification function&gt; </p>
<p>DemGeneral/DemHeaderFileInclusion =  </p>
<p>&lt;Header file declaring the Dcm notification function&gt; </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.16.4 </b></p>
<p><b>Event Data Changed </b></p>
<p>These notifications will be called from Dem if the data related to an event has changed. </p>
<p><b>&gt; </b></p>
<p>General notification:  </p>
<p>This is a single callback function which is called for each event on data change. </p>
<p><b>&gt; </b></p>
<p>Event specific notification:  </p>
<p>Each event may have one callback function which is called on event data change. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>57 </p>
<p>based on template version 5.0.0 </p>
<p><b>3.16.5 </b></p>
<p><b>Monitor Re-Initialization </b></p>
<p>These notifications are called from Dem, to signal to diagnostic monitors that a new test </p>
<p>result is now requested. This can happen due to clearing the fault memory, the start of a </p>
<p>new  operation  cycle,  or  the  re-enabling  of  previously  disabled  DTC  settings  or  enable </p>
<p>conditions </p>
<p>The set of notification calls is fully customizable in the configuration. </p>
<p><b>&gt; </b></p>
<p>Event specific notification:  </p>
<p>Each event may have one callback function which is called for the reasons mentioned </p>
<p>above. </p>
<p><b>&gt; </b></p>
<p>Function specific notifications:  </p>
<p>Each event may have one or more of this callback functions which is called for the </p>
<p>reasons mentioned above. </p>
<p>For combined events, this callback is notified for each event if they are re-enabled by </p>
<p>enable conditions. </p>
<p><b>3.16.6 </b></p>
<p><b>ClearDTC Notification </b></p>
<p>These  notifications  will  be  called  from  the  Dem  task  function  either  before  of  after </p>
<p>processing the clear request. This is configurable per notification. </p>
<p><b>&gt; </b></p>
<p>Before a clear request is started, i.e. before any DTC is modified or a ClearAllowed </p>
<p>callbacks is invoked. </p>
<p><b>&gt; </b></p>
<p>After a clear request has finished. This is either after all DTCs have been reset in </p>
<p>RAM, or after the cleared NV information was persisted by the NvM. The notification </p>
<p>will be triggered before Dcm can send a response. </p>
<p><b>3.17 </b></p>
<p><b>Indicators </b></p>
<p>An  event  can  be  configured  to  have  one  or  more  indicators  assigned.  An  indicator  is </p>
<p>reported  active  if  at  least  one  assigned  event  requests  it,  and  cleared  when  all  events </p>
<p>assigned to it have revoked their warning indicator request (i.e. by healing or diagnostic </p>
<p>service ClearDtc). </p>
<p>The indicator status is set always with event confirmation (set condition of bit 3), and reset </p>
<p>after the configured number of operation cycles during which the event was tested, but not </p>
<p>tested failed. </p>
<p>An event’s warning indicator request status is reported in bit 7 of the UDS status byte. </p>
<p><b>3.17.1 </b></p>
<p><b>User Controlled WarningIndicatorRequest </b></p>
<p>Use  cases  that  demand  setting  of  the  UDS  Bit  7  (WarningIndicatorRequest)  differently </p>
<p>from  the  normal  indicator  handling  can  be  met  using  the  operation  SetWIRStatus  (see </p>
<p>chapter 6.6.1.1.9). </p>
<p>Examples include resetting the WIR bit only with the next power cycle after the indicator </p>
<p>status has healed, or setting it with the first failed result instead of the ‘confirmedDTC’ bit. </p>
<p>This  interface  also  allows  controlling  Bit7  of  a  BSW  error.  There  is  only  a  SWC  API </p>
<p>available to control the WIR status bit of BSW errors, so a SWC module has to be used for </p>
<p>this task in all cases. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>58 </p>
<p>based on template version 5.0.0 </p>
<p>To calculate the visible status of Bit 7, the ‘normal’ monitor WIR request is logically OR’ed </p>
<p>to the user controlled state as depicted in Figure 3-6. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>UDS  DTC  status  change  notifications  are  called  only  if  the  combined  (User </p>
<p>Controlled  +  Indicator)  status  changes.  In  case  more  detailed  information  is </p>
<p>needed a SWC can use the operation GetWIRStatus in combination with event </p>
<p>status notifications. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>Figure 3-6 </p>
<p>User Controlled WarningIndicatorRequest </p>
<p><b>3.18 </b></p>
<p><b>Interface to the Runtime Environment </b></p>
<p>The Dem interacts with the application through the Rte and defined port interfaces (see </p>
<p>chapter 6.6). </p>
<p>There are no statically defined callouts that need to be implemented by the application. All </p>
<p>notifications and callouts are set up during configuration. </p>
<p>This is why the Dem software component description file (Dem_swc.arxml) is generated </p>
<p>based on the configuration. </p>
<p><b>3.19 </b></p>
<p><b>Error Handling </b></p>
<p><b>3.19.1 </b></p>
<p><b>Development Error Reporting </b></p>
<p>By </p>
<p>default, </p>
<p>development </p>
<p>errors </p>
<p>are </p>
<p>reported </p>
<p>to </p>
<p>the </p>
<p>Det </p>
<p>using </p>
<p>the </p>
<p>service </p>
<p>Det_ReportError()</p>
<p>  as  specified  in  [2],  if development  error reporting  is  enabled  (i.e. </p>
<p>pre-compile parameter </p>
<p>Dem_DEV_ERROR_DETECT==STD_ON</p>
<p>). </p>
<p>If  another  module  is  used  for  development  error  reporting,  the  function  prototype  for </p>
<p>reporting the error can be configured by the integrator, but must have the same signature </p>
<p>as the service </p>
<p>Det_ReportError()</p>
<p>. </p>
<p>The reported Dem ID is 54. </p>
<p>The  reported  service  IDs  identify  the  services  which  are  described  in  6.2. The following </p>
<p>table presents the service IDs and the related services: </p>
<p><b>Service ID </b></p>
<p><b>Service </b></p>
<p>0x00 </p>
<p>Dem_GetVersionInfo() </p>
<p>0x01 </p>
<p>Dem_PreInit()/Dem_MasterPreInit() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>59 </p>
<p>based on template version 5.0.0 </p>
<p><b>Service ID </b></p>
<p><b>Service </b></p>
<p>0x02 </p>
<p>Dem_Init()/Dem_MasterInit() </p>
<p>0x03 </p>
<p>Dem_Shutdown() </p>
<p>0x04 </p>
<p>Dem_SetEventStatus() </p>
<p>0x05 </p>
<p>Dem_ResetEventStatus() </p>
<p>0x06 </p>
<p>Dem_PrestoreFreezeFrame() </p>
<p>0x07 </p>
<p>Dem_ClearPrestoredFreezeFrame() </p>
<p>0x08 </p>
<p>Dem_SetOperationCycleState() </p>
<p>0x09 </p>
<p>Dem_ResetEventDebounceStatus() </p>
<p>0x0A </p>
<p>Dem_GetEventUdsStatus() </p>
<p>0x0B </p>
<p>Dem_GetEventFailed() </p>
<p>0x0C </p>
<p>Dem_GetEventTested() </p>
<p>0x0D </p>
<p>Dem_GetDTCOfEvent() </p>
<p>0x0E </p>
<p>Dem_GetSeverityOfDTC() </p>
<p>0x0F </p>
<p>Dem_ReportErrorStatus() </p>
<p>0x11 </p>
<p>Dem_SetAgingCycleState </p>
<p>0x12 </p>
<p>Dem_SetAgingCycleCounterValue </p>
<p>0x13 </p>
<p>Dem_SetDTCFilter() </p>
<p>0x15 </p>
<p>Dem_GetStatusOfDTC() </p>
<p>0x16 </p>
<p>Dem_GetDTCStatusAvailabilityMask() </p>
<p>0x17 </p>
<p>Dem_GetNumberOfFilteredDTC() </p>
<p>0x18 </p>
<p>Dem_GetNextFilteredDTC() </p>
<p>0x19 </p>
<p>Dem_GetDTCByOccurrenceTime() </p>
<p>0x1A </p>
<p>Dem_DisableDTCRecordUpdate() </p>
<p>0x1B </p>
<p>Dem_EnableDTCRecordUpdate() </p>
<p>0x1C </p>
<p>Dem_DcmGetOBDFreezeFrameData() </p>
<p>0x1D </p>
<p>Dem_GetNextFreezeFrameData() </p>
<p>0x1F </p>
<p>Dem_GetSizeOfFreezeFrameSelection() </p>
<p>0x20 </p>
<p>Dem_GetNextExtendedDataRecord() </p>
<p>0x21 </p>
<p>Dem_GetSizeOfExtendedDataRecordSelection() </p>
<p>0x23 </p>
<p>Dem_ClearDTC() </p>
<p>0x24 </p>
<p>Dem_DisableDTCSetting() </p>
<p>0x25 </p>
<p>Dem_EnableDTCSetting() </p>
<p>0x29 </p>
<p>Dem_GetIndicatorStatus() </p>
<p>0x32 </p>
<p>Dem_GetEventMemoryOverflow() </p>
<p>0x33 </p>
<p>Dem_SetDTCSuppression() </p>
<p>0x34 </p>
<p>Dem_GetFunctionalUnitOfDTC() </p>
<p>0x35 </p>
<p>Dem_GetNumberOfEventMemoryEntries() </p>
<p>0x37 </p>
<p>Dem_SetEventAvailable() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>60 </p>
<p>based on template version 5.0.0 </p>
<p><b>Service ID </b></p>
<p><b>Service </b></p>
<p>0x38 </p>
<p>Dem_SetStorageCondition() </p>
<p>0x39 </p>
<p>Dem_SetEnableCondition() </p>
<p>0x3A </p>
<p>Dem_GetNextFilteredRecord() </p>
<p>0x3B </p>
<p>Dem_GetNextFilteredDTCAndFDC() </p>
<p>0x3C </p>
<p>Dem_GetTranslationType() </p>
<p>0x3D </p>
<p>Dem_GetNextFilteredDTCAndSeverity() </p>
<p>0x3E </p>
<p>Dem_GetFaultDetectionCounter() </p>
<p>0x3F </p>
<p>Dem_SetFreezeFrameRecordFilter() </p>
<p>0x40 </p>
<p>Dem_DltGetAllExtendedDataRecords </p>
<p>0x41 </p>
<p>Dem_DltGetMostRecentFreezeFrameRecordData </p>
<p>0x51 </p>
<p>Dem_SetEventDisabled </p>
<p>0x52 </p>
<p>Dem_DcmReadDataOfOBDFreezeFrame </p>
<p>0x53 </p>
<p>Dem_DcmGetDTCOfOBDFreezeFrame </p>
<p>0x55 </p>
<p>Dem_MainFunction()/Dem_MasterMainFunction() </p>
<p>0x61 </p>
<p>Dem_DcmReadDataOfPID01 </p>
<p>0x63 </p>
<p>Dem_DcmReadDataOfPID1C </p>
<p>0x64 </p>
<p>Dem_DcmReadDataOfPID21 </p>
<p>0x65 </p>
<p>Dem_DcmReadDataOfPID30 </p>
<p>0x66 </p>
<p>Dem_DcmReadDataOfPID31 </p>
<p>0x67 </p>
<p>Dem_DcmReadDataOfPID41 </p>
<p>0x68 </p>
<p>Dem_DcmReadDataOfPID4D </p>
<p>0x69 </p>
<p>Dem_DcmReadDataOfPID4E </p>
<p>0x6A </p>
<p>Dem_DcmReadDataOfPID91 </p>
<p>0x6B </p>
<p>Dem_DcmGetInfoTypeValue08 </p>
<p>0x6C </p>
<p>Dem_DcmGetInfoTypeValue0B </p>
<p>0x6D </p>
<p>Dem_GetEventExtendedDataRecordEx() </p>
<p>0x6E </p>
<p>Dem_GetEventFreezeFrameDataEx() </p>
<p>0x71 </p>
<p>Dem_RepIUMPRDenLock </p>
<p>0x72 </p>
<p>Dem_RepIUMPRDenRelease </p>
<p>0x73 </p>
<p>Dem_RepIUMPRFaultDetect </p>
<p>0x79 </p>
<p>Dem_SetPtoStatus </p>
<p>0x7A </p>
<p>Dem_SetWIRStatus() </p>
<p>0x90 </p>
<p>Dem_J1939DcmSetDTCFilter() </p>
<p>0x91 </p>
<p>Dem_J1939DcmGetNumberOfFilteredDTC () </p>
<p>0x92 </p>
<p>Dem_J1939DcmGetNextFilteredDTC() </p>
<p>0x93 </p>
<p>Dem_J1939DcmFirstDTCwithLampStatus() </p>
<p>0x94 </p>
<p>Dem_J1939DcmGetNextDTCwithLampStatus () </p>
<p>0x95 </p>
<p>Dem_J1939DcmClearDTC() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>61 </p>
<p>based on template version 5.0.0 </p>
<p><b>Service ID </b></p>
<p><b>Service </b></p>
<p>0x96 </p>
<p>Dem_J1939DcmSetFreezeFrameFilter() </p>
<p>0x97 </p>
<p>Dem_J1939DcmGetNextFreezeFrame() </p>
<p>0x98 </p>
<p>Dem_J1939DcmGetNextSPNInFreezeFrame() </p>
<p>0x99 </p>
<p>Dem_J1939DcmSetRatioFilter </p>
<p>0x9A </p>
<p>Dem_J1939DcmGetNextFilteredRatio </p>
<p>0x9B </p>
<p>Dem_J1939DcmReadDiagnosticReadiness1 </p>
<p>0x9C </p>
<p>Dem_J1939DcmReadDiagnosticReadiness2 </p>
<p>0x9D </p>
<p>Dem_J1939DcmReadDiagnosticReadiness3 </p>
<p>0x9E </p>
<p>Dem_GetOperationCycleState </p>
<p>0x9F </p>
<p>Dem_GetDebouncingOfEvent() </p>
<p>0xA2 </p>
<p>Dem_SetDTR </p>
<p>0xA3 </p>
<p>Dem_DcmGetAvailableOBDMIDs </p>
<p>0xA4 </p>
<p>Dem_DcmGetNumTIDsOfOBDMID </p>
<p>0xA5 </p>
<p>Dem_DcmGetDTRData </p>
<p>0xAA </p>
<p>Dem_SetPfcCycleQualified </p>
<p>0xAE </p>
<p>Dem_SetIUMPRDenCondition </p>
<p>0xB2 </p>
<p>Dem_DcmGetDTCSeverityAvailabilityMask </p>
<p>0xB3 </p>
<p>Dem_ReadDataOfPID01 </p>
<p>0xB4 </p>
<p>Dem_GetB1Counter </p>
<p>0xB5 </p>
<p>Dem_GetMonitorStatus() </p>
<p>0xB7 </p>
<p>Dem_SelectDTC() </p>
<p>0xB8 </p>
<p>Dem_GetDTCSelectionResult() </p>
<p>0xB9 </p>
<p>Dem_SelectFreezeFrameData() </p>
<p>0xBA </p>
<p>Dem_SelectExtendedDataRecord() </p>
<p>Table 3-9  </p>
<p>Service IDs </p>
<p>Table 3-10 presents the service IDs of APIs not defined by AUTOSAR, the related services </p>
<p>and corresponding errors: </p>
<p><b>Service ID </b></p>
<p><b>Service </b></p>
<p>0xD0 </p>
<p>Dem_InitMemory() </p>
<p>0xD1 </p>
<p>Dem_PostRunRequested() </p>
<p>0xD2 </p>
<p>Dem_GetEventEnableCondition() </p>
<p>0xD3 </p>
<p>Dem_GetWIRStatus() </p>
<p>0xD4 </p>
<p>Dem_EnablePermanentStorage() </p>
<p>0xD5 </p>
<p>Dem_GetIUMPRGeneralData() </p>
<p>0xD7 </p>
<p>Dem_GetNextIUMPRRatioDataAndDTC() </p>
<p>0xD8 </p>
<p>Dem_GetCurrentIUMPRRatioDataAndDTC() </p>
<p>0xD9 </p>
<p>Dem_GetPermanentStorageState() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>62 </p>
<p>based on template version 5.0.0 </p>
<p><b>Service ID </b></p>
<p><b>Service </b></p>
<p>0xDA </p>
<p>Dem_IUMPRLockNumerators() </p>
<p>0xDB </p>
<p>Dem_RequestNvSynchronization() </p>
<p>0xDC </p>
<p>Dem_GetEventAvailable() </p>
<p>0xDD </p>
<p>Dem_SetIUMPRFilter() </p>
<p>0xDE </p>
<p>Dem_GetNumberOfFilteredIUMPR() </p>
<p>0xDF </p>
<p>Dem_UpdateAvailableOBDMIDs() </p>
<p>0xF1 </p>
<p>Dem_NvM_InitAdminData() </p>
<p>Dem_NvM_InitStatusData() </p>
<p>Dem_NvM_InitDebounceData() </p>
<p>Dem_NvM_InitEventAvailableData() </p>
<p>Dem_NvM_InitObdFreezeFrameData() </p>
<p>Dem_NvM_InitObdIumprData() </p>
<p>Dem_NvM_InitDtrData() </p>
<p>0xF2 </p>
<p>Dem_NvM_JobFinished() </p>
<p>0xF3 </p>
<p>Dem_SetHideOBDOccurrences() </p>
<p>0xF4 </p>
<p>Dem_GetHideOBDOccurrences() </p>
<p>0xF5 </p>
<p>Dem_SatellitePreInit() </p>
<p>0xF6 </p>
<p>Dem_SatelliteInit() </p>
<p>0xF7 </p>
<p>Dem_SatelliteMainFunction() </p>
<p>0xF8 </p>
<p>Dem_GetEventIdOfDTC() </p>
<p>0xF9 </p>
<p>Dem_GetDTCSuppression() </p>
<p>0xFF </p>
<p>Internal functions without dedicated API Id </p>
<p>Table 3-10  </p>
<p>Additional Service IDs   </p>
<p>The errors reported to Det are described in the following table: </p>
<p><b>Error Code </b></p>
<p><b>Description </b></p>
<p>0x10 </p>
<p>DEM_E_PARAM_CONFIG </p>
<p>Service was called with a parameter value which is </p>
<p>not allowed in this configuration</p>
<p> </p>
<p>0x11 </p>
<p>DEM_E_PARAM_POINTER </p>
<p>Service was called with a NULL pointer argument </p>
<p>0x12 </p>
<p>DEM_E_PARAM_DATA </p>
<p>Service was called with an invalid parameter value </p>
<p>0x13 </p>
<p>DEM_E_PARAM_LENGTH </p>
<p>Service was called with an invalid length or size </p>
<p>parameter </p>
<p>0x20 </p>
<p>DEM_E_UNINIT </p>
<p>Service was called before the Dem module has been </p>
<p>initialized </p>
<p>0x30 </p>
<p>DEM_E_NODATAAVAILABLE </p>
<p>Data collection failed (application error) </p>
<p>0x40 </p>
<p>DEM_E_WRONG_CONDITION </p>
<p>Service was called with unsatisfied precondition </p>
<p>0xF0 </p>
<p>DEM_E_INCONSISTENT_STATE </p>
<p>Dem is in an inconsistent internal state </p>
<p>Table 3-11  </p>
<p>Errors reported to Det </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>63 </p>
<p>based on template version 5.0.0 </p>
<p><b>3.19.1.1 </b></p>
<p><b>Parameter Checking </b></p>
<p>AUTOSAR requires that API functions check the validity of their parameters. These checks </p>
<p>are for development error reporting and are en-/disabled together with development error </p>
<p>reporting. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>If the Dem is used in Pre-Compile variant, Dem_MasterPreInit() does not verify the </p>
<p>initialization pointer. This pointer is unused anyways, so we deviate from [1] in order to </p>
<p>be more in line with most other Autosar modules. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>3.19.1.2 </b></p>
<p><b>SilentBSW run-time checks </b></p>
<p>The Dem module provides several run-time checks to prevent memory corruption caused </p>
<p>by inconsistent NV data. These checks are active only when enabled by configuration. </p>
<p>Most of the Dem state is preserved in NV memory, so inconsistencies introduced into the </p>
<p>NV state would accumulate. The result would be misbehavior at a much later time, e.g. </p>
<p>multiple power cycles after the actual error occurred. To prevent this, the Dem will enter an </p>
<p>error state once a run-time check fails. In this error state, most API functions will return an </p>
<p>error code and return immediately without effect. </p>
<p>To  check  for  the  operational  state  of  the  Dem  module,  you  have  access  to  the  global </p>
<p>variable </p>
<p>Dem_LineOfRuntimeError</p>
<p>. It will be set to 0 during normal operation. If a run-</p>
<p>time check fails, the variable will be set to the code line on which the error had occurred. In </p>
<p>addition, a DET error is reported, assuming DET reporting is enabled by configuration. </p>
<p>The only way to recover from the Dem error state is an ECU reset. </p>
<p><b>3.19.2 </b></p>
<p><b>Production Code Error Reporting </b></p>
<p>The Dem does not report any production code related errors. </p>
<p>Production  code  errors  in  general  are  errors  which  shall  be  saved  through  the  Dem  by </p>
<p>definition. Errors of Dem itself occurring during normal operation are not saved as DTC. </p>
<p><b>3.20 </b></p>
<p><b>J1939 </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>Dependent on the licensed components of your delivery the feature J1939 may not be </p>
<p>available in DEM.  </p>
<p><b> </b></p>
<p><b> </b></p>
<p>In </p>
<p>general </p>
<p>the </p>
<p>SAE </p>
<p>J1939 </p>
<p>communication </p>
<p>protocol </p>
<p>was </p>
<p>developed </p>
<p>for </p>
<p>heavy-duty </p>
<p>environments but is also applicable for communication networks in light- and medium-duty </p>
<p>on-road and off-road vehicles.  </p>
<p>J1939 does not describe how the fault memory shall behave but how to report the faults </p>
<p>and their related data. </p>
<p>With  the  interface  described  in  chapter  6.2.9  the  following  diagnostic  messages  can  be </p>
<p>supported: </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>64 </p>
<p>based on template version 5.0.0 </p>
<p><b>Diagnostic Message </b></p>
<p>DM1 – Active Diagnostic Trouble Codes </p>
<p>DM2 – Previously Active Diagnostic Trouble Codes </p>
<p>DM3 – Diagnostic Data Clear/Reset Of Previously Active DTCs </p>
<p>DM4 – Freeze Frame Parameters </p>
<p>DM5 – Diagnostic Readiness 1 </p>
<p>DM11 – Diagnostic Data Clear/Reset of Active DTCs </p>
<p>DM25 – Expanded Freeze Frame </p>
<p>DM27 – All Pending DTCs </p>
<p>DM31 – DTC To Lamp Association </p>
<p>DM35 – Immediate Fault Status </p>
<p>DM53 – Active Service Only DTCs </p>
<p>DM54 – Previously Active Service Only DTCs </p>
<p>DM55 – Diagnostic Data Clear/Reset for All Service Only DTCs </p>
<p>Table 3-12  </p>
<p>Diagnostic messages where content is provided by Dem </p>
<p><b>3.20.1 </b></p>
<p><b>J1939 Freeze Frame and J1939 Expanded Freeze Frame </b></p>
<p>With  J1939  enabled,  the  Dem  supports  two  globally  defined  J1939  specific  freezes  in </p>
<p>addition to the environmental data described in chapter 3.11. Each DTC can be configured </p>
<p>individually to support freeze frame and/or expanded freeze frame, or none. </p>
<p>The  J1939  (expanded)  freeze  frame  data  is  stored  when  the  DTC  becomes  active </p>
<p>(ConfirmedDTC </p>
<p></p>
<p> 1) and is not updated if the DTC reoccurs. </p>
<p>These freeze frames are stored in addition to any configured ‘standard’ freeze frames but </p>
<p>they are not mapped into a UDS snapshot record. </p>
<p><b>3.20.2 </b></p>
<p><b>Indicators </b></p>
<p>In addition to the ‘normal’ indicators (refer to 3.17) a J1939 related DTC may support up to </p>
<p>one of the J1939 specific indicators listed below. </p>
<p><b>&gt; </b></p>
<p>Red Stop Lamp (RSL) </p>
<p><b>&gt; </b></p>
<p>Amber Warning Lamp (AWL) </p>
<p><b>&gt; </b></p>
<p>Protect Lamp (PL) </p>
<p>These indicators use different behavior settings, as required for J1939. These settings are </p>
<p>valid for the indicators mentioned above:  </p>
<p><b>&gt; </b></p>
<p>Continuous </p>
<p><b>&gt; </b></p>
<p>Fast Flash </p>
<p><b>&gt; </b></p>
<p>Slow Flash </p>
<p>Differently  from  the  ‘normal’  AUTOSAR  indicators,  Dem_GetIndicatorStatus()  returns  a </p>
<p>prioritized result if multiple events request the same indicator with different behavior. E.g. </p>
<p>the  PL  is  triggered  at  the  same  time  as  “Continuous”  and  “Fast  Flash”,  the  behavior  is </p>
<p>indicated as “Continuous”. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>65 </p>
<p>based on template version 5.0.0 </p>
<p>DTC  and  event  suppression  (refer  to  chapter  3.10.2)  with  DTC  format  set  to  J1939  the </p>
<p>configured </p>
<p>indicator </p>
<p>is </p>
<p>not </p>
<p>applied </p>
<p>to </p>
<p>the </p>
<p>ECU </p>
<p>indicator </p>
<p>state. </p>
<p>I.e. </p>
<p>the </p>
<p>API </p>
<p>Dem_GetIndicatorStatus()  will  return  the  same  result  whether  DTCs  are  suppressed  or </p>
<p>not. To match this behavior, the network management node ID related indicator status also </p>
<p>reports the indicator state of suppressed DTCs. </p>
<p><b>3.20.3 </b></p>
<p><b>Clear DTC </b></p>
<p>In contrast to the clear process defined by UDS which provides the DTC itself or the group </p>
<p>of DTCs that shall be cleared, the J1939 Clear DTC command provides the DTC status </p>
<p>that must match the available J1939 DTCs to be cleared.  </p>
<p>DTCs with the following DTC status can be cleared: </p>
<p><b>DTC Status </b></p>
<p> </p>
<p>Active </p>
<p>TestFailed (Bit0) == 1  </p>
<p>AND  </p>
<p>ConfirmedDTC (Bit3) == 1 </p>
<p>Previously Active </p>
<p>TestFailed (Bit0) == 0  </p>
<p>AND  </p>
<p>ConfirmedDTC (Bit3) == 1 </p>
<p>Table 3-13  </p>
<p>J1939 DTC Status to be cleared </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Events without a DTC number cannot be cleared using the J1939 API as they do not </p>
<p>support the ConfirmedDTC status. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.20.4 </b></p>
<p><b>Service Only DTCs </b></p>
<p>Service  Only  diagnostic  trouble  codes  are  DTCs  that  do  not  use  an  indicator  and  are </p>
<p>stored in secondary memory. These DTCs are accessed by DMs 53-55.   </p>
<p><b>3.21 </b></p>
<p><b>Clear DTC APIs </b></p>
<p>The clear DTC operations are implemented in full accordance with [1].  </p>
<p>Please be aware that the &lt;xxx&gt;ClearDTC interfaces start an asynchronous clear process. </p>
<p>While  one  clear  operation  is  in  progress,  clear  requests  from  different  clients  receive  a </p>
<p>DEM_CLEAR_BUSY response (see chapters 6.2.6.28 and 6.2.9.1 for details). </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The Dem will allow a clear request for a different client as soon as the previous clear </p>
<p>operation is finished, but before the final result of the previous clear operation is </p>
<p>retrieved (Figure 3-7). </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>66 </p>
<p>based on template version 5.0.0 </p>
<p> </p>
<p>Figure 3-7 </p>
<p>Concurrent Clear Requests </p>
<p><b> sd Clear DTC</b></p>
<p><b>Client 1</b></p>
<p><b>Client 2</b></p>
<p><b>Dem</b></p>
<p><b>Clear</b></p>
<p><b>Operation</b></p>
<p><b>Clear</b></p>
<p><b>Operation</b></p>
<p>clear request is rejected as </p>
<p>clear operation for client 2 is </p>
<p>in progress</p>
<p>clear request is allowed as </p>
<p>clear operation for client 2 is </p>
<p>finished --&gt; clear operation for </p>
<p>client 1 is started</p>
<p>Polling call for first clear </p>
<p>request: final result for </p>
<p>clear operation is retrieved</p>
<p>clear request is rejected as </p>
<p>clear operation for client 1 </p>
<p>is in progress</p>
<p>Polling call for the first </p>
<p>clear request: clear </p>
<p>operation is in progress</p>
<p>Polling call for second clear </p>
<p>request: final result for clear </p>
<p>operation is retrieved</p>
<p>clear operation for client 2 </p>
<p>is started</p>
<p>ClearDTC()</p>
<p>start()</p>
<p>:DEM_PENDING</p>
<p>ClearDTC()</p>
<p>:DEM_PENDING</p>
<p>ClearDTC()</p>
<p>:DEM_CLEAR_BUSY</p>
<p>fi ni sh()</p>
<p>ClearDTC()</p>
<p>start()</p>
<p>:DEM_PENDING</p>
<p>ClearDTC()</p>
<p>:E_OK</p>
<p>ClearDTC()</p>
<p>:DEM_CLEAR_BUSY</p>
<p>fi ni sh()</p>
<p>ClearDTC()</p>
<p>:E_OK</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>67 </p>
<p>based on template version 5.0.0 </p>
<p><b>4 </b></p>
<p><b>Integration </b></p>
<p>This chapter gives necessary information for the integration of the MICROSAR  Dem into </p>
<p>an application environment of an ECU. </p>
<p><b>4.1 </b></p>
<p><b>Scope of Delivery </b></p>
<p>The delivery of the Dem contains the files which are described in the chapters 4.1.1 and </p>
<p>4.1.2: </p>
<p><b>4.1.1 </b></p>
<p><b>Static Files </b></p>
<p><b>File Name </b></p>
<p><b>Source </b></p>
<p><b>Code </b></p>
<p><b>Delivery </b></p>
<p><b>Object </b></p>
<p><b>Code </b></p>
<p><b>Delivery </b></p>
<p><b>Description </b></p>
<p>Dem.c </p>
<p></p>
<p> </p>
<p> </p>
<p>This is the source file of the Dem. It </p>
<p>contains the main functionality of the </p>
<p>Dem. </p>
<p>Dem.h </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p>This header file provides the Dem API </p>
<p>functions for BSW modules and the </p>
<p>application. This file is supposed to be </p>
<p>included by client modules but not by </p>
<p>Dcm. </p>
<p>Dem_Dcm.h </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p>This header file provides the Dem API </p>
<p>functions for the Dcm. This file is </p>
<p>supposed to be included by Dcm. </p>
<p>Dem_J1939Dcm.h </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p>This header file provides the Dem API </p>
<p>functions for the J1939Dcm. This file is </p>
<p>supposed to be included by J1939Dcm. </p>
<p>Dem_Types.h </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p>This header file contains all Dem data </p>
<p>types. Do not include this file directly, but </p>
<p>include Dem.h instead. </p>
<p>Dem_Cbk.h </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p>This header file contains callback </p>
<p>functions intended for the NvM module. </p>
<p>Include this in the NvM configuration for </p>
<p>the declarations of the initialization and </p>
<p>notification functions. </p>
<p>Dem_Validation.h </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p>This header file contains static </p>
<p>configuration checks. Inconsistent </p>
<p>configuration settings will trigger #error </p>
<p>directives within this file. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>68 </p>
<p>based on template version 5.0.0 </p>
<p><b>File Name </b></p>
<p><b>Source </b></p>
<p><b>Code </b></p>
<p><b>Delivery </b></p>
<p><b>Object </b></p>
<p><b>Code </b></p>
<p><b>Delivery </b></p>
<p><b>Description </b></p>
<p>Dem_Cdd_Types.h </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p>This header file contains all types that are </p>
<p>supposed to be generated by the Rte. </p>
<p>In case no Rte is used, this file is included </p>
<p>instead of Rte_Dem_Type.h. Otherwise, </p>
<p>this file is not used at all. </p>
<p>Dem_Cfg_Types.h </p>
<p>Dem_Cfg_Macros.h </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p>Internal header file, do not include directly </p>
<p>Dem_Cfg_Declarations.h </p>
<p>Dem_Cfg_Definitions.h  </p>
<p>Dem_MemCopy.h </p>
<p>Dem_Int.h </p>
<p>Dem_&lt;*&gt;_Fwd.h </p>
<p>Dem_&lt;*&gt;_Types.h </p>
<p>Dem_&lt;*&gt;_Interface.h </p>
<p>Dem_&lt;*&gt;_Implementation.h </p>
<p></p>
<p> </p>
<p> </p>
<p>Internal header file, do not include directly </p>
<p>_Dem_MemMap.h </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p>Template header for memory mapping, </p>
<p>see chapter 4.3.2 </p>
<p>Dem_bswmd.arxml </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p>This file contains the definition of all Dem </p>
<p>configuration parameters. </p>
<p>Table 4-1  </p>
<p>Static files </p>
<p><b>4.1.2 </b></p>
<p><b>Dynamic Files </b></p>
<p>The dynamic files are generated by the configuration tool Cfg5. </p>
<p><b>File Name </b></p>
<p><b>Description </b></p>
<p>Dem_Cfg.h </p>
<p>This header file contains the configuration switches of the Dem. </p>
<p>Dem_Lcfg.c </p>
<p>This source file contains configuration values and tables of the </p>
<p>Dem. </p>
<p>Dem_Lcfg.h </p>
<p>This header file provides access functions to the Dem for the </p>
<p>configuration values and tables. </p>
<p>Dem_PBcfg.c </p>
<p>This source file contains post-buildable configuration </p>
<p>values/tables of the Dem.  </p>
<p>For easier handling, this file is created in pre-compile </p>
<p>configurations as well. If your build environment produces error </p>
<p>messages due to this file not defining any symbols, feel free to </p>
<p>exclude it from the build. </p>
<p>Dem_PBcfg.h </p>
<p>This header file provides access functions to the Dem for the </p>
<p>post-buildable configuration values and tables. </p>
<p>Dem_AdditionalIncludeCfg.h </p>
<p>This header file provides additional include files specified by the </p>
<p>user with the configuration parameter </p>
<p>DemGeneral/DemHeaderFileInclusion </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>69 </p>
<p>based on template version 5.0.0 </p>
<p><b>File Name </b></p>
<p><b>Description </b></p>
<p>Dem_Swc.h </p>
<p>Internal header file, do not include directly. </p>
<p>RTE generated callback prototypes or DEM internal substitution </p>
<p>Dem_Swc_Types.h </p>
<p>Internal header file, do not include directly. </p>
<p>RTE generated Dem types or DEM internal substitution. </p>
<p>Dem_swc.arxml </p>
<p>This AUTOSAR xml file is used for the configuration of the Rte. It </p>
<p>contains the information to get prototypes of callback functions </p>
<p>offered by other components. </p>
<p>Table 4-2  </p>
<p>Generated files </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>70 </p>
<p>based on template version 5.0.0 </p>
<p><b>4.2 </b></p>
<p><b>Include Structure </b></p>
<p> </p>
<p>Figure 4-1 </p>
<p>Include structure </p>
<p><b>4.3 </b></p>
<p><b>Compiler Abstraction and Memory Mapping  </b></p>
<p>The  objects  (e.g.  variables,  functions,  constants)  are  declared  by  compiler  independent </p>
<p>definitions  –  the  compiler  abstraction  definitions.  Each  compiler  abstraction  definition  is </p>
<p>assigned to a memory section. </p>
<p><b> </b></p>
<p><b>class IncludeStructure</b></p>
<p>Dem.c</p>
<p>Dem.h</p>
<p>Dem_Cfg.h</p>
<p>Dem_Lcfg.c</p>
<p>Dem_Cbk.h</p>
<p>Dem_Types.h</p>
<p>SchM_Dem.h</p>
<p>Dem_Lcfg.h</p>
<p>FiM.h</p>
<p>Dcm.h</p>
<p>NvM.h</p>
<p>Std_Types.h</p>
<p>MemMap.h</p>
<p>Rte_DemMaster_NN.h</p>
<p>Rte_DemMaster_NN_Type.h</p>
<p>Det.h</p>
<p>Dem_AdditionalIncludeCfg.h</p>
<p>Dem_Cdd_Types.h</p>
<p>Dem_PBcfg.c</p>
<p>Dem_PBcfg.h</p>
<p>Dem_Dcm.h</p>
<p>Dem_J1939Dcm.h</p>
<p>vstdlib.h</p>
<p>EcuM_Error.h</p>
<p>Dem_Validation.h</p>
<p>Dlt.h</p>
<p>J1939Dcm.h</p>
<p>J1939Nm.h</p>
<p>Dem_Int.h</p>
<p>Dem_Swc.h</p>
<p>Dem_Swc_Types.h</p>
<p>Dem_Cfg_Types.h</p>
<p>Dem_Cfg_Macros.h</p>
<p>Os.h</p>
<p>Dem_&lt;Internal_Header_Files&gt;.h</p>
<p>Dem_MemMap.h</p>
<p>(template)</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>[useRTE]</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>[useRTE]</p>
<p>«include»</p>
<p>[useRTE]</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>[noRTE]</p>
<p>«include»</p>
<p>«include»</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>71 </p>
<p>based on template version 5.0.0 </p>
<p>The  following  table  contains  the  memory  section  names  and  the  compiler  abstraction </p>
<p>definitions of the Dem and illustrates their assignment among each other. </p>
<p><b>Compiler Abstraction </b></p>
<p><b>Definitions </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Memory Mapping </b></p>
<p><b>Sections </b></p>
<p>DEM_CODE</p>
<p> </p>
<p> </p>
<p>DEM_CONST </p>
<p> </p>
<p>DEM_CAL_PRM</p>
<p> </p>
<p> </p>
<p>DEM_APPL_CONST </p>
<p> </p>
<p> </p>
<p>DEM_PBCFG </p>
<p>DEM_START_SEC_CODE </p>
<p>DEM_STOP_SEC_CODE </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>DEM_START_SEC_CONST_&lt;size&gt; </p>
<p>DEM_STOP_SEC_CONST_&lt;size&gt; </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>DEM_START_SEC_CALIB_&lt;size&gt; </p>
<p>DEM_STOP_SEC_CALIB_&lt;size&gt;</p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p>DEM_START_SEC_PBCFG </p>
<p>DEM_STOP_SEC_PBCFG </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p>DEM_START_SEC_PBCFG_ROOT </p>
<p>DEM_STOP_SEC_PBCFG_ROOT </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p>Table 4-3  </p>
<p>Compiler abstraction and memory mapping, constant sections </p>
<p> </p>
<p><b>Compiler Abstraction </b></p>
<p><b>Definitions </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Memory Mapping </b></p>
<p><b>Sections </b></p>
<p>DEM_VAR_INIT </p>
<p> </p>
<p>DEM_VAR_NOINIT </p>
<p> </p>
<p>DEM_VAR_UNCACHED </p>
<p>DEM_DCM_DATA </p>
<p> </p>
<p>DEM_NVM_DATA </p>
<p> </p>
<p>DEM_DLT_DATA</p>
<p> </p>
<p> </p>
<p>DEM_APPL_DATA </p>
<p> </p>
<p>DEM_SHARED_DATA </p>
<p>DEM_START_SEC_VAR_NO_INIT_&lt;size&gt; </p>
<p>DEM_STOP_SEC_VAR_NO_INIT_&lt;size&gt; </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p>DEM_START_SEC_VAR_INIT_&lt;size&gt; </p>
<p>DEM_STOP_SEC_VAR_INIT_&lt;size&gt; </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>72 </p>
<p>based on template version 5.0.0 </p>
<p>DEM_START_SEC_VAR_SAVED_ZONE0_&lt;size&gt; </p>
<p>DEM_STOP_SEC_VAR_SAVED_ZONE0_&lt;size&gt; </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p>DEM_START_SEC_&lt;OS_APPLICATION_NAME&gt;_VAR_NO</p>
<p>INIT_UNSPECIFIED </p>
<p>DEM_STOP_SEC_&lt;OS_APPLICATION_NAME&gt;_VAR_NOI</p>
<p>NIT_UNSPECIFIED </p>
<p>DEM_START_SEC_0_VAR_NOINIT_UNSPECIFIED </p>
<p>DEM_STOP_SEC_0_VAR_NOINIT_UNSPECIFIED </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>DCM diagnostic buffer (section depends on DCM </p>
<p>implementation) </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p>Application or RTE buffer used in port communication </p>
<p>(section depends on configuration and port mapping) </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p>Table 4-4  </p>
<p>Compiler abstraction and memory mapping, variable sections </p>
<p><b>4.3.1 </b></p>
<p><b>Copy Routines </b></p>
<p>By  default,  the  Dem  implementation  uses  the  copy  routines  provided  by  the  Vector </p>
<p>standard  library  (VStdLib).  Its  copy  routines  are  aware  of  the Autosar  Memory  Mapping </p>
<p>feature, and will work independently from the chosen mapping. </p>
<p>If the Dem module is not integrated into a MICROSAR 4 environment, the VstdLib module </p>
<p>might not be available, or not be enabled to support Autosar Memory Mapping. </p>
<p>In  this  case,  you  can  disable  the  use  of  VstdLib  (Configuration  option  DemGeneral/ </p>
<p>DemUseMemcopyMacros). The Dem provides a simple copy routine based on a for-loop, </p>
<p>which is used as default replacement for the VstdLib implementation. </p>
<p>If necessary, you can also replace this default implementation. To do so, simply provide a </p>
<p>specialized definition of the following macros, e.g. globally, or in a user-config file: </p>
<p>Dem_MemCpy_Macro(destination_ptr, source_ptr, length_in_byte) </p>
<p>Dem_MemSet_Macro(destination_ptr, value_byte, length_in_byte) </p>
<p><b>4.3.2 </b></p>
<p><b>Memory Map with multiple partitions </b></p>
<p>With  only  a  single  partition,  the  Dem  implementation  can  work  with  the  default  memory </p>
<p>map  defined  in  file  ‘</p>
<p>_Dem_MemMap.h</p>
<p>’.  To  use  this  file,  you  need  to  first  rename  it  to </p>
<p>‘</p>
<p>Dem_MemMap.h</p>
<p>’ </p>
<p>With </p>
<p>each </p>
<p>configured </p>
<p>DemSatellite </p>
<p>instance </p>
<p>(see </p>
<p>configuration </p>
<p>containers </p>
<p>/Os/Os-</p>
<p>Application </p>
<p>that </p>
<p>are </p>
<p>referenced </p>
<p>from</p>
<p>  DemGeneral/DemOsApplicationRef, </p>
<p>DemGeneral/DemMasterOsApplicationRef </p>
<p>and</p>
<p> </p>
<p>DemEventParameter/Dem-</p>
<p>EventOsApplicationRef</p>
<p>),  you  need  to  extend  the  memory  map  of  the  Dem  with  a </p>
<p>preprocessor directive corresponding to the name of the related OsApplication. At the end </p>
<p>of file ‘</p>
<p>_Dem_MemMap.h</p>
<p>’ you will find a commented section mapping – you can copy this </p>
<p>template  into  your  ‘</p>
<p>Dem_MemMap.h</p>
<p>’  file,  un-comment  it,  and  adapt  it  to  match  each </p>
<p>OsApplication instance. </p>
<p><b>4.4 </b></p>
<p><b>Synchronization </b></p>
<p>The Dem uses two mechanisms to maintain data consistency. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>73 </p>
<p>based on template version 5.0.0 </p>
<p>Where </p>
<p>possible, </p>
<p>the </p>
<p>Dem </p>
<p>uses </p>
<p>a </p>
<p>synchronization </p>
<p>method </p>
<p>based </p>
<p>on </p>
<p>atomic </p>
<p>compare/exchange. Otherwise, the Dem relies on a critical section mechanism. </p>
<p><b>4.4.1 </b></p>
<p><b>Atomic Compare/Exchange </b></p>
<p>Most  hardware  platforms  supply  instructions  for  efficient  synchronization  –  test-and-set, </p>
<p>compare-exchange or similar features. </p>
<p>During integration, a suitable method for synchronization can be provided, e.g. based on a </p>
<p>compiler  intrinsic,  or  by  a  short  inline  function  implementing  the  compare-exchange </p>
<p>behavior  using  the  mechanism  provided  by  the  hardware  platform  and  compiler  (see </p>
<p>chapter 6.5.1.14). </p>
<p>As  a  fallback,  the  Dem  supplements  a  default  implementation  using  a  critical  section. </p>
<p>While using this default implementation will achieve data consistency, it requires a critical </p>
<p>section that guarantees atomicity across all processor cores. In multi-core environments, </p>
<p>usage of this default implementation is discouraged due to the incurred overhead. </p>
<p><b>4.4.2 </b></p>
<p><b>Critical Sections </b></p>
<p>The Dem uses the Critical Section implementation of the SchM.  </p>
<p><b>4.4.2.1 </b></p>
<p><b>Exclusive Area 0 </b></p>
<p><b>DiagMonitor </b></p>
<p><b>Purpose: </b></p>
<p>Ensures data consistency between the Diagnostic Monitors and the Dem task. </p>
<p><b>Interfaces: </b></p>
<p><b>&gt; </b></p>
<p>SchM_Enter_Dem_DEM_EXCLUSIVE_AREA_0<b> </b></p>
<p><b>&gt; </b></p>
<p>SchM_Exit_Dem_DEM_EXCLUSIVE_AREA_0<b> </b></p>
<p> </p>
<p><b>Runtime: </b></p>
<p>Short runtime; The runtime will increase if J1939 nodes are used.  </p>
<p> </p>
<p><b>Dependency: </b></p>
<p><b>&gt; </b></p>
<p>Dem_MainFunction()<b> </b></p>
<p><b>&gt; </b></p>
<p>Dem_ReportErrorStatus() </p>
<p><b>&gt; </b></p>
<p>Dem_SetEventStatus() </p>
<p><b>&gt; </b></p>
<p>Dem_GetIndicatorStatus() </p>
<p><b>&gt; </b></p>
<p>Dem_SetWIRStatus() </p>
<p><b>&gt; </b></p>
<p>Dem_SetEventAvailable() </p>
<p><b>&gt; </b></p>
<p>Dem_SetDTCSuppression() </p>
<p><b>&gt; </b></p>
<p>Dem_RepIUMPRFaultDetect()</p>
<p>1</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Dem_RepIUMPRDenLock()</p>
<p>1</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Dem_RepIUMPRDenRelease()</p>
<p>1</p>
<p> </p>
<p><b>&gt; </b></p>
<p>Dem_SetIUMPRDenCondition()</p>
<p>1</p>
<p> </p>
<p>                                            </p>
<p>1</p>
<p> API may not be part of the delivery as its availability depends on the DEM license. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>74 </p>
<p>based on template version 5.0.0 </p>
<p><b>DiagMonitor </b></p>
<p><b>&gt; </b></p>
<p>Dem_SetDTR() </p>
<p><b>&gt; </b></p>
<p>Dem_DcmGetDTRData() </p>
<p> </p>
<p><b>Recommendation: </b></p>
<p>This critical section may be called from any BSW and CDD, and even before the system is fully </p>
<p>initialized. </p>
<p>Table 4-5  </p>
<p>Exclusive Area 0 </p>
<p><b>4.4.2.2 </b></p>
<p><b>Exclusive Area 1 </b></p>
<p><b>StateManager </b></p>
<p><b>Purpose: </b></p>
<p>Ensures data consistency in case of preempted execution between application state managers </p>
<p>and Dem task.  </p>
<p><b>Interfaces: </b></p>
<p><b>&gt; </b></p>
<p>SchM_Enter_Dem_DEM_EXCLUSIVE_AREA_1<b> </b></p>
<p><b>&gt; </b></p>
<p>SchM_Exit_Dem_DEM_EXCLUSIVE_AREA_1<b> </b></p>
<p> </p>
<p><b>Runtime: </b></p>
<p>short runtime, sparse usage </p>
<p> </p>
<p><b>Dependency: </b></p>
<p><b>&gt; </b></p>
<p>Dem_MainFunction()<b> </b></p>
<p><b>&gt; </b></p>
<p>Dem_SetOperationCycleState() </p>
<p><b>&gt; </b></p>
<p>Dem_SetEnableCondition() </p>
<p><b>&gt; </b></p>
<p>Dem_SetStorageCondition() </p>
<p><b>&gt; </b></p>
<p>Dem_DisableDTCSetting() </p>
<p><b>&gt; </b></p>
<p>Dem_EnableDTCSetting() </p>
<p><b>&gt; </b></p>
<p>Dem_SetPfcCycle()</p>
<p>1</p>
<p> </p>
<p> </p>
<p><b>Recommendation: </b></p>
<p>No recommendation. </p>
<p>Table 4-6  </p>
<p>Exclusive Area 1 </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>75 </p>
<p>based on template version 5.0.0 </p>
<p><b>4.4.2.3 </b></p>
<p><b>Exclusive Area 2 </b></p>
<p><b>DcmApi </b></p>
<p><b>Purpose: </b></p>
<p>Protects global state data and values used to track Dcm related tasks from concurrent </p>
<p>modification. </p>
<p> </p>
<p><b>Interfaces: </b></p>
<p><b>&gt; </b></p>
<p>SchM_Enter_Dem_DEM_EXCLUSIVE_AREA_2<b> </b></p>
<p><b>&gt; </b></p>
<p>SchM_Exit_Dem_DEM_EXCLUSIVE_AREA_2<b> </b></p>
<p> </p>
<p><b>Runtime: </b></p>
<p>short runtime, sparse usage </p>
<p> </p>
<p><b>Dependency: </b></p>
<p><b>&gt; </b></p>
<p>Dem_MainFunction()<b> </b></p>
<p><b>&gt; </b></p>
<p>Dem_EnablePermanentStorage()</p>
<p>1</p>
<p> </p>
<p><b>Recommendation: </b></p>
<p>No recommendation.  </p>
<p>Table 4-7  </p>
<p>Exclusive Area 2 </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>76 </p>
<p>based on template version 5.0.0 </p>
<p><b>4.4.2.4 </b></p>
<p><b>Exclusive Area 3 </b></p>
<p><b>CrossCoreComm </b></p>
<p><b>Purpose: </b></p>
<p>Protects global state data from concurrent modification. </p>
<p><b>Interfaces: </b></p>
<p><b>&gt; </b></p>
<p>SchM_Enter_Dem_DEM_EXCLUSIVE_AREA_3 </p>
<p><b>&gt; </b></p>
<p>SchM_Exit_Dem_DEM_EXCLUSIVE_AREA_3 </p>
<p> </p>
<p><b>Runtime: </b></p>
<p>short runtime, very frequent usage </p>
<p> </p>
<p><b>Dependency: </b></p>
<p><b>&gt; </b></p>
<p>Dem_SatelliteInit() (*) </p>
<p><b>&gt; </b></p>
<p>Dem_MasterMainFunction() </p>
<p><b>&gt; </b></p>
<p>Dem_SatelliteMainFunction() (*) </p>
<p><b>&gt; </b></p>
<p>Dem_ReportErrorStatus() (*) </p>
<p><b>&gt; </b></p>
<p>Dem_SetEventStatus() (*) </p>
<p><b>&gt; </b></p>
<p>Dem_ResetEventStatus() (*) </p>
<p><b>&gt; </b></p>
<p>Dem_ResetEventDebounceStatus() (*) </p>
<p><b>&gt; </b></p>
<p>Dem_SetEventAvailable() (*) </p>
<p><b>&gt; </b></p>
<p>Dem_SetDTR()</p>
<p>1</p>
<p> (*) </p>
<p><b>&gt; </b></p>
<p>Dem_PrestoreFreezeFrame() </p>
<p><b>&gt; </b></p>
<p>Dem_ClearPrestoredFreezeFrame() </p>
<p><b>Recommendation: </b></p>
<p>This critical section must synchronize across multiple processor cores, so it must be mapped to </p>
<p>an adequate mechanism. </p>
<p>Additionally, provide a platform specific CompareAndSwap (see chapter 4.4.1). </p>
<p> </p>
<p>(*) </p>
<p>The critical section is only used if the default CompareAndSwap algorithm is NOT </p>
<p>substituted with a platform specific implementation. </p>
<p> </p>
<p><b>4.5 </b></p>
<p><b>NvM Integration </b></p>
<p>In  general,  the  Dem  module  is  designed  to  work  with  an Autosar  NvM  to  provide  non-</p>
<p>volatile data storage. </p>
<p>It  is  expected  that  all  NV  blocks  used  by  the  Dem  are  configured  with  the  parameters </p>
<p>detailed in the following chapters: </p>
<p><b>&gt; </b></p>
<p>RAM buffer </p>
<p><b>&gt; </b></p>
<p>Initialization method: ROM element or initialization function </p>
<p><b>&gt; </b></p>
<p>Single block job end notification </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>77 </p>
<p>based on template version 5.0.0 </p>
<p><b>&gt; </b></p>
<p>Enabled for both WriteAll and ReadAll </p>
<p>When using a non-Autosar NV manager, please also refer to the Autosar SWS of the NvM </p>
<p>module for more details on the expected behavior. </p>
<p><b>4.5.1 </b></p>
<p><b>NVRAM Demand </b></p>
<p>All non-volatile data blocks used by the Dem must be configured to match the size of the </p>
<p>underlying </p>
<p>type. </p>
<p>Since </p>
<p>the </p>
<p>actual </p>
<p>size </p>
<p>depends </p>
<p>on </p>
<p>compiler </p>
<p>settings </p>
<p>and </p>
<p>platform </p>
<p>properties, this size cannot be calculated by the configuration tool. </p>
<p>To find the correct data structure sizes, you can use temporary code to perform a ‘sizeof’ </p>
<p>operation on the data types involved, or check your linker map file if it contains this kind of </p>
<p>data. </p>
<p>The MICROSAR NvM implementation supports a feature to verify the correct configuration </p>
<p>of block sizes. It is strongly recommended to enable this feature; it also provides a very </p>
<p>easy way to find out the correct block sizes. </p>
<p>Table 4-8 lists the types used by the different data elements. </p>
<p><b>NvRam  Item </b></p>
<p><b>RAM buffer symbol </b></p>
<p><b>Type </b></p>
<p><b>Comment </b></p>
<p>Admin Data </p>
<p>Dem_Cfg_AdminData </p>
<p>Dem_Cfg_AdminDataType </p>
<p>- </p>
<p>Event Data </p>
<p>Dem_Cfg_StatusData </p>
<p>Dem_Cfg_StatusDataType </p>
<p>- </p>
<p>Debounce Data </p>
<p>Dem_Cfg_DebounceData </p>
<p>Dem_Cfg_DebounceDataType </p>
<p>Only if de-</p>
<p>bounce counter </p>
<p>storage is </p>
<p>enabled </p>
<p>Available Data </p>
<p>Dem_Cfg_EventAvailableData </p>
<p>Dem_Cfg_EventAvailableDataType </p>
<p>Only if </p>
<p>DemAvailabilitySt</p>
<p>orage is enabled </p>
<p>Primary </p>
<p>Memory </p>
<p>Dem_Cfg_PrimaryEntry_0 </p>
<p>… </p>
<p>Dem_Cfg_PrimaryEntry_N </p>
<p>Dem_Cfg_PrimaryEntryType </p>
<p>- </p>
<p>Secondary </p>
<p>Memory </p>
<p>Dem_Cfg_SecondaryEntry_0 </p>
<p>… </p>
<p>Dem_Cfg_SecondaryEntry_N </p>
<p>Dem_Cfg_PrimaryEntryType </p>
<p>Only if secondary </p>
<p>memory is </p>
<p>enabled </p>
<p>Table 4-8  </p>
<p>NvRam blocks </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>Dem_Cfg_PrimaryEntry_0… Dem_Cfg_PrimaryEntry_N depend on the number of </p>
<p>primary entries stored in the ECU. (e.g. 0 … 19 in case of 20 primary entries). The </p>
<p>same applies to the other memory types. </p>
<p><b> </b></p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>78 </p>
<p>based on template version 5.0.0 </p>
<p><b>4.5.2 </b></p>
<p><b>NVRAM Initialization </b></p>
<p>The NvM provides a means to initialize RAM buffers, if the backing storage cannot restore </p>
<p>a preserved copy – e.g. because none has ever been stored yet. </p>
<p>For this, the Dem provides initialization functions and default ROM data. The Init functions </p>
<p>are declared in Dem_Cbk.h, the ROM constants are declared via Dem.h. </p>
<p><b>NvRam Item </b></p>
<p><b>Initialization </b></p>
<p>Admin Data </p>
<p>Call </p>
<p>Dem_NvM_InitAdminData()</p>
<p> </p>
<p>Event Data </p>
<p>Call </p>
<p>Dem_NvM_InitStatusData()</p>
<p> </p>
<p>Debounce Data </p>
<p>Call </p>
<p>Dem_NvM_InitDebounceData()</p>
<p> </p>
<p>Available Data </p>
<p>Call </p>
<p>Dem_NvM_InitEventAvailableData()</p>
<p> </p>
<p>Primary Memory </p>
<p>Copy initialization data from </p>
<p>Dem_Cfg_MemoryEntryInit</p>
<p> </p>
<p>Secondary Memory </p>
<p>Copy initialization data from </p>
<p>Dem_Cfg_MemoryEntryInit</p>
<p> </p>
<p>Table 4-9  </p>
<p>NvRam initialization </p>
<p><b>4.5.2.1 </b></p>
<p><b>Controlled Re-initialization </b></p>
<p>Some  use-cases  require  the  total  reset  of  all  stored  data.  A  simple  way  for  that  is  to </p>
<p>change the Dem configuration id (DemGeneral/DemCompiledConfigId) in the configuration </p>
<p>tool. </p>
<p>This  is  especially  useful  during  development,  when  a  different  software  configuration  is </p>
<p>loaded while the NV contents still remain from an older software version. Please be aware </p>
<p>that changing the Dem configuration is likely to require resetting the NV data. </p>
<p>If  a  different  configuration  id  is  detected  during </p>
<p>Dem_MasterInit()</p>
<p>,  the  Dem  will </p>
<p>completely  reinitialize  all  data. This  can be helpful if  you  do  not want  to  use  the  similar </p>
<p>feature provided by NvM.  </p>
<p>In post-build configurations, the configuration Id will change automatically to ensure the NV </p>
<p>data is cleared if configuration changes invalidate the stored NV data. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Re-initialization is no replacement for ClearDtc. It will not respect any requirements </p>
<p>regarding the clear command. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>4.5.2.2 </b></p>
<p><b>Manual Re-initialization </b></p>
<p>If you need to reset the Dem’s data manually, you can do so by calling all NvM initialization </p>
<p>callbacks (Dem_NvM_Init*, see chapter 6.4) and zeroing the Primary/Secondary memory </p>
<p>blocks (Dem_Cfg_PrimaryEntry_X, Dem_Cfg_SecondaryEntry_X). </p>
<p>Please  be  aware  that  this  will  not  cause  the  NvM  to  actually  persist  the  changes  into </p>
<p>NVRAM. You also need to mark the corresponding NvBlockIds as changed – refer to your </p>
<p>configuration to find out the correct handles. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>79 </p>
<p>based on template version 5.0.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Do not modify the Dem NV data blocks while the Dem is active. This will cause </p>
<p>undefined behavior, including write access to random memory locations. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>4.5.2.3 </b></p>
<p><b>Initialization and ECU Reset </b></p>
<p>The  Dem  module  currently  has  no  direct  control  over  the  order  the  NvM  module  writes </p>
<p>data to the backing storage. In order to persist newly initialized NV data, the Dem depends </p>
<p>on a full shutdown of the ECU. </p>
<p>In general there are three ways to achieve a consistent initialization state: </p>
<p>1. </p>
<p>The NvM supports a compiled config ID and can guarantee that all data is re-</p>
<p>initialized when this Id changes. The caveat with this approach is that the NvM </p>
<p>config ID feature cannot be restricted to the Dem data. </p>
<p>2. </p>
<p>Use the config ID feature or manual initialization of Dem NV data as described </p>
<p>prior in this chapter. Both these options require a full shutdown phase including </p>
<p>NvM_WriteAll to work correctly. These approaches work only when the ECU </p>
<p>design, or the software update process, guarantee a full shutdown. </p>
<p>3. </p>
<p>During the software update process you directly erase the NV data used by the </p>
<p>Dem. How to do this depends on the ECU design. But, when an ECU is expected </p>
<p>to hard reset after a SW update, the best way to achieve consistent initialization </p>
<p>without using the NvM compiled config Id is to clear the NV data in the backing </p>
<p>storage. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Although the Dem takes steps to sanitize the restored NV data, it is expected that the </p>
<p>stored NV data matches the Dem configuration. Failing to clear the NV data on </p>
<p>configuration change can lead to unexpected behavior. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>4.5.2.4 </b></p>
<p><b>Common Errors </b></p>
<p>The Dem software cannot handle all possible inconsistent NV data combinations. In some </p>
<p>situations  the  NV  data  must  be managed  in  parts from  outside  the  Dem  to  ensure  data </p>
<p>consistency. </p>
<p><b></b></p>
<p><b> </b></p>
<p>Initial initialization: </p>
<p>On the very first startup, the Dem will re-initialize the NV data. Unless this data is </p>
<p>actually persisted within the NVRAM, the Dem will keep re-initializing all data on </p>
<p>startup.  </p>
<p><b>You must allow the Dem to initialize its data, which requires at least one normal </b></p>
<p><b>shutdown</b>. </p>
<p><b></b></p>
<p><b> </b></p>
<p>Incomplete recovery: </p>
<p>After changing the Dem configuration, the contents currently stored in the NV memory </p>
<p>are internally inconsistent for the Dem module. This can happen when applying a new </p>
<p>Dem installation on an existing hardware, or when changing the Dem configuration </p>
<p>during development. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>80 </p>
<p>based on template version 5.0.0 </p>
<p>In most cases, the compiled config Id will suffice to re-initialize old content, but in some </p>
<p>cases the NvM will itself re-initialize some of the Dem blocks – but not all. In this case, </p>
<p>the compiled config Id does not work reliably. </p>
<p><b>4.5.3 </b></p>
<p><b>Expected NvM Behavior </b></p>
<p> </p>
<p>Figure 4-2 </p>
<p>NvM behavior </p>
<p>The key assumptions about NvM behavior are depicted in Figure 4-2. </p>
<p><b></b></p>
<p><b> </b></p>
<p>The NvM initialization will start <b>after </b></p>
<p>Dem_MasterPreInit()</p>
<p> was called. </p>
<p><b></b></p>
<p><b> </b></p>
<p>Before </p>
<p>Dem_MasterInit()</p>
<p> is called, <b>all </b>blocks used by Dem are either restored </p>
<p>from non-volatile memory, or re-initialized by calling the respective initialization </p>
<p>function or copying the initialization ROM data. </p>
<p><b></b></p>
<p><b> </b></p>
<p>If a block has been re-initialized, the NvM will not need a separate call to </p>
<p>NvM_SetRamBlockStatus()</p>
<p> to retain the changed data later on. </p>
<p><b></b></p>
<p><b> </b></p>
<p><b>After </b></p>
<p>Dem_Shutdown()</p>
<p> is called, all blocks marked as modified by Dem or due to re-</p>
<p>initialization are retained in non-volatile memory. </p>
<p><b></b></p>
<p><b> </b></p>
<p><b>Before </b></p>
<p>Dem_MasterInit()</p>
<p> is called after a </p>
<p>Dem_Shutdown()</p>
<p>, all data has either </p>
<p>been restored again, or is still valid. </p>
<p><b></b></p>
<p><b> </b></p>
<p>After the Dem has requested an immediate write block, the NvM is expected to notify </p>
<p>the result by means of callback </p>
<p>Dem_NvM_JobFinished()</p>
<p>.  </p>
<p> </p>
<p><b> </b></p>
<p><b>stm NVRAM Handling</b></p>
<p><b>Startup</b></p>
<p><b>Pre-Initialization</b></p>
<p><b>Run State</b></p>
<p><b>Shutdown</b></p>
<p>Immediate NvRam write == ON             Immediate NvRam write == OFF</p>
<p>Startup</p>
<p><b>DEM Pre-Initialization</b></p>
<p><b>notes</b></p>
<p>-&gt; Dem_PreInit()</p>
<p><b>Nv M Initialization</b></p>
<p><b>notes</b></p>
<p><i>-&gt; NvM_ReadAll()</i></p>
<p>Block</p>
<p>invalid?</p>
<p><b>Initialize Block</b></p>
<p><b>notes</b></p>
<p><i>Either option:</i></p>
<p><i> call initialization function</i></p>
<p><i> copy ROM data</i></p>
<p><b>DEM </b></p>
<p><b>Initialization</b></p>
<p><b>notes</b></p>
<p>-&gt; Dem_Init()</p>
<p><b>Ram-Block status: </b></p>
<p><b>modified</b></p>
<p><b>notes</b></p>
<p>NvM_SetRamBlockStatus</p>
<p><b>loop all Bocks used by Dem</b></p>
<p><b>Operate</b></p>
<p><b>Dem Shutdown</b></p>
<p><b>notes</b></p>
<p>-&gt; Dem_Shutdown()</p>
<p><b>Nv M data retention</b></p>
<p><b>notes</b></p>
<p><i>-&gt; NvM_WriteAll()</i></p>
<p>Block</p>
<p>modified?</p>
<p><b>Write data to </b></p>
<p><b>NVRAM</b></p>
<p><b>Ram-Block status: </b></p>
<p><b>unmodified</b></p>
<p><b>loop all blocks used by Dem</b></p>
<p>Abort</p>
<p>Shutdown</p>
<p><b>wait Nv M job notification</b></p>
<p><b>notes</b></p>
<p>-&gt; Dem_NvM_JobFinished</p>
<p>[Yes]</p>
<p>[!PostRunRequested]</p>
<p>[data has changed]</p>
<p>/NvM_SetRamBlockStatus</p>
<p>[JobResult ==</p>
<p>NVM_REQ_OK]</p>
<p>[data has changed]</p>
<p>/NvM_WriteBlock</p>
<p>[RAM intact]</p>
<p>[val i d]</p>
<p>[Invalid]</p>
<p>[RAM destroyed]</p>
<p>[JobResult !=</p>
<p>NVM_REQ_OK]</p>
<p>/NvM_SetRamBlockStatus</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>81 </p>
<p>based on template version 5.0.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The Dem cannot keep track of NVRAM blocks that have not been retained in non-</p>
<p>volatile memory if the shutdown process is aborted.  </p>
<p>After </p>
<p>Dem_MasterInit()</p>
<p> is called, the Dem assumes the NvM will not need a trigger </p>
<p>to store a block which has changed before </p>
<p>Dem_Shutdown()</p>
<p> was called. </p>
<p>Due to this, the Dem will also not instruct the NvM to immediately write changed </p>
<p>environment data from before </p>
<p>Dem_Shutdown()</p>
<p>. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The Dem tries to detect completely uninitialized NVRAM data by means of a ‘magic </p>
<p>pattern’ in the AdminData block. </p>
<p>Still, the Dem is unable to detect only partially initialized data. So if your implementation </p>
<p>of the NvM module only initializes some of the Dem’s non-volatile data, the results are </p>
<p>undefined. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Even when some NV data is stored during runtime of the Dem module, it is not optional </p>
<p>to store the remaining data as well. </p>
<p>The shutdown phase must always be finished before powering down the ECU. It is not </p>
<p>sufficient to simply drop the power supply. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>If the NV data storage during runtime was not successful the Dem marks the NVRAM </p>
<p>block as to be considered for shutdown NVRAM storage. Hence it is mandatory to </p>
<p>configure all Dem NVRAM blocks to be processed during NvM_WriteAll. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>4.5.4 </b></p>
<p><b>Flash Lifetime Considerations </b></p>
<p>If  you  need  to  safe  on  writes  to  the  NVRAM,  e.g.  because  your  backing  storage  is </p>
<p>implemented as Flash EEPROM emulation, be aware of your options available to reduce </p>
<p>Dem data writes. </p>
<p>NV synchronization takes place at least at shutdown, but due to configuration or explicit </p>
<p>request  the  NV  data  can  be  synchronized  during  runtime  as  well.  In  that  case,  multiple </p>
<p>writes to the backing storage can happen during a single power cycle, increasing wear on </p>
<p>the backing storage. Please refer to Table 3-8 for details regarding the write frequency. </p>
<p><b>4.6 </b></p>
<p><b>Rte Integration </b></p>
<p><b>4.6.1 </b></p>
<p><b>Runnable Entities </b></p>
<p>The Dem has been implemented in a way that allows all API to safely preempt each other. </p>
<p>So, all runnables can be called from fully preemptive tasks. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>82 </p>
<p>based on template version 5.0.0 </p>
<p><b>Runnable entity </b></p>
<p><b>Remarks </b></p>
<p>Dem_MainFunction </p>
<p>The Dem_MainFunction Runnable entity corresponds to </p>
<p>the Dem cyclic task function. As such, it has to be </p>
<p>mapped to a task.  </p>
<p>Most notification and callout functions are called from this </p>
<p>Runnable </p>
<p>Dem_SetEventStatus </p>
<p>Dem_ResetEventStatus </p>
<p>Dem_GetEventStatus </p>
<p>Dem_GetEventFailed </p>
<p>Dem_GetEventTested </p>
<p>Dem_GetDTCOfEvent </p>
<p>Dem_GetEventEnableCondition </p>
<p>Dem_GetEventFreezeFrameData </p>
<p>Dem_GetEventExtendedDataRecord </p>
<p>Dem_GetFaultDetectionCounter </p>
<p>Dem_PrestoreFreezeFrame </p>
<p>Dem_ClearPrestoredFreezeFrame </p>
<p>Dem_GetDebouncingOfEvent </p>
<p>These runnables should not be mapped to a task for </p>
<p>efficiency reasons. </p>
<p>Please note that these API are implemented reentrant for </p>
<p>different Pports, so clients do not need to synchronize </p>
<p>these calls. </p>
<p>Dem_SetOperationCycleState </p>
<p>Dem_GetOperationCycleState </p>
<p>Dem_SetEnableCondition </p>
<p>Dem_SetStorageCondition </p>
<p>Dem_GetIndicatorStatus </p>
<p>Dem_GetEventMemoryOverflow </p>
<p>Dem_PostRunRequest </p>
<p>Dem_SetDTCSuppression </p>
<p>Dem_GetDTCSuppression </p>
<p>Table 4-10  </p>
<p>Dem runnable entities </p>
<p><b>4.6.2 </b></p>
<p><b>Application Port Interface </b></p>
<p>Application software will communicate with the Dem through port interfaces only. The Dem </p>
<p>port  interfaces  all  use  port  defines  arguments  to  abstract  from  internal  object  handles. </p>
<p>Please refer to general Autosar documentation (not in scope of this document). </p>
<p>The  EventId  is  available  through  some  notification  port  operations,  though  a  typical </p>
<p>application is strongly advised not to rely on the handle of a Dem event for any reason. </p>
<p>Instead, use port mapping to use a specific event and let the Rte handle the details. </p>
<p><b>4.6.3 </b></p>
<p><b>DcmIf </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Changes </b></p>
<p>Since version 13.00.00 the DcmIf is no longer required and has been removed. </p>
<p><b> </b></p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>83 </p>
<p>based on template version 5.0.0 </p>
<p><b>4.7 </b></p>
<p><b>Post-Run requirements </b></p>
<p>Before  shutting  down  the  Dem  by  calling </p>
<p>Dem_Shutdown()</p>
<p>  the  runtime  environment </p>
<p>needs to verify that the Dem is in a consistent state. </p>
<p>Normally,  this  can  be  achieved  within </p>
<p>Dem_Shutdown()</p>
<p>,  but  in  some  cases  the  Dem </p>
<p>needs to wait for an NVRAM  write operation to complete before the cleanup operations </p>
<p>can be performed. This will only be possible if immediate writes are activated. </p>
<p>For  this  reason,  the  Dem  must  be  queried  via  the API </p>
<p>Dem_PostRunRequested()</p>
<p>  to </p>
<p>make  sure  there  are  no  pending  write  operations  that  block  the  shutdown  process. </p>
<p>Otherwise  the  Dem  will  notify  this  state  to  the  Det  (if  Development  Error  Detection  is </p>
<p>enabled) and some event related data will be lost. E.g. a cleared event could be present </p>
<p>again after the ECU restarts. </p>
<p>The runtime environment should make sure that monitors do not report test results to the </p>
<p>Dem  after  the  result  of </p>
<p>Dem_PostRunRequested()</p>
<p>  is  evaluated,  because  this  would </p>
<p>lengthen the time the Dem requires in PostRun. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>If you want to test for the post run condition, the Dem will enter this state only if the </p>
<p>same data is modified again while the NVRAM write is pending. This second </p>
<p>invalidation of the data block can only be reported to NvM after the write completes.  </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>4.8 </b></p>
<p><b>Run-Time limitation </b></p>
<p>In order to reduce run time ‘spikes’, the Dem supports a simple limiter for clearing the fault </p>
<p>memory.  In  effect,  the  Dem  can  be  instructed  to  only  delete  a  limited  number  of  DTCs </p>
<p>during  a  single  task  cycle.  This  will  cause  the  operation  to  take  much  longer,  but  will </p>
<p>distribute the effort through multiple task cycles. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Combined DTCs must be cleared ‘en bloc’, so the Dem will clear combined events </p>
<p>even when it exceeds the allowed limit. Thus, the sum of the largest combined event </p>
<p>and the limiter value can be cleared during a single task cycle. </p>
<p><b> </b></p>
<p><b> </b></p>
<p>A suggestion for the ‘correct’ setting of the clear limit, or even if the feature should be used </p>
<p>in  a  given  set-up  cannot  be  given  in  the  scope  of  this  document.  It  remains  in  the </p>
<p>responsibility of the integrator to identify run-time constraints that require its use. </p>
<p><b>4.9 </b></p>
<p><b>Split main function </b></p>
<p>The Dem currently only provides a single task function. In case the features ‘time based </p>
<p>debouncing’ and ‘OBD’ are not enabled, the Dem main function does not drive a timer. In </p>
<p>that case, the configured cycle time is irrelevant for the function of the Dem module. </p>
<p>This allows mapping the Dem task function on a lower priority task, or a background task. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>84 </p>
<p>based on template version 5.0.0 </p>
<p>Since the Dcm APIs are also served from the Dem task function, this can affect the Dcm </p>
<p>response  times.  To  prevent  unwanted  NRC  78  (response  pending)  responses  from  the </p>
<p>Dcm  module,  make  sure  the  Dem  main  function  is  not  stalled  by  your  choice  of  task </p>
<p>mapping. </p>
<p>As  soon  as  the  Dem  configuration  requires  timer  handling  (e.g.  for  time  based  de-</p>
<p>bouncing), the Dem main function must be called with the configured cycle time. </p>
<p><b>4.10 </b></p>
<p><b>Multi-Partition setup </b></p>
<p>The  Dem  architecture  (see  chapter  3.2) expects  write  access for  the master Dem to  all </p>
<p>partitions, whereas the satellites themselves do not write memory outside of their partition </p>
<p>(see Figure 4-3). As a result, the DemMaster must be mapped to a partition which allows </p>
<p>this level of access. </p>
<p>BSW errors are not connected to the Dem via the RTE, as well aren’t direct function calls, </p>
<p>e.g. by Dcm, FiM or CDD modules. This removes the ability to ascertain a correct call at </p>
<p>configuration time.  </p>
<p> </p>
<p> </p>
<p>Figure 4-3 </p>
<p>Multi-Partition memory write access </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Make sure that calls to Dem_SetEventStatus()originate from the partition configured for </p>
<p>the reported event. Make sure other direct API calls originate from the partition </p>
<p>configured for the DemMaster. </p>
<p>The Dem implementation supports a development error check for this constraint. </p>
<p><b> </b></p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>85 </p>
<p>based on template version 5.0.0 </p>
<p><b>5 </b></p>
<p><b>Measurement and Calibration </b></p>
<p>Measurement  and  calibration  is  a  powerful  workflow  during  ECU  development  phase </p>
<p>which allows to monitor (e.g. via  XCP) module internal variables and  also to modify the </p>
<p>configuration so the behavior will be changed. These changes in the module configuration </p>
<p>can be done without the need to build new software which is flashed into the ECU. </p>
<p><b>5.1 </b></p>
<p><b>Measurable Data </b></p>
<p>Measurable objects are not intended to be modified as they may have direct influence to </p>
<p>DEM state machines and therefore might result in an undefined behavior. So their current </p>
<p>value shall be read out only.  </p>
<p>Please  note  that  not  all  elements  might  be  available  –  disabled  features  usually  also </p>
<p>disable some of the RAM tables. </p>
<p>The following tables describe the measurable objects: </p>
<p><b>5.1.1 </b></p>
<p><b>Dem_Cfg_StatusData </b></p>
<p><b>Dem_Cfg_StatusData </b></p>
<p>Measureable Item </p>
<p>Base Type </p>
<p>Description </p>
<p>FirstFailedEvent </p>
<p>uint16 </p>
<p>The event id which was first reported as failed (FDC 127). </p>
<p>FirstConfirmedEvent </p>
<p>uint16 </p>
<p>The event id which has confirmed first. </p>
<p>MostRecentFailedEvent </p>
<p>uint16 </p>
<p>The event id which was reported as failed (FDC 127) </p>
<p>most recently. </p>
<p>MostRecentConfmdEvent </p>
<p>uint16 </p>
<p>The event id which has confirmed most recently. </p>
<p>TripCount[] </p>
<p>uint8 </p>
<p>The number of trips for each event. </p>
<p>EventStatus[] </p>
<p>uint8 </p>
<p>The current UDS status for each event. Please note that </p>
<p>the actual DTC status may differ from the event status. </p>
<p>Table 5-1  </p>
<p>Measurement item Dem_Cfg_StatusData </p>
<p><b>5.1.2 </b></p>
<p><b>Dem_Cfg_EventDebounceValue </b></p>
<p><b>Dem_Cfg_EventDebounceValue[] </b></p>
<p>Measureable Item </p>
<p>Base Type </p>
<p>Description </p>
<p>Dem_Cfg_EventDebounceValue[] </p>
<p>sint16 </p>
<p>Current value of the de-bounce counter or </p>
<p>time, depending on selected algorithm. </p>
<p>Table 5-2  </p>
<p>Measurement item Dem_Cfg_EventDebounceValue </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>86 </p>
<p>based on template version 5.0.0 </p>
<p><b>5.1.3 </b></p>
<p><b>Dem_Cfg_EventMaxDebounceValues </b></p>
<p><b>Dem_Cfg_EventMaxDebounceValues[] </b></p>
<p>Measureable Item </p>
<p>Base Type </p>
<p>Description </p>
<p>Dem_Cfg_EventMaxDebounceValues[] </p>
<p>sint16 </p>
<p>Maximum value of the de-bounce counter or </p>
<p>time in current operation cycle, depending on </p>
<p>the selected algorithm. </p>
<p>Table 5-3  </p>
<p>Measurement item Dem_Cfg_EventMaxDebounceValues[] </p>
<p><b>5.1.4 </b></p>
<p><b>Dem_Cfg_PrimaryEntry_&lt;Number&gt; </b></p>
<p><b>Dem_Cfg_PrimaryEntry_&lt;Number&gt; </b></p>
<p>Measureable Item </p>
<p>Base Type </p>
<p>Description </p>
<p>Timestamp </p>
<p>uint32 </p>
<p>Entry/ update time of the primary entry slot. Used to provide </p>
<p>a chronology order between the primary entry slots. </p>
<p>AgingCounter </p>
<p>uint16 </p>
<p>The current aging count of the event (refer to 3.11.1). </p>
<p>EventId </p>
<p>uint16 </p>
<p>The event id which is stored in this primary entry slot. </p>
<p>MaxDebounceValue </p>
<p>uint16 </p>
<p>The maximum de-bounce value of the respective event since </p>
<p>last fault memory clear. </p>
<p>OccurrenceCounter </p>
<p>uint8 or uint16 </p>
<p>refer to 3.11.1 </p>
<p>SnapshotData[][] </p>
<p>uint8 </p>
<p>refer to 3.11 </p>
<p>ExtendedData[][] </p>
<p>uint8 </p>
<p>refer to 3.11 </p>
<p>ExtendedHeader </p>
<p>uint8 </p>
<p>Bit coded information which extended data record is </p>
<p>currently stored. </p>
<p>SnapshotHeader </p>
<p>uint8 </p>
<p>If DEM is configured for calculated snapshots: bit coded </p>
<p>information which snapshot record is currently stored. </p>
<p>If DEM is configured for configured snapshots: counter which </p>
<p>indicates the current number of stored snapshot records. </p>
<p>Table 5-4  </p>
<p>Measurement item Dem_Cfg_PrimaryEntry_&lt;Number&gt; </p>
<p><b>5.2 </b></p>
<p><b>Post-Build Support </b></p>
<p>Please also refer to chapter 7.3 for configuration aspects of the post-build features. </p>
<p><b>5.2.1 </b></p>
<p><b>Initialization </b></p>
<p>During  the  startup  of  the  ECU,  the  Dem  expects  to  receive  a  pointer  to <b> preliminary </b></p>
<p>configuration </p>
<p>data </p>
<p>in </p>
<p>Dem_MasterPreInit(). </p>
<p>Typically </p>
<p>the </p>
<p>final </p>
<p>ECU </p>
<p>configuration </p>
<p>is </p>
<p>determined after the NV subsystem is available, but the Dem still needs access to the de-</p>
<p>bouncing configuration of events reported prior to full initialization. </p>
<p>The final configuration data can optionally be passed to Dem_MasterInit(). </p>
<p>Both pointers are passed by the MICROSAR EcuM based on the post-build configuration. </p>
<p>If  no  MICROSAR  EcuM  is  used,  the  procedure  of  how  to  find  the  proper  initialization </p>
<p>pointers is out of scope of this document. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>87 </p>
<p>based on template version 5.0.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The final configuration may not introduce change to the de-bouncing configuration of </p>
<p>events reported prior to full initialization. </p>
<p>The new configuration data cannot be applied in retrospect, so the state of these </p>
<p>events could become inconsistent, e.g. FDC &gt; 127, and TestFailed == 0. </p>
<p><b> </b></p>
<p><b> </b></p>
<p>The  Dem  module  will  verify  the  configuration  data  before  accepting  it  to  initialize  the </p>
<p>module. If this verification fails, an EcuM error hook (see chapter 6.3.1) is called with an </p>
<p>error code according to Table 5-5. </p>
<p><b>Error Code </b></p>
<p><b>Reason </b></p>
<p>ECUM_BSWERROR_NULLPTR </p>
<p>Initialization with a null pointer. </p>
<p>ECUM_BSWERROR_MAGICNUMBER </p>
<p>Magic pattern check failed. This pattern is </p>
<p>appended at the end of the initialization root </p>
<p>structure. An error here is a strong indication of </p>
<p>random data, or a major incompatibility </p>
<p>between the code and the configuration data. </p>
<p>ECUM_BSWERROR_COMPATIBILITYVERSION </p>
<p>The configuration data was created by an </p>
<p>incompatible generator. This is also tested by </p>
<p>verification of a ‘magic’ pattern, so initialization </p>
<p>with random data can also cause this error </p>
<p>code.  </p>
<p>Table 5-5  </p>
<p>Error Codes possible during Post-Build initialization failure </p>
<p>If no MICROSAR EcuM is used, this error hooks and the error code constants have to be </p>
<p>provided by the environment. </p>
<p>1. </p>
<p>If the pointer equals NULL_PTR, initialization is rejected. </p>
<p>2. </p>
<p>If the initialization structure does not end with the correct magic number it is rejected. </p>
<p>3. </p>
<p>If the initialization structure was created by an incompatible generator version it is </p>
<p>rejected (starting magic number check) </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The verification steps performed during initialization are neither intended nor sufficient </p>
<p>to detect corrupted configuration data. They are intended only to detect initialization </p>
<p>with a random pointer, and to reject data created by an incompatible generator version. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>88 </p>
<p>based on template version 5.0.0 </p>
<p><b>5.2.2 </b></p>
<p><b>Post-Build Loadable </b></p>
<p>Vector also provides a tool based approach superior to calibration. While calibration only </p>
<p>modifies  existing  configuration  tables,  the  Post-Build  Loadable  approach  also  allows  to </p>
<p>validate the configuration change preventing misconfiguration, and to use compacted table </p>
<p>structures – with benefits to run-time and ROM usage. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>We do not support adding (or removing) of Events to /from an existing configuration </p>
<p>during Post-Build. If you have ‘inactive’ monitors that are enabled by calibration or </p>
<p>other means, statically set up the Event for this monitor and use the API </p>
<p>Dem_SetEventAvailable() to control event availability. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>5.2.3 </b></p>
<p><b>Post-Build Selectable </b></p>
<p>The MICROSAR Identity Manager (refer to [9]) is an implementation of the AUTOSAR 4 </p>
<p>post-build  selectable  concept.  It  allows  the  ECU  manufacturer  to  include  several  DEM </p>
<p>configurations  within  one  ECU.  With  post-build  selectable  and  the  Identity  Manager  the </p>
<p>ECU  variants  are  downloaded  within  the ECUs  non-volatile  memory  (e.g.  flash) at  ECU </p>
<p>build  time.  Post-build  selectable  does  not  allow  modification  of  DEM  aspects  after  ECU </p>
<p>build time. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>Please refer to the basic software module description (bswmd) file accompanying your </p>
<p>delivery to find which parameters support post-build selectable. </p>
<p>This information is also displayed in the DaVinci Configurator 5 tool. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>We do not support adding (or removing) of Events to / from an existing configuration. If </p>
<p>you have monitors that are enabled only in some configurations, set up the Event for </p>
<p>this monitor and use the configuration parameter DemEventAvailableInVariant, or API </p>
<p>Dem_SetEventAvailable() to control event availability. </p>
<p>It is not supported to disable all events in all variants using parameter </p>
<p>DemEventAvailableInVariant. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>89 </p>
<p>based on template version 5.0.0 </p>
<p><b>6 </b></p>
<p><b>API Description </b></p>
<p>For an interfaces overview please see Figure 2-2. </p>
<p><b>6.1 </b></p>
<p><b>Type Definitions </b></p>
<p>The types defined by the Dem are described in [1]. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>90 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2 </b></p>
<p><b>Services provided by Dem </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Basic Knowledge </b></p>
<p>Call context means ‘who calls the API’. Typically these are rooted in an OS task </p>
<p>function or interrupt service routine and contain the call stack up to the API in question. </p>
<p>Call contexts are important to analyze possible data corruption that can occur due to </p>
<p>simultaneous calls from different call contexts. This is not restricted to interruption due </p>
<p>to preemptive OS tasks – A call to an API function from within a notification or callback </p>
<p>function also is a different call context. </p>
<p>Typically not all possible call sequences can be implemented safe for data consistency </p>
<p>with reasonable effort, and valid call contexts might be restricted as a consequence. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>6.2.1 </b></p>
<p><b>Dem_GetVersionInfo() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>Dem_GetVersionInfo</b></p>
<p> </p>
<p>( Std_VersionInfoType* versioninfo )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>versioninfo </p>
<p>Pointer to where to store the version information of this module. </p>
<p><b>Return code </b></p>
<p>void </p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>Returns the version information of this module. </p>
<p>The version information is decimal coded. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-1  </p>
<p>Dem_GetVersionInfo() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>91 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.2 </b></p>
<p><b>Dem_MasterMainFunction() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>Dem_MasterMainFunction</b></p>
<p> </p>
<p>( void )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>N/A</p>
<p><b> </b></p>
<p>N/A </p>
<p><b>Return code </b></p>
<p>void</p>
<p><b> </b></p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>Processes status changes and serves as time base. </p>
<p>This function implements run-time heavy tasks. Make sure to allow it has a sufficient time slot for worst </p>
<p>case execution scenarios. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-2  </p>
<p>Dem_MasterMainFunction() </p>
<p><b>6.2.3 </b></p>
<p><b>Dem_SatelliteMainFunction() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>Dem_SatelliteMainFunction</b></p>
<p> </p>
<p>( void )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>SatelliteId </p>
<p>Identification of a satellite by assigned SatelliteId. </p>
<p><b>Return code </b></p>
<p>void</p>
<p><b> </b></p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>Processes time based de-bouncing for events assigned to the satellite. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-3  </p>
<p>Dem_SatelliteMainFunction() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>92 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.4 </b></p>
<p><b>Dem_MainFunction() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>Dem_MainFunction</b></p>
<p> </p>
<p>( void )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>N/A</p>
<p><b> </b></p>
<p>N/A </p>
<p><b>Return code </b></p>
<p>void</p>
<p><b> </b></p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>Processes all not event based Dem internal functions.  </p>
<p>This function implements run-time heavy tasks. Make sure to allow it has a sufficient time slot for worst </p>
<p>case execution scenarios. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This function can only be used in configurations with one partition, i.e. a single satellite. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context.  </p>
<p>Table 6-4  </p>
<p>Dem_MainFunction() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>93 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.5 </b></p>
<p><b>Interface EcuM </b></p>
<p><b>6.2.5.1 </b></p>
<p><b>Dem_MasterPreInit() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>Dem_MasterPreInit</b></p>
<p> </p>
<p>( const Dem_ConfigType* ConfigPtr )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ConfigPtr </p>
<p>Pointer to preliminary configuration data </p>
<p><b>Return code </b></p>
<p>void </p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>Initializes the basic functionality of the master partition. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>The ConfigPtr is used only in post-build variants. </p>
<p><b>&gt; </b></p>
<p>If ConfigPtr is not needed, it is not checked to be non-NULL </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function may not interrupt any other Dem function.  </p>
<p>Table 6-5 </p>
<p>Dem_MasterPreInit() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>94 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.5.2 </b></p>
<p><b>Dem_SatellitePreInit() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>Dem_SatellitePreInit</b></p>
<p> </p>
<p>( Dem_SatelliteInfoType SatelliteId )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>SatelliteId </p>
<p>Identification of a satellite by assigned SatelliteId. </p>
<p><b>Return code </b></p>
<p>void </p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>Initializes the basic functionality of the satellite so that events assigned to this satellite can be reported by </p>
<p>BSW-modules. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function may not interrupt any other Dem function.  </p>
<p>Table 6-6 </p>
<p>Dem_SatellitePreInit() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>95 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.5.3 </b></p>
<p><b>Dem_PreInit() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>Dem_PreInit</b></p>
<p> </p>
<p>( const Dem_ConfigType* ConfigPtr )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ConfigPtr </p>
<p>Pointer to preliminary configuration data </p>
<p><b>Return code </b></p>
<p>void </p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>Initializes the basic functionality of the master and satellite partition so that events can be reported by </p>
<p>BSW-modules. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>The ConfigPtr is used only in post-build variants. </p>
<p><b>&gt; </b></p>
<p>If ConfigPtr is not needed, it is not checked to be non-NULL. </p>
<p><b>&gt; </b></p>
<p>This function can only be used in configurations with one partition, i.e. a single satellite. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function may not interrupt any other Dem function.  </p>
<p>Table 6-7  </p>
<p>Dem_PreInit() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>96 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.5.4 </b></p>
<p><b>Dem_MasterInit() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>Dem_MasterInit</b></p>
<p> </p>
<p>( const Dem_ConfigType* ConfigPtr )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ConfigPtr </p>
<p>Pointer to configuration data (Since version 7.00.00) </p>
<p><b>Return code </b></p>
<p>void </p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>Initializes or re-initializes the master partition. </p>
<p>If NULL is passed, the configuration passed to Dem_PreInit() will be used instead. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>The ConfigPtr is used only in post-build variants. </p>
<p><b>&gt; </b></p>
<p>The pointer is not checked to be non-NULL </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function may not interrupt any other Dem function.  </p>
<p>Table 6-8 </p>
<p>Dem_MasterInit() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>97 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.5.5 </b></p>
<p><b>Dem_SatelliteInit() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>Dem_SatelliteInit</b></p>
<p> </p>
<p>( Dem_SatelliteInfoType SatelliteId )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>SatelliteId </p>
<p>Identification of a satellite by assigned SatelliteId. </p>
<p><b>Return code </b></p>
<p>void </p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>Initializes the satellite partition. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function may not interrupt any other Dem function.  </p>
<p>Table 6-9 </p>
<p>Dem_SatelliteInit() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>98 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.5.6 </b></p>
<p><b>Dem_Init() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>Dem_Init</b></p>
<p> </p>
<p>( const Dem_ConfigType* ConfigPtr )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ConfigPtr </p>
<p>Pointer to configuration data (Since version 7.00.00) </p>
<p><b>Return code </b></p>
<p>void </p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>Initializes the master and satellite partition. </p>
<p>If NULL is passed, the configuration passed to Dem_PreInit() will be used instead. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>The ConfigPtr is used only in post-build variants. </p>
<p><b>&gt; </b></p>
<p>The pointer is not checked to be non-NULL. </p>
<p><b>&gt; </b></p>
<p>This function can only be used in configurations with one partition, i.e. a single satellite. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function may not interrupt any other Dem function. </p>
<p>Table 6-10  </p>
<p>Dem_Init() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>99 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.5.7 </b></p>
<p><b>Dem_InitMemory() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>Dem_InitMemory</b></p>
<p> </p>
<p>( void )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>N/A </p>
<p>N/A </p>
<p><b>Return code </b></p>
<p>void </p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>- Extension to Autosar – </p>
<p>Use this function to initialize static RAM variables in case the start-up code is not used to initialize RAM. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function may not interrupt any other Dem function. </p>
<p>Table 6-11  </p>
<p>Dem_InitMemory() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>100 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.5.8 </b></p>
<p><b>Dem_Shutdown() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>Dem_Shutdown</b></p>
<p> </p>
<p>( void )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>N/A </p>
<p>N/A </p>
<p><b>Return code </b></p>
<p>void </p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>Shutdown Dem functionality. </p>
<p>The function freezes the Dem data structures. As a result the Dem functionality is no longer available, but </p>
<p>the Dem non-volatile data can be stored in non-volatile memory. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>Most pending asynchronous tasks will get lost when this function is called. The only </p>
<p>exceptions are pending event status changes. These remain queued according to [1]. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function may not interrupt any other Dem function. It has to be called from the master </p>
<p>partition. </p>
<p>Table 6-12  </p>
<p>Dem_Shutdown() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>101 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6 </b></p>
<p><b>Interface SWC and CDD </b></p>
<p><b>6.2.6.1 </b></p>
<p><b>Dem_SetEventStatus() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_SetEventStatus</b></p>
<p> </p>
<p>( Dem_EventIdType EventId, Dem_EventStatusType </p>
<p>EventStatus )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an event by assigned EventId. </p>
<p>EventStatus </p>
<p>Monitor test result </p>
<p>DEM_EVENT_STATUS_PASSED: monitor reports a qualified passed test </p>
<p>result  </p>
<p>DEM_EVENT_STATUS_FAILED: monitor reports a qualified failed test result </p>
<p>DEM_EVENT_STATUS_PREPASSED: monitor reports a passed test result </p>
<p>DEM_EVENT_STATUS_PREFAILED: monitor reports a failed test result </p>
<p>DEM_EVENT_STATUS_PASSED_CONDITIONS_NOT_FULFILLED: monitor </p>
<p>reports a qualified passed test result when similar conditions are not fulfilled </p>
<p>DEM_EVENT_STATUS_FAILED_CONDITIONS_NOT_FULFILLED: monitor </p>
<p>reports a qualified failed test result when similar conditions are not fulfilled </p>
<p>DEM_EVENT_STATUS_PREPASSED_CONDITIONS_NOT_FULFILLED: </p>
<p>monitor reports a passed test result when similar conditions are not fulfilled </p>
<p>DEM_EVENT_STATUS_PREFAILED_CONDITIONS_NOT_FULFILLED: </p>
<p>monitor reports a failed test result when similar conditions are not fulfilled </p>
<p>DEM_EVENT_STATUS_FDC_THRESHOLD_REACHED: </p>
<p>monitor reports that FDC exceeds the storage threshold </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: set of event status was successful </p>
<p>E_NOT_OK: set of event status failed or could not be accepted (e.g.: the </p>
<p>operation cycle configured for this event has not been started, an according </p>
<p>enable condition has been disabled) </p>
<p><b>Functional Description </b></p>
<p>API for SWCs to report a monitor result to the Dem. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant (for different EventId). </p>
<p><b>&gt; </b></p>
<p>This function is not reentrant with the other operations defined in DiagnosticMonitor (for the </p>
<p>same EventId) (see Table 6-102) </p>
<p><b>&gt; </b></p>
<p>EventStatus values DEM_EVENT_STATUS_&lt;x&gt;_ CONDITIONS_NOT_FULFILLED are only </p>
<p>supported for OBD configurations. </p>
<p><b>&gt; </b></p>
<p>EventStatus value DEM_EVENT_STATUS_FDC_THRESHOLD_REACHED is only valid for </p>
<p>events using monitor internal debouncing. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context, with limitations. It has to be called from the </p>
<p>respective satellite partition. </p>
<p>Table 6-13  </p>
<p>Dem_SetEventStatus() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>102 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.2 </b></p>
<p><b>Dem_ResetEventStatus() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_ResetEventStatus</b></p>
<p> </p>
<p>( Dem_EventIdType EventId )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an event by assigned EventId. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: reset of event status was successful </p>
<p>E_NOT_OK: reset of event status failed or is not allowed, because the event </p>
<p>is already tested in this operation cycle </p>
<p><b>Functional Description </b></p>
<p>Resets the event failed status of an event. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant (for different EventId). </p>
<p><b>&gt; </b></p>
<p>This function is not reentrant with the other operations defined in DiagnosticMonitor (for the </p>
<p>same EventId) (see Table 6-102) </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context, with limitations. It has to be called from the </p>
<p>respective satellite partition. </p>
<p>Table 6-14  </p>
<p>Dem_ResetEventStatus() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>103 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.3 </b></p>
<p><b>Dem_ResetEventDebounceStatus() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_ResetEventDebounceStatus() </b>( Dem_EventIdType EventId, </p>
<p>Dem_DebounceResetStatusType DebounceResetStatus )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an event by assigned EventId. </p>
<p>DebounceResetStatus </p>
<p>Select the action to take </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: The request was processed successfully </p>
<p>E_NOT_OK: The request was rejected </p>
<p><b>Functional Description </b></p>
<p>SWC API to control the Dem internal event de-bouncing. </p>
<p>Depending on DebounceResetStatus and the EventId's configured debouncing algorithm, this API performs </p>
<p>the following: </p>
<p>&gt; </p>
<p>Time Based Debouncing </p>
<p>&gt; </p>
<p>DEM_DEBOUNCE_STATUS_FREEZE </p>
<p>If the de-bounce timer is active, it is paused without modifying its current value. Otherwise this has </p>
<p>no effect. The timer will continue if the monitor reports another PREFAILED or PREPASSED in the </p>
<p>same direction. </p>
<p>&gt; </p>
<p>DEM_DEBOUNCE_STATUS_RESET </p>
<p>The de-bounce timer is stopped and its value is set to 0. </p>
<p>&gt; </p>
<p>Counter Based Debouncing </p>
<p>&gt; </p>
<p>DEM_DEBOUNCE_STATUS_FREEZE: </p>
<p>This has no effect. </p>
<p>&gt; </p>
<p>DEM_DEDOUNCE_STATUS_RESET: </p>
<p>This will set the current value of the debounce counter back to 0. </p>
<p>&gt; </p>
<p>Monitor Internal Debouncing </p>
<p>&gt; </p>
<p>The API returns E_NOT_OK in either case. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant (for different EventId). </p>
<p><b>&gt; </b></p>
<p>This function is not reentrant with the other operations defined in DiagnosticMonitor (for the </p>
<p>same EventId) (see Table 6-102) </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context, with limitations. It has to be called from the </p>
<p>respective satellite partition. </p>
<p>Table 6-15  </p>
<p>Dem_ResetEventDebounceStatus() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>104 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.4 </b></p>
<p><b>Dem_PrestoreFreezeFrame() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_PrestoreFreezeFrame</b></p>
<p> </p>
<p>( Dem_EventIdType EventId )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an event by assigned EventId. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Freeze frame pre-storage was successful </p>
<p>E_NOT_OK: Freeze frame pre-storage failed </p>
<p><b>Functional Description </b></p>
<p>Captures the freeze frame data for a specific event. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant (for different EventId). </p>
<p><b>&gt; </b></p>
<p>This function is not reentrant with the other operations defined in DiagnosticMonitor (for the </p>
<p>same EventId) (see Table 6-102) </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>The function can have significant run-time. </p>
<p><b>&gt; </b></p>
<p>If the call to this function coincides with the event storage on the task function, the Dem might </p>
<p>capture a current data set instead of using the pre-stored data. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context, with limitations. It has to be called from the </p>
<p>master partition. </p>
<p>Table 6-16  </p>
<p>Dem_PrestoreFreezeFrame() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>105 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.5 </b></p>
<p><b>Dem_ClearPrestoredFreezeFrame() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_ClearPrestoredFreezeFrame</b></p>
<p> </p>
<p>( Dem_EventIdType EventId )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an event by assigned EventId. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Clear pre-stored freeze frame was successful </p>
<p>E_NOT_OK: Clear pre-stored freeze frame failed </p>
<p><b>Functional Description </b></p>
<p>Clears a pre-stored freeze frame of a specific event. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant (for different EventId). </p>
<p><b>&gt; </b></p>
<p>This function is not reentrant with the other operations defined in DiagnosticMonitor (for the </p>
<p>same EventId) (see Table 6-102) </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>If the call to this function coincides with the event storage on the task function, the Dem might </p>
<p>use the pre-stored data set instead of discarding it. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context, with limitations. It has to be called from the </p>
<p>master partition. </p>
<p>Table 6-17  </p>
<p>Dem_ClearPrestoredFreezeFrame() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>106 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.6 </b></p>
<p><b>Dem_SetOperationCycleState() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_SetOperationCycleState</b></p>
<p> </p>
<p>( uint8 OperationCycleId, </p>
<p>Dem_OperationCycleStateType CycleState )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>OperationCycleId </p>
<p>Identification of operation cycle, like power cycle or driving cycle. </p>
<p>CycleState </p>
<p>New operation cycle state: (re-)start or end </p>
<p>DEM_CYCLE_STATE_START: start a stopped cycle or restart an active cycle </p>
<p>DEM_CYCLE_STATE_END: stop an active cycle </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: set of operation cycle was successful </p>
<p>E_NOT_OK: set of operation cycle failed </p>
<p><b>Functional Description </b></p>
<p>This function reports a started or stopped operation cycle to the Dem.  </p>
<p>The state change will set TestNotCompletedThisOperationCycle bits for all events using OperationCycleId </p>
<p>as operation cycle. Also all passive events using OperationCycleId as aging or healing cycle will increase </p>
<p>their respective counter and can heal or age. </p>
<p>It is allowed to call this run in pre-initialized mode to start the operation cycle of BSW events before full </p>
<p>initialization.  </p>
<p>Since all these operations are computationally intensive, this function will not immediately complete but </p>
<p>postpone the work to the Dem task. Events that use OperationCycleId as operation cycle still use the last </p>
<p>known state until then.  </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant (for different OperationCycleId). </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context, with limitations. It has to be called from the </p>
<p>master partition. </p>
<p>Table 6-18  </p>
<p>Dem_SetOperationCycleState() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>107 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.7 </b></p>
<p><b>Dem_GetOperationCycleState() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetOperationCycleState</b></p>
<p> </p>
<p>( uint8 OperationCycleId, </p>
<p>Dem_OperationCycleStateType* CycleState )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>OperationCycleId </p>
<p>Identification of operation cycle, like power cycle or driving cycle. </p>
<p>CycleState </p>
<p>State of the requested operation cycle: (re-)start or end </p>
<p>DEM_CYCLE_STATE_START: operation cycle is (re-)started </p>
<p>DEM_CYCLE_STATE_END: operation cycle is ended </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: request for operation cycle state was successful </p>
<p>E_NOT_OK: request for operation cycle state failed </p>
<p><b>Functional Description </b></p>
<p>This function returns the current operation cycle state.  </p>
<p>  </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context, with limitations. It has to be called from the </p>
<p>master partition. </p>
<p>Table 6-19  </p>
<p>Dem_GetOperationCycleState </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>108 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.8 </b></p>
<p><b>Dem_GetEventUdsStatus() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetEventUdsStatus</b></p>
<p> </p>
<p>( Dem_EventIdType EventId, </p>
<p>Dem_UdsStatusByteType* UDSStatusByte ) </p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetEventStatus </b>( Dem_EventIdType EventId, </p>
<p>Dem_EventStatusExtendedType* UDSStatusByte )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an event by assigned EventId. </p>
<p>UDSStatusByte </p>
<p>UDS event status byte of the requested event. </p>
<p>If the return value of the function call is E_NOT_OK, this parameter does not </p>
<p>contain valid data. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: get of event status was successful </p>
<p>E_NOT_OK: get of event status failed </p>
<p><b>Functional Description </b></p>
<p>Gets the current UDS event status byte of an event. </p>
<p>API Dem_GetEventStatus is available for compatibility reasons. Please use Dem_GetEventUdsStatus </p>
<p>instead.   </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant (for different EventId). </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context.  </p>
<p>Table 6-20  </p>
<p>Dem_GetEventUdsStatus() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>109 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.9 </b></p>
<p><b>Dem_GetMonitorStatus() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetMonitorStatus</b></p>
<p> </p>
<p>( Dem_EventIdType EventId, </p>
<p>Dem_MonitorStatusType* MonitorStatus )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an event by assigned EventId. </p>
<p>MonitorStatus </p>
<p>Monitor status byte of the requested event. </p>
<p>If the return value of the function call is E_NOT_OK, this parameter does not </p>
<p>contain valid data. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: get monitor status was successful </p>
<p>E_NOT_OK: get monitor status failed </p>
<p><b>Functional Description </b></p>
<p>Gets the current monitor status of an event. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant (for different EventId). </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context.  </p>
<p>Table 6-21  </p>
<p>Dem_GetMonitorStatus() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>110 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.10 </b></p>
<p><b>Dem_GetEventFailed() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetEventFailed</b></p>
<p> </p>
<p>( Dem_EventIdType EventId, Boolean* </p>
<p>EventFailed )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an event by assigned EventId. </p>
<p>EventFailed </p>
<p>TRUE – Last Failed  </p>
<p>FALSE – not Last Failed </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: get of “EventFailed” was successful </p>
<p>E_NOT_OK: get of “EventFailed” was not successful </p>
<p><b>Functional Description </b></p>
<p>- Extension to Autosar – </p>
<p>Gets the failed status of an event. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant (for different EventId). </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context.  </p>
<p>Table 6-22  </p>
<p>Dem_GetEventFailed() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>111 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.11 </b></p>
<p><b>Dem_GetEventTested() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetEventTested</b></p>
<p> </p>
<p>( Dem_EventIdType EventId, Boolean* </p>
<p>EventTested )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an event by assigned EventId. </p>
<p>EventTested </p>
<p>TRUE – event tested this cycle </p>
<p>FALSE – event not tested this cycle  </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: get of event state “tested” successful </p>
<p>E_NOT_OK: get of event state “tested” failed </p>
<p><b>Functional Description </b></p>
<p>- Extension to Autosar – </p>
<p>Gets the tested status of an event. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant (for different EventId). </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context.  </p>
<p>Table 6-23  </p>
<p>Dem_GetEventTested() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>112 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.12 </b></p>
<p><b>Dem_GetDTCOfEvent() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetDTCOfEvent</b></p>
<p> </p>
<p>( Dem_EventIdType EventId, Dem_DTCFormatType </p>
<p>DTCFormat, uint32* DTCOfEvent )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an event by assigned EventId. </p>
<p>DTCFormat </p>
<p>Defines the output-format of the requested DTC value. </p>
<p>DEM_DTC_FORMAT_UDS: output format shall be UDS </p>
<p>DEM_DTC_FORMAT_OBD: output format shall be OBD </p>
<p>DEM_DTC_FORMAT_J1939: output format shall be J1939 </p>
<p>DTCOfEvent </p>
<p>Receives the DTC value in respective format returned by this function. If the </p>
<p>return value of the function is other than E_OK this parameter does not </p>
<p>contain valid data. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: get of DTC was successful </p>
<p>E_NOT_OK: the call was not successful </p>
<p>E_NO_DTC_AVAILABLE: there is no DTC </p>
<p><b>Functional Description </b></p>
<p>Provides the DTC number for the given EventId. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant (for different EventId). </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-24  </p>
<p>Dem_GetDTCOfEvent() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>113 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.13 </b></p>
<p><b>Dem_GetEventAvailable() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetEventAvailable</b></p>
<p> </p>
<p>(Dem_EventIdType EventId, Boolean </p>
<p>*AvailableStatus)</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an event by assigned EventId. </p>
<p>AvailableStatus </p>
<p>Receives the current availability status: </p>
<p>TRUE: Event is ‘available’ </p>
<p>FALSE: Event is ‘not available’ </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Request processed successfully </p>
<p>E_NOT_OK: Invalid parameters passed to the function (only if Det is enabled). </p>
<p><b>Functional Description </b></p>
<p>This API returns the current availability state of an event (also see Dem_SetEventAvailable()) </p>
<p>It is valid to call this API for events that have been set to unavailable.  </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>Conditional [DemAvailabilityStorage == false]: This API may be called before full initialization </p>
<p>(after Dem_MasterPreInit). </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context, with limitations. </p>
<p>Table 6-25  </p>
<p>Dem_GetEventAvailable() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>114 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.14 </b></p>
<p><b>Dem_SetEnableCondition() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_SetEnableCondition</b></p>
<p> </p>
<p>( uint8 EnableConditionID, Boolean </p>
<p>ConditionFulfilled )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EnableConditionID </p>
<p>This parameter identifies the enable condition. </p>
<p>ConditionFulfilled </p>
<p>This parameter specifies whether the enable condition assigned to the </p>
<p>EnableConditionID is fulfilled (TRUE) or not fulfilled (FALSE). </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: the enable condition could be set successfully </p>
<p>E_NOT_OK: the setting of the enable condition failed </p>
<p><b>Functional Description </b></p>
<p>Sets an enable condition. </p>
<p>Each event may have assigned several enable conditions. Only if all enable conditions referenced by the </p>
<p>event are fulfilled the event will be processed in Dem_SetEventStatus(), Dem_ReportErrorStatus() and </p>
<p>during time based de-bouncing. </p>
<p>Depending on configuration, enabling an enable condition can be deferred to the Dem task. Enable </p>
<p>condition changes of the same enable condition can be lost if they change faster than the cycle time of the </p>
<p>Dem main function. See chapter 3.8 for further details. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant (for different EnableConditionID).  </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context, with limitations. It has to be called from the </p>
<p>master partition. </p>
<p>Table 6-26  </p>
<p>Dem_SetEnableCondition() </p>
<p> </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>115 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.15 </b></p>
<p><b>Dem_SetStorageCondition() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_SetStorageCondition</b></p>
<p> </p>
<p>( uint8 StorageConditionID, Boolean </p>
<p>ConditionFulfilled )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>StorageConditionID </p>
<p>This parameter identifies the storage condition. </p>
<p>ConditionFulfilled </p>
<p>This parameter specifies whether the storage condition assigned to the </p>
<p>StorageConditionID is fulfilled or not fulfilled. </p>
<p>TRUE: storage condition fulfilled </p>
<p>FALSE: storage condition not fulfilled  </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: the storage condition could be set successfully </p>
<p>E_NOT_OK: the setting of the storage condition failed </p>
<p><b>Functional Description </b></p>
<p>Sets a storage condition. </p>
<p>Each event may have assigned several storage conditions. Only if all storage conditions referenced by the </p>
<p>event are fulfilled the event may be stored in memory. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant (for different StorageConditionID). </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context, with limitations. It has to be called from the </p>
<p>master partition. </p>
<p>Table 6-27  </p>
<p>Dem_SetStorageCondition() </p>
<p> </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>116 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.16 </b></p>
<p><b>Dem_GetFaultDetectionCounter() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetFaultDetectionCounter</b></p>
<p> </p>
<p>( Dem_EventIdType EventId, sint8* </p>
<p>FaultDetectionCounter )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Provide the EventId value the fault detection counter is requested for. If the </p>
<p>return value of the function is other than OK this parameter does not contain </p>
<p>valid data.  </p>
<p>FaultDetectionCounter </p>
<p>This parameter receives the Fault Detection Counter information of the </p>
<p>requested EventId. If the return value of the function call is other than E_OK </p>
<p>this parameter does not contain valid data. </p>
<p>-128dec…127dec PASSED… FAILED according to ISO 14229-1 </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: request was successful </p>
<p>E_NOT_OK: request failed </p>
<p>DEM_E_NO_FDC_AVAILABLE: if the event does not support de-bouncing </p>
<p><b>Functional Description </b></p>
<p>Gets the fault detection counter of an event. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant (for different EventId). </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-28  </p>
<p>Dem_GetFaultDetectionCounter() </p>
<p> </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>117 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.17 </b></p>
<p><b>Dem_GetIndicatorStatus() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetIndicatorStatus</b></p>
<p> </p>
<p>( uint8 IndicatorId, </p>
<p>Dem_IndicatorStatusType* IndicatorStatus )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>IndicatorId </p>
<p>The respective indicator which shall be checked for its status. </p>
<p>IndicatorStatus </p>
<p>Status of the indicator, like off, on, or blinking. </p>
<p>DEM_INDICATOR_OFF: indicator off </p>
<p>DEM_INDICATOR_CONTINUOUS: continuous on </p>
<p>DEM_INDICATOR_BLINKING: blinking mode  </p>
<p>DEM_INDICATOR_BLINK_CONT: continuous and blinking mode </p>
<p>DEM_INDICATOR_FAST_FLASH: fast flash mode  </p>
<p>DEM_INDICATOR_SLOW_FLASH: slow flash mode  </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Operation was successful </p>
<p>E_NOT_OK: Operation failed or is not supported </p>
<p><b>Functional Description </b></p>
<p>Gets the indicator status derived from the event status and the configured indicator states. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. It has to be called from the master partition. </p>
<p>Table 6-29  </p>
<p>Dem_GetIndicatorStatus() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>118 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.18 </b></p>
<p><b>Dem_GetEventFreezeFrameDataEx() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetEventFreezeFrameDataEx</b></p>
<p> </p>
<p>( Dem_EventIdType EventId, uint8 </p>
<p>RecordNumber, uint16 DataId, uint8* DestBuffer, uint16* BufSize )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an event by assigned EventId. </p>
<p>RecordNumber </p>
<p>This parameter is a unique identifier for a freeze frame record as defined in </p>
<p>ISO15031-5 and ISO14229-1. </p>
<p>0xFF means that the most recent freeze frame record shall be returned. </p>
<p>DataId </p>
<p>This parameter specifies the PID (ISO15031-5) or DID (ISO14229-1) that shall </p>
<p>be copied to the destination buffer. </p>
<p>DestBuffer </p>
<p>The pointer to the buffer where the freeze frame data shall be written to. </p>
<p>BufSize </p>
<p>When the function is called this parameter must contain the maximum number </p>
<p>of data bytes that can be written to the buffer. </p>
<p>The function returns the actual number of written data bytes in this parameter. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Operation was successful; the requested data was copied to the </p>
<p>destination buffer. </p>
<p>E_NOT_OK: The request was rejected, e.g. due to variant coding (see </p>
<p>Dem_SetEventAvailable()) OR </p>
<p>the requested data is currently not accessible (e.g. in case of asynchronous </p>
<p>preempted data retrieval from application). </p>
<p>DEM_NO_SUCH_ELEMENT: The data is not currently stored for the </p>
<p>requested event OR </p>
<p>the requested RecordNumber is not supported for the given event OR </p>
<p>the requested data identifier is not supported within the requested record </p>
<p>(freeze frame). </p>
<p>DEM_BUFFER_TOO_SMALL: The provided destination buffer is too small </p>
<p><b>Functional Description </b></p>
<p>Gets the data of a freeze frame/snapshot record for the given EventId. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant (for different EventId). </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-30  </p>
<p>Dem_GetEventFreezeFrameDataEx() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>119 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.19 </b></p>
<p><b>Dem_GetEventExtendedDataRecordEx() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetEventExtendedDataRecordEx</b></p>
<p> </p>
<p>( Dem_EventIdType EventId, uint8 </p>
<p>RecordNumber, uint8* DestBuffer, uint16* BufSize )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an event by assigned EventId. </p>
<p>RecordNumber </p>
<p>Identification of requested Extended data record. The valid range is 0x01 … </p>
<p>0xFF whereas 0xFF means that all extended data records shall be returned. </p>
<p>DestBuffer </p>
<p>The pointer to the buffer where the extended data shall be written to. </p>
<p>BufSize </p>
<p>When the function is called this parameter must contain the maximum number </p>
<p>of data bytes that can be written to the buffer. </p>
<p>The function returns the actual number of written data bytes in this parameter. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Operation was successful; the requested data was copied to the </p>
<p>destination buffer. </p>
<p>E_NOT_OK: The request was rejected, e.g. due to variant coding (see </p>
<p>Dem_SetEventAvailable()) OR </p>
<p>the requested data is currently not accessible (e.g. in case of asynchronous </p>
<p>preempted data retrieval from application). </p>
<p>DEM_NO_SUCH_ELEMENT: The data is not currently stored for the </p>
<p>requested event OR </p>
<p>the requested data was not copied due to an undefined RecordNumber for the </p>
<p>given event. </p>
<p>DEM_BUFFER_TOO_SMALL: The provided destination buffer is too small </p>
<p><b>Functional Description </b></p>
<p>Gets the data of an extended data record by the given EventId. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant (for different EventId). </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-31  </p>
<p>Dem_GetEventExtendedDataRecordEx() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>120 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.20 </b></p>
<p><b>Dem_GetEventEnableCondition() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetEventEnableCondition</b></p>
<p> </p>
<p>( Dem_EventIdType EventId, Boolean* </p>
<p>ConditionFulfilled )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>This parameter identifies the enable condition. </p>
<p>ConditionFulfilled </p>
<p>This parameter specifies whether the enable conditions assigned to the </p>
<p>EventId is fulfilled (TRUE) or not fulfilled (FALSE). </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Request processed successfully </p>
<p>E_NOT_OK: Invalid parameters passed to the function (only if Det is enabled). </p>
<p><b>Functional Description </b></p>
<p>- Extension to AUTOSAR –  </p>
<p>Returns the enable condition state for the given event. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-32  </p>
<p>Dem_GetEventEnableCondition() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>121 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.21 </b></p>
<p><b>Dem_GetEventMemoryOverflow() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetEventMemoryOverflow</b></p>
<p> </p>
<p>( uint8 ClientId, Dem_DTCOriginType </p>
<p>DTCOrigin, Boolean* OverflowIndication )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>DemClientID identifying the DemEventMemorySet to which the requested </p>
<p>event memory belongs to. </p>
<p>DTCOrigin </p>
<p>Selects the memory which shall be checked for overflow indication. </p>
<p>DEM_DTC_ORIGIN_PRIMARY_MEMORY: event information located in the </p>
<p>primary memory  </p>
<p>DEM_DTC_ORIGIN_SECONDARY_MEMORY: event information located in </p>
<p>the secondary memory </p>
<p>DEM_DTC_ORIGIN_PERMANENT_MEMORY: event information located in </p>
<p>the permanent memory </p>
<p>DEM_DTC_ORIGIN_MIRROR_MEMORY: event information located in the </p>
<p>mirror memory </p>
<p>OverflowIndication </p>
<p>This parameter returns TRUE if the according event memory was overflowed, </p>
<p>otherwise it returns FALSE. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Operation was successful </p>
<p>E_NOT_OK: Operation failed or is not supported </p>
<p><b>Functional Description </b></p>
<p>Reports if a DTC was displaced or not stored in the given event memory because the event memory was </p>
<p>completely full at the time. </p>
<p>ClientID is currently not evaluated as DemEventMemorySets are not supported. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. It has to be called from the master partition. </p>
<p>Table 6-33  </p>
<p>Dem_GetEventMemoryOverflow() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>122 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.22 </b></p>
<p><b>Dem_GetNumberOfEventMemoryEntries() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetNumberOfEventMemoryEntries</b></p>
<p> </p>
<p>( uint8 ClientId, </p>
<p>Dem_DTCOriginType DTCOrigin, uint8* NumberOfEventMemoryEntries )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>DemClientID identifying the DemEventMemorySet to which the </p>
<p>requested event memory belongs to. </p>
<p>DTCOrigin </p>
<p>Identifier of the event memory concerned. </p>
<p>DEM_DTC_ORIGIN_PRIMARY_MEMORY: event information </p>
<p>located in the primary memory  </p>
<p>DEM_DTC_ORIGIN_SECONDARY_MEMORY: event information </p>
<p>located in the secondary memory </p>
<p>DEM_DTC_ORIGIN_PERMANENT_MEMORY: event information </p>
<p>located in the permanent memory </p>
<p>DEM_DTC_ORIGIN_MIRROR_MEMORY: event information located </p>
<p>in the mirror memory </p>
<p>NumberOfEventMemoryEntries </p>
<p>Pointer to receive the event count. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Operation was successful </p>
<p>E_NOT_OK: Operation failed or is not supported </p>
<p><b>Functional Description </b></p>
<p>This function reports the number of event entries occupied by events. This does not necessarily correspond </p>
<p>to the DTC count read by Dcm due to event combination and other effects like post-building the OBD </p>
<p>relevance of a DTC stored in OBD permanent memory. </p>
<p>ClientID is currently not evaluated as DemEventMemorySets are not supported. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. It has to be called from the master partition. </p>
<p>Table 6-34  </p>
<p>Dem_GetNumberOfEventMemoryEntries() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>123 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.23 </b></p>
<p><b>Dem_PostRunRequested() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_PostRunRequested</b></p>
<p> </p>
<p>(Boolean* IsRequested )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>IsRequested </p>
<p>Set to TRUE:  In case the Dem needs more time to finish NvRAM related </p>
<p>tasks. Shutdown is not possible without data loss. </p>
<p>Set to FALSE: Shutdown is possible. This value is only valid if all monitors are </p>
<p>disabled. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: is always returned with disabled Det </p>
<p>E_NOT_OK: is returned with enabled Det when an error is detected </p>
<p><b>Functional Description </b></p>
<p>- Extension to Autosar – </p>
<p>Test if the Dem can be shut down safely (without possible data loss). </p>
<p>This function must be polled after leaving RUN mode (all application monitors have been stopped). Due to </p>
<p>pending NvM activity, data loss is possible if Dem_Shutdown is called while this function still returns TRUE. </p>
<p>As soon as the NvM finishes writing the current Dem data block, this function will return FALSE. The time </p>
<p>window for unsafe shutdown only depends on the write time of a data block (up to several seconds in </p>
<p>unfortunate circumstances!) </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. It has to be called from the master partition. </p>
<p>Table 6-35  </p>
<p>Dem_PostRunRequested() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>124 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.24 </b></p>
<p><b>Dem_SetWIRStatus() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_SetWIRStatus</b></p>
<p> </p>
<p>(Dem_EventIdType EventId, Boolean WIRStatus )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an event by assigned EventId. </p>
<p>WIRStatus </p>
<p>Set to TRUE:  The WarningIndicatorRequest Bit of the DTC status for the </p>
<p>specified Event will be reported as “1”, independent to the current event </p>
<p>status. </p>
<p>Set to FALSE: The behavior of the WarningIndicatorRequest Bit in the DTC </p>
<p>status byte only depends on the event status. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: is returned if the new WIR status have been applied successfully </p>
<p>E_NOT_OK: is returned if the new WIR status have not been applied (e.g. </p>
<p>because of disabled ControlDTCSetting). The application should repeat the </p>
<p>request </p>
<p><b>Functional Description </b></p>
<p>This API can be used to override the status of the WarningIndicatorRequest Bit in the DTC status to “1”. </p>
<p>Note that overriding the WIR status does neither affect the internal event status nor any indicators related </p>
<p>to the event. Only the DTC status reported by APIs like Dem_GetStatusOfDTC (et al.) or the DT Status </p>
<p>Changed callbacks are affected. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant (for different EventId). </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context, with limitations. It has to be called from the </p>
<p>master partition. </p>
<p>Table 6-36  </p>
<p>Dem_SetWIRStatus () </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>125 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.25 </b></p>
<p><b>Dem_GetWIRStatus() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetWIRStatus</b></p>
<p> </p>
<p>(Dem_EventIdType EventId, Boolean* WIRStatus )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an event by assigned EventId. </p>
<p>WIRStatus </p>
<p>Set to TRUE:  The WarningIndicatorRequest Bit is currently user-controlled </p>
<p>and have been set by the API Dem_SetWIRStatus. </p>
<p>Set to FALSE: The WarningIndicatorRequest Bit is currently not user-</p>
<p>controlled. The WIR-Bit in the DTC status byte only depends on the event </p>
<p>status. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Request processed successfully. </p>
<p>E_NOT_OK: Invalid parameters passed to the function (only if Det is enabled). </p>
<p><b>Functional Description </b></p>
<p>- Extension to Autosar – </p>
<p>This API can be used to get the current overridden status of the WarningIndicatorRequest Bit in the DTC </p>
<p>status. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. It has to be called from the master partition. </p>
<p>Table 6-37  </p>
<p>Dem_GetWIRStatus () </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>126 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.26 </b></p>
<p><b>Dem_SetDTCSuppression() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_SetDTCSuppression</b></p>
<p> </p>
<p>(uint8 ClientId, boolean SuppressionStatus </p>
<p>)</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module </p>
<p>SuppressionStatus </p>
<p>TRUE: Suppress the DTC </p>
<p>FALSE: Lift suppression of the DTC </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Request was processed successfully </p>
<p>E_NOT_OK: No DTC was selected before the call or invalid parameters </p>
<p>passed to the function (only if Det is enabled) </p>
<p>DEM_WRONG_DTC: The selected DTC does not exist in the selected origin </p>
<p>or no single DTC has been selected </p>
<p>DEM_WRONG_DTCORIGIN: The selected DTC origin does not exist </p>
<p>DEM_PENDING: The requested operation is not yet completed. The caller </p>
<p>can keep polling. </p>
<p><b>Functional Description </b></p>
<p>This API requires a DTC selection by Dem_SelectDTC() before it can be called.  </p>
<p>The API suppresses the Event reporting the given DTCs such, that Dcm will not report the DTC. DTC </p>
<p>notification functions (e.g. to Dcm) are not called as well, preventing RoE responses. </p>
<p>Event reporting and notification (e.g. to FiM) are not affected and work as usual. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>When the call to this function interrupts the entry process, this function can suppress an event </p>
<p>that is in the process of being entered into the event memory. In that case the function returns </p>
<p>E_OK but the DTC is still reported to the Dcm. </p>
<p>In order to make sure the suppression works correctly, either </p>
<p><b>&gt; </b></p>
<p>clear DTCs after changing suppression </p>
<p><b>&gt; </b></p>
<p>change suppression of DTCs before the monitors start reporting </p>
<p><b>&gt; </b></p>
<p>prevent interruption of the Dem task by this function </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from SWC modules, with limitations. It has to be called from the </p>
<p>master partition. </p>
<p>Table 6-38  </p>
<p>Dem_SetDTCSuppression() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>127 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.27 </b></p>
<p><b>Dem_SetEventAvailable() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_SetEventAvailable</b></p>
<p> </p>
<p>(Dem_EventIdType EventId, Boolean </p>
<p>AvailableStatus)</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an event by assigned EventId. </p>
<p>AvailableStatus </p>
<p>TRUE: Set the Event to ‘available’ </p>
<p>FALSE: Set the Event to ‘not available’ </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Request processed successfully </p>
<p>E_NOT_OK: Event is already active (i.e. stored in event memory), or invalid </p>
<p>parameters passed to the function (only if Det is enabled). </p>
<p><b>Functional Description </b></p>
<p>Setting an event to unavailable prevents all APIs from using this EventId.  </p>
<p>Event reporting and notification are not possible and the event will not be stored to the event memory.  </p>
<p>Events having bit 0 (TestFailed) or bit 3 (ConfirmedDTC) set, stored events and events requesting an </p>
<p>indicator cannot be set unavailable. </p>
<p>Normally, the availability setting is volatile, and this API must be called in each power cycle of the ECU. In </p>
<p>case the option DemAvailabilityStorage is active, the last state is persisted in NVRAM. Since NVRAM is </p>
<p>restored between PreInit and Init, this API cannot be called before full initialization when using this option.  </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different EventId. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>Conditional [DemAvailabilityStorage == false]: This API may be called before full initialization </p>
<p>(after Dem_MasterPreInit). </p>
<p><b>&gt; </b></p>
<p>Before full initialization, the API cannot verify if the preconditions mentioned (CDTC not set, </p>
<p>etc.) because the relevant information is not yet restored from NvRam. Therefore, event </p>
<p>availability will change unconditionally before full initialization, but stored DTCs will still appear </p>
<p>in the diagnostic responses. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context, with limitations. It has to be called from the </p>
<p>master partition. </p>
<p>Table 6-39  </p>
<p>Dem_SetEventAvailable() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>128 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.28 </b></p>
<p><b>Dem_ClearDTC() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_ClearDTC</b></p>
<p> </p>
<p>( uint8 ClientId )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: clearing has completed, the requested DTC(s) are reset. </p>
<p>DEM_WRONG_DTC: the requested DTC is not valid in the context of </p>
<p>DTCFormat and DTCOrigin. </p>
<p>DEM_WRONG_DTCORIGIN: the requested DTC origin is not available in the </p>
<p>context of DTCFormat. </p>
<p>DEM_CLEAR_FAILED: the clear operation could not be started. </p>
<p>DEM_PENDING: the clear operation was started and is currently processed to </p>
<p>completion. </p>
<p>DEM_BUSY: the clear operation is busy serving a different client. </p>
<p>DEM_CLEAR_MEMORY_ERROR: (Since AR4.2.1) The clear operation has </p>
<p>completed in RAM, but synchronization to NVRAM has failed. </p>
<p><b>Functional Description </b></p>
<p>Requires a prior call to Dem_SelectDTC to choose the DTC or DTC group to clear. </p>
<p>Clears the stored event data from the event memory, resets the event status byte and de-bounce state. </p>
<p>There is a variety of configuration settings that further control the behavior of this function: </p>
<p>&gt; </p>
<p>see DemClearDTCBehavior to control what part of non-volatile write back must have completed before </p>
<p>this function returns E_OK </p>
<p>&gt; </p>
<p>Init monitor functions are called when an event is cleared, after clearing the event but before returning </p>
<p>OK to the tester </p>
<p>&gt; </p>
<p>If an event does not allow clearing (see CBClrEvt_&lt;EventName&gt;()), Init monitor callbacks are called </p>
<p>nonetheless. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. It has to be called from the master partition. </p>
<p>Table 6-40  </p>
<p>Dem_ClearDTC() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>129 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.29 </b></p>
<p><b>Dem_RequestNvSynchronization() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_RequestNvSynchronization</b></p>
<p> </p>
<p>( void )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>N/A </p>
<p>N/A </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Request processed successfully </p>
<p>E_NOT_OK: Request not processed due to errors, e.g. not initialized </p>
<p><b>Functional Description </b></p>
<p>This function can be used to request synchronization with the NV memory.  </p>
<p>Following the call to this API, the Dem module will write back all modified NV blocks to the backing storage. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>The write process will take a long time (depending on the ECU load, NV subsystem and </p>
<p>configuration size, it can take multiple seconds) </p>
<p><b>&gt; </b></p>
<p>Only modifications up to the call to this API are taken into account. </p>
<p><b>&gt; </b></p>
<p>There is no indication when everything was written. The Dem still requires a proper shutdown </p>
<p>procedure even when this API is used. </p>
<p><b>&gt; </b></p>
<p>If the Dem shuts down while synchronizing the NV content, pending changes are still written </p>
<p>during NvM_WriteAll so no data is lost. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. It has to be called from the master partition. </p>
<p><b>&gt; </b></p>
<p>Although this function is mapped to a port interface, it is safe for use from BSW or CDD </p>
<p>context. </p>
<p>Table 6-41  </p>
<p>Dem_RequestNvSynchronization() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>130 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.30 </b></p>
<p><b>Dem_GetDebouncingOfEvent() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetDebouncingOfEvent</b></p>
<p> </p>
<p>( Dem_EventIdType EventId, </p>
<p>Dem_DebouncingStateType* DebouncingState )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an event by assigned EventId. </p>
<p>DebouncingState </p>
<p>Debouncing state of event.  </p>
<p>Multiple bits can be set depending on current FDC of the event: </p>
<p>DEM_TEMPORARILY_DEFECTIVE (Bit 0): Temporarily Defective </p>
<p>(corresponds to 0 &lt; FDC &lt; 127) </p>
<p>DEM_FINALLY_DEFECTIVE (Bit 1): Finally Defective </p>
<p>(corresponds FDC = 127) </p>
<p>DEM_TEMPORARILY_HEALED (Bit 2): Temporarily Healed </p>
<p>(corresponds to -128 &lt; FDC &lt; 0) </p>
<p>DEM_TEST_COMPLETE (Bit 3): Test Complete </p>
<p>(corresponds to FDC = -128 or FDC = 127) </p>
<p>DEM_DTR_UPDATE (Bit 4): DTR Update (= Test Complete &amp;&amp; enable and </p>
<p>storage conditions of event fulfilled) </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Operation was successful </p>
<p>E_NOT_OK: Operation failed </p>
<p><b>Functional Description </b></p>
<p>Returns the de-bouncing state for the given event.  </p>
<p>This function shall not be used for events with monitor internal de-bouncing. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-42  </p>
<p>Dem_GetDebouncingOfEvent() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>131 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.31 </b></p>
<p><b>Dem_SelectDTC() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_SelectDTC</b></p>
<p> </p>
<p>( uint8 ClientId, uint32 DTC, </p>
<p>Dem_DTCFormatTypeDTCFormat, Dem_DTCOriginType DTCOrigin )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p>DTC </p>
<p>Defines the DTC in respective format that shall be selected in the event </p>
<p>memory. If the DTC fits to a DTC group number, all DTCs of the group shall be </p>
<p>selected. </p>
<p>DTCFormat </p>
<p>Defines the input format of the provided DTC value. </p>
<p>DEM_DTC_FORMAT_UDS:  select UDS DTCs </p>
<p>DEM_DTC_FORMAT_OBD:  select OBD DTCs </p>
<p>DEM_DTC_FORMAT_J1939:  select J1939 DTCs </p>
<p>DTCOrigin </p>
<p>This parameter is used to select the event memory. </p>
<p>DEM_DTC_ORIGIN_PRIMARY_MEMORY: Event information located in the </p>
<p>primary memory. </p>
<p>DEM_DTC_ORIGIN_SECONDARY_MEMORY: Event information located in </p>
<p>the secondary memory. </p>
<p>DEM_DTC_ORIGIN_PERMANENT_MEMORY: Event information located in </p>
<p>the permanent memory. </p>
<p>DEM_DTC_ORIGIN_MIRROR_MEMORY: Event information located in the </p>
<p>mirror memory </p>
<p>DEM_DTC_ORIGIN_OBD_RELEVANT_MEMORY: Same effect as for </p>
<p>DEM_DTC_ORIGIN_PRIMARY_MEMORY. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Selection processed successfully. </p>
<p>E_NOT_OK: Invalid parameters passed to the function (only if Det is enabled). </p>
<p><b>Functional Description </b></p>
<p>Selects a DTC or group of DTC.  </p>
<p>This is a preparation step for other APIs that work on DTCs or a DTC group.  </p>
<p>Whether the combination of parameter values of the selection is reasonable depends on the subsequent </p>
<p>API call. All applicable errors with respect to the DTC selected are returned by the respective API. E.g. </p>
<p>Dem_ClearDTC will return the appropriate return code if the DTC number is not available, or a DTC group </p>
<p>was correctly identified but prohibited from being cleared. </p>
<p>It is prohibited to select a DTC for a client during the execution of an asynchronous operation (e.g. </p>
<p>Dem_ClearDTC(), Dem_J1939DcmClearDTC(), Dem_DisableDTCRecordUpdate()). Selecting a DTC will </p>
<p>be permitted as soon as the asynchronous operation is finished, but before the final result is retrieved.  </p>
<p>The DTC record update will be enabled for the selected DTC if it was disabled before. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>132 </p>
<p>based on template version 5.0.0 </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>DTC format ‘DEM_DTC_FORMAT_OBD’ is not supported while selecting a single DTC. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. It has to be called from the master partition. </p>
<p>Table 6-43  </p>
<p>Dem_SelectDTC() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>133 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.32 </b></p>
<p><b>Dem_GetDTCSelectionResult() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetDTCSelectionResult</b></p>
<p> </p>
<p>( uint8 ClientId )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: The DTC select parameter check is successful and the requested DTC </p>
<p>or group of DTC in the selected origin is selected for further operations. </p>
<p>E_NOT_OK: No DTC was selected before the call. </p>
<p>DEM_WRONG_DTC: The selected DTC does not exist in the selected origin. </p>
<p>DEM_WRONG_DTCORIGIN: The selected DTC origin does not exist. </p>
<p>DEM_PENDING: The requested operation is not yet completed. The caller </p>
<p>can keep polling. </p>
<p><b>Functional Description </b></p>
<p>This function requires a DTC selection by Dem_SelectDTC() before it can be called. </p>
<p>Use this API to check if a DTC or DTC group is supported by the Dem configuration. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. It has to be called from the master partition. </p>
<p>Table 6-44  </p>
<p>Dem_GetDTCSelectionResult() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>134 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.33 </b></p>
<p><b>Dem_GetEventIdOfDTC() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetEventIdOfDTC</b></p>
<p> </p>
<p>( uint8 ClientId, Dem_EventIdType* EventId )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p>EventId </p>
<p>This parameter receives the EventId of the requested DTC. If the return value </p>
<p>of the function call is other than E_OK this parameter does not contain valid </p>
<p>data.  </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: The EventId of the selected DTC was stored in EventId. </p>
<p>E_NOT_OK: No DTC was selected before the call. </p>
<p>DEM_WRONG_DTC: The selected DTC does not exist in the selected origin </p>
<p>or no single DTC has been selected </p>
<p>DEM_WRONG_DTCORIGIN: The selected DTC origin does not exist. </p>
<p>DEM_PENDING: The requested operation is not yet completed. The caller </p>
<p>can keep polling. </p>
<p><b>Functional Description </b></p>
<p>- Extension to Autosar – </p>
<p>This function requires a DTC selection by Dem_SelectDTC() before it can be called. </p>
<p>Gets the EventId of a DTC. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. It has to be called from the master partition. </p>
<p>Table 6-45  </p>
<p>Dem_GetEventIdOfDTC() </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>135 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.6.34 </b></p>
<p><b>Dem_GetDTCSuppression() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetDTCSuppression</b></p>
<p> </p>
<p>(uint8 ClientId, boolean *SuppressionStatus </p>
<p>)</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module </p>
<p>SuppressionStatus </p>
<p>This parameter receives the current suppression state of the DTC. If the return </p>
<p>value of the function call is other than E_OK this parameter does not contain </p>
<p>valid data. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: The suppression state of the DTC was stored in SuppressionStatus </p>
<p>E_NOT_OK: No DTC was selected before the call or invalid parameters </p>
<p>passed to the function (only if Det is enabled) </p>
<p>DEM_WRONG_DTC: The selected DTC does not exist in the selected origin </p>
<p>or no single DTC has been selected </p>
<p>DEM_WRONG_DTCORIGIN: The selected DTC origin does not exist </p>
<p>DEM_PENDING: The requested operation is not yet completed. The caller </p>
<p>can keep polling. </p>
<p><b>Functional Description </b></p>
<p>This API requires a DTC selection by Dem_SelectDTC() before it can be called.  </p>
<p>The API retrieves the current suppression state of a DTC. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from SWC modules, with limitations. It has to be called from the </p>
<p>master partition. </p>
<p>Table 6-46  </p>
<p>Dem_GetDTCSuppression() </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>136 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.7 </b></p>
<p><b>Interface BSW </b></p>
<p><b>6.2.7.1 </b></p>
<p><b>Dem_ReportErrorStatus() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>Dem_ReportErrorStatus</b></p>
<p> </p>
<p>( Dem_EventIdType EventId, Dem_EventStatusType </p>
<p>EventStatus )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>Identification of an event by assigned EventId. </p>
<p>EventStatus </p>
<p>Monitor test result </p>
<p>DEM_EVENT_STATUS_PASSED: monitor reports a qualified passed test </p>
<p>result  </p>
<p>DEM_EVENT_STATUS_FAILED: monitor reports a qualified failed test result </p>
<p>DEM_EVENT_STATUS_PREPASSED: monitor reports a passed test result </p>
<p>DEM_EVENT_STATUS_PREFAILED: monitor reports a failed test result </p>
<p>DEM_EVENT_STATUS_PASSED_CONDITIONS_NOT_FULFILLED: monitor </p>
<p>reports a qualified passed test result when similar conditions are not fulfilled </p>
<p>DEM_EVENT_STATUS_FAILED_CONDITIONS_NOT_FULFILLED: monitor </p>
<p>reports a qualified failed test result when similar conditions are not fulfilled </p>
<p>DEM_EVENT_STATUS_PREPASSED_CONDITIONS_NOT_FULFILLED: </p>
<p>monitor reports a passed test result when similar conditions are not fulfilled </p>
<p>DEM_EVENT_STATUS_PREFAILED_CONDITIONS_NOT_FULFILLED: </p>
<p>monitor reports a failed test result when similar conditions are not fulfilled </p>
<p>DEM_EVENT_STATUS_FDC_THRESHOLD_REACHED: </p>
<p>monitor reports that FDC exceeds the storage threshold </p>
<p><b>Return code </b></p>
<p>void </p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>- Extension to Autosar – </p>
<p>BSW API to report a monitor result. </p>
<p>Deprecated API; use Dem_SetEventStatus() instead. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant (for different EventId). </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. It has to be called from the respective satellite </p>
<p>partition. </p>
<p>Table 6-47  </p>
<p>Dem_ReportErrorStatus() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>137 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8 </b></p>
<p><b>Interface Dcm </b></p>
<p><b>6.2.8.1 </b></p>
<p><b>Dem_SetDTCFilter() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_SetDTCFilter</b></p>
<p> </p>
<p>( uint8 ClientId, uint8 DTCStatusMask, </p>
<p>Dem_DTCFormatType DTCFormat, Dem_DTCOriginType DTCOrigin, boolean </p>
<p>FilterWithSeverity, Dem_DTCSeverityType DTCSeverityMask, boolean </p>
<p>FilterForFaultDetectionCounter )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p>DTCStatusMask </p>
<p>Status byte mask for DTC status byte filtering </p>
<p>0x00: deactivate the status-byte filtering to report all supported DTCs </p>
<p>0x01… 0xFF: status byte mask according to ISO14229-1 to filter for DTCs </p>
<p>with at least one status bit set matching this status byte mask. </p>
<p>The mask values 0x04, 0x08 and 0x0C will filter in chronologic order. </p>
<p>DTCFormat </p>
<p>Defines the output-format of the requested DTC values for the sub-sequent </p>
<p>API calls. </p>
<p>DEM_DTC_FORMAT_OBD: report DTC in OBD format </p>
<p>DEM_DTC_FORMAT_UDS: report DTC in UDS format </p>
<p>DEM_DTC_FORMAT_J1939: not allowed  </p>
<p>DTCOrigin </p>
<p>If the Dem supports more than one event memory this parameter is used to </p>
<p>select the source memory the DTCs shall be read from. </p>
<p>DEM_DTC_ORIGIN_PRIMARY_MEMORY: event information located in the </p>
<p>primary memory  </p>
<p>DEM_DTC_ORIGIN_SECONDARY_MEMORY: event information located in </p>
<p>the secondary memory </p>
<p>DEM_DTC_ORIGIN_PERMANENT_MEMORY: event information located in </p>
<p>the permanent memory </p>
<p>DEM_DTC_ORIGIN_MIRROR_MEMORY: event information located in the </p>
<p>mirror memory </p>
<p>DEM_DTC_ORIGIN_OBD_RELEVANT_MEMORY: Only OBD relevant DTCs </p>
<p>in primary memory are taken into account.  </p>
<p>FilterWithSeverity </p>
<p>This flag defines whether severity information (ref. to parameter below) shall </p>
<p>be used for filtering. This is to allow for coexistence of DTCs with and without </p>
<p>severity information. </p>
<p>DTCSeverityMask </p>
<p>This parameter contains the DTCSeverityMask according to ISO14229-1. </p>
<p>Only evaluated if FilterWithSeverity == TRUE. </p>
<p>FilterForFaultDetect</p>
<p>ionCounter </p>
<p>This flag defines whether the fault detection counter information shall be used </p>
<p>for filtering or not. If fault detection counter information is filter criteria, only </p>
<p>those DTCs with a fault detection counter value between 1 and 0x7E will be </p>
<p>reported. </p>
<p>Note: If the event does not use Dem internal de-bouncing, the Dem will </p>
<p>request this information via GetFaultDetectionCounter. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>Status of the operation to (re-)set a DTC filter. </p>
<p>E_OK: filter was accepted </p>
<p>E_NOT_OK: filter was not accepted </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>138 </p>
<p>based on template version 5.0.0 </p>
<p><b>Functional Description </b></p>
<p>Initialize the DTC filter with the given criteria. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled. </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-48  </p>
<p>Dem_SetDTCFilter() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>139 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.2 </b></p>
<p><b>Dem_GetNumberOfFilteredDTC() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetNumberOfFilteredDTC</b></p>
<p> </p>
<p>( uint8 ClientId, uint16* </p>
<p>NumberOfFilteredDTC )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p>NumberOfFilteredDTC </p>
<p>Receives the number of DTCs matching the defined filter criteria. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: a valid number of DTC was calculated </p>
<p>E_NOT_OK: No Filter was selected before the call. </p>
<p>DEM_PENDING: The requested operation is not yet completed. The caller </p>
<p>can keep polling. </p>
<p><b>Functional Description </b></p>
<p>Returns the number of DTCs matching the filter criteria. </p>
<p>This function requires setting a DTC Filter by Dem_SetDTCFilter() before it can be called. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled.  </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-49  </p>
<p>Dem_GetNumberOfFilteredDTC() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>140 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.3 </b></p>
<p><b>Dem_GetNextFilteredDTC() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Dem_GetNextFilteredDTC</b></p>
<p> </p>
<p>(uint8 ClientId, uint32* DTC, uint8* </p>
<p>DTCStatus )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p>DTC </p>
<p>Receives the DTC value in respective format of the filter returned by this </p>
<p>function. If the return value of the function is other than DEM_FILTERED_OK </p>
<p>this parameter does not contain valid data. </p>
<p>DTCStatus </p>
<p>This parameter receives the status information of the filtered DTC.  </p>
<p>It follows the format as defined in ISO14229-1. </p>
<p>If the return value of the function call is other than DEM_FILTERED_OK this </p>
<p>parameter does not contain valid data. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: DTC number and status are valid </p>
<p>E_NOT_OK: No Filter was selected before the call. </p>
<p>DEM_NO_SUCH_ELEMENT: no (further) DTC matches the filter criteria – end </p>
<p>of iteration </p>
<p>DEM_PENDING: The requested operation is not yet completed. The caller </p>
<p>can keep polling. </p>
<p><b>Functional Description </b></p>
<p>Gets the next filtered DTC and its status. </p>
<p>This function requires setting a DTC Filter by Dem_SetDTCFilter() before it can be called. </p>
<p>DEM_PENDING is not returned for OBD related requests. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled.  </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-50  </p>
<p>Dem_GetNextFilteredDTC() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>141 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.4 </b></p>
<p><b>Dem_GetNextFilteredDTCAndFDC() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetNextFilteredDTCAndFDC</b></p>
<p> </p>
<p>( uint8 ClientId, uint32* DTC, </p>
<p>sint8* DTCFaultDetectionCounter )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p>DTC </p>
<p>Receives the DTC value in respective format of the filter returned by this </p>
<p>function. If the return value of the function is other than E_OK this parameter </p>
<p>does not contain valid data. </p>
<p>DTCFaultDetectionCou</p>
<p>nter </p>
<p>This parameter receives the Fault Detection Counter information of the </p>
<p>requested DTC. If the return value of the function call is other than E_OK this </p>
<p>parameter does not contain valid data. </p>
<p>-128dec…127dec  / PASSED…FAILED according to ISO 14229-1 </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: DTC number and FDC are valid </p>
<p>E_NOT_OK: No Filter was selected before the call. </p>
<p>DEM_NO_SUCH_ELEMENT: no DTC can be identified (iteration end) </p>
<p>DEM_PENDING: The requested operation is not yet completed. The caller </p>
<p>can keep polling. </p>
<p><b>Functional Description </b></p>
<p>Gets the current DTC and its associated Fault Detection Counter (FDC) from the Dem. </p>
<p>This function requires setting a DTC Filter by Dem_SetDTCFilter() before it can be called. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is aynchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled.  </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-51  </p>
<p>Dem_GetNextFilteredDTCAndFDC() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>142 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.5 </b></p>
<p><b>Dem_GetNextFilteredDTCAndSeverity() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Dem_GetNextFilteredDTCAndSeverity</b></p>
<p> </p>
<p>( uint8 ClientId, uint32* DTC, </p>
<p>uint8* DTCStatus, Dem_DTCSeverityType* DTCSeverity, uint8* DTCFunctionalUnit )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p>DTC </p>
<p>Receives the DTC value in respective format of the filter returned by this </p>
<p>function. If the return value of the function is other than E_OK this parameter </p>
<p>does not contain valid data. </p>
<p>DTCStatus </p>
<p>Receives the status value returned by the function. If the return value of the </p>
<p>function is other than E_OK this parameter does not contain valid data. </p>
<p>DTCSeverity </p>
<p>Receives the severity value returned by the function. If the return value of the </p>
<p>function is other than E_OK this parameter does not contain valid data. </p>
<p>DTCFunctionalUnit </p>
<p>Receives the functional unit value returned by the function. If the return value </p>
<p>of the function is other than E_OK this parameter does not contain valid data. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: DTC number and all other out parameter are valid </p>
<p>E_NOT_OK: No Filter was selected before the call. </p>
<p>DEM_NO_SUCH_ELEMENT: no DTC can be identified (iteration end) </p>
<p>DEM_PENDING: The requested operation is not yet completed. The caller </p>
<p>can keep polling. </p>
<p><b>Functional Description </b></p>
<p>Gets the current DTC and its Severity from the Dem. </p>
<p>This function requires setting a DTC Filter by Dem_SetDTCFilter() before it can be called. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled.  </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-52  </p>
<p>Dem_GetNextFilteredDTCAndSeverity() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>143 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.6 </b></p>
<p><b>Dem_SetFreezeFrameRecordFilter() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Dem_SetFreezeFrameRecordFilter</b></p>
<p> </p>
<p>(uint8 ClientId, </p>
<p>Dem_DTCFormatType DTCFormat, uint16* NumberOfFilteredRecords )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p>DTCFormat </p>
<p>Defines the output-format of the requested DTC values for the sub-sequent </p>
<p>API calls. </p>
<p>DEM_DTC_FORMAT_OBD: report DTC in OBD format </p>
<p>DEM_DTC_FORMAT_UDS: report DTC in UDS format  </p>
<p>DEM_DTC_FORMAT_J1939: not allowed </p>
<p>NumberOfFilteredReco</p>
<p>rds </p>
<p>Receives the number of freeze frame records currently stored in the event </p>
<p>memory. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>Status of the operation to (re-)set a freeze frame record filter. </p>
<p>E_OK: filter was accepted </p>
<p>E_NOT_OK: filter was not accepted </p>
<p><b>Functional Description </b></p>
<p>Initialize the DTC record filter with the given criteria. </p>
<p>Using this function all currently stored snapshot records are counted and the internal state machine is </p>
<p>initialized to read a copy of their data (see Dem_GetNextFilteredRecord()). The number of snapshot </p>
<p>records is not fixed. It can change after this function has returned, so Dem_GetNextFilteredRecord()  can </p>
<p>actually return fewer records. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled.  </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-53  </p>
<p>Dem_SetFreezeFrameRecordFilter() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>144 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.7 </b></p>
<p><b>Dem_GetNextFilteredRecord() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Dem_GetNextFilteredRecord</b></p>
<p> </p>
<p>( uint8 ClientId, uint32* DTC, uint8* </p>
<p>RecordNumber )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p>DTC </p>
<p>Receives the DTC value in respective format of the filter returned by this </p>
<p>function. If the return value of the function is other than E_OK this parameter </p>
<p>does not contain valid data.  </p>
<p>RecordNumber </p>
<p>Receives the freeze frame record number of the reported DTC. If the return </p>
<p>value of the function is other than E_OK this parameter does not contain valid </p>
<p>data. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: returned DTC number and RecordNumber are valid </p>
<p>E_NOT_OK: No Filter was selected before the call. </p>
<p>DEM_NO_SUCH_ELEMENT: no further matching records are available </p>
<p>DEM_PENDING: The requested operation is not yet completed. The caller </p>
<p>can keep polling. </p>
<p><b>Functional Description </b></p>
<p>Gets the next freeze frame/ snapshot record number and its associated DTC stored in the event memory. </p>
<p>This function requires setting a Record Filter by Dem_SetFreezeFrameRecordFilter() before it can be </p>
<p>called. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled.  </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-54  </p>
<p>Dem_GetNextFilteredRecord() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>145 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.8 </b></p>
<p><b>Dem_GetStatusOfDTC() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetStatusOfDTC</b></p>
<p> </p>
<p>( uint8 ClientId, uint8* DTCStatus )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p>DTCStatus </p>
<p>This parameter receives the status information of the requested DTC. If the </p>
<p>return value of the function call is other than E_OK this parameter does not </p>
<p>contain valid data. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: The status information of the selected DTC was stored in DTCStatus </p>
<p>E_NOT_OK: No DTC was selected before the call. </p>
<p>DEM_WRONG_DTC: The selected DTC does not exist in the selected origin </p>
<p>OR a ‘DTC group’ or ‘all DTCs’ is selected OR the DTC is suppressed </p>
<p>DEM_WRONG_DTCORIGIN: The selected DTC origin does not exist </p>
<p>DEM_PENDING: The requested operation is not yet completed. The caller </p>
<p>can keep polling. </p>
<p>DEM_NO_SUCH_ELEMENT: The selected DTC does not support a status. </p>
<p><b>Functional Description </b></p>
<p>This function requires a DTC selection by Dem_SelectDTC() before it can be called. </p>
<p>Gets the current UDS status of a DTC. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled.  </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-55  </p>
<p>Dem_GetStatusOfDTC() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>146 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.9 </b></p>
<p><b>Dem_GetDTCStatusAvailabilityMask() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetDTCStatusAvailabilityMask</b></p>
<p> </p>
<p>( uint8 ClientId, uint8* </p>
<p>DTCStatusMask )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p>DTCStatusMask </p>
<p>The value DTCStatusMask indicates the supported DTC status bits from the </p>
<p>Dem. All supported information is indicated by setting the corresponding </p>
<p>status bit to 1. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: get of DTC status mask was successful </p>
<p>E_NOT_OK: get of DTC status mask failed </p>
<p><b>Functional Description </b></p>
<p>Gets the DTC status availability mask. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled.  </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-56  </p>
<p>Dem_GetDTCStatusAvailabilityMask() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>147 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.10 </b></p>
<p><b>Dem_GetDTCByOccurrenceTime() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetDTCByOccurrenceTime</b></p>
<p> </p>
<p>( uint8 ClientId, Dem_DTCRequestType </p>
<p>DTCRequest, uint32* DTC )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p>DTCRequest </p>
<p>This parameter defines the request type of the DTC. </p>
<p>DEM_FIRST_DET_CONFIRMED_DTC: first detected confirmed DTC </p>
<p>requested </p>
<p>DEM_MOST_RECENT_FAILED_DTC: most recent failed DTC requested </p>
<p>DEM_MOST_REC_DET_CONFIRMED_DTC: most recently detected </p>
<p>confirmed DTC requested </p>
<p>DEM_FIRST_FAILED_DTC: first failed DTC requested  </p>
<p>DTC </p>
<p>Receives the DTC value in UDS format returned by the function. If the return </p>
<p>value of the function is other than E_OK this parameter does not contain valid </p>
<p>data. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: the function returns a valid DTC </p>
<p>E_NOT_OK: the call was not successful (e.g. not supported by configuration) </p>
<p>DEM_NO_SUCH_ELEMENT: The requested DTC is not stored </p>
<p><b>Functional Description </b></p>
<p>Gets the DTC by occurrence time. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled.  </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-57  </p>
<p>Dem_GetDTCByOccurrenceTime() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>148 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.11 </b></p>
<p><b>Dem_GetTranslationType() </b></p>
<p><b>Prototype </b></p>
<p>Dem_DTCTranslationFormatType</p>
<p> </p>
<p><b>Dem_GetTranslationType</b></p>
<p> </p>
<p>( uint8 ClientId )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p><b>Return code </b></p>
<p>Dem_DTCTranslationFo</p>
<p>rmatType </p>
<p>Returns the configured DTC translation format. A combination of different DTC </p>
<p>formats is not possible. </p>
<p>DEM_DTC_TRANSLATION_ISO15031_6: DTC is formatted according </p>
<p>ISO15031-6 </p>
<p>DEM_DTC_TRANSLATION_ISO14229_1: DTC is formatted according </p>
<p>ISO14229-1 </p>
<p>DEM_DTC_TRANSLATION_SAEJ1939_73: DTC is formatted according </p>
<p>SAE1939-73 </p>
<p>DEM_DTC_TRANSLATION_ISO11992_4: DTC is formatted according </p>
<p>ISO11992-4  </p>
<p>DEM_DTC_TRANSLATION_J2012DA_FORMAT_04: DTC is formatted </p>
<p>according SAE_J2012-DA_DTCFormat_04 </p>
<p><b>Functional Description </b></p>
<p>Gets the supported DTC formats of the ECU. </p>
<p>The supported formats are configured via DemTypeOfDTCSupported. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled. </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-58  </p>
<p>Dem_GetTranslationType() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>149 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.12 </b></p>
<p><b>Dem_GetSeverityOfDTC() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>Dem_GetSeverityOfDTC</b></p>
<p> </p>
<p>( uint8 ClientId, Dem_DTCSeverityType* </p>
<p>DTCSeverity )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p>DTCSeverity </p>
<p>This parameter receives the severity of the requested DTC. If the return value </p>
<p>of the function call is other than E_OK this parameter does not contain valid </p>
<p>data. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: The severity information of the selected DTC was stored in </p>
<p>DTCSeverity. If no severity is configured for the selected DTC the returned </p>
<p>value for DTCSeverity is DEM_DTC_SEV_NO_SEVERITY. </p>
<p>E_NOT_OK: No DTC was selected before the call  </p>
<p>DEM_WRONG_DTC: The selected DTC does not exist in the selected origin </p>
<p>or the DTC is suppressed or no single DTC has been selected </p>
<p>DEM_WRONG_DTCORIGIN: The selected DTC origin does not exist </p>
<p>DEM_PENDING: The requested operation is not yet completed. The caller </p>
<p>can keep polling. </p>
<p><b>Functional Description </b></p>
<p>This function requires a DTC selection by Dem_SelectDTC() before it can be called. </p>
<p>Gets the severity of the requested DTC. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled.  </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-59  </p>
<p>Dem_GetSeverityOfDTC() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>150 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.13 </b></p>
<p><b>Dem_GetFunctionalUnitOfDTC() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetFunctionalUnitOfDTC</b></p>
<p> </p>
<p>( uint8 ClientId, uint8* </p>
<p>DTCFunctionalUnit )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p>DTCFunctionalUnit </p>
<p>This parameter receives the functional unit of the requested DTC. If the return </p>
<p>value of the function call is other than E_OK this parameter does not contain </p>
<p>valid data. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: The functional unit information of the selected DTC was stored in </p>
<p>DTCFunctionalUnit. If no functional unit is configured for the selected DTC the </p>
<p>value of DTCFunctionalUnit is set to 0x00. </p>
<p>E_NOT_OK: No DTC was selected before the call  </p>
<p>DEM_WRONG_DTC: The selected DTC does not exist in the selected origin </p>
<p>or the DTC is suppressed or no single DTC has been selected </p>
<p>DEM_WRONG_DTCORIGIN: The selected DTC origin does not exist </p>
<p>DEM_PENDING: The requested operation is not yet completed. The caller </p>
<p>can keep polling. </p>
<p><b>Functional Description </b></p>
<p>This function requires a DTC selection by Dem_SelectDTC() before it can be called. </p>
<p>Gets the functional unit of the requested DTC. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled.  </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-60  </p>
<p>Dem_GetFunctionalUnitOfDTC() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>151 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.14 </b></p>
<p><b>Dem_DisableDTCRecordUpdate() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_DisableDTCRecordUpdate</b></p>
<p> </p>
<p>( uint8 ClientId )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: entry is locked, read APIs may be called now  </p>
<p>E_NOT_OK: No DTC was selected before the call. </p>
<p>DEM_WRONG_DTC: The selected DTC in the selected format does not exist </p>
<p>in the selected origin or the DTC is suppressed </p>
<p>DEM_WRONG_DTCORIGIN: The selected DTC origin does not exist </p>
<p>DEM_PENDING: The requested operation is not yet completed. The caller </p>
<p>can keep polling. </p>
<p><b>Functional Description </b></p>
<p>This function requires a DTC selection by Dem_SelectDTC() before it can be called. </p>
<p>Disables the event memory update of a specific DTC (only one at a time) so it can be read out by the Dcm. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled.  </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-61  </p>
<p>Dem_DisableDTCRecordUpdate() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>152 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.15 </b></p>
<p><b>Dem_EnableDTCRecordUpdate() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_EnableDTCRecordUpdate</b></p>
<p> </p>
<p>( uint8 ClientId )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Enabling the memory update was successful.  </p>
<p>E_NOT_OK: Enabling was not successful (e.g. due to an invalid ClientId) </p>
<p><b>Functional Description </b></p>
<p>Enables the event memory update of the DTC disabled by Dem_DisableDTCRecordUpdate() before. </p>
<p>The arguments of a Dem_SelectDTC() call preceding this Dem_EnableDTCRecordUpdate() need not </p>
<p>match the arguments of the Dem_SelectDTC() call preceding Dem_DisableDTCRecordUpdate(). The </p>
<p>‘enable’ call will reverse the effects of the preceding ‘disable’ call. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled.  </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-62  </p>
<p>Dem_EnableDTCRecordUpdate() </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>153 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.16 </b></p>
<p><b>Dem_SelectFreezeFrameData() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_SelectFreezeFrameData</b></p>
<p> </p>
<p>( uint8 ClientId, uint8 RecordNumber )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p>RecordNumber </p>
<p>This parameter is a unique identifier for a freeze frame record as defined in </p>
<p>ISO15031-5 and ISO14229-1.  </p>
<p>The value 0x00 indicates the OBD freeze frame. </p>
<p>A value in range 0x01...0xFE selects a specific snapshot record </p>
<p>The value 0xFF selects all snapshot records. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Selection processed successfully. </p>
<p>E_NOT_OK: Invalid parameters passed to the function (only if Det is enabled). </p>
<p><b>Functional Description </b></p>
<p>Sets the filter to be used by Dem_GetNextFreezeFrameData() and </p>
<p>Dem_GetSizeOfFreezeFrameSelection().  </p>
<p>The DTC whose freeze frame/snapshot record data shall be read, was selected beforehand by </p>
<p>Dem_SelectDTC(). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled.  </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p><b>&gt; </b></p>
<p>With disabled Det, the return code is always E_OK </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-63  </p>
<p>Dem_SelectFreezeFrameData () </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>154 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.17 </b></p>
<p><b>Dem_GetNextFreezeFrameData() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetNextFreezeFrameData</b></p>
<p> </p>
<p>( uint8 ClientId, uint8* DestBuffer, </p>
<p>uint16* BufSize )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p>DestBuffer </p>
<p>This parameter contains a byte pointer that points to the buffer, to which the </p>
<p>freeze frame data record shall be written to.  </p>
<p>The format is: {RecordNumber, NumOfDIDs, DID[1], data[1], …, DID[N], </p>
<p>data[N]} </p>
<p>BufSize </p>
<p>When the function is called this parameter contains the maximum number of </p>
<p>data bytes that can be written to the buffer. </p>
<p>The function returns the actual number of written data bytes in this parameter. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Size and data were returned successfully. </p>
<p>E_NOT_OK: Missing call to Dem_SelectFreezeFrameData(). </p>
<p>DEM_NO_SUCH_ELEMENT: The requested record is not available. </p>
<p>DEM_BUFFER_TOO_SMALL: The destination buffer is too small. </p>
<p>DEM_PENDING: The requested operation is not yet completed. The caller </p>
<p>can keep polling. </p>
<p><b>Functional Description </b></p>
<p>Gets freeze frame/ snapshot record data by DTC. The function stores the data in the provided DestBuffer. If </p>
<p>the requested freeze frame is not currently stored, no bytes are written to DestBuffer and BufSize is set to </p>
<p>0. </p>
<p>This function requires a DTC selection by Dem_SelectDTC() and a record selection by </p>
<p>Dem_SelectFreezeFrameData() before it can be called.  </p>
<p>All applicable errors with respect to the selected DTC are already returned by </p>
<p>Dem_DisableDTCRecordUpdate() (which is a precondition for Dem_SelectFreezeFrameData()). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled.  </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-64  </p>
<p>Dem_GetFreezeFrameDataByDTC() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>155 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.18 </b></p>
<p><b>Dem_GetSizeOfFreezeFrameSelection() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetSizeOfFreezeFrameSelection</b></p>
<p> </p>
<p>( uint8 ClientId, uint16* </p>
<p>SizeOfFreezeFrame )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p>SizeOfFreezeFrame </p>
<p>Receive number of bytes in the requested freeze frame record. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Size returned successfully. </p>
<p>E_NOT_OK: Missing call to Dem_SelectFreezeFrameData(). </p>
<p>DEM_NO_SUCH_ELEMENT: The requested record is not available. </p>
<p>DEM_PENDING: The requested operation is not yet completed. The caller </p>
<p>can keep polling. </p>
<p><b>Functional Description </b></p>
<p>Get the size of the selected snapshot record. </p>
<p>This function requires a DTC selection by Dem_SelectDTC() and a record selection by </p>
<p>Dem_SelectFreezeFrameData() before it can be called.  </p>
<p>All applicable errors with respect to the selected DTC are already returned by </p>
<p>Dem_DisableDTCRecordUpdate() (which is a precondition for Dem_SelectFreezeFrameData()). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled.  </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-65  </p>
<p>Dem_GetSizeOfFreezeFrameByDTC() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>156 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.19 </b></p>
<p><b>Dem_SelectExtendedDataRecord() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_SelectExtendedDataRecord</b></p>
<p> </p>
<p>( uint8 ClientId, uint8 </p>
<p>ExtendedDataNumber )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p>ExtendedDataNumber </p>
<p>0x01...0xEF selects a specific extended data record.  </p>
<p>0xFE selects all emission related extended data records. </p>
<p>0xFF selects all extended data records </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Selection processed successfully. </p>
<p>E_NOT_OK: Invalid parameters passed to the function (only if Det is enabled). </p>
<p><b>Functional Description </b></p>
<p>Sets the filter to be used by Dem_GetNextExtendedDataRecord() and </p>
<p>Dem_GetSizeOfExtendedDataRecordSelection(). </p>
<p>The DTC whose extended data records shall be read, was selected beforehand by Dem_SelectDTC(). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled.  </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p><b>&gt; </b></p>
<p>With disabled Det, the return code is always E_OK </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-66  </p>
<p>Dem_SelectExtendedDataRecordBy() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>157 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.20 </b></p>
<p><b>Dem_GetNextExtendedDataRecord() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetNextExtendedDataRecord</b></p>
<p> </p>
<p>( uint8 ClientId, uint8* </p>
<p>DestBuffer, uint16* BufSize )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p>DestBuffer </p>
<p>This parameter contains a byte pointer that points to the buffer to which the </p>
<p>Extended Data shall be written.  </p>
<p>The format is [RecordNumber, data[0], data[1] … data[N]]  </p>
<p>BufSize </p>
<p>When the function is called this parameter contains the maximum number of </p>
<p>data bytes that can be written to the buffer. </p>
<p>The function returns the actual number of written data bytes in this parameter. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: data was found and returned </p>
<p>E_NOT_OK: Missing call to Dem_SelectExtendedDataRecord(). </p>
<p>DEM_NO_SUCH_ELEMENT: the requested record is not available </p>
<p>DEM_BUFFER_TOO_SMALL: the destination buffer is too small </p>
<p>DEM_PENDING: The requested operation is not yet completed. The caller </p>
<p>can keep polling. </p>
<p><b>Functional Description </b></p>
<p>Get the next selected extended data record. The function stores the data in the provided DestBuffer. If the </p>
<p>requested record is not currently stored, no bytes are written to DestBuffer and BufSize is set to 0. </p>
<p>This function requires a DTC selection by Dem_SelectDTC() and a record selection by </p>
<p>Dem_SelectExtendedDataRecord() before it can be called.  </p>
<p>All applicable errors with respect to the selected DTC are already returned by </p>
<p>Dem_DisableDTCRecordUpdate() (which is a precondition for Dem_SelectExtendedDataRecord()). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled.  </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-67  </p>
<p>Dem_GetNextExtendedDataRecord () </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>158 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.21 </b></p>
<p><b>Dem_GetSizeOfExtendedDataRecordSelection() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_GetSizeOfExtendedDataRecordSelection</b></p>
<p> </p>
<p>( uint8 ClientId, </p>
<p>uint16* SizeOfExtendedDataRecord )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p>SizeOfExtendedDataRe</p>
<p>cord </p>
<p>Receives the size of the requested data record </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: data was found and returned </p>
<p>E_NOT_OK: Missing call to Dem_SelectExtendedDataRecord(). </p>
<p>DEM_NO_SUCH_ELEMENT: the requested record is not available </p>
<p>DEM_PENDING: The requested operation is not yet completed. The caller </p>
<p>can keep polling. </p>
<p><b>Functional Description </b></p>
<p>Get the size of a formatted extended data record stored for a DTC. </p>
<p>This function requires a DTC selection by Dem_SelectDTC() and a record selection by </p>
<p>Dem_SelectExtendedDataRecord() before it can be called.  </p>
<p>All applicable errors with respect to the selected DTC are already returned by </p>
<p>Dem_DisableDTCRecordUpdate() (which is a precondition for Dem_SelectExtendedDataRecord()). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled.  </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-68  </p>
<p>Dem_GetSizeOfExtendedDataRecordByDTC() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>159 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.22 </b></p>
<p><b>Dem_DisableDTCSetting() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_DisableDTCSetting</b></p>
<p> </p>
<p>( uint8 ClientId )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: the DTCs setting is switched off. </p>
<p>E_NOT_OK: Invalid parameters passed to the function (only if Det is enabled). </p>
<p>DEM_PENDING: The requested operation is not yet completed. The caller </p>
<p>can keep polling. </p>
<p><b>Functional Description </b></p>
<p>Disables the setting (including update) of the status bits of all DTCs. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled. </p>
<p><b>&gt; </b></p>
<p>In this implementation the ‘ClientId’ value is ignored – each client disables all DTCs </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-69  </p>
<p>Dem_DisableDTCSetting() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>160 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.8.23 </b></p>
<p><b>Dem_EnableDTCSetting() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_EnableDTCSetting</b></p>
<p> </p>
<p>( uint8 ClientId )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ClientId </p>
<p>Unique client id, assigned to the instance of the calling module. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: the DTCs setting is switched on. </p>
<p>E_NOT_OK: Invalid parameters passed to the function (only if Det is enabled). </p>
<p>DEM_PENDING: The requested operation is not yet completed. The caller </p>
<p>can keep polling. </p>
<p><b>Functional Description </b></p>
<p>Enables the DTC setting for all DTCs </p>
<p>Changes to control DTC setting can get lost if they toggle change faster than the cycle time of the Dem </p>
<p>main function. See chapter 3.8 for further details. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant for different ClientIds. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportDcm’ is set to enabled.  </p>
<p><b>&gt; </b></p>
<p>In this implementation the ‘ClientId’ value is ignored – each client enables all DTCs </p>
<p><b>&gt; </b></p>
<p>This function is only callable from the master partition (see ch. 3.2) </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-70  </p>
<p>Dem_EnableDTCSetting() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>161 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.9 </b></p>
<p><b>Interface J1939Dcm </b></p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>Dependent on the licensed components of your delivery the interfaces listed in this </p>
<p>chapter may not be available in DEM.  </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p><b>6.2.9.1 </b></p>
<p><b>Dem_J1939DcmClearDTC() </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnClearDTCType</p>
<p> </p>
<p><b>Dem_J1939DcmClearDTC</b></p>
<p> </p>
<p>( Dem_J1939DcmSetClearFilterType </p>
<p>DTCTypeFilter, Dem_DTCOriginType DTCOrigin, uint8 NodeAddress )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>DTCTypeFilter </p>
<p>DEM_J1939DTC_CLEAR_ALL: Clears all Active DTCs               </p>
<p>DEM_J1939DTC_CLEAR_PREVIOUSLY_ACTIVE: Clears all previously </p>
<p>active DTCs </p>
<p>DEM_J1939DTC_CLEAR_ALL_AND_PREVIOUSLY_ACTIVE: Clears all </p>
<p>active and previously active DTCs </p>
<p>DTCOrigin </p>
<p>If the Dem supports more than one event memory, this parameter is used to </p>
<p>select the memory which shall be cleared. </p>
<p>DEM_DTC_ORIGIN_PRIMARY_MEMORY: event information located in the </p>
<p>primary memory  </p>
<p>DEM_DTC_ORIGIN_SECONDARY_MEMORY: event information located in </p>
<p>the secondary memory </p>
<p>NodeAddress </p>
<p>The network management node ID to be cleared.   </p>
<p><b>Return code </b></p>
<p>Dem_ReturnClearDTCTy</p>
<p>pe </p>
<p>E_OK: clearing has completed, the requested DTC(s) are reset. </p>
<p>DEM_WRONG_DTC: the requested DTC is not valid in the context of </p>
<p>DTCFormat and DTCOrigin. </p>
<p>DEM_WRONG_DTCORIGIN: the requested DTCOrigin is not available in the </p>
<p>context of DTCFormat. </p>
<p>DEM_CLEAR_FAILED: the clear operation could not be started. </p>
<p>DEM_PENDING: the clear operation was started and is currently processed to </p>
<p>completion. </p>
<p>DEM_BUSY: the clear operation is busy serving a different client. </p>
<p>DEM_CLEAR_MEMORY_ERROR: (Since AR4.2.1) The clear operation has </p>
<p>completed in RAM, but synchronization to NVRAM has failed. </p>
<p><b>Functional Description </b></p>
<p>Clears the J1939 DTCs only </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>162 </p>
<p>based on template version 5.0.0 </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportJ1939Dcm’ is set to enabled. </p>
<p>Table 6-71  </p>
<p>Dem_J1939DcmClearDTC() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>163 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.9.2 </b></p>
<p><b>Dem_J1939DcmFirstDTCwithLampStatus() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>Dem_J1939DcmFirstDTCwithLampStatus</b></p>
<p> </p>
<p>( uint8 NodeAddress )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>NodeAddress </p>
<p>The network management node ID to be filtered.  </p>
<p><b>Return code </b></p>
<p>void </p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>Initializes the filter mechanism to the first event in the primary memory </p>
<p> </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportJ1939Dcm’ is set to enabled. </p>
<p>Table 6-72  </p>
<p>Dem_J1939DcmFirstDTCwithLampStatus() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>164 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.9.3 </b></p>
<p><b>Dem_J1939DcmGetNextDTCwithLampStatus () </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnGetNextFilteredElementType</p>
<p> </p>
<p><b>Dem_J1939DcmGetNextDTCwithLampStatus </b></p>
<p> </p>
<p>( </p>
<p>J1939DcmLampStatusType LampStatus, uint32 J1939DTC, uint8 OccurrenceCounter )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>LampStatus </p>
<p>DTC specific lamp status </p>
<p>J1939DTC </p>
<p>J1939 DTC number </p>
<p>OccurrenceCounter </p>
<p>The DTC specific occurrence counter </p>
<p><b>Return code </b></p>
<p>Dem_ReturnGetNext-</p>
<p>FilteredElementType </p>
<p>DEM_FILTERED_OK: Returned next filtered element </p>
<p>DEM_FILTERED_NO_MATCHING_ELEMENT: No further element (matching </p>
<p>the filter criteria) found </p>
<p>DEM_FILTERED_BUFFER_TOO_SMALL: not used  </p>
<p><b>Functional Description </b></p>
<p>Gets the next filtered J1939 DTC for DM31 including current LampStatus </p>
<p> </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportJ1939Dcm’ is set to enabled. </p>
<p>Table 6-73  </p>
<p>Dem_J1939DcmGetNextDTCwithLampStatus () </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>165 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.9.4 </b></p>
<p><b>Dem_J1939DcmGetNextFilteredDTC() </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnGetNextFilteredElementType</p>
<p> </p>
<p><b>Dem_J1939DcmGetNextFilteredDTC</b></p>
<p> </p>
<p>(uint32 </p>
<p>J1939DTC, uint8 OccurenceCounter )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>J1939DTC </p>
<p>the J1939 DTC number </p>
<p>OccurenceCounter </p>
<p>the occurrence counter of the DTC </p>
<p><b>Return code </b></p>
<p>Dem_ReturnGetNext-</p>
<p>FilteredElementType </p>
<p>DEM_FILTERED_OK: Returned next filtered element </p>
<p>DEM_FILTERED_NO_MATCHING_ELEMENT: No further element (matching </p>
<p>the filter criteria) found </p>
<p>DEM_FILTERED_PENDING: The requested value is calculated </p>
<p>asynchronously and currently not available. The caller can retry later. </p>
<p>DEM_FILTERED_BUFFER_TOO_SMALL: not used   </p>
<p><b>Functional Description </b></p>
<p>Provides the next DTC that matches the filter criteria. </p>
<p> </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportJ1939Dcm’ is set to enabled. </p>
<p>Table 6-74  </p>
<p>Dem_J1939DcmGetNextFilteredDTC() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>166 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.9.5 </b></p>
<p><b>Dem_J1939DcmGetNextFreezeFrame() </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnGetNextFilteredElementType</p>
<p> </p>
<p><b>Dem_J1939DcmGetNextFreezeFrame</b></p>
<p> </p>
<p>( uint32 </p>
<p>J1939DTC, uint8 OccurrenceCounter , uint8 DestBuffer, uint8 BufSize )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>J1939DTC </p>
<p>J1939 DTC number </p>
<p>OccurrenceCounter </p>
<p>DTC specific occurrence counter </p>
<p>DestBuffer </p>
<p>Pointer to the buffer where the Freeze Frame data shall be copied to. </p>
<p>BufSize </p>
<p>in: size of the available buffer </p>
<p>out: number of bytes copied into the buffer </p>
<p><b>Return code </b></p>
<p>Dem_ReturnGetNext-</p>
<p>FilteredElementType </p>
<p>DEM_FILTERED_OK: Returned next filtered element </p>
<p>DEM_FILTERED_NO_MATCHING_ELEMENT: No further element (matching </p>
<p>the filter criteria) found </p>
<p>DEM_FILTERED_PENDING: The requested value is calculated </p>
<p>asynchronously and currently not available. The caller can retry later. </p>
<p>DEM_FILTERED_BUFFER_TOO_SMALL: Buffer in the BufSize parameter is </p>
<p>not huge enough   </p>
<p><b>Functional Description </b></p>
<p>Returns the next J1939DTC and Freeze Frame matching the filter criteria </p>
<p> </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportJ1939Dcm’ is set to enabled. </p>
<p>Table 6-75  </p>
<p>Dem_J1939DcmGetNextFreezeFrame() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>167 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.9.6 </b></p>
<p><b>Dem_J1939DcmGetNextSPNInFreezeFrame() </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnGetNextFilteredElementType</p>
<p> </p>
<p><b>Dem_J1939DcmGetNextSPNInFreezeFrame</b></p>
<p> </p>
<p>( </p>
<p>uint32 SPNSupported, uint8 SPNDataLength )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>SPNSupported </p>
<p>This parameter contains the next SPN in the ExpandedFreezeFrame  </p>
<p>SPNDataLength </p>
<p>This parameter contains the corresponding data length of the SPN </p>
<p><b>Return code </b></p>
<p>Dem_ReturnGetNext-</p>
<p>FilteredElementType </p>
<p>DEM_FILTERED_OK: Returned next filtered element </p>
<p>DEM_FILTERED_NO_MATCHING_ELEMENT: No further element (matching </p>
<p>the filter criteria) found </p>
<p>DEM_FILTERED_PENDING: The requested value is calculated </p>
<p>asynchronously and currently not available. The caller can retry later. </p>
<p>DEM_FILTERED_BUFFER_TOO_SMALL: Buffer in the BufSize parameter is </p>
<p>not huge enough   </p>
<p><b>Functional Description </b></p>
<p>Returns the SPNs that are stored in the J1939 FreezeFrame(s) </p>
<p>This interface returns always DEM_FILTERED_NO_MATCHING_ELEMENT as the data is directly provided </p>
<p>from J1939DCM </p>
<p> </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportJ1939Dcm’ is set to enabled. </p>
<p>Table 6-76  </p>
<p>Dem_J1939DcmGetNextSPNInFreezeFrame() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>168 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.9.7 </b></p>
<p><b>Dem_J1939DcmGetNumberOfFilteredDTC () </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnGetNumberOfFilteredDTCType </p>
<p> </p>
<p><b>Dem_J1939DcmGetNumberOfFilteredDTC </b></p>
<p> </p>
<p>( </p>
<p>uint16 NumberOfFilteredDTC )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>NumberOfFilteredDTC </p>
<p>number of DTCs matching the filter criteria </p>
<p><b>Return code </b></p>
<p>Dem_ReturnGetNumber-</p>
<p>OfFilteredDTCType  </p>
<p>DEM_NUMBER_OK: A valid number was calculated </p>
<p>DEM_NUMBER_FAILED: No valid number can be calculated </p>
<p>DEM_NUMBER_PENDING: not used </p>
<p><b>Functional Description </b></p>
<p>Gets the number of currently filtered DTCs set by the function Dem_J1939DcmSetDTCFilter(). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportJ1939Dcm’ is set to enabled. </p>
<p>Table 6-77  </p>
<p>Dem_J1939DcmGetNumberOfFilteredDTC () </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>169 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.9.8 </b></p>
<p><b>Dem_J1939DcmSetDTCFilter() </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnSetFilterType</p>
<p> </p>
<p><b>Dem_J1939DcmSetDTCFilter</b></p>
<p> </p>
<p>(  </p>
<p>Dem_J1939DcmDTCStatusFilterType DTCStatusFilter, Dem_DTCKindType DTCKind, </p>
<p>Dem_DTCOriginType DTCOrigin, uint8 NodeAddress, Dem_J1939DcmLampStatusType </p>
<p>LampStatus )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>DTCStatusFilter </p>
<p>DEM_J1939DTC_ACTIVE: Confirmed == 1 and TestFailed == 1 </p>
<p>DEM_J1939DTC_PREVIOUSLY_ACTIVE: Confirmed == 1 and  </p>
<p>TestFailed == 0 </p>
<p>DEM_J1939DTC_PENDING: Pending == 1  </p>
<p>DEM_J1939DTC_PERMANENT: not supported </p>
<p>DEM_J1939DTC_CURRENTLY_ACTIVE: TestFailed == 1 </p>
<p>DTCKind </p>
<p>DEM_DTC_KIND_ALL_DTCS: All DTCs </p>
<p>DEM_DTC_KIND_EMISSION_REL_DTCS: not supported </p>
<p>DTCOrigin </p>
<p>If the Dem supports more than one event memory this parameter is used to </p>
<p>select the source memory the DTCs shall be read from. </p>
<p>DEM_DTC_ORIGIN_PRIMARY_MEMORY: event information located in the </p>
<p>primary memory  </p>
<p>DEM_DTC_ORIGIN_SECONDARY_MEMORY: event information located in </p>
<p>the secondary memory </p>
<p>NodeAddress </p>
<p>The network management node ID to be filtered. </p>
<p>LampStatus </p>
<p>The ECU Lamp Status </p>
<p>HighByte </p>
<p> bits 7,6: Malfunction Indicator Lamp Status </p>
<p> bits 5,4: Red Stop Lamp Status  </p>
<p> bits 3,2: Amber Warning Lamp Status  </p>
<p> bits 1,0: Protect Lamp Status </p>
<p>LowByte </p>
<p> bits 7,6: Flash Malfunction Indicator Lamp  </p>
<p> bits 5,4: Flash Red Stop Lamp  </p>
<p> bits 3,2: Flash Amber Warning Lamp  </p>
<p> bits 1,0: Flash Protect Lamp  </p>
<p><b>Return code </b></p>
<p>Dem_ReturnSetFilterType </p>
<p>DEM_FILTER_ACCEPTED: Filter was accepted </p>
<p>DEM_WRONG_FILTER: Wrong filter selected  </p>
<p><b>Functional Description </b></p>
<p>Sets the filter criteria for the J1939 DTC filter mechanism and returns the ECU lamp status. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>170 </p>
<p>based on template version 5.0.0 </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportJ1939Dcm’ is set to enabled. </p>
<p>Table 6-78  </p>
<p>Dem_J1939DcmSetDTCFilter() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>171 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.9.9 </b></p>
<p><b>Dem_J1939DcmSetFreezeFrameFilter() </b></p>
<p><b>Prototype </b></p>
<p>Dem_ReturnSetFilterType</p>
<p> </p>
<p><b>Dem_J1939DcmSetFreezeFrameFilter</b></p>
<p> </p>
<p>(  </p>
<p>Dem_J1939DcmSetFreezeFrameFilterType FreezeFrameKind, uint8 NodeAddress )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>FreezeFrameKind </p>
<p>DEM_J1939DCM_FREEZEFRAME: Set the filter for J1939 Freeze Frame </p>
<p>data </p>
<p>DEM_J1939DCM_EXPANDED_FREEZEFRAME: Set the filter for J1939 </p>
<p>Expanded Freeze Frame data </p>
<p>DEM_J1939DCM_SPNS_IN_EXPANDED_FREEZEFRAME: Not supported, </p>
<p>DM24 message is handled by J1939Dcm </p>
<p>NodeAddress </p>
<p>The network management node ID to be filtered. </p>
<p><b>Return code </b></p>
<p>Dem_ReturnSetFilterType </p>
<p>DEM_FILTER_ACCEPTED: Filter was accepted </p>
<p>DEM_WRONG_FILTER: Wrong filter selected  </p>
<p><b>Functional Description </b></p>
<p>Sets the filter criteria for the consecutive calls of functions </p>
<p><b>&gt; </b></p>
<p>- Dem_J1939DcmGetNextFreezeFrame() </p>
<p><b>&gt; </b></p>
<p>- Dem_J1939DcmGetNextSPNInFreezeFrame() </p>
<p> </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>Only available if ‘DemSupportJ1939Dcm’ is set to enabled. </p>
<p>Table 6-79  </p>
<p>Dem_J1939DcmSetFreezeFrameFilter() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>172 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.2.9.10 </b></p>
<p><b>Dem_J1939DcmReadDiagnosticReadiness1() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_J1939DcmReadDiagnosticReadiness1</b></p>
<p> </p>
<p>( </p>
<p>Dem_J1939DcmDiagnosticReadiness1Type DataValue, uint8 NodeAddress )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>DataValue </p>
<p>Buffer of 8 bytes containing the contents of Diagnostic Readiness 1 (DM5) </p>
<p>computed by the Dem. </p>
<p>NodeAddress </p>
<p>The network management node ID to be filtered. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p><b>&gt; </b></p>
<p>E_OK: Operation was successful. </p>
<p><b>&gt; </b></p>
<p>E_NOT_OK: Operation failed. </p>
<p><b>Functional Description </b></p>
<p>Returns the DM5 data </p>
<p> </p>
<p><b>Particularities and Limitations </b></p>
<p>This function is not reentrant. </p>
<p>This function is synchronous. </p>
<p>Only available if ‘DemSupportJ1939Dcm’ is set to enabled. </p>
<p>OBDII is not supported </p>
<p>Table 6-80  </p>
<p>Dem_J1939DcmReadDiagnosticReadiness1() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>173 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.3 </b></p>
<p><b>Services used by Dem </b></p>
<p>In the following table services provided by other components, which are used by the Dem </p>
<p>are listed. For details about prototype and functionality refer to the documentation of the </p>
<p>providing component. </p>
<p><b>Component </b></p>
<p><b>API </b></p>
<p>Det </p>
<p>optional Dem_ReportErrorStatus </p>
<p>FiM </p>
<p>optional FiM_DemTriggerOnEventStatus </p>
<p>Dlt </p>
<p>optional Dlt_DemTriggerOnEventStatus </p>
<p>EcuM </p>
<p>optional EcuM_BswErrorHook </p>
<p>NvM </p>
<p>optional NvM_GetErrorStatus </p>
<p>optional NvM_SetRamBlockStatus </p>
<p>optional NvM_WriteBlock </p>
<p>Dcm </p>
<p>optional Dcm_DemTriggerOnDTCStatus </p>
<p>J1939Dcm </p>
<p>optional J1939Dcm_DemTriggerOnDTCStatus </p>
<p>SchM </p>
<p>optional SchM_Enter_Dem_&lt;ExclusiveArea&gt; </p>
<p>optional SchM_Exit_Dem_&lt;ExclusiveArea&gt; </p>
<p>Os </p>
<p>optional: GetCurrentApplicationID </p>
<p>Table 6-81  </p>
<p>Services used by the Dem </p>
<p><b>6.3.1 </b></p>
<p><b>EcuM_BswErrorHook() </b></p>
<p><b>Prototype </b></p>
<p>void <b>EcuM_BswErrorHook </b>( uint16 BswModuleId, uint8 ErrorId ) </p>
<p><b>Parameter </b></p>
<p>BswModuleId </p>
<p>Autosar ModuleId. The Dem will pass </p>
<p>DEM_MODULE_ID</p>
<p>. </p>
<p>ErrorId </p>
<p>Error code detailing the error cause, see Table 5-5 </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>This function is called to report defunct configuration data passed to Dem_MasterPreInit. </p>
<p>The Dem will leave Dem_MasterPreInit after a call to this function, without initializing. Further calls to the </p>
<p>Dem module are not safe.  </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is called in error cases, when initializing only a Post-Build configurations </p>
<p><b>&gt; </b></p>
<p>It is not safe if this function returns to the caller, especially if development error detection is disabled by </p>
<p>configuration. </p>
<p>Call context </p>
<p><b>&gt; </b></p>
<p>This function is called from Dem_MasterPreInit() </p>
<p>Table 6-82  </p>
<p>EcuM_BswErrorHook() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>174 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.4 </b></p>
<p><b>Callback Functions </b></p>
<p>This chapter describes the callback functions that are implemented by the  Dem and can </p>
<p>be invoked by other modules. The prototypes of the callback functions are provided in the </p>
<p>header file </p>
<p>Dem_Cbk.h</p>
<p> by the Dem. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>175 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.4.1 </b></p>
<p><b>Dem_NvM_JobFinished() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_NvM_JobFinished</b></p>
<p> </p>
<p>( uint8 ServiceId, NvM_RequestResultType </p>
<p>JobResult )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>ServiceId </p>
<p>The ServiceId indicates which one of the asynchronous services triggered via </p>
<p>the operations of Interface NvM Service (Read/Write) the notification belongs </p>
<p>to. </p>
<p>The value is currently not used by the Dem. </p>
<p>JobResult </p>
<p>Provides the result of the asynchronous job. </p>
<p>NVM_REQ_OK: last asynchronous request has been finished successfully    </p>
<p>NVM_REQ_NOT_OK: last asynchronous request has been finished </p>
<p>unsuccessfully </p>
<p>NVM_REQ_PENDING: not used in this context  </p>
<p>NVM_REQ_INTEGRITY_FAILED: not used in this context </p>
<p>NVM_REQ_BLOCK_SKIPPED: not used in this context    </p>
<p>NVM_REQ_NV_INVALIDATED: not used in this context   </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: is always returned </p>
<p><b>Functional Description </b></p>
<p>Is triggered from NvM to notify that the requested job which is processed asynchronous has been finished. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>Must be configured for every Dem related NVRAM block </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-83  </p>
<p>Dem_NvM_JobFinished() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>176 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.4.2 </b></p>
<p><b>Dem_NvM_InitAdminData() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_NvM_InitAdminData</b></p>
<p> </p>
<p>( void )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>N/A </p>
<p>N/A </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: is always returned </p>
<p><b>Functional Description </b></p>
<p>Initialize NvBlock for administrative data. </p>
<p>This function is supposed to be called by the NvM in order to (re)initialize the data in case the non-volatile </p>
<p>memory has never been stored, or was corrupted (see NvMBlockDescriptor/NvMInitBlockCallback).  </p>
<p>This API is intended as callback function the NvM module. It will not mark the initialized block ‘changed’. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-84  </p>
<p>Dem_NvM_InitAdminData() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>177 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.4.3 </b></p>
<p><b>Dem_NvM_InitStatusData() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_NvM_InitStatusData</b></p>
<p> </p>
<p>( void )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>N/A </p>
<p>N/A </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: is always returned </p>
<p><b>Functional Description </b></p>
<p>Initialize NvBlock for event status data. </p>
<p>This function is supposed to be called by the NvM in order to (re)initialize the data in case the non-volatile </p>
<p>memory has never been stored, or was corrupted (see NvMBlockDescriptor/NvMInitBlockCallback). </p>
<p>This API is intended as callback function the NvM module. It will not mark the initialized block ‘changed’. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-85  </p>
<p>Dem_NvM_InitStatusData() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>178 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.4.4 </b></p>
<p><b>Dem_NvM_InitDebounceData() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_NvM_InitDebounceData</b></p>
<p> </p>
<p>( void )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>N/A </p>
<p>N/A </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: is always returned </p>
<p><b>Functional Description </b></p>
<p>Initialize NvBlock for event de-bounce data. </p>
<p>This function is supposed to be called by the NvM in order to (re)initialize the data in case the non-volatile </p>
<p>memory has never been stored, or was corrupted (see NvMBlockDescriptor/NvMInitBlockCallback). </p>
<p>This API is intended as callback function the NvM module. It will not mark the initialized block ‘changed’. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-86  </p>
<p>Dem_NvM_InitDebounceData() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>179 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.4.5 </b></p>
<p><b>Dem_NvM_InitEventAvailableData() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>Dem_NvM_InitEventAvailableData</b></p>
<p> </p>
<p>( void )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>N/A </p>
<p>N/A </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: is always returned </p>
<p><b>Functional Description </b></p>
<p>Initialize NvBlock for event availability data. </p>
<p>This function is supposed to be called by the NvM in order to (re)initialize the data in case the non-volatile </p>
<p>memory has never been stored, or was corrupted (see NvMBlockDescriptor/NvMInitBlockCallback). </p>
<p>This API is intended as callback function the NvM module. It will not mark the initialized block ‘changed’. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function is not reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p>Table 6-87  </p>
<p>Dem_NvM_InitEventAvailableData() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>180 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.5 </b></p>
<p><b>Configurable Interfaces </b></p>
<p><b>6.5.1 </b></p>
<p><b>Callouts </b></p>
<p>At  its  configurable  interfaces  the  Dem  defines  callouts  that  can  be  mapped  to  callback </p>
<p>functions provided by other modules. The mapping is not statically defined by the Dem but </p>
<p>can be performed at configuration time. The function prototypes that can be used for the </p>
<p>configuration  have  to  match  the  appropriate  function  prototype  signatures,  which  are </p>
<p>described in the following sub-chapters.  </p>
<p> </p>
<p><b>6.5.1.1 </b></p>
<p><b>CBClrEvt_&lt;EventName&gt;() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CBClrEvt_&lt;EventName&gt;</b></p>
<p> </p>
<p>( boolean* Allowed )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>Allowed </p>
<p>True – clearance of event is allowed </p>
<p>False – clearance of event is not allowed </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Operation was successful </p>
<p>E_NOT_OK: Operation failed </p>
<p><b>Functional Description </b></p>
<p>Is triggered on DTC deletion to request the permission if the event may be cleared or not. </p>
<p>If the return value of the function call is other than E_OK the Dem clears the event for security reasons </p>
<p>without checking the Allowed value. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function shall be reentrant. </p>
<p><b>&gt; </b></p>
<p>This function shall be synchronous. </p>
<p>Call Context </p>
<p><b>&gt; </b></p>
<p>This function is called from task context. </p>
<p>Table 6-88  </p>
<p>CBClrEvt_&lt;EventName&gt;() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>181 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.5.1.2 </b></p>
<p><b>CBDataEvt_&lt;EventName&gt;() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CBDataEvt_&lt;EventName&gt;</b></p>
<p> </p>
<p>( void )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>N/A </p>
<p>N/A </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>Return value unused </p>
<p><b>Functional Description </b></p>
<p>Is triggered on changes of the event related data in the event memory. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function shall be reentrant. </p>
<p><b>&gt; </b></p>
<p>This function shall be synchronous. </p>
<p><b>&gt; </b></p>
<p>This function signature deviates from [1] to match the Rte_Call signature. </p>
<p>Call Context </p>
<p><b>&gt; </b></p>
<p>This function is called from task context. </p>
<p>Table 6-89  </p>
<p>CBDataEvt_&lt;EventName&gt;() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>182 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.5.1.3 </b></p>
<p><b>CBFaultDetectCtr_&lt;EventName&gt;() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CBFaultDetectCtr_&lt;EventName&gt;</b></p>
<p> </p>
<p>( sint8* FaultDetectionCounter )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>FaultDetectionCounter </p>
<p>This parameter receives the fault detection counter information (according </p>
<p>ISO 14229-1) of the requested EventId. If the return value of the function call </p>
<p>is other than E_OK this parameter does not contain valid data. </p>
<p> </p>
<p>-128dec…127dec PASSED…FAILED according to [7]  </p>
<p> </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: request was successful </p>
<p>E_NOT_OK: request failed </p>
<p> </p>
<p><b>Functional Description </b></p>
<p>Gets the current fault detection counter value for the requested monitor-internal de-bouncing event. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function shall be reentrant. </p>
<p><b>&gt; </b></p>
<p>This function shall be synchronous. </p>
<p>Call Context </p>
<p><b>&gt; </b></p>
<p>This function is called from APIs with unrestricted call context. </p>
<p>Table 6-90  </p>
<p>CBFaultDetectCtr_&lt;EventName&gt;() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>183 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.5.1.4 </b></p>
<p><b>CBInitEvt_&lt;EventName&gt;() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CBInitEvt_&lt;EventName&gt;</b></p>
<p> </p>
<p>( Dem_InitMonitorReasonType </p>
<p>InitMonitorReason )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>InitMonitorReason </p>
<p>Specific (re-)initialization reason evaluated from the monitor to identify the </p>
<p>initialization kind to be performed. </p>
<p>DEM_INIT_MONITOR_CLEAR:  Monitor of the EventId is cleared and all </p>
<p>internal values and states are reset </p>
<p>DEM_INIT_MONITOR_RESTART: Monitor of the EventId is requested to </p>
<p>restart </p>
<p> </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>Return value is unused. </p>
<p><b>Functional Description </b></p>
<p>(Re-)initializes the diagnostic monitor of a specific event.  </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function shall be reentrant. </p>
<p><b>&gt; </b></p>
<p>This function shall be synchronous. </p>
<p>Call Context </p>
<p><b>&gt; </b></p>
<p>This function is called from task context. </p>
<p>Table 6-91  </p>
<p>CBInitEvt_&lt;EventName&gt;() </p>
<p><b>6.5.1.5 </b></p>
<p><b>CBInitFct_&lt;N&gt;() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CBInitFct_&lt;N&gt;</b></p>
<p> </p>
<p>( void )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>N/A </p>
<p>N/A </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>Return value unused </p>
<p><b>Functional Description </b></p>
<p>Resets the diagnostic monitor of a specific function. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function shall be reentrant. </p>
<p><b>&gt; </b></p>
<p>This function shall be synchronous. </p>
<p>Call Context </p>
<p><b>&gt; </b></p>
<p>This function is called from task context. </p>
<p>Table 6-92  </p>
<p>CBInitFct_&lt;N&gt;() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>184 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.5.1.6 </b></p>
<p><b>CBReadData_&lt;SyncDataElement&gt;() </b></p>
<p><b>Prototype </b></p>
<p>Client/Server API </p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CBReadData_&lt;SyncDataElement&gt;</b></p>
<p> </p>
<p>( uint8* Buffer ) </p>
<p>Client/Server API with </p>
<p>Event Id </p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CBReadData_&lt;SyncDataElement&gt;</b></p>
<p> </p>
<p>( Dem_EventIdType </p>
<p>EventId, uint8* Buffer ) </p>
<p>Sender/Receiver APIs </p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CBReadData_&lt;SyncDataElement&gt;</b></p>
<p> </p>
<p>( boolean* Data ) </p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CBReadData_&lt;SyncDataElement&gt;</b></p>
<p> </p>
<p>( uint8* Data ) </p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CBReadData_&lt;SyncDataElement&gt;</b></p>
<p> </p>
<p>( sint8* Data ) </p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CBReadData_&lt;SyncDataElement&gt;</b></p>
<p> </p>
<p>( uint16* Data ) </p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CBReadData_&lt;SyncDataElement&gt;</b></p>
<p> </p>
<p>( sint16* Data ) </p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CBReadData_&lt;SyncDataElement&gt;</b></p>
<p> </p>
<p>( uint32* Data ) </p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CBReadData_&lt;SyncDataElement&gt;</b></p>
<p> </p>
<p>( sint32* Data ) </p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CBReadData_&lt;SyncDataElement&gt;</b></p>
<p> </p>
<p>( uint8* Buffer ) </p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CBReadData_&lt;SyncDataElement&gt;</b></p>
<p> </p>
<p>( sint8* Buffer ) </p>
<p><b>Parameter </b></p>
<p>Buffer</p>
<p> </p>
<p>Buffer containing the value of the data element. </p>
<p>EventId</p>
<p> </p>
<p>The EventId which has caused the trigger. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Operation was successful </p>
<p>E_NOT_OK: Operation failed </p>
<p><b>Functional Description </b></p>
<p>Requests the current value of the data element for freeze frame or extended data storage. </p>
<p>If the callback returns E_NOT_OK, the data is substituted by a pattern of 0xFF </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function shall be reentrant. </p>
<p><b>&gt; </b></p>
<p>This function shall be synchronous. </p>
<p>Call Context </p>
<p><b>&gt; </b></p>
<p>This function is called from task context. </p>
<p>Table 6-93  </p>
<p>CBReadData_&lt;SyncDataElement&gt;() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>185 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.5.1.7 </b></p>
<p><b>CBStatusDTC_&lt;N&gt;() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CBStatusDTC_&lt;N&gt;</b></p>
<p> </p>
<p>( uint32 DTC, uint8 DTCStatusOld, uint8 </p>
<p>DTCStatusNew )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>DTC </p>
<p>Diagnostic Trouble Code in UDS format. </p>
<p>DTCStatusOld </p>
<p>DTC status ANDed with DTCStatusAvailabilityMask before change.   </p>
<p>DTCStatusNew </p>
<p>DTC status ANDed with DTCStatusAvailabilityMask after change </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>Return value unused </p>
<p><b>Functional Description </b></p>
<p>Is triggered on changes of the UDS DTC status byte. The trigger will not occur for changed status bits </p>
<p>which are disabled by the DTCStatusAvailabilityMask.  </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function shall be reentrant. </p>
<p><b>&gt; </b></p>
<p>This function shall be synchronous. </p>
<p>Call Context </p>
<p><b>&gt; </b></p>
<p>This function is called from APIs with unrestricted call context. </p>
<p>Table 6-94  </p>
<p>CBStatusDTC_&lt;N&gt;() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>186 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.5.1.8 </b></p>
<p><b>CBStatusJ1939DTC_&lt;N&gt;() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CBStatusJ1939DTC_&lt;N&gt;</b></p>
<p> </p>
<p>( uint32 DTC, uint8 DTCStatusOld, uint8 </p>
<p>DTCStatusNew )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>DTC </p>
<p>Diagnostic Trouble Code in J1939 format. </p>
<p>DTCStatusOld </p>
<p>DTC status ANDed with DTCStatusAvailabilityMask before change.   </p>
<p>DTCStatusNew </p>
<p>DTC status ANDed with DTCStatusAvailabilityMask after change </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>Return value unused </p>
<p><b>Functional Description </b></p>
<p>Is triggered on changes of the J1939 DTC status byte. The trigger will not occur for changed status bits </p>
<p>which are disabled by the DTCStatusAvailabilityMask.  </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function shall be reentrant. </p>
<p><b>&gt; </b></p>
<p>This function shall be synchronous. </p>
<p>Call Context </p>
<p><b>&gt; </b></p>
<p>This function is called from APIs with unrestricted call context. </p>
<p>Table 6-95  </p>
<p>CBStatusJ1939DTC_&lt;N&gt;() </p>
<p><b>6.5.1.9 </b></p>
<p><b>CBStatusEvt_&lt;EventName&gt;_&lt;N&gt;() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CBStatusEvt_&lt;EventName&gt;_&lt;N&gt;</b></p>
<p> </p>
<p>( Dem_EventStatusExtendedType </p>
<p>EventStatusOld, Dem_EventStatusExtendedType EventStatusNew )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventStatusOld </p>
<p>UDS status byte of event before change. </p>
<p>EventStatusNew </p>
<p>UDS status byte of event after change. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>Return value unused </p>
<p><b>Functional Description </b></p>
<p>Triggers on changes of the status byte for the related EventId. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function shall be reentrant. </p>
<p><b>&gt; </b></p>
<p>This function shall be synchronous. </p>
<p><b>&gt; </b></p>
<p>This function signature deviates from [1] to match the Rte_Call signature. </p>
<p>Call Context </p>
<p><b>&gt; </b></p>
<p>This function is called from APIs with unrestricted call context. </p>
<p>Table 6-96  </p>
<p>CBStatusEvt_&lt;EventName&gt;_&lt;N&gt;() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>187 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.5.1.10 </b></p>
<p><b>GeneralCBDataEvt() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>GeneralCBDataEvt</b></p>
<p> </p>
<p>( Dem_EventIdType EventId )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>The EventId which has caused the trigger </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>Return value unused </p>
<p><b>Functional Description </b></p>
<p>Is triggered on changes of the event related data in the event memory. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function shall be reentrant. </p>
<p><b>&gt; </b></p>
<p>This function shall be synchronous. </p>
<p><b>&gt; </b></p>
<p>This function signature deviates from [1] to match the Rte_Call signature. </p>
<p>Call Context </p>
<p><b>&gt; </b></p>
<p>This function is called from task context. </p>
<p>Table 6-97  </p>
<p>GeneralCBDataEvt() </p>
<p><b>6.5.1.11 </b></p>
<p><b>GeneralCBStatusEvt() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>GeneralCBStatusEvt</b></p>
<p> </p>
<p>( Dem_EventIdType EventId, </p>
<p>Dem_EventStatusExtendedType EventStatusOld, Dem_EventStatusExtendedType </p>
<p>EventStatusNew )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>The EventId which has caused the trigger. </p>
<p>EventStatusOld </p>
<p>UDS status byte of event before change. </p>
<p>EventStatusNew </p>
<p>UDS status byte of event after change. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>Return value unused </p>
<p><b>Functional Description </b></p>
<p>Triggers on changes of the status byte for the related EventId. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function shall be reentrant. </p>
<p><b>&gt; </b></p>
<p>This function shall be synchronous. </p>
<p><b>&gt; </b></p>
<p>This function signature deviates from [1] to match the Rte_Call signature. </p>
<p>Call Context </p>
<p><b>&gt; </b></p>
<p>This function is called from APIs with unrestricted call context. </p>
<p>Table 6-98  </p>
<p>GeneralCBStatusEvt() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>188 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.5.1.12 </b></p>
<p><b>&lt;Module&gt;_ClearDtcNotification </b></p>
<p><b>_&lt;DemEventMemorySet&gt;_&lt;ShortName&gt;() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b> &lt;Module&gt;_ClearDtcNotification_&lt;DemEventMemorySet&gt;_&lt;ShortName&gt;</b></p>
<p> </p>
<p>(uint32 DTC, Dem_DTCFormatType DTCFormat, Dem_DTCOriginType DTCOrigin)</p>
<p> </p>
<p><b>Parameter </b></p>
<p>DTC </p>
<p>The DTC number requested to be cleared </p>
<p>DTCFormat </p>
<p>The DTC format requested to be cleared </p>
<p>DTCOrigin </p>
<p>The DTC origin requested to be cleared </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>Return value is not evaluated </p>
<p><b>Functional Description </b></p>
<p>Each notification function can be configured to be triggered either before ClearDTC is started, or after </p>
<p>ClearDTC has completed. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function shall be reentrant. </p>
<p><b>&gt; </b></p>
<p>This function shall be synchronous. </p>
<p>Call Context </p>
<p><b>&gt; </b></p>
<p>This function is called from task context. </p>
<p>Table 6-99  </p>
<p>&lt;Module&gt;_ClearDtcNotification_&lt;DemEventMemorySet&gt; </p>
<p>_&lt;ShortName&gt;() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>189 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.5.1.13 </b></p>
<p><b>&lt;Module&gt;_DemTriggerOnMonitorStatus() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b> &lt;Module&gt;_DemTriggerOnMonitorStatus</b></p>
<p> </p>
<p>(Dem_EventIdType EventId)</p>
<p> </p>
<p><b>Parameter </b></p>
<p>EventId </p>
<p>The ID of the event with the monitor status change </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>Global notification function that is triggered with changes of the monitor status. It is called synchronously in </p>
<p>context of event status reporting. </p>
<p>There is no interface with this global notification, as the call context of this notification is the same as the </p>
<p>event status reporting context, which can be a BSW module context. Therefore the notification can’t be </p>
<p>routed by the RTE to a SW-C. </p>
<p>The actual name of the notification is specified through the configuration parameter </p>
<p>DemGeneral/DemGeneralCallbackMonitorStatusChangedFnc – the configuration value is not restricted to </p>
<p>the name pattern “&lt;Module&gt;_DemTriggerOnMonitorStatus”. For interaction with the Function Inhibition </p>
<p>Manager (FIM) use “FiM_DemTriggerOnMonitorStatus”. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function shall be reentrant. </p>
<p><b>&gt; </b></p>
<p>This function shall be synchronous. </p>
<p><b>&gt; </b></p>
<p>This function signature deviates from [1] to match the FiM_DemTriggerOnMonitorStatus </p>
<p>signature. </p>
<p>Call Context </p>
<p><b>&gt; </b></p>
<p>This function is called from APIs with unrestricted call context. </p>
<p>Table 6-100  &lt;Module&gt;_ DemTriggerOnMonitorStatus() </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>190 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.5.1.14 </b></p>
<p><b>ApplDem_SyncCompareAndSwap() </b></p>
<p><b>Prototype </b></p>
<p>boolean <b>ApplDem_SyncCompareAndSwap </b>( </p>
<p>  volatile unsigned int* AddressPtr, </p>
<p>  unsigned int OldValue, </p>
<p>  unsigned int NewValue </p>
<p>  )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>AddressPtr </p>
<p>Memory location to modify. The pointer is aligned to int. </p>
<p>OldValue </p>
<p>The comparison value </p>
<p>NewValue </p>
<p>The value to write </p>
<p><b>Return code </b></p>
<p>TRUE </p>
<p>The new value was written to AddressPtr </p>
<p>FALSE </p>
<p>The new value was not written to AddressPtr </p>
<p><b>Functional Description </b></p>
<p>The function is expected to implement the following operation <b>atomically</b>: </p>
<p>IF value at location AddressPtr EQUALS OldValue: </p>
<p> </p>
<p>STORE NewValue at location AddressPtr  </p>
<p> </p>
<p>RETURN TRUE </p>
<p>OTHERWISE: </p>
<p> </p>
<p>RETURN FALSE </p>
<p> </p>
<p>Many hardware platforms provide an operation which allows to implement this function with a single </p>
<p>instructions, e.g. CMPXCHG, or instructions to write such a function efficiently and lock free e.g. </p>
<p>LDREX/STREX and LDARX/STDCX </p>
<p><b>Particularities and Limitations </b></p>
<p>&gt; </p>
<p>This function shall be reentrant </p>
<p>&gt; </p>
<p>This function shall be synchronous </p>
<p>&gt; </p>
<p>Providing this function is optional, the Dem can use a default implementation. Since the default </p>
<p>implementation is not optimized for the current platform it is strongly recommended to use this callout. </p>
<p>The configuration parameter </p>
<p>DemGeneral/DemUserDefinedCompareAndSwap</p>
<p> alters between.  </p>
<p>&gt; </p>
<p>When using the external callout function, the DEM typically needs a function prototype which is </p>
<p>delivered by adding an include file via parameter </p>
<p>DemGeneral/DemHeaderFileInclusion</p>
<p>. </p>
<p>Call context </p>
<p>&gt; </p>
<p>This function is called from APIs with unrestricted call context. </p>
<p>Table 6-101  ApplDem_SyncCompareAndSwap() </p>
<p><b>6.6 </b></p>
<p><b>Service Ports </b></p>
<p><b>6.6.1 </b></p>
<p><b>Client Server Interface </b></p>
<p>A client server interface is related to a Provide Port at the server side and a Require Port </p>
<p>at client side.  </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>191 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.6.1.1 </b></p>
<p><b>Provide Ports on Dem Side </b></p>
<p>At  the  Provide  Ports  of  the  Dem  the  API  functions  described  in  6.2  are  available  as </p>
<p>Runnable Entities. The Runnable Entities are invoked via Operations. The mapping from a </p>
<p>SWC client call to an Operation is performed by the RTE. In this mapping the RTE adds </p>
<p>Port Defined Argument Values to the client call of the SWC, if configured. </p>
<p>The  following  sub-chapters  present  the  Provide  Ports  defined  for  the  Dem  and  the </p>
<p>Operations defined for the Provide Ports, the API functions related to the Operations and </p>
<p>the Port Defined Argument Values to be added by the RTE. </p>
<p><b>6.6.1.1.1 </b></p>
<p><b>DiagnosticMonitor </b></p>
<p>Port Defined Argument: Dem_EventIdType EventId </p>
<p><b>Operation </b></p>
<p><b>API Function </b></p>
<p><b>Arguments </b></p>
<p>SetEventStatus </p>
<p>Dem_SetEventStatus </p>
<p>IN Dem_EventStatusType </p>
<p>EventStatus,  </p>
<p>ERR{E_NOT_OK} </p>
<p>ResetEventStatus </p>
<p>Dem_ResetEventStatus </p>
<p>ERR{E_NOT_OK} </p>
<p>ResetEventDebounceStatus </p>
<p>Dem_ResetEventDebounceStatus </p>
<p>ERR{E_NOT_OK} </p>
<p>PrestoreFreezeFrame</p>
<p>1</p>
<p> </p>
<p>Dem_PrestoreFreezeFrame </p>
<p>ERR{E_NOT_OK} </p>
<p>ClearPrestoredFreezeFrame</p>
<p>1</p>
<p> </p>
<p>Dem_ClearPrestoredFreezeFrame </p>
<p>ERR{E_NOT_OK} </p>
<p>SetEventDisabled</p>
<p>2</p>
<p> </p>
<p>Dem_SetEventDisabled </p>
<p>ERR{E_NOT_OK} </p>
<p>Table 6-102  DiagnosticMonitor </p>
<p><b>6.6.1.1.2 </b></p>
<p><b>DiagnosticInfo and GeneralDiagnosticInfo </b></p>
<p>DiagnosticInfo has Port Defined Argument: Dem_EventIdType EventId </p>
<p><b>Operation </b></p>
<p><b>API Function </b></p>
<p><b>Arguments </b></p>
<p>GetEventStatus </p>
<p>Dem_GetEventUdsStatus </p>
<p>OUT Dem_UdsStatusByteType </p>
<p>UdsStatusByte,  </p>
<p>ERR{E_NOT_OK} </p>
<p>GetEventUdsStatus </p>
<p>Dem_GetEventUdsStatus </p>
<p>OUT Dem_UdsStatusByteType </p>
<p>UdsStatusByte,  </p>
<p>ERR{E_NOT_OK} </p>
<p>GetEventFailed </p>
<p>Dem_GetEventFailed </p>
<p>OUT boolean EventFailed,  </p>
<p>ERR{E_NOT_OK} </p>
<p>GetEventTested </p>
<p>Dem_GetEventTested </p>
<p>OUT boolean EventTested,  </p>
<p>ERR{E_NOT_OK} </p>
<p>                                            </p>
<p>1</p>
<p> Conditional: if configuration parameter </p>
<p><b>DemGeneral/DemMaxNumberPrestoredFF</b></p>
<p> &gt; 0 </p>
<p>2</p>
<p> Conditional: if OBD II support is licensed and configured in </p>
<p><b>DemGeneral/DemOBDSupport</b></p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>192 </p>
<p>based on template version 5.0.0 </p>
<p><b>Operation </b></p>
<p><b>API Function </b></p>
<p><b>Arguments </b></p>
<p>GetDTCOfEvent </p>
<p>Dem_GetDTCOfEvent </p>
<p>IN Dem_DTCFormatType DTCFormat,  </p>
<p>OUT uint32 DTCOfEvent,  </p>
<p>ERR{E_NOT_OK, </p>
<p>DEM_E_NO_DTC_AVAILABLE} </p>
<p>GetFaultDetectionCounter </p>
<p>Dem_ </p>
<p>GetFaultDetectionCounter </p>
<p>OUT sint8 FaultDetectionCounter,  </p>
<p>ERR{E_NOT_OK, </p>
<p>DEM_E_NO_FDC_AVAILABLE} </p>
<p>GetEventEnableCondition </p>
<p>Dem_GetEventEnableCondition </p>
<p>OUT boolean ConditionFullfilled  </p>
<p>ERR{E_NOT_OK} </p>
<p>GetEventFreezeFrameDataEx </p>
<p>Dem_ </p>
<p>GetEventFreezeFrameDataEx </p>
<p>IN uint8 RecordNumber,  </p>
<p>IN uint16 DataId,  </p>
<p>OUT Dem_MaxDataValueType </p>
<p>DestBuffer,  </p>
<p>INOUT uint16 BufSize, </p>
<p>ERR{E_NOT_OK, </p>
<p>DEM_NO_SUCH_ELEMENT, </p>
<p>DEM_BUFFER_TOO_SMALL} </p>
<p>GetEventExtendedDataRecord</p>
<p>Ex </p>
<p>Dem_ </p>
<p>GetEventExtendedDataRecord </p>
<p>IN uint8 RecordNumber,  </p>
<p>OUT Dem_MaxDataValueType </p>
<p>DestBuffer, </p>
<p>INOUT uint16 BufSize, </p>
<p>ERR{E_NOT_OK, </p>
<p>DEM_NO_SUCH_ELEMENT, </p>
<p>DEM_BUFFER_TOO_SMALL} </p>
<p>GetDebouncingOfEvent </p>
<p>Dem_GetDebouncingOfEvent </p>
<p>OUT Dem_DebouncingStateType </p>
<p>DebouncingState, </p>
<p>ERR{E_NOT_OK} </p>
<p>GetMonitorStatus </p>
<p>Dem_GetMonitorStatus </p>
<p>OUT Dem_MonitorStatusType </p>
<p>MonitorStatus, </p>
<p>ERR{E_NOT_OK} </p>
<p>Table 6-103  DiagnosticInfo and GeneralDiagnosticInfo </p>
<p><b>6.6.1.1.3 </b></p>
<p><b>OperationCycle </b></p>
<p>Port Defined Argument: uint8 OperationCycleId </p>
<p><b>Operation </b></p>
<p><b>API Function </b></p>
<p><b>Arguments </b></p>
<p>SetOperationCycleState </p>
<p>Dem_SetOperationCycleState </p>
<p>IN Dem_OperationCycleStateType </p>
<p>CycleState,  </p>
<p>ERR{E_NOT_OK} </p>
<p>GetOperationCycleState </p>
<p>Dem_GetOperationCycleState </p>
<p>OUT Dem_OperationCycleStateType </p>
<p>CycleState,  </p>
<p>ERR{E_NOT_OK} </p>
<p>Table 6-104  OperationCycle </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>193 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.6.1.1.4 </b></p>
<p><b>AgingCycle </b></p>
<p>Not supported </p>
<p><b>6.6.1.1.5 </b></p>
<p><b>ExternalAgingCycle </b></p>
<p>Not supported </p>
<p><b>6.6.1.1.6 </b></p>
<p><b>EnableCondition </b></p>
<p>Port Defined Argument: uint8 EnableConditionId </p>
<p><b>Operation </b></p>
<p><b>API Function </b></p>
<p><b>Arguments </b></p>
<p>SetEnableCondition </p>
<p>Dem_SetEnableCondition </p>
<p>IN boolean ConditionFulfilled,  </p>
<p>ERR{E_NOT_OK} </p>
<p>Table 6-105  EnableCondition </p>
<p><b>6.6.1.1.7 </b></p>
<p><b>StorageCondition </b></p>
<p>Port Defined Argument: uint8 StorageConditionId </p>
<p><b>Operation </b></p>
<p><b>API Function </b></p>
<p><b>Arguments </b></p>
<p>SetStorageCondition </p>
<p>Dem_SetStorageCondition </p>
<p>IN boolean ConditionFulfilled,  </p>
<p>ERR{E_NOT_OK} </p>
<p>Table 6-106  StorageCondition </p>
<p><b>6.6.1.1.8 </b></p>
<p><b>IndicatorStatus </b></p>
<p>Port Defined Argument: uint8 IndicatorStatus </p>
<p><b>Operation </b></p>
<p><b>API Function </b></p>
<p><b>Arguments </b></p>
<p>GetIndicatorStatus </p>
<p>Dem_GetIndicatorStatus </p>
<p>OUT Dem_IndicatorStatusType </p>
<p>IndicatorStatus,  </p>
<p>ERR{E_NOT_OK} </p>
<p>Table 6-107  IndicatorStatus </p>
<p><b>6.6.1.1.9 </b></p>
<p><b>EventStatus </b></p>
<p>Port Defined Argument: Dem_EventIdType EventId </p>
<p><b>Operation </b></p>
<p><b>API Function </b></p>
<p><b>Arguments </b></p>
<p>SetWIRStatus </p>
<p>Dem_SetWIRStatus </p>
<p>IN boolean WIRStatus,  </p>
<p>ERR{E_NOT_OK} </p>
<p>GetWIRStatus </p>
<p>Dem_GetWIRStatus </p>
<p>OUT boolean WIRStatus, </p>
<p>ERR{E_NOT_OK} </p>
<p>Table 6-108  EventStatus </p>
<p><b>6.6.1.1.10 </b></p>
<p><b>EvMemOverflowIndication </b></p>
<p>Port Defined Arguments: uint8 ClientId, Dem_DTCOriginType DTCOrigin </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>194 </p>
<p>based on template version 5.0.0 </p>
<p><b>Operation </b></p>
<p><b>API Function </b></p>
<p><b>Arguments </b></p>
<p>GetEventMemoryOverflow </p>
<p>Dem_ </p>
<p>GetEventMemoryOverflow </p>
<p>OUT boolean OverflowIndication,  </p>
<p>ERR{E_NOT_OK} </p>
<p>GetNumberOfEventMemory</p>
<p>Entries </p>
<p>Dem_GetNumberOfEventMemoryEn</p>
<p>tries </p>
<p>OUT uint8 </p>
<p>NumberOfEventMemoryEntries,  </p>
<p>ERR{E_NOT_OK} </p>
<p>Table 6-109  EvMemOverflowIndication </p>
<p><b>6.6.1.1.11 </b></p>
<p><b>DTCSuppression </b></p>
<p>Port Defined Argument: uint8 ClientId </p>
<p><b>Operation </b></p>
<p><b>API Function </b></p>
<p><b>Arguments </b></p>
<p>SetDTCSuppression </p>
<p>Dem_SetDTCSuppression </p>
<p>IN boolean SuppressionStatus , </p>
<p>ERR{E_NOT_OK, </p>
<p>DEM_WRONG_DTC, </p>
<p>DEM_WRONG_DTCORIGIN, </p>
<p>DEM_PENDING} </p>
<p>GetDTCSuppression </p>
<p>Dem_GetDTCSuppression </p>
<p>OUT boolean SuppressionStatus, </p>
<p>ERR{E_NOT_OK, </p>
<p>DEM_WRONG_DTC, </p>
<p>DEM_WRONG_DTCORIGIN, </p>
<p>DEM_PENDING } </p>
<p>Table 6-110  DTCSuppression </p>
<p><b>6.6.1.1.12 </b></p>
<p><b>DemServices </b></p>
<p><b>Operation </b></p>
<p><b>API Function </b></p>
<p><b>Arguments </b></p>
<p>GetDtcStatusAvailabilityMask </p>
<p>Dem_ </p>
<p>GetDtcStatusAvailabilityMask </p>
<p>IN uint8 ClientId, </p>
<p>OUT uint8 DTCStatusMask,  </p>
<p>ERR{E_NOT_OK} </p>
<p>GetPostRunRequested </p>
<p>Dem_ </p>
<p>GetPostRunRequested </p>
<p>OUT boolean isRequested, </p>
<p>ERR{E_NOT_OK} </p>
<p>SynchronizeNvData</p>
<p>1</p>
<p> </p>
<p>Dem_ </p>
<p>RequestNvSynchronization </p>
<p>ERR{E_NOT_OK} </p>
<p>Table 6-111   DemServices </p>
<p><b>6.6.1.1.13 </b></p>
<p><b>DcmIf </b></p>
<p>The DcmIf PortInterface is a special case, not intended to be used by application software. </p>
<p>Instead, this interface is a means to establish the call contexts for application notification </p>
<p>callbacks  that  are  the  result  of  function  calls  to  the  Dem  by  the  Dcm.  The  interface </p>
<p>description is omitted intentionally for this reason. </p>
<p>                                            </p>
<p>1</p>
<p> Conditional: if configuration parameter DemGeneral/DemNvSynchronizeSupport == true </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>195 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.6.1.1.14 </b></p>
<p><b>ClearDTC </b></p>
<p>Port Defined Argument: uint8 ClientId </p>
<p><b>Operation </b></p>
<p><b>API Function </b></p>
<p><b>Arguments </b></p>
<p>SelectDTC </p>
<p>Dem_SelectDTC </p>
<p>IN uint32 DTC,IN </p>
<p>Dem_DTCFormatType DTCFormat,IN </p>
<p>Dem_DTCOriginType DTCOrigin </p>
<p>ERR{E_OK, </p>
<p>E_NOT_OK } </p>
<p>ClearDTC </p>
<p>Dem_ </p>
<p>ClearDTC </p>
<p>ERR{E_NOT_OK , </p>
<p>DEM_CLEAR_FAILED, </p>
<p>DEM_PENDING, </p>
<p>DEM_CLEAR_BUSY, </p>
<p>DEM_CLEAR_MEMORY_ERROR, </p>
<p>DEM_WRONG_DTC, </p>
<p>DEM_WRONG_DTCORIGIN} </p>
<p> </p>
<p><b>6.6.1.2 </b></p>
<p><b>Require Ports on Dem Side </b></p>
<p>At its Require Ports the Dem calls Operations. These Operations have to be provided by </p>
<p>the  SWCs  by  means  of  Runnable  Entities.  These  Runnable  Entities  implement  the </p>
<p>callback functions expected by the Dem. </p>
<p>The following sub-chapters present the Require Ports defined for the Dem, the Operations </p>
<p>that are called from the Dem and the related Callouts, which are described in chapter 6.5. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>If following interfaces are used as port interfaces without RTE, the function</p>
<p> prefix  </p>
<p><b>Rte_Call </b>will be replaced by the prefix <b>Appl_Dem</b>. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>6.6.1.2.1 </b></p>
<p><b>CBInitEvt_&lt;EventName&gt; </b></p>
<p><b>Operation </b></p>
<p><b>Callout </b></p>
<p>InitMonitorForEvent </p>
<p>Rte_Call_ CBInitEvt_&lt;EventName&gt;_InitMonitorForEvent </p>
<p>(EventName: DemEventParameter.shortname) </p>
<p>Table 6-112  CBInitEvt_&lt;EventName&gt; </p>
<p><b>6.6.1.2.2 </b></p>
<p><b>CBInitFct_&lt;DtcName&gt;_ </b></p>
<p><b>Operation </b></p>
<p><b>Callout </b></p>
<p>InitMonitorForFunction </p>
<p>Rte_Call_ CBInitFct_&lt;DtcName&gt;_&lt;N&gt; _InitMonitorForFunction </p>
<p>(DtcName: DemDTCClass.shortname, </p>
<p>N: counter per DemDTCClass) </p>
<p>Table 6-113  CBInitFct_&lt;DtcName&gt;_&lt;N&gt; </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>196 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.6.1.2.3 </b></p>
<p><b>CBEventUdsStatusChanged </b></p>
<p><b>_&lt;EventName&gt;_&lt;CallbackName&gt; </b></p>
<p><b>Operation </b></p>
<p><b>Callout </b></p>
<p>CallbackEventUdsStatusChange</p>
<p>d </p>
<p>Rte_Call_CBEventUdsStatusChanged_&lt;EventName&gt;_&lt;CallbackName</p>
<p>&gt; _CallbackEventUdsStatusChanged </p>
<p>(EventName: DemEventParameter.shortname, </p>
<p>CallbackName: DemCallbackEventStatusChanged.shortname) </p>
<p>Table 6-114  CBEventUdsStatusChanged_&lt;EventName&gt;_&lt;CallbackName&gt; </p>
<p><b>6.6.1.2.4 </b></p>
<p><b>GeneralCBStatusEvt </b></p>
<p><b>Operation </b></p>
<p><b>Callout </b></p>
<p>GeneralCallbackEventUdsStatus</p>
<p>Changed </p>
<p>Rte_Call_ GeneralCBStatusEvt </p>
<p>_GeneralCallbackEventUdsStatusChanged </p>
<p>Table 6-115  GeneralCBStatusEvt </p>
<p><b>6.6.1.2.5 </b></p>
<p><b>CBStatusDTC_&lt;CallbackName&gt; </b></p>
<p><b>Operation </b></p>
<p><b>Callout </b></p>
<p>DTCStatusChanged </p>
<p>Rte_Call_ CBStatusDTC_&lt;CallbackName&gt;_DTCStatusChanged </p>
<p>(CallbackName: </p>
<p>DemCallbackDTCStatusChanged</p>
<p>.shortname) </p>
<p>Table 6-116  CBStatusDTC_&lt;CallbackName&gt; </p>
<p><b>6.6.1.2.6 </b></p>
<p><b>CBDataEvt_&lt;EventName&gt; </b></p>
<p><b>Operation </b></p>
<p><b>Callout </b></p>
<p>EventDataChanged </p>
<p>Rte_Call_ CBDataEvt_&lt;EventName&gt;_EventDataChanged </p>
<p>(EventName: DemEventParameter.shortname) </p>
<p>Table 6-117  CBDataEvt_&lt;EventName&gt; </p>
<p><b>6.6.1.2.7 </b></p>
<p><b>GeneralCBDataEvt </b></p>
<p><b>Operation </b></p>
<p><b>Callout </b></p>
<p>EventDataChanged </p>
<p>Rte_Call_ GeneralCBDataEvt _EventDataChanged </p>
<p>Table 6-118  GeneralCBDataEvt </p>
<p><b>6.6.1.2.8 </b></p>
<p><b>CBClrEvt_&lt;EventName&gt; </b></p>
<p><b>Operation </b></p>
<p><b>Callout </b></p>
<p>ClearEventAllowed </p>
<p>Rte_Call_ CBClrEvt_&lt;EventName&gt;_ClearEventAllowed </p>
<p>(EventName: DemEventParameter.shortname) </p>
<p>Table 6-119  CBClrEvt_&lt;EventName&gt; </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>197 </p>
<p>based on template version 5.0.0 </p>
<p><b>6.6.1.2.9 </b></p>
<p><b>CBReadData_&lt;SyncDataElement&gt; </b></p>
<p><b>Operation </b></p>
<p><b>Callout </b></p>
<p>ReadData </p>
<p>Rte_Call_ CBReadData_&lt;SyncDataElement&gt; _ReadData </p>
<p>(SyncDataElement: DemDataClass.shortname) </p>
<p>Table 6-120  CBReadData_&lt;SyncDataElement&gt; </p>
<p><b>6.6.1.2.10 </b></p>
<p><b>CBFaultDetectCtr_&lt;EventName&gt; </b></p>
<p><b>Operation </b></p>
<p><b>Callout </b></p>
<p>GetFaultDetectionCounter </p>
<p>Rte_Call_ CBFaultDetectCtr_&lt;EventName&gt; </p>
<p>_GetFaultDetectionCounter </p>
<p>(EventName: DemEventParameter.shortname) </p>
<p>Table 6-121  CBFaultDetectCtr_&lt;EventName&gt; </p>
<p><b>6.6.1.2.11 </b></p>
<p><b>CBControlDTCSetting </b></p>
<p><b>Operation </b></p>
<p><b>Callout </b></p>
<p>ControlDTCSettingChanged </p>
<p>Rte_Call_CBControlDTCSetting_ControlDTCSettingChanged </p>
<p>Table 6-122  CBControlDTCSetting </p>
<p><b>6.6.1.2.12 </b></p>
<p><b>DemSc </b></p>
<p><b>Operation </b></p>
<p><b>Callout </b></p>
<p>GetCurrentOdometer </p>
<p>Rte_Call_DemSc_ GetCurrentOdometer </p>
<p>GetExternalTesterStatus </p>
<p>Rte_Call_ DemSc_GetExternalTesterStatus </p>
<p>Table 6-123  DemSc </p>
<p><b>6.6.1.2.13 </b></p>
<p><b>ClearDtcNotification </b></p>
<p><b>_&lt;EventMemorySet&gt;_&lt;Notification&gt; </b></p>
<p><b>Operation </b></p>
<p><b>Callout </b></p>
<p>ClearDtcNotification </p>
<p>Rte_Call_ClearDtcNotification_&lt;EventMemorySet&gt;_&lt;Notification&gt;_Cle</p>
<p>arDtcNotification </p>
<p>(EventMemorySet: DemEventMemorySet.shortname, </p>
<p>Notification: DemClearDTCNotification.shortname) </p>
<p>Table 6-124  ClearDtcNotification_&lt;EventMemorySet&gt;_&lt;Notification&gt; </p>
<p><b>6.7 </b></p>
<p><b>Not Supported APIs </b></p>
<p><b>Operation </b></p>
<p>Dem_DcmGetOBDFreezeFrameData() </p>
<p>Dem_SetOperationCycleCntValue() </p>
<p>Dem_SetAgingCycleState() </p>
<p>Dem_SetAgingCycleCounterValue() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>198 </p>
<p>based on template version 5.0.0 </p>
<p><b>Operation </b></p>
<p>Dem_DltGetMostRecentFreezeFrameRecordData() </p>
<p>Dem_DltGetAllExtendedDataRecords() </p>
<p>Dem_RepIUMPRFaultDetect() </p>
<p>Dem_RepIUMPRDenLock() </p>
<p>Dem_RepIUMPRDenRelease() </p>
<p>Dem_DcmGetInfoTypeValue08() </p>
<p>Dem_DcmGetInfoTypeValue0B() </p>
<p>Dem_DcmReadDataOfPID01() </p>
<p>Dem_DcmReadDataOfPID1C() </p>
<p>Dem_DcmReadDataOfPID21() </p>
<p>Dem_DcmReadDataOfPID30() </p>
<p>Dem_DcmReadDataOfPID31() </p>
<p>Dem_DcmReadDataOfPID41() </p>
<p>Dem_DcmReadDataOfPID4D() </p>
<p>Dem_DcmReadDataOfPID4E() </p>
<p>Dem_DcmReadDataOfOBDFreezeFrame() </p>
<p>Dem_DcmGetDTCOfOBDFreezeFrame() </p>
<p>Dem_SetPtoStatus() </p>
<p>Table 6-125  Not Supported APIs </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>199 </p>
<p>based on template version 5.0.0 </p>
<p><b>7 </b></p>
<p><b>Configuration </b></p>
<p>In the Dem the attributes can be configured with the following tools: </p>
<p><b>&gt; </b> Configuration in GCE </p>
<p><b>&gt; </b> Configuration in DaVinci Configurator </p>
<p>The configuration of post-build is described in [8] and [9]. </p>
<p><b>7.1 </b></p>
<p><b>Configuration Variants </b></p>
<p>The Dem supports the configuration variants </p>
<p><b>&gt; </b></p>
<p>VARIANT-PRE-COMPILE </p>
<p><b>&gt; </b></p>
<p>VARIANT-POST-BUILD-LOADABLE </p>
<p><b>&gt; </b></p>
<p>VARIANT-POST-BUILD-SELECTABLE </p>
<p>The configuration classes of the Dem parameters depend on the supported configuration </p>
<p>variants. For their definitions please see the Dem_bswmd.arxml file. </p>
<p><b>7.2 </b></p>
<p><b>Configurable Attributes </b></p>
<p>The description of each configurable option is described within the Dem_bswmd.arxml file. </p>
<p>You  can  use  the  online  help  of  DaVinci  Configurator  5  to  access  these  parameter </p>
<p>descriptions comfortably. </p>
<p><b>7.3 </b></p>
<p><b>Configuration of Post-Build Loadable </b></p>
<p>This component uses a static RAM management which differs from the concept described </p>
<p>in the mentioned post-build documentation. </p>
<p>Since  all  RAM  buffers  scale  with  the  number  of  configured  events,  and  the  number  of </p>
<p>events  cannot  be  changed  during  post-build  time,  we  see  no  need  for  dynamic  RAM </p>
<p>management. </p>
<p>The NVRAM required is however also not covered by dynamic RAM management. NvM </p>
<p>cannot  change  its  memory  allocation,  so  this  is  a  restriction  by  necessity.  In  post-build </p>
<p>configurations, the Dem can reserve some NV memory for snapshot data storage using </p>
<p>parameter /DemGeneral/DemPostbuild/DemMaxSizeFreezeFrame. </p>
<p>It is mainly used to verify that configuration changes do not increase the required NVRAM </p>
<p>beyond the available amount. You can however increase its value if you need flexibility to </p>
<p>add DIDs to existing snapshot records. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The reserved NVRAM size cannot be reduced during post-build. Be aware of the </p>
<p>additional wear on the Flash memory if FEE is used to back the Dem NV data. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>200 </p>
<p>based on template version 5.0.0 </p>
<p><b>7.3.1 </b></p>
<p><b>Supported Variance </b></p>
<p>Since much of the configuration of Dem can result in API changes, some restrictions apply </p>
<p>regarding which features and configuration elements can be modified after linking. </p>
<p>E.g., </p>
<p>there </p>
<p>is </p>
<p>no </p>
<p>sensible </p>
<p>way </p>
<p>to </p>
<p>introduce </p>
<p>(and </p>
<p>implement) </p>
<p>additional </p>
<p>application </p>
<p>callbacks. All code has to be already present in the ECU; service ports must be connected </p>
<p>via RTE. Also, it’s not generally possible to add arbitrary data to the NV data structures, </p>
<p>whose block sizes are static as well. </p>
<p>Generally, </p>
<p>Post-Build </p>
<p>Loadable </p>
<p>for </p>
<p>the </p>
<p>Dem </p>
<p>module </p>
<p>supports </p>
<p>modifying </p>
<p>an </p>
<p>existing </p>
<p>configuration, but not changing it structurally. The exhaustive list of parameters that can be </p>
<p>modified using Post-Build Loadable is documented in the Dem parameter description file </p>
<p>(BSWMD file). The list below is only intended as short outline. </p>
<p><b>&gt; </b></p>
<p>DTC numbers </p>
<p><b>&gt; </b></p>
<p>De-bouncing parameters </p>
<p><b>&gt; </b></p>
<p>Step sizes and thresholds </p>
<p><b>&gt; </b></p>
<p>Qualification time </p>
<p><b>&gt; </b></p>
<p>DTC operation cycle </p>
<p><b>&gt; </b></p>
<p>DID numbers </p>
<p><b>&gt; </b></p>
<p>DIDs contained in snapshots </p>
<p><b>&gt; </b></p>
<p>Restricted by the amount of reserved NV data </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>201 </p>
<p>based on template version 5.0.0 </p>
<p><b>8 </b></p>
<p><b>AUTOSAR Standard Compliance </b></p>
<p><b>8.1 </b></p>
<p><b>Deviations </b></p>
<p><b>Deviation </b></p>
<p><b>Comment </b></p>
<p>DemGetNextFilteredDTCAndFDC() </p>
<p>If monitor internal de-bouncing is used the Dem </p>
<p>requests the application for the fault detection counter. </p>
<p>To implement the necessary call sequence definition, </p>
<p>the Dem provides this interface as part of PortInterface </p>
<p>DcmIf. </p>
<p>Dem_J1939DcmGetNextSPNIn </p>
<p>FreezeFrame()</p>
<p> </p>
<p>The interface is not supported and therefore will </p>
<p>always return. </p>
<p>DEM_FILTERED_NO_MATCHING_ELEMENT. </p>
<p>The </p>
<p>intended functionality is implemented in the Vector </p>
<p>J1939Dcm.</p>
<p> </p>
<p> </p>
<p>Operation cycle handling </p>
<p>Only the Operation Cycle using the ‘Autostart’ option is </p>
<p>considered active before initialization. This is different </p>
<p>from the Autosar standard, which defines to set all </p>
<p>cycles to active, and undo the effects for cycles not </p>
<p>started at initialization time. </p>
<p>CBStatusEvt </p>
<p>and </p>
<p>CBtDataEvt </p>
<p>Notification signature </p>
<p>The signature of these callbacks is expected to match </p>
<p>Rte_Call (see chapter 6.5.1 Callouts). Notifications </p>
<p>with return type ‘void’ are not possible. </p>
<p>Dem_J1939DcmClearDTC() </p>
<p>This API can also be called for DTCOrigin </p>
<p>DEM_DTC_ORIGIN_SECONDARY_MEMORY. </p>
<p>Dem_J1939DcmSetDTCFilter() </p>
<p>This API can also be called for DTCOrigin </p>
<p>DEM_DTC_ORIGIN_SECONDARY_MEMORY. </p>
<p>Table 8-1  </p>
<p>Deviations </p>
<p><b>8.2 </b></p>
<p><b>Additions/ Extensions </b></p>
<p><b>Extension </b></p>
<p><b>Comment </b></p>
<p>Dem_InitMemory() </p>
<p>see 6.2.5.7 </p>
<p>Dem_PostRunRequested() </p>
<p>see 6.2.6.23 </p>
<p>Dem_GetEventEnableCondition() </p>
<p>see 6.2.6.20 </p>
<p>Extension of </p>
<p>CBReadData_&lt;SyncDataElement&gt;()</p>
<p> </p>
<p>see 6.5.1.6 </p>
<p>Table 8-2  </p>
<p>Extensions </p>
<p><b>8.3 </b></p>
<p><b>Limitations </b></p>
<p><b>Limitation </b></p>
<p><b>Comment </b></p>
<p>Enable Conditions </p>
<p>Maximum number of Enable Conditions is limited to 254. </p>
<p>Operation Cycles </p>
<p>Maximum number of Operation Cycles is limited to 16 for efficiency </p>
<p>reasons. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>202 </p>
<p>based on template version 5.0.0 </p>
<p><b>Limitation </b></p>
<p><b>Comment </b></p>
<p>Aging Threshold </p>
<p>Maximum possible aging cycles are limited to 255 (from 256) for </p>
<p>efficiency reasons. </p>
<p>Non-Volatile storage </p>
<p>Configuration option DemStatusBitStorageTestFailed == false will </p>
<p>reset the Test Failed bit during initialization, but it will be stored in </p>
<p>NVRAM anyways. </p>
<p>DemGroupOfDTC </p>
<p>Configuration of DTC groups is limited to 4. These are intended to be </p>
<p>used to support the Powertrain, Body, Chassis and Network </p>
<p>groupings defined by ISO 15031-6. </p>
<p>Different definitions may not work as intended. </p>
<p>Snapshot Record/ Freeze </p>
<p>Frame </p>
<p>Interface </p>
<p>Dem_GetEventFreezeFrameDataEx()</p>
<p> will return the </p>
<p>most recent record only if the records are configured as “Calculated”. </p>
<p>Interface </p>
<p>Dem_GetEventFreezeFrameDataEx()</p>
<p> will return </p>
<p>E_NOT_OK if the records are configured as “Configured” and the </p>
<p>requested record is 0xFF.  </p>
<p>Internal Data Elements </p>
<p>The internal data elements which can be mapped into an extended </p>
<p>data or snapshot record will always have their current internal values </p>
<p>at the time the data is read out. </p>
<p>This will not apply to the following elements as they are static </p>
<p>configuration elements: Significance, Priority, OBD DTC, root cause </p>
<p>Event Id  </p>
<p>J1939 DTC </p>
<p>If the DTC class has configured a J1939 DTC then an UDS DTC </p>
<p>must be also available. </p>
<p>J1939NmNodes</p>
<p> </p>
<p>Maximum number of different nodes is limited to 255 (from 256) for </p>
<p>efficiency reasons.  </p>
<p>J1939 Indicators </p>
<p>An event is only allowed to support one J1939 related indicators </p>
<p>(RSL, AWL, PL). The MIL indicator is not supported. </p>
<p>J1939 Freeze Frame and </p>
<p>Expanded Freeze Frame </p>
<p>Only one global defined J1939 Freeze Frame and one global J1939 </p>
<p>Expanded Freeze Frame is supported. </p>
<p>De-bounce counter </p>
<p>storage in NVRAM </p>
<p>This feature is limited to counter based de-bounced events only. </p>
<p>BSW events which are reported before initialization of DEM </p>
<p>(Dem_MasterInit()) must not use this feature. </p>
<p>DTC selection </p>
<p>DEM_DTC_FORMAT_OBD is not supported while selecting a single </p>
<p>DTC with function</p>
<p> </p>
<p>Dem_SelectDTC()</p>
<p>.</p>
<p> </p>
<p>Table 8-3 </p>
<p>Limitations   </p>
<p><b>8.4 </b></p>
<p><b>Not Supported Service Interfaces </b></p>
<p>The following table contains service interfaces which are not supported from Dem. </p>
<p><b>Port </b></p>
<p><b>Operation(s) </b></p>
<p>AgingCycle </p>
<p>SetAgingCycleState </p>
<p>ExternalAgingCycle </p>
<p>SetAgingCycleCounterValue </p>
<p>PowerTakeOff </p>
<p>SetPtoStatus </p>
<p>Table 8-4  </p>
<p>Service Interfaces which are not supported </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>203 </p>
<p>based on template version 5.0.0 </p>
<p>  </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>204 </p>
<p>based on template version 5.0.0 </p>
<p><b>9 </b></p>
<p><b>Glossary and Abbreviations </b></p>
<p><b>9.1 </b></p>
<p><b>Glossary </b></p>
<p><b>Term </b></p>
<p><b>Description </b></p>
<p>DaVinci Configurator 5 </p>
<p>Configuration and code generation tool for MICROSAR components </p>
<p>Combined Event </p>
<p>The combination of multiple events into a combined status. </p>
<p>Warning Indicator </p>
<p>The warning indicator managed by the Dem only provides the </p>
<p>information that the related indicator (e.g. lamp in the dashboard) shall </p>
<p>be requested, the de-/activation must be handled by the application or a </p>
<p>different ECU.  </p>
<p>Each event that currently requests an indicator will have set the warning </p>
<p>indicator requested bit in the status byte. </p>
<p>Table 9-1  </p>
<p>Glossary </p>
<p><b>9.2 </b></p>
<p><b>Abbreviations </b></p>
<p><b>Abbreviation </b></p>
<p><b>Description </b></p>
<p>API </p>
<p>Application Programming Interface </p>
<p>AUTOSAR </p>
<p>Automotive Open System Architecture </p>
<p>AWL </p>
<p>Amber Warning Lamp  </p>
<p>BSW </p>
<p>Basic Software </p>
<p>BSWMD </p>
<p>Basic Software Module Description </p>
<p>Cfg5 </p>
<p>DaVinci Configurator 5 </p>
<p>CPU </p>
<p>Central Processing Unit </p>
<p>Dcm </p>
<p>Diagnostic Communication Manager </p>
<p>DCY </p>
<p>Driving Cycle </p>
<p>Dem </p>
<p>Diagnostic Event Manager </p>
<p>Det </p>
<p>Development Error Tracer </p>
<p>Dlt </p>
<p>Diagnostic Log and Trace </p>
<p>DTC </p>
<p>Diagnostic Trouble Code </p>
<p>EAD </p>
<p>Embedded Architecture Designer </p>
<p>ECU </p>
<p>Electronic Control Unit </p>
<p>EcuM </p>
<p>Ecu Manager </p>
<p>EEPROM </p>
<p>Electrically Erasable Programmable Read-Only Memory  </p>
<p>FDC </p>
<p>Fault Detection Counter </p>
<p>FEE </p>
<p>Flash EEPROM Emulation </p>
<p>GCE </p>
<p>Generic Content Editor </p>
<p>HIS </p>
<p>Hersteller Initiative Software </p>
<p>ID </p>
<p>Identification </p>
<p>ISR </p>
<p>Interrupt Service Routine </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>205 </p>
<p>based on template version 5.0.0 </p>
<p>MICROSAR </p>
<p>Microcontroller Open System Architecture (the Vector AUTOSAR </p>
<p>solution) </p>
<p>MIL </p>
<p>Malfunction Indicator Lamp </p>
<p>NVRAM </p>
<p>Non-volatile Random Access Memory </p>
<p>NvM </p>
<p>NVRAM Manager </p>
<p>OBD </p>
<p>On Board Diagnostics </p>
<p>OCC </p>
<p>Occurrence Counter </p>
<p>OS </p>
<p>AUTOSAR compliant Operating System </p>
<p>PL </p>
<p>Protect Lamp </p>
<p>PPort </p>
<p>Provided Port </p>
<p>RAM </p>
<p>Random Access Memory </p>
<p>ROE </p>
<p>Response On Event </p>
<p>ROM </p>
<p>Read-Only Memory </p>
<p>RPort </p>
<p>Required Port </p>
<p>RSL </p>
<p>Red Stop Lamp </p>
<p>Rte </p>
<p>Runtime Environment </p>
<p>SAE </p>
<p>Society of Automotive Engineers </p>
<p>SchM </p>
<p>Schedule Manager </p>
<p>SRS </p>
<p>Software Requirement Specification </p>
<p>SWC </p>
<p>Software Component </p>
<p>SWS </p>
<p>Software Specification </p>
<p>UDS </p>
<p>Unified Diagnostic Services </p>
<p>WUC </p>
<p>Warmup Cycle </p>
<p>Table 9-2  </p>
<p>Abbreviations </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR Diagnostic Event Manager (Dem) </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 7.6.1 </p>
<p>206 </p>
<p>based on template version 5.0.0 </p>
<p><b>10  Contact </b></p>
<p>Visit our website for more information on </p>
<p> </p>
<p><b>&gt; </b></p>
<p>News </p>
<p><b>&gt; </b></p>
<p>Products </p>
<p><b>&gt; </b></p>
<p>Demo software </p>
<p><b>&gt; </b></p>
<p>Support </p>
<p><b>&gt; </b></p>
<p>Training data </p>
<p><b>&gt; </b></p>
<p>Addresses </p>
<p> </p>
<p>www.vector.com </p>
<p> </p>
</body>
</html>
{% endraw %}